<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.3.0">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2022-11-17T21:40:05+09:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">LeeJellan</title><subtitle>안녕하세요!🙂 IT,여행,기타 등 기록을 남기기위한 블로그 입니다 !</subtitle><author><name>LEE JAEHYEOK</name></author><entry><title type="html">TIL) 인증, 보안 기초</title><link href="http://localhost:4000/til/2022/11/17/til.html" rel="alternate" type="text/html" title="TIL) 인증, 보안 기초" /><published>2022-11-17T00:00:00+09:00</published><updated>2022-11-17T00:00:00+09:00</updated><id>http://localhost:4000/til/2022/11/17/til</id><content type="html" xml:base="http://localhost:4000/til/2022/11/17/til.html"><![CDATA[<p>오늘은 드디어<br />
인증과 보안관련된 공부가 시작되었다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AJc5JmSK7Vlbd6P-ZA2TpRO9yTFxz9gH-OdxjYebZ6-r_KUFyGQiml5Hx8m6WodAQFCprhzYPGAg5SXnE-TkysLMqq-BedG44A=w1920-h864" alt="image" class="align-left" style="max-width: 50%" /></p>

<p>Spring Security, JWT, OAuth2 등<br />
여러가지를 배울 예정이고</p>

<p>가장 고전하는 영역이지 않을까 생각한다.</p>

<hr />

<p>오늘은 인증, 보안에 대한 기초를 먼저 파악하고<br />
내일부터 본격적인 Spring Security 사용법을 알아볼 것 같다.<br />
오늘은 기초인 HTTPS와 Hashing, Cookie, Session에 대해 알아보자</p>

<p><br /></p>

<h3 id="https">HTTPS</h3>

<p>우리가 여태까지 배웠기를 HTTP 프로토콜을 이용해<br />
TCP/IP 통신으로 서버와 연결할 수 있다고 공부를 했었다.<br />
HTTP Message를 통해 Json 객체를 받아보기도 하였다.</p>

<p>HTTPS의 Hyper Text Transfer Protocol Secure Socket layer의 약자다. <br />
보면 알 수 있듯이 기존의 <strong>HTTP + Secure Socket layer</strong>가 붙은 모습이다.<br />
HTTP 프로토콜을 보다 안전하게 요청을 주고 받기위해 SSL, TLS라는 알고리즘을 이용해 <br />
HTTP 통신을 하는 과정에서 데이터를 암호화하여 전송하는 방법이다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AJc5JmQ7kg8wBa9J9dzD10tI68mzIX9M97wYHvAyH-tNw-vTeDL5V8vTsTeX3a_QiO7FnYOL0DMp_w7JRIh9Jt27wXdEgUoDiw=w1510-h1614" alt="image" class="align-left" style="max-width: 100%" /><br />
HTTPS TLS HandShake (출처: <a href="https://www.cloudflare.com/ko-kr/learning/ssl/what-happens-in-a-tls-handshake">CLOUDFLARE 사이트 참조</a> )</p>

<p>해당 그림은 HTTPS의 통신 핸드쉐이크이다. <br />
클라이언트에서 접속요청이 왔을 때, 내부적으로 통신이되어지는 순서이다.</p>

<p>TCP 연결이 완료후 TLS 핸드쉐이크가 동작하는 모습을 볼 수 있고<br />
TLS 핸드쉐이크 내에서는 인증서, 대칭키, 비대칭키와 같은 암복호를 통해<br />
인증된 서버에 접속을 할 수 있게 확인을 해준다.</p>

<p>정말 간단하게 정리해보자면</p>

<p><strong><span style="color:#F04965">대칭키 </span>: 키 한개로 암복호를 한다.</strong><br />
<strong><span style="color:#F04965">비대칭키</span> : 암호화한 키와 복호화한키가 다르다.</strong></p>

<p>키의 종류로는 <strong>공개키(Public Key)</strong>와 <strong>개인키(Private Key)</strong>가 존재하고</p>

<p>대칭키 같은경우에는 공개키-공개키, 개인키-개인키로 암호화 복호화를 할 수 있고<br />
비대칭키 같은 경우에는 공개키-개인키, 개인키-공개키로 암호화 복호화를 할 수 있다.<br />
HTTPS TLS 핸드쉐이크는 대칭키,비대칭키를 둘다 사용한다.</p>

<p>여기서 비대칭키 같은 경우에는<br />
개인키로 암호화한것을 공개키로 복호화할 수 있는데, 목적은 인증서같은 누구나 볼 수 있는 정보고<br />
공개키로 암호화한것을 개인키로 복호화할 수 있는데, 목적은 정보보호와 외부의 탈취방지를 위한 것이다.</p>

<p>여기서 <strong>인증서</strong>라는 개념이나오는데<br />
이러한 인증서의 역할은 서버에서 인증서를 브라우저에게 보내주는데<br />
클라이언트에 접속한 곳이 정말 해당 서버와 일치하는지 보증해주는 장치이다.<br />
이러한 인증서를 관리해주는 공인된 기관들을<br />
Certificate Authority 라고하며 대표적으로 AWS가 있다.</p>

<p>TLS 핸드쉐이크를 정리해보자면</p>

<ol>
  <li>Client -&gt; Server에게 헬로 요청</li>
  <li>Server -&gt; Client 인증서를 포함해서 헬로 응답 (개인키로 암호화하여 전달)</li>
  <li>Client는 내장된 CA 리스트를 보고 인증서를 확인한다. (개인키-&gt;공개키 복호화)</li>
  <li>Client가 CA의 공개키로 복호화를 통해 인증서를 검증했다면 Client는 대칭키를 만든다.</li>
  <li>이 대칭키를 서버의 공개키로 암호화해서 Client -&gt; Server에 전달한다.</li>
  <li>그럼 Server는 서버의 개인키로 복호화하여 클라이언트의 대칭키를 확인한다. (공개키-&gt;개인키 복호화)</li>
  <li>Server -&gt; Client의 대칭키로 샘플 데이터를 암호화해서 클라이언트에게 보내서 확인한다.</li>
  <li>Client는 서버에게 받은 데이터를 대칭키로 복호화해서 서로 대칭키를 잘 가지고 있는지 확인한다</li>
  <li>이 후에는 Client와 Server는 서로 대칭키로 암호화와 복호화를 진행하여 데이터를 전송한다</li>
</ol>

<p>사실 이런 일련의 과정들은<br />
브라우저와 서버가 해당 과정을 대신 처리해주기 때문에<br />
개념과 순서정도만 이해하면 좋을 것 같다.</p>

<p><br /></p>

<h4 id="로컬-환경에서-테스트">로컬 환경에서 테스트</h4>
<p>그럼 로컬환경에서 인증서 발급과 <br />
Https 서버를 구현하는 간단한 예제를 살펴보자</p>

<p>우선 Tomcat WAS를 사용하기위해<br />
스프링부트로 프로젝트를 만들었고</p>

<p>로컬환경에서 인증서를 만들기위해 터미널로 mkcert를 설치해야한다.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>mkcert
</code></pre></div></div>
<p>homebrew를 이용해 mkcert 설치</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkcert <span class="nt">-install</span>
</code></pre></div></div>
<p>PKCS12 형식 인증서를 생성할 수 있도록 설치</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkcert <span class="nt">-pkcs12</span> localhost
</code></pre></div></div>
<p>내가 만든 프로젝트 resources 경로에서<br />
위의 명령어를 실행시켜 PKCS12 인증서를 생성해주면</p>

<p><br /></p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AJc5JmSGGxmFhNDI5InKLm5xBczg_DBOgwK4OJj_PGLONuWvOCIyDPyNnQBHZR2LmGmp5KEwzXwK3MxI2-ryG8RDepbN8HRYxw=w3024-h1614" alt="image" class="align-left" style="max-width: 50%" /></p>

<p>위와 같이 resources에 <br />
localhost.p12 인증서가 생긴다.</p>

<p>인증서가 생겼다면 application.properties 안에</p>
<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">server.ssl.key-store</span><span class="p">=</span><span class="s">classpath:localhost.p12</span>
<span class="py">server.ssl.key-store-type</span><span class="p">=</span><span class="s">PKCS12</span>
<span class="py">server.ssl.key-store-password</span><span class="p">=</span><span class="s">changeit</span>
</code></pre></div></div>
<p>와 같이 입력해주면 https로 서버를 사용가능하다.<br />
여기서 비밀번호는 초기해 셋팅을 하지않으면 changeit으로 입력하면된다.</p>

<p>그리고 스프링 애플리케이션을 실행시키면</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AJc5JmThmekJqkRGtjmJemxwLYuP9uTAyLwsOWuvrxTqsdCdOtk4pnyAXTjmlQ8MrR_5PaU4rYOu8DZll_u-Qvzy1E2s4UGW7A=w3024-h1614" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>사진과 같이 https로 서버 구현된 것을 확인할 수 있다.</p>

<p><br /></p>

<h3 id="hasing">Hasing</h3>
<p>어떤한 문자열에 임의의 연상을 적용하여 <br />
다른 문자열로 변환하는 것을 Hasing이라고 한다.</p>

<p>즉, 해싱한다는 의미는 어떠한 값을 암호화해준다 생각하면 될 것 같다.<br />
여기서 해싱의 특징을 적어보자면</p>

<ol>
  <li>모든 값에 대한 해시값을 계산하는데 오래걸리지 않아야한다.</li>
  <li>최대한 해시값을 피해야 하며, 모든 값은 고유한 해시값을 가진다.</li>
  <li>아죽 작은 단위의 변경이라도 완전히 다른 해시값을 가져야한다.</li>
</ol>

<h3 id="salt">Salt</h3>
<p>암호화해야 하는 값에 어떤 별도의 값을 추가하여 결과를 변형하는 것이다.<br />
영어로 소금이라는 뜻과 걸맞게 무언가 간을치는 느낌이라 생각하면 될 것 같다.</p>

<p>Salt의 큰 특징을 4가지 살펴보면</p>

<ol>
  <li>유저와 패스워드 별로 유일한 값을 가져야 한다.</li>
  <li>사용자 계정을 생성할 때와 비밀번호를 변경할 때 마다 새로운 임의의 Salt를 사용해서 해싱해야 한다.</li>
  <li>절대 재사용하지 말아야한다.</li>
  <li>DB의 유저테이블에 같이 저장 되어야한다.</li>
</ol>

<h3 id="cookie">Cookie</h3>

<p>쿠키는 서버가 웹 브라우저에 정보를 저장하고 불러올 수 있는 수단<br />
이라고 생각하면 간단할 것 같다.</p>

<p>우리가 이전에 배운 Http 프로토콜은<br />
무상태성(stateless)은 이전에 했던 작업에 대해 기억하지 않는 특성을 가지는데<br />
검색을 하려는데 검색목록이 아래 표시된다든지<br />
로그인 기억버튼을 눌러놓았는데 다음에 열어도 눌려져있다든지<br />
우리는 요청을 보낼때 무상태성으로 동작하기때문에 이러한 내용들을 기억하지 못 하는데<br />
브라우저에서 쿠키라는 것을 이용해 이러한 내용들을 저장해 사용할 수 있는 것이다.</p>

<p>한마디로 서버가 클라이언트에서 요청을 받고<br />
클라이언트쪽에 응답할때 쿠키에 데이터를 싦어서 보내면<br />
브라우저에서 쿠키값을 유지시키고 사용한다고 보면될 것 같다.</p>

<p>쿠키의 옵션으로는</p>

<p>domain - 서버와 요청의 도메인이 일치하는 경우 쿠키 전송<br />
path - 서버의 요청의 세부 경로가 일치하는 경우 쿠키 전송<br />
maxage/expires - 쿠키의 유효기간 설정<br />
httpOnly - 스크립트의 쿠키 접근 가능 여부 설정<br />
secure - HTTPS 에서만 쿠키 전송 여부 설정<br />
sameSite - 같은 사이트에서만 쿠키를 사용할 수 있게 하는 설정</p>

<h3 id="session">Session</h3>

<p>세션은 인증해주는 방법으로<br />
여러 페이지에 걸쳐 사용되는 사용자 정보를 저장하는 방법이다.</p>

<p>세션은 중요한 데이터를 서버에 저장하고 암호화된<br />
세션id를 쿠키에 담아 클라이언트에 전달하고<br />
세션id가 부여된 브라우저는 신분증같이 이를 이 유저는 인증에 성공했다고 알리며<br />
다른 요청을 보낼때 마다 해당 세선id로 인증을 거치며 사용할 수 있게된다.</p>

<p><br />
<br /></p>

<p><strong>쿠키와 세션의 비교</strong></p>

<table>
  <thead>
    <tr>
      <th> </th>
      <th style="text-align: center">Cookie</th>
      <th style="text-align: center">Seesion</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>설명</td>
      <td style="text-align: center">쿠키는 그저 http의 stateless<br />한 것을 보완해주는 도구</td>
      <td style="text-align: center">접속 상태를 서버가 가짐<br /> 접속 상태와 권환 부여를 위해<br />세션아이디를 쿠키로 전송</td>
    </tr>
    <tr>
      <td>접속 상태<br />저장 경로</td>
      <td style="text-align: center">클라이언트</td>
      <td style="text-align: center">서버</td>
    </tr>
    <tr>
      <td>장점</td>
      <td style="text-align: center">서버에 부담을 덜어줌</td>
      <td style="text-align: center">신뢰할 수 있는 유저인지 서버에서 확인</td>
    </tr>
    <tr>
      <td>단점</td>
      <td style="text-align: center">쿠키 그자체는 인증이 아님</td>
      <td style="text-align: center">하나의 서버에서만 접속 상태를 가지므로 <br />서버분산에 불리</td>
    </tr>
  </tbody>
</table>

<p><br /></p>

<hr />

<p>오늘은 이렇게 인증, 보안에 관한 <br />
간단한 CS 지식들을 공부해보았는데<br />
사실 처음 듣는 개념들이라 아직 어떻게 쓰이는지 감을 잡기가 어렵다.</p>

<p>이러한 것들이 있고 후에 학습하면서<br />
이렇게 사용하는구나를 깨닫고 내것으로 체득을 해야할 것 같다.</p>

<p>오늘 공부는 여기서 끝 !</p>

<p><br /></p>

<p><span style="color:#994C00"><strong>오늘의 커피량</strong></span>: ☕️ ☕️<br />
<strong>오늘의 점심</strong>: 라면, 김밥</p>]]></content><author><name>LEE JAEHYEOK</name></author><category term="TIL" /><category term="TIL" /><category term="부트캠프" /><category term="코드스테이츠" /><summary type="html"><![CDATA[오늘은 드디어 인증과 보안관련된 공부가 시작되었다.]]></summary></entry><entry><title type="html">TIL) 세달차 회고</title><link href="http://localhost:4000/til/2022/11/16/til.html" rel="alternate" type="text/html" title="TIL) 세달차 회고" /><published>2022-11-16T00:00:00+09:00</published><updated>2022-11-16T00:00:00+09:00</updated><id>http://localhost:4000/til/2022/11/16/til</id><content type="html" xml:base="http://localhost:4000/til/2022/11/16/til.html"><![CDATA[<p>어느덧 가을을 지나 겨울을 향해 달리고있다.<br />
시간은 멈추지 않는다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AJc5JmR16i01UpPNroUzNknMVxn4tsIkhDV6gkngKajpEaMzj2xJ4E5Vyez__5rtpW5xjh_1Acwk1IZjAcZmfys0znB7kYUlsA=w3024-h1728" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>내가 느끼는 한국사회에서의 시간은<br />
조금더 빠른 것 같다는 생각이드는 요즘.</p>

<p>공부에 대한 재미와 열망이 강해지고 있다.<br />
좋은 징조인 것 같다는 생각도들고, 공부하면할 수록 더욱더<br />
파고들어 알고싶다는 욕심이 가득해진다.</p>

<p>현재 단계에서 학습에 어느정도 방해가 되는 요소라고 생각한다.<br />
알면서도 한가지에 대해 계속 파다보니 다른 공부들을<br />
전부 학습하기에 시간이 많이 허비되고 비효율적이라는  점을 발견했다.</p>

<p>어느덧 개발공부한지 세달차가 되어버린<br />
나의 일상과 회고를 작성해보려한다.</p>

<hr />

<h3 id="내가-배운-것">내가 배운 것?</h3>
<p>지난 세달간 배운 것을 나열하자면<br />
엄청나게 많은 내용들이 있다.</p>

<p><img src="https://lh3.googleusercontent.com/drive-viewer/AJc5JmSXU951Um_58x0b3_0a2GfPEYsLXEs-jRIv8ABUveSo7Iw5c_T-fB_Qq0joTmnrxVKOQF2vwPY=w1512-h753" alt="image" class="align-left" style="max-width: 80%" /></p>

<p>Java와 JavaScrpit도 구분하지 못하는 내가<br />
어느덧 Java와 Spring Framework를 사용하고 있으니<br />
느리지만 대단한 발전이라고 생각한다.</p>

<p>이번 한달은 Spring에 대해 집중적으로 공부하는 시간이였다.<br />
Spring MVC, 애플리케이션 계층, Spring 예외처리,<br />
Spring JDBC,JPA,Transaction, JUnit, APi 문서 자동화 등<br />
기본적인 지식부터 Spring을 이용한 웹애플리케이션<br />
설계와 구현에 대한 전반적인 내용들을 다루어보았었다.</p>

<p>한달동안 정말이지 가장 유익했던 공부를 많이한 것 같다.  <br />
이유는 당연하게도 실무에서 사용되는 기술들을 배웠다는 점이 가장 컸고<br />
해당 기술로 어느정도 웹애플리케이션을 만드는 구조에대해 익힌 것 같아서이다.</p>

<p><br /></p>

<h3 id="세달-간-나의-루틴은">세달 간 나의 루틴은?</h3>
<p>인간이란 생물은 참 신기한 것 같다.<br />
복잡한 감정을 느끼게 되어 행복할 수도 불행할 수도 있는 것 같으니,,</p>

<p>이번달은 사실 가장 복잡한 감정을 많이 느낀 달이다.<br />
오랜기간 같은걸 반복하다보면 목표가 흐려지고 지치기 마련이다.<br />
나도 난이도가 증가하는 학습과 학습량 그리고 반복되는 일상에<br />
어느정도 번아웃이 왔었고, 마음가짐을 여러번 고쳐먹었었다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AJc5JmRlTDexto7K3zOvG3HYqMS_zovg7kMNMWV_JL6QzWm5fP4TRqS5b9iNtWo3ee1ln1iJUhg2uR-djF3gZupYtWSzYRNn=w3024-h1614" alt="image" class="align-left" style="max-width: 80%" /></p>

<p>세달 동안 거의 루틴이 동일하다.<br />
<strong>콘텐츠 학습(09:00~18:00) -&gt; 복습 및 TIL 작성(19:00~21:00) -&gt; 강의 공부 및 예습(21:00~)</strong><br />
위와 같은 루틴으로 계속 공부해왔고, 중간에 리프레쉬를 위해<br />
운동도 해보고 여러가지를 시도해보았지만, 침대에서 쉬었다가 <br />
다시 공부하는게 가장 나한테 집중을 할 수 있게 해주는 요인으로 확인했다.</p>

<p>강의는 주로 Infren 김영한님의 강의를 듣고있고<br />
지식적으로나 인간적으로 매우 배울점이 많은 분이신 것 같다는 생각이 든다.<br />
하신 말씀중에 너무나도 기억에 남는게</p>

<p>열정은 금방식는다. 무언가 도전을한다면<br />
몰입할 수 있는 시스템을 만들어서 거기에 나를 던지라는 말이 너무나도 와닿았다.  <br />
현재 내가 그런 상태이기 때문에, 열정보단 내가 공부하는<br />
루틴과 시스템을 만들어 잘 지키도록 노력을 해야겠다고 생각했고</p>

<p>나도 저렇게 멋지게 성장해야겠다는 마음을 항상 다지고있다.</p>

<p><br /></p>

<h3 id="다음달은-어떻게-보낼-것인가">다음달은 어떻게 보낼 것인가?</h3>

<p>지난 세달간 열심히 달려왔고<br />
항상 해오던 것들은 유지할 생각이다.</p>

<p>데일리 루틴으로 항상 하는것은</p>
<ol>
  <li>1일 1커밋하여 잔디심기 (의미있는 것들로)</li>
  <li>TIL 블로그 작성하기</li>
</ol>

<p>이렇게 2가지는 항상 해오고 있다.<br />
주말에는 못하더라도 부족했던 부분에 대한 복습과 프로젝트때<br />
필요할 것 같은 기술에 대한 예습을 주로하는 편이다.<br />
이 부분들은 나와 잘 맞는 것 같고, 성장에 도움이된다 생각하여<br />
매번 실천할 생각이다.</p>

<p>오랜 공부시간동안 운동을 나갔다오거나<br />
다른 것으로 리프레쉬하는 방법을 많이 취해보았는데<br />
크게 도움은 없다고 깨달았고, 누워서 정신을 맑게<br />
쉬는 것이 최고의 방법이라 생각하여 이 부분도 계속 이렇게 공부에<br />
집중할 수 있도록 유지할 생각이다.</p>

<p><br /></p>

<p>그리고 공부하면서 깨달은 안좋은 습관들을 발견했다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AJc5JmRpTAUYSI-GUgK5uUnr4WgRsY_BsNfK-teJ_Bu1og9-RxJlO8Q1HRRnCY01NZUpfNaJdscM7wwPNseuLvdUlc7ZLff_5w=w1920-h864" alt="image" class="align-left" style="max-width: 40%" /></p>

<ol>
  <li>공부중 카카오톡과 SNS를 수시로 들어간다.</li>
  <li>노래를 들으면서 공부한다.</li>
  <li>오늘 공부의 목표점에 도달하면 다음공부를 미룬다.</li>
</ol>

<p>처음에는 대수롭지 않게 생각하고 있던 습관들이다.<br />
최근에 공부를하면서 내집중을 흐리는데 가장 큰 역할을 한다고 생각했고 <br />
학교처럼 공부시간에 철저하게 시스템을 갖춰<br />
거기안에서 내가 실천할 수 있게끔 공부하는 방식으로 개선을 했다.</p>

<p>이 개선방법으로 계속 공부해나아갈 생각이고<br />
3번과 같은 경우, 다들 그런지는 모르겠지만… 오늘의 학습량을<br />
마치고 나면 그냥 시간이 남아도 쉬어버리는 문제가 있었다.</p>

<p>마음의 안심이랄까? 오늘할꺼 다했다! 라는 생각이 들어서<br />
공부를 안하게되어서, 억지로라도 인프런 강의를 켜서<br />
듣기 시작하다보니 이제 그 시간이 재밋어지기 시작하고있다.<br />
뭐든지 실천하는게 가장 어렵듯이 강의를 키기까지가 제일 어렵지만<br />
막상 키고나면 재밌어서 계속 듣게되는 효과가 있는 것 같다.</p>

<p><br /></p>

<p>그리고 가장 공부가 필요하다고 생각하는 부분이 드는게 있다.<br />
물론 현재 배우고있는 Spring 관련 공부는 계속해야하는 것이지만<br />
이제 슬슬 <strong>정규식관련 문법, 알고리즘 공부</strong>를 준비해야할 것 같다는 생각이든다.</p>

<p>다음달 학습을 어느정도 마친후<br />
알고리즘 공부도 체계적으로 진행해볼 예정이다.<br />
다양한 문제를 접하기 보다는, 한가지 유형의 문제를 많이 풀어<br />
먼저 익숙해지는 방법을 가지고 범위를 확장시켜 나아갈 생각이다.</p>

<p><br /></p>

<h3 id="마치며">마치며</h3>

<p>어렸을 때 부터, 여러가지를 많이 경험해보고 싶었고<br />
어떻게 하다보니까 지금에서야 개발자 준비를 하게되었다.</p>

<p>적지않은 나이에 준비를 시작하자니 불안감과 상대적 비교가<br />
나를 가장 불안하게 했던 달이었던 것 같다.</p>

<p>최근에 가장 감명깊게 보았던 것 중에서<br />
조금 오그라들거나 별거 아닌 것 처럼 느끼는 분들도 있을 것 같긴한데<br />
나한테는 큰 임펙트로 다가와서 얘기해보려한다.</p>

<p>내가 가장 많이하는 게임.. 리그오브레전드<br />
나 같은 겜돌이들은 당연히 이번년도에 열리는 결승전 경기를 보았을 거라 생각한다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AJc5JmTXoT1HvGMR6nEoy_n4kpu1lcISRNm8bgZN4eeS86_HASrkFdxrDDPt7RLkMKW6DR-q62hJyo-QTUpuNjaoKCC-c5o59w=w1920-h864" alt="image" class="align-left" style="max-width: 70%" /></p>

<p>DRX Deft 선수가 10년의 역경을 이기고 우승 트로피를 들어올리는 장면이다.<br />
아마 역대 가장 스토리가 좋은 결승전으로 꼽힐거고<br />
롤을하는 유저들이라면 백퍼센트 공감할 것 같다.</p>

<p>한국에서도 가장 낮은 시드로 월즈에 진출해<br />
가장 약한팀으로 평가받았고 누구도 우승할거라 예상하지 못했을 거다.<br />
결승하는 과정도 진짜 순탄치않았고, 나는 그과정들을 다챙겨 보았었다.</p>

<p>올라가는 과정 중 데프트 선수가 했던 얘기가 기사화 되어<br />
기사의 작명으로 <strong>‘중요한건 꺽이지 않는 마음’</strong> 이라는 말이 밈이되었고 명언이되었다.</p>

<p>누구에겐 장난처럼들리고 별 것 아닌 것 처럼 들릴 수 있겠지만<br />
지금 개발자로 커리어 전환하려는 나의 마음이 가볍지 않았기 때문에<br />
나에겐 이 문구가 꽤나 크게 다가왔다.</p>

<p>단순히 컨텐츠적으로 재미로 소모할 수 있었겠지만<br />
내 마음의 큰 변화가 생겼고, 그 동안 나는 너무 가볍게 공부하지 않았을까?<br />
정말 죽어라 고생하면서 공부하고있니? 라는 물음들이<br />
가슴속에 던져졌고 나는 이를 계기로 조금 더 성장하면서<br />
나아가야겠다는 마음을 가지게 된 것 같다.</p>

<p><br /></p>

<p>이상 세달차 공부 중인 <br />
나란 사람의 회고를 적어본다.</p>

<p><br /></p>]]></content><author><name>LEE JAEHYEOK</name></author><category term="TIL" /><category term="TIL" /><category term="부트캠프" /><category term="코드스테이츠" /><summary type="html"><![CDATA[어느덧 가을을 지나 겨울을 향해 달리고있다. 시간은 멈추지 않는다.]]></summary></entry><entry><title type="html">TIL) Application 빌드, 실행</title><link href="http://localhost:4000/til/2022/11/15/til.html" rel="alternate" type="text/html" title="TIL) Application 빌드, 실행" /><published>2022-11-15T00:00:00+09:00</published><updated>2022-11-15T00:00:00+09:00</updated><id>http://localhost:4000/til/2022/11/15/til</id><content type="html" xml:base="http://localhost:4000/til/2022/11/15/til.html"><![CDATA[<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gNq0VcIEmAZMz_1paQl-4m8_fIqcR-XIxlvy4GrezxEOvY6tzpT_1uI3JJK_XNFFzX3gFipA7DgprUqDMmQVqM19rSf8Q=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>오늘은 섹션 마지막날이다. <br />
벌써 3달째를 달리고 있는 부트캠프</p>

<p>확실히 혼자 공부하는 것보다 가이드라인이 제시되니<br />
스텝바이스텝으로 성장하는 모습이 눈에 보이니</p>

<p>만족스러운 나날을 보내고 있다.<br />
그럼에도 아직 새발의 피 정도만 공부했기에<br />
오늘도 공부를 시작해보자</p>

<hr />

<p>오늘은 애플리케이션 빌드하는 법을 알아보려한다.<br />
실제로 나중에 서버에 배포를 해야하기에 ..</p>

<h2 id="애플리케이션-빌드실행">애플리케이션 빌드/실행</h2>

<p>우리는 여태까지 IntelliJ IDE의 도움을 받아서<br />
빌드를 진행했었다.</p>

<p>IDE를 사용하지않고 로컬 환경이 아닌 서버환경에서 실행<br />
가능하게 하려면 Gradle이나 Maven같은 빌드 툴을 이용해서 Spring Boot<br />
기반의 애플리케이션 소스 코드를 빌드하는 기본적인 방법을 알고있어야한다.</p>

<p>우선 IDE를 이용해 빌드하는 방법을 알아보자<br />
(우리가 만든 프로젝트는 Gradle이다)</p>

<p><br /></p>

<h3 id="빌드">빌드</h3>

<p><strong>1). IDE를 통한 build</strong></p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gNkvOHRKiADoB4F8uygjnopOf4yqKRcMFN3Y0F47e49WVx74nLU_L3f20JxUX0AQCXTBFVgFD6JOgB04D4H2SxJJebxAw=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>내가 만든 프로젝트 이름 -&gt; Taske -&gt; bootJar or build 를<br />
더블 클릭해서 빌드해줄 수 있다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AJc5JmSjKwMt-ckmZXkOIp-tqZfr2mCjaNKgrTC6qMK0HNni9P8v92vYxD8qYjRGYLi0wIHQy-4Tf-ysvMVxchljPxkJPytO=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>빌드가 완료되면 Jar 파일이 생기는데<br />
여기서 plain.jar 파일은 build task를 실행하면 생기는 파일이다.<br />
우리는 실행 가능한 Jar 파일인 plain이 안붙은 파일을 실행시키면 된다.</p>

<p><br /></p>

<p><strong>2). 터미널로 build</strong></p>

<p>첫번째로 Gradle이 설치되어 있는지 확인해보자</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gradle <span class="nt">-v</span>
</code></pre></div></div>

<p>만약에 버젼이 안뜨고 zsh: command not found: gradle<br />
찾을 수 없다고 한다면, homebrew를 통해 gradle을 다운 받는다.</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>gradle
</code></pre></div></div>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">==&gt;</span> Downloading https://ghcr.io/v2/homebrew/core/openjdk/17/manifests/17.0.5
<span class="c">######################################################################## 100.0%</span>
<span class="o">==&gt;</span> Downloading https://ghcr.io/v2/homebrew/core/openjdk/17/blobs/sha256:0e2244e35a350256474b6eb6e03d11af5c0270ab7ca4e6bc71
<span class="o">==&gt;</span> Downloading from https://pkg-containers.githubusercontent.com/ghcr1/blobs/sha256:0e2244e35a350256474b6eb6e03d11af5c0270
<span class="c">######################################################################## 100.0%</span>
<span class="o">==&gt;</span> Downloading https://ghcr.io/v2/homebrew/core/gradle/manifests/7.5.1_1
<span class="c">######################################################################## 100.0%</span>
<span class="o">==&gt;</span> Downloading https://ghcr.io/v2/homebrew/core/gradle/blobs/sha256:b8a590221ce177514ddff10c925b892ee856b9a23cc28dc623124b
<span class="o">==&gt;</span> Downloading from https://pkg-containers.githubusercontent.com/ghcr1/blobs/sha256:b8a590221ce177514ddff10c925b892ee856b9
<span class="c">######################################################################## 100.0%</span>
<span class="o">==&gt;</span> Installing dependencies <span class="k">for </span>gradle: openjdk@17
<span class="o">==&gt;</span> Installing gradle dependency: openjdk@17
<span class="o">==&gt;</span> Pouring openjdk@17--17.0.5.arm64_monterey.bottle.tar.gz
🍺  /opt/homebrew/Cellar/openjdk@17/17.0.5: 642 files, 307MB
<span class="o">==&gt;</span> Installing gradle
<span class="o">==&gt;</span> Pouring gradle--7.5.1_1.all.bottle.tar.gz
🍺  /opt/homebrew/Cellar/gradle/7.5.1_1: 11,340 files, 276.1MB
<span class="o">==&gt;</span> Running <span class="sb">`</span>brew cleanup gradle<span class="sb">`</span>...
Disable this behaviour by setting HOMEBREW_NO_INSTALL_CLEANUP.
Hide these hints with HOMEBREW_NO_ENV_HINTS <span class="o">(</span>see <span class="sb">`</span>man brew<span class="sb">`</span><span class="o">)</span><span class="nb">.</span>
<span class="o">==&gt;</span> <span class="sb">`</span>brew cleanup<span class="sb">`</span> has not been run <span class="k">in </span>the last 30 days, running now...
</code></pre></div></div>

<p>이렇게 다운 받고 난뒤에 다시<br />
버젼을 체크해보면 설치된 모습을 확인해 볼 수 있다.</p>

<p><br /></p>

<p>이제 Gradle이 설치되었으니<br />
우리가 만든 애플리케이션 폴더에 들어가서<br />
아래와 같이 빌드 명령어를 입력해 주면 빌드가 되어진다.</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./gradlew build
</code></pre></div></div>

<p><strong>zsh: permission denied: ./gradlew</strong><br />
만약 명령어 입력시 위에처럼 권한 문제가 발생한다면</p>

<p>gradlew의 권한을 644 -&gt; 755로 변경해주어야한다.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ll
</code></pre></div></div>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">-rwxr-xr-x</span>   1 ljh  staff   7.9K 11 15 10:44 gradlew
</code></pre></div></div>
<p>현재 경로에서를 ll을 입력하여 권한 상태를 확인할 수 있다.<br />
ls -l 을 입력하여도 확인이 가능하다</p>

<p>rwx : 7<br />
r-x : 5<br />
r-x : 5<br />
와 같이 권한을 변경해주어야 하며</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chmod </span>755 gradlew
</code></pre></div></div>
<p>권한 변경 명령어인 chmod로 권한을 변경해주면</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./gradlew build
</code></pre></div></div>
<p>명령어가 정상적으로 빌드되어지는 모습을 확인할 수 있다.</p>

<p>빌드가 되어지면 위에 IDE를 통해 빌드했던 것 처럼<br />
build &gt; libs 폴더에 .jar 파일이 생기는 것을 확인할 수 있다.</p>

<p><br /></p>

<h3 id="실행">실행</h3>

<p><strong>터미널로 Jar 파일 실행시키기</strong></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java <span class="nt">-jar</span> section3-week3-template-build-0.0.1-SNAPSHOT.jar
</code></pre></div></div>
<p>기본적으로 .jar파일을 실행시키려면<br />
java -jar을 입력후 파일이름을 넣어주면<br />
애플리케이션이 IDE에서 실행되는 것 처럼 실행되는 모습을<br />
터미널에서 확인할 수 있다.</p>

<p><br /></p>

<p><strong>프로파일(Profile) 적용</strong></p>

<p>프로파일 적용이란.<br />
우리는 로컬환경에서 테스트하기위해 H2 DataBase를 주로 사용해왔다.<br />
하지만 서버에 배포하거나 실제 애플리케이션을 적용하는 DataBase는<br />
다른 DataBase가 올 수 있다. 그렇자고 기존에 설정한 H2 관련<br />
데이터를 서버에 올릴때 일일이 지워서 하기에는 불편함이 있어<br />
동시에 사용할 수 있도록 Spring에서는 프로파일(Profile)이라는 기능을 제공해준다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gNVRhs0fF44pgVaBPKUdF2aVOB9HWNny4_gw6wyvlz5td8IXIw3uhTQZuQhQJkFevEKtgvFCnFhwKgV9SJsZdlar03AUA=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>우선 .yml 파일을 분리해주어야한다.</p>

<p>application.yml<br />
application-local.yml<br />
application-server.yml</p>

<p>이렇게 세개로 분리해주었고 기존에 빌드시 사용하는 yml 파일은<br />
application.yml 파일이다.   해당 파일에는 아무런 코드도 넣지 않았고</p>

<p>우리는 애플리케이션을 실행할 때 설정에 따라 local.yml, server.yml로<br />
변경해가면서 사용이 가능하다.</p>

<p>local.yml -&gt; h2 정보<br />
server.yml -&gt; mysql 정보<br />
나는 위와 같이 등록해놓고 사용하였다.</p>

<p>mysql을 사용한다고 가정하고 설정을 진행해보자</p>

<p><strong>1). yml 설정 변경</strong></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">spring</span><span class="pi">:</span>
  <span class="na">profiles</span><span class="pi">:</span>
    <span class="na">active</span><span class="pi">:</span> <span class="s">server</span>
</code></pre></div></div>
<p>application.yml 파일에 위와 같이 설정해주면 된다.</p>

<p><br /></p>

<p><strong>2). 구성 편집</strong></p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AJc5JmTrEQ-vD2xirlKWhVpEcb96S87oR1s3Wjb2F_-Xup3XvpXxN0yvNE4Mbe2s79htd5-npeN9wfiVaA8Fow_bGjK8Q1yE=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>IDE의 구성 편집에서도 수정할 수 있다.<br />
애플리케이션을 선택 후</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>--spring.profiles.active=server
</code></pre></div></div>

<p>위와 같이 입력해주면 된다.</p>

<p><br /></p>

<p>설정을 끝냈으면 이제 .jar 파일을 실행시키면 된다.<br />
기존과 동일하게 실행 시키는데 뒤에<br />
–spring.profiles.active=server 를 추가해주고 실행시키면된다.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java <span class="nt">-jar</span> section3-week3-homework-build-0.0.1-SNAPSHOT.jar <span class="nt">--spring</span>.profiles.active<span class="o">=</span>server
</code></pre></div></div>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gPsLVoNTpjR8xJLJAwP4xyDmw8zjaz0XeAdt4QomyJV1uM0dEzTKpcIzikSqw5TAHr1AJt4hrgO47p_ZBfQ-nSK6-9L=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>실행 시킬 경우</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The following 1 profile is active: "server"
</code></pre></div></div>

<p>위와 같은 profile 문구가 발생한다면<br />
정상적으로 연결이 되어졌다는걸 확인할 수 있다.</p>

<p><br /></p>

<h3 id="오늘-만난-error">오늘 만난 ERROR</h3>

<p>오늘 만난 에러중 dataSource 관련 에러가 발생했었다.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'dataSource' defined in class path resource 
[org/springframework/boot/autoconfigure/jdbc/DataSourceConfiguration$Hikari.class]: Bean instantiation via factory method failed; nested exception 
is org.springframework.beans.BeanInstantiationException: Failed to instantiate [com.zaxxer.hikari.HikariDataSource]: Factory method 'dataSource' 
threw exception; nested exception is java.lang.IllegalStateException: Cannot load driver class: com.mysql.cj.jdbc.Driver
</code></pre></div></div>

<p>해당 내용은 의존라이브러리가 제대로 추가되어있지 않아<br />
읽어오지 못하는 현상 같았고</p>

<p>mysql 과 연동하기 때문에 msql 의존라이브러리를 추가하였고</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// mysql 의존라이브러리 추가
runtimeOnly 'mysql:mysql-connector-java'
</code></pre></div></div>

<p>의존 라이브러리 추가후</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gMae5HizPF6syR7eBuQLmncWHLBOE-0y7fGS6RiuafbOdpIvYrLsxbcRv0EYY1bWe3X9WHdhj0HgRifbnEzk-a7Q04Z=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>위와 같이 라이브러리 패키지가 생기면<br />
해당 오류는 해결이 가능할 것 이다.</p>

<hr />

<p>오늘은 이렇게 터미널로 build 하는 법과 execution 하는<br />
방법을 알아 보았다. 아마도 나중에 서버에 이런식으로<br />
애플리케이션을 실행 시켜놓고 운영하는게 아닐까? 라는 생각을 해본다.</p>

<p>오늘 공부도 여기서 끝 !!</p>

<p><br /></p>

<p><span style="color:#994C00"><strong>오늘의 커피량</strong></span>: ☕️ ☕️ ☕️<br />
<strong>오늘의 점심</strong>: 김치찌개, 김밥</p>]]></content><author><name>LEE JAEHYEOK</name></author><category term="TIL" /><category term="TIL" /><category term="부트캠프" /><category term="코드스테이츠" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">Spring) MySQL Local 연동 하기</title><link href="http://localhost:4000/spring/2022/11/15/spring-mysql.html" rel="alternate" type="text/html" title="Spring) MySQL Local 연동 하기" /><published>2022-11-15T00:00:00+09:00</published><updated>2022-11-15T00:00:00+09:00</updated><id>http://localhost:4000/spring/2022/11/15/spring-mysql</id><content type="html" xml:base="http://localhost:4000/spring/2022/11/15/spring-mysql.html"><![CDATA[<p>오늘은 Spring을 이용해 MySQL을 Local 환경에서<br />
연결하여 사용해보려고한다.</p>

<p>기존에 H2를 사용해 테스트를 진행했었고 JPA를 사용하기때문에  <br />
저장소만 바꿔주는 테스트를 해보려는 것이다.</p>

<p>MySQL WorkBench GUI로 작업하였고<br />
리소스는 .yml 파일을 사용했다.</p>

<p>개발환경에 따른 MySQL 설치와 사용환경은 준비되어있다고 가정하겠다.</p>

<p><br /></p>

<p>1). bulid.gradle 설정</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>runtimeOnly 'mysql:mysql-connector-java'
</code></pre></div></div>

<p>첫번째로 의존라이브러리를 추가해줘야한다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AJc5JmT3UmG6D9zRRTBuGTrPPBn1AMzOguxqyJyTCiPbwzSnqYvkwa2lcq7zFy-3TB1VCBhRhCBXyPGBvN2KxBkWBnjq3NhY9Q=w3024-h1614" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>추가하고 Gradle Reload를 할 경우 위와 같이<br />
라이브러리 패키지가 생기는 것을 확인할 수 있다.</p>

<p><br /></p>

<p>2). .yml 파일 설정</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">spring</span><span class="pi">:</span>
  <span class="na">jpa</span><span class="pi">:</span>
    <span class="na">hibernate</span><span class="pi">:</span>
      <span class="na">ddl-auto</span><span class="pi">:</span> <span class="s">create-drop</span>  <span class="c1"># 스키마 자동 생성</span>
    <span class="na">show-sql</span><span class="pi">:</span> <span class="no">true</span>      <span class="c1"># SQL 쿼리 출력</span>
    <span class="na">properties</span><span class="pi">:</span>
      <span class="na">hibernate</span><span class="pi">:</span>
        <span class="na">format_sql</span><span class="pi">:</span> <span class="no">true</span>  <span class="c1"># SQL pretty print</span>
  <span class="na">datasource</span><span class="pi">:</span>
    <span class="na">driver-class-name</span><span class="pi">:</span> <span class="s">com.mysql.cj.jdbc.Driver</span>
    <span class="na">url</span><span class="pi">:</span> <span class="s">jdbc:mysql://localhost:포트넘버/스키마이름?serverTimezone=Asia/Seoul</span> <span class="c1"># 포트넘버, 스키마이름</span>
    <span class="na">username</span><span class="pi">:</span>  <span class="c1"># 유저네임</span>
    <span class="na">password</span><span class="pi">:</span>  <span class="c1"># 비밀번호</span>
</code></pre></div></div>

<p>두번째로 연결을위한 .yml파일 설정이다.<br />
프로젝트 이름 &gt; main &gt; resources 에서 확인이 가능하고<br />
properties 확장자를 application.yml로 변경하였다.</p>

<p>spring : <br />
jpa : <br />
에 해당하는 부분은 jpa관련 설정이다.</p>

<p>우리가 봐야할 부분은<br />
spring :<br />
datasource :<br />
이부분이고 해당 부분에 MySQL 설정 정보를 넣어줘야한다.</p>

<p>넣어줘야할 정보는 4가지 이다.</p>
<ol>
  <li>포트넘버</li>
  <li>스키마 이름</li>
  <li>유저네임</li>
  <li>비밀번호</li>
</ol>

<p>이렇게 총 4가지의 정보를 넣어주면 되고 헷갈리는 분들을 위해<br />
아래에 어디서 찾는지 적어보겠다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AJc5JmTQ8kpsyLHOtqRJe4AWUM2aNJaivLTPJXYRrN0ouL1c4O408flzunjeHgxsWpz-ciRq_28B1-XViwZ9D2zNRMJFtVTE=w1512-h807" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>워크밴치(MySQL WorkBench)를 열어보면<br />
커넥션에 관한 정보가 나온다.<br />
없으면 연결을 한번도 하지 않은 것이기에<br />
커넥션을 만들어주면 된다.</p>

<p>커넥션을 더블클릭 해보자</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AJc5JmSYYNi9Ztave6ML9l2HlQz6N0L9Qp9hExMMGC6gWibCjaC77q3_Kr13n0i3FVaKMw3Uw7i2pJEffAYTGQbXcXNJs88a=w3024-h1614" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>더블클릭을 하면 위와같은 팝업창을 확인할 수 있다.<br />
여기서 주소는 localhost:3306 을 사용한다는 것을 알 수 있고<br />
비밀번호를 입력하면 해당 커넥션으로 접속이 가능하다.</p>

<p>여기서 알 수 있는 정보는</p>

<p><strong>포트넘버 = 3306<br />
유저네임 = root<br />
비밀번호 = 본인이 설정한 해당 비밀번호</strong></p>

<p>이렇게 알 수 있다.</p>

<p>그리고 접속을 한 다음에는</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AJc5JmTl-Yr7RL6BgRLfYwoprmSbmBdVuW57E1ZZZNHIkUzW7qSYqUYhsrV8oxAIaYAwRvmuBETxjvR-HdrKpeLwOww8acgNJQ=w3024-h1614" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>전체적인 화면을 볼 수 있는 Schemas에 들어가<br />
스키마를 생성해주면 된다.</p>

<p>생성한 스키마가 스키마이름이 되는 것이다.<br />
나는 example로 설정했고<br />
이렇게 최종적으로 4가지 정보를 알아볼 수 있었다.</p>

<p>이렇게 정리해서 정보를 적어보자면</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">datasource</span><span class="pi">:</span>
  <span class="na">driver-class-name</span><span class="pi">:</span> <span class="s">com.mysql.cj.jdbc.Driver</span>
  <span class="na">url</span><span class="pi">:</span> <span class="s">jdbc:mysql://localhost:3306/example?serverTimezone=Asia/Seoul</span> <span class="c1"># 포트:3306 , 스키마:example</span>
  <span class="na">username</span><span class="pi">:</span> <span class="s">root</span>  <span class="c1"># 유저네임</span>
  <span class="na">password</span><span class="pi">:</span> <span class="s">내 비밀번호</span> <span class="c1"># 비밀번호</span>
</code></pre></div></div>

<p>이렇게 설정할 수 있을 것이다.</p>

<p>여기서 비밀번호를 까먹은 사람들이 많은데.. 까먹지 않도록 유의하자<br />
처음에 mysql를 다운받고 설정한 비밀번호다.<br />
인터넷에 비밀번호 리셋 하는법 등이 있으니 참고해보자</p>]]></content><author><name>LEE JAEHYEOK</name></author><category term="Spring" /><category term="Spring" /><category term="mysql" /><summary type="html"><![CDATA[오늘은 Spring을 이용해 MySQL을 Local 환경에서 연결하여 사용해보려고한다.]]></summary></entry><entry><title type="html">TIL) API Documentation 2</title><link href="http://localhost:4000/til/2022/11/14/til.html" rel="alternate" type="text/html" title="TIL) API Documentation 2" /><published>2022-11-14T00:00:00+09:00</published><updated>2022-11-14T00:00:00+09:00</updated><id>http://localhost:4000/til/2022/11/14/til</id><content type="html" xml:base="http://localhost:4000/til/2022/11/14/til.html"><![CDATA[<p>한 주가 끝나고 새로운 주가 시작되었다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOXnXDoCRH7AtlOncucaI0nI7RqC9GMkm0ZG-VhgIXazy7m5tTSccABV_f-3G5RjFSfN1ojWWOJzPxeYeKp4Ycs2Ykj=w1920-h921" alt="image" class="align-left" style="max-width: 65%" /></p>

<p>Spring 핵심 기술을 배우는 섹션이 거의 막바지로 다가왔다.<br />
내가 사용할 수 있는 기술은 정말 적은 것 같은데</p>

<p>벌써 어느덧 섹션 끝에 다다르다니…<br />
시간이 진짜 빠르다고 느끼는 반면, 좀 더 열심히해서 <br />
지식을 채워 넣어야 내 목적지까지 도달할 수 있을 것 같다는 생각이 든다.</p>

<hr />

<p>오늘은 Spring Rest Docs를 활용해보는 시간이다.</p>

<p>저번주에 간단하게 사용방법을 배웠고<br />
오늘은 Controller의 모든 API를 문서화 시켜보려한다.</p>

<h2 id="api-자동-문서화-연습">API 자동 문서화 연습</h2>

<p>저번주에는 POST와 PACTH에 대한<br />
자동 문서화를 진행했다.</p>

<p>지금 만들고 있는 애플리케이션에서는 GET, DELETE<br />
API만 자동화 시켜주면 마무리가 된다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">mockito</span><span class="o">.</span><span class="na">BDDMockito</span><span class="o">.</span><span class="na">given</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">mockito</span><span class="o">.</span><span class="na">Mockito</span><span class="o">.</span><span class="na">doNothing</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">restdocs</span><span class="o">.</span><span class="na">mockmvc</span><span class="o">.</span><span class="na">RestDocumentationRequestBuilders</span><span class="o">.*;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">restdocs</span><span class="o">.</span><span class="na">request</span><span class="o">.</span><span class="na">RequestDocumentation</span><span class="o">.</span><span class="na">parameterWithName</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">test</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">result</span><span class="o">.</span><span class="na">MockMvcResultMatchers</span><span class="o">.</span><span class="na">jsonPath</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">test</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">result</span><span class="o">.</span><span class="na">MockMvcResultMatchers</span><span class="o">.</span><span class="na">status</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">restdocs</span><span class="o">.</span><span class="na">payload</span><span class="o">.</span><span class="na">PayloadDocumentation</span><span class="o">.*;</span> <span class="c1">//responseFields(); , fieldWithPath() 사용</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">restdocs</span><span class="o">.</span><span class="na">mockmvc</span><span class="o">.</span><span class="na">MockMvcRestDocumentation</span><span class="o">.</span><span class="na">document</span><span class="o">;</span> <span class="c1">// document();</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">restdocs</span><span class="o">.</span><span class="na">request</span><span class="o">.</span><span class="na">RequestDocumentation</span><span class="o">.</span><span class="na">pathParameters</span><span class="o">;</span> <span class="c1">// pathParameters();</span>
</code></pre></div></div>
<p>시작 전 우리가 사용하기 위한 기술에 대한<br />
import를 진행해준다.</p>

<p>유의 깊게 볼 것은 RestDocs 구성을 위한 API들이다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nd">@AutoConfigureRestDocs</span>
<span class="nd">@WebMvcTest</span><span class="o">(</span><span class="nc">MemberController</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@MockBean</span><span class="o">(</span><span class="nc">JpaMetamodelMappingContext</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DocumentationTest</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">MockMvc</span> <span class="n">mockMvc</span><span class="o">;</span>

    <span class="nd">@MockBean</span>
    <span class="kd">private</span> <span class="nc">MemberService</span> <span class="n">memberService</span><span class="o">;</span>

    <span class="nd">@MockBean</span>
    <span class="kd">private</span> <span class="nc">MemberMapper</span> <span class="n">mapper</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">Gson</span> <span class="n">gson</span><span class="o">;</span>
    
    <span class="o">...</span>
    
<span class="o">}</span>
</code></pre></div></div>
<p>기본적인 위존성 주입과 Class 애노테이션을 셋팅 한 다음<br />
Test 코드를 작성해 API 자동화하여 만들어 줄 수 있다.</p>

<p>@Test 코드 작성 시 우리가 이전 부터 학습해왔던<br />
Mockito를 이용해 Slice 계층별 테스트를 만들어 줄 수가 있다.</p>

<p>Controller의 계층 별 테스트를 위해<br />
Service영역과의 연결된 부분을 Mock 객체를 반환시켜<br />
실제 데이터가 들어간 것 처럼 테스트하는 방법이다.</p>

<p>내가 총 만들어야할 API는 3개이고<br />
멤버 조회, 멤버 전체조회, 멤버 삭제 이렇게 된다.</p>

<p><strong>1). GET</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">getMemberTest</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="nc">MemberDto</span><span class="o">.</span><span class="na">response</span> <span class="n">response</span> <span class="o">=</span> <span class="nc">StubData</span><span class="o">.</span><span class="na">MockMember</span><span class="o">.</span><span class="na">getSingleResponseBody</span><span class="o">();</span>
    <span class="kt">long</span> <span class="n">memberid</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getMemberId</span><span class="o">();</span>

    <span class="c1">// findMember(); Mock 처리하기 , 반환 필요x (새로운 객체)</span>
    <span class="n">given</span><span class="o">(</span><span class="n">memberService</span><span class="o">.</span><span class="na">findMember</span><span class="o">(</span><span class="nc">Mockito</span><span class="o">.</span><span class="na">anyLong</span><span class="o">())).</span><span class="na">willReturn</span><span class="o">(</span><span class="k">new</span> <span class="nc">Member</span><span class="o">());</span>

    <span class="c1">// memberToMemberResponse(); Mock 처리하기 , 반수필수 타입 = MemberDto.response</span>
    <span class="n">given</span><span class="o">(</span><span class="n">mapper</span><span class="o">.</span><span class="na">memberToMemberResponse</span><span class="o">(</span><span class="nc">Mockito</span><span class="o">.</span><span class="na">any</span><span class="o">())).</span><span class="na">willReturn</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>

    <span class="nc">ResultActions</span> <span class="n">actions</span> <span class="o">=</span> <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span>
            <span class="n">get</span><span class="o">(</span><span class="s">"/v11/members/{member-id}"</span><span class="o">,</span> <span class="n">memberid</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
    <span class="o">);</span>

    <span class="n">actions</span>
            <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">isOk</span><span class="o">())</span>
            <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.data.memberId"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="s">"1"</span><span class="o">))</span>
            <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.data.email"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="s">"dhfif718@gmail.com"</span><span class="o">))</span>
            <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.data.name"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="s">"이재혁"</span><span class="o">))</span>
            <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.data.phone"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="s">"010-1234-5678"</span><span class="o">))</span>
            <span class="o">.</span><span class="na">andDo</span><span class="o">(</span><span class="n">document</span><span class="o">(</span><span class="s">"get-findMember"</span><span class="o">,</span>
                    <span class="n">getRequestPreProcessor</span><span class="o">(),</span>
                    <span class="n">getResponsePreProcessor</span><span class="o">(),</span>
                    <span class="n">pathParameters</span><span class="o">(</span>
                            <span class="n">parameterWithName</span><span class="o">(</span><span class="s">"member-id"</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"회원 식별자"</span><span class="o">)</span>
                    <span class="o">),</span>
                    <span class="n">responseFields</span><span class="o">(</span>
                            <span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
                                    <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">OBJECT</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"결과 데이터"</span><span class="o">),</span>
                                    <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data.memberId"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">NUMBER</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"회원 식별자"</span><span class="o">),</span>
                                    <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data.email"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">STRING</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"이메일"</span><span class="o">),</span>
                                    <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data.name"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">STRING</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"이름"</span><span class="o">),</span>
                                    <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data.phone"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">STRING</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"전화 번호"</span><span class="o">),</span>
                                    <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data.memberStatus"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">STRING</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"회원 상태: 활동중/휴면상태/탈퇴상태"</span><span class="o">),</span>
                                    <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data.stamp"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">NUMBER</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"스탬프 갯수"</span><span class="o">)</span>
                            <span class="o">)</span>
                    <span class="o">)</span>
            <span class="o">));</span>
<span class="o">}</span>
</code></pre></div></div>
<p>크게 달라진점은 없다.<br />
andDo를 통해 검증과 동시에 API 자동화를 위한<br />
여러가지 파라미터들을 넘겨주고 있다.</p>

<p>GET 요청이기때문에 requestFields();에 대한<br />
작성은 따로하지 않았다.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"memberId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"email"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"dhfif718@gmail.com"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"이재혁"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"010-1234-5678"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"memberStatus"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"활동중"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"stamp"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p>최종 적으로 responseFields의 Json 형태는 위와 같이 이루어진다.<br />
현재는 data라는 Object안에 한종류의 데이터가 들어가 있다.</p>

<p><br /></p>

<p>만약 전체조회를 위해<br />
data안에 배열로 데이터가 존재한다면 어떻게<br />
표시를 해주어야할까?</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">responseFields</span><span class="o">(</span>
        <span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
                <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data.[].memberId"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">NUMBER</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"회원 식별자"</span><span class="o">),</span>
                <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data.[].email"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">STRING</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"이메일"</span><span class="o">),</span>
                <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data.[].name"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">STRING</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"이름"</span><span class="o">),</span>
                <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data.[].phone"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">STRING</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"전화 번호"</span><span class="o">),</span>
                <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data.[].memberStatus"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">STRING</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"회원 상태: 활동중/휴면상태/탈퇴상태"</span><span class="o">),</span>
                <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data.[].stamp"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">NUMBER</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"스탬프 갯수"</span><span class="o">),</span>
        <span class="o">)</span>
<span class="o">)</span>
</code></pre></div></div>
<p>responseFields의 위와 같이 data.[].을 이용해  <br />
배열에 해당하는 내용을 표시해줄 수 있다.</p>

<p>또한</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">responseFields</span><span class="o">(</span>
        <span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
                <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">ARRAY</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"결과 데이터"</span><span class="o">).</span><span class="na">optional</span><span class="o">(),</span>
                <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data[].memberId"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">NUMBER</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"회원 식별자"</span><span class="o">),</span>
                <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data[].email"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">STRING</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"이메일"</span><span class="o">),</span>
                <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data[].name"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">STRING</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"이름"</span><span class="o">),</span>
                <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data[].phone"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">STRING</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"전화 번호"</span><span class="o">),</span>
                <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data[].memberStatus"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">STRING</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"회원 상태: 활동중/휴면상태/탈퇴상태"</span><span class="o">),</span>
                <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data[].stamp"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">NUMBER</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"스탬프 갯수"</span><span class="o">),</span>
        <span class="o">)</span>
<span class="o">)</span>
</code></pre></div></div>
<p>위와 같이도 표기할 수 있다.</p>

<p>여기서 한가지 참고해야할 점은
JsonFieldType.OBJECT = data : {}<br />
JsonFieldType.ARRAY = data : []  <br />
과 같이 표기할 때 사용한다는 점이다.</p>

<p>하나의 멤버만 조회했을때 OBJECT를 사용한 이유와<br />
여러 멤버를 조회했을때 ARRAY를 사용한 이유이다.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"data"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"memberId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"email"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"dhfif718@gmail.com"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"이재혁"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"010-1234-5678"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"memberStatus"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"활동중"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"stamp"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
  </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"memberId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="nl">"email"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"tmdghwlq@naver.com"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"염승호"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"010-2000-4000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"memberStatus"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"활동중"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"stamp"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
  </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"memberId"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
    </span><span class="nl">"email"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"dragonwon@nate.com"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"정용원"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"phone"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"010-7777-4587"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"memberStatus"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"활동중"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"stamp"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
  </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>실제로 build하여 생성된 response-body를 확인해보면<br />
우리가 최종적으로 반환한 데이터에 따른 배열이<br />
위와 같이 잘표시되는 모습을 확인해 볼 수 있다.</p>

<p>이렇게 복잡한 구조의 Json형태일지라도<br />
배열에 대한 위치만 잘 지정해주면 @Test 컴파일시 정상적으로<br />
실행되어 스니핏이 잘 만들어 지는 것을 확인할 수 있다.</p>

<p><br /></p>

<p><strong>2). DELETE</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteMemberTest</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="kt">long</span> <span class="n">memberId</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>

    <span class="c1">// deleteMember(); Mock 처리하기, 반환타입 = void</span>
    <span class="n">doNothing</span><span class="o">().</span><span class="na">when</span><span class="o">(</span><span class="n">memberService</span><span class="o">).</span><span class="na">deleteMember</span><span class="o">(</span><span class="n">memberId</span><span class="o">);</span>

    <span class="nc">ResultActions</span> <span class="n">actions</span> <span class="o">=</span> <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span>
            <span class="n">delete</span><span class="o">(</span><span class="s">"/v11/members/{member-id}"</span><span class="o">,</span> <span class="n">memberId</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
    <span class="o">);</span>

    <span class="n">actions</span>
            <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">isNoContent</span><span class="o">())</span>
            <span class="o">.</span><span class="na">andDo</span><span class="o">(</span><span class="n">document</span><span class="o">(</span>
                    <span class="s">"delete-member"</span><span class="o">,</span>
                    <span class="n">getRequestPreProcessor</span><span class="o">(),</span>
                    <span class="n">getResponsePreProcessor</span><span class="o">(),</span>
                    <span class="n">pathParameters</span><span class="o">(</span>
                            <span class="n">parameterWithName</span><span class="o">(</span><span class="s">"member-id"</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"회원 식별자"</span><span class="o">)</span>
                    <span class="o">)</span>
            <span class="o">));</span>
<span class="o">}</span>
</code></pre></div></div>
<p>Delete는 사실 더욱더 간단하다.<br />
requestFields와 responseFields의 따로 만들어줄<br />
필요가 없기 때문에 parameter에 대한 API 내용만 적어주면된다..</p>

<p>이렇게 오늘은 GET,DELETE에 대한<br />
API 문서 자동화를 진행했다.</p>

<p><br /></p>

<h2 id="오늘-마주한-error">오늘 마주한 ERROR</h2>

<p>1). 문제 확인<br />
GET, DELETE에 대한 테스트케이스는 통과한 상태로<br />
gradle build하는 과정 중 문제가 발생했다.</p>

<p>첫번째는 아래와 같은 오류 코드가 발생</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">There</span> <span class="n">were</span> <span class="n">failing</span> <span class="n">tests</span><span class="o">.</span> <span class="nc">See</span> <span class="n">the</span> <span class="n">report</span> <span class="nl">at:</span> <span class="nl">file:</span><span class="c1">///Users/ljh/Desktop/myprogram/CodeStates/be-homework-api-documentation/build/reports/tests/test/index.html</span>
</code></pre></div></div>

<p>두번째는 resources의 index.html 파일이 생기지 않았다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gMjr35Sq1Q_a5w8FeW6-h0MrJhp27At6mtmeNDPdy7Vt_Ypfia_OLvp8OjFswdwaRI3nxa-Cvww99s3zBMEEy_jQBxi=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>첫번째 문제로 인해 파일 생성이 되지 않은 듯 했다.</p>

<p><br /></p>

<p>2). 문제 해결<br />
첫번째 오류 코드를 천천히 보니  테스트를 실패했으니<br />
해당경로에 들어가서 보라는 것 같았다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gNEdF_s4q2MG1_Td-VloiVybdGvYGUqHewVUU_L9Rbbqq45xouzGpvldtATTmL0KjTJ9V_ds1JEsC8_UclbIK5tZVMOgg=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>해당 경로에 들어가서 index.html 파일을 열어보았다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gMAh6qcJXhFrBUv5fVdmlay6LC7TIDSpP9naAOl97GCFV9bR5kjFhWtyExFHdc_m0yiA8zkbZYSHda_SyeuxH_TbW84=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>열어보았더니 Test Summary라는<br />
테스트 결과에 대한 요약을 나타내주는 화면이 있었고</p>

<p>MemberControllerTest4의 getMembersTest() 메서드가<br />
테스트를 통과하지 못했구나라고 알아차렸다.</p>

<p>해당 문제는 내가 GET, DELETE를 추가하면서<br />
기존에 둔 테스트코드에 영향이 갔었고<br />
오류를 수정하고 다시 gradle build를 하니</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gMIqLDdClsJaEodvMjJXyFMOE1Ats6JM6us5Nwq8nB--Jr620vXRnfWD_RaqptDSvECTD2WLT4H7bNj9_9dGzzC7tDn=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>index.hmtl 파일이 생성된 모습을 확인할 수 있다 !!</p>

<hr />

<p>오늘은 API 자동화를 위한<br />
Spring Rest Docs를 연습해보는 시간을 가졌다.<br />
이런식으로 테스트코드와 연결해<br />
API 문서를 만들 수 있다는게 너무 좋은 기술인 것 같다는 생각이든다.</p>

<p>사실 이전까지만해도 수동으로 사람이 다적어서 관리하는 줄 알았는데<br />
이렇게 좋은 방법으로 관리를 할 수 있다는 점에서<br />
좋은 기술을 배운 것 같아 뿌듯한 느낌이 들었다.</p>

<p>오늘 공부도 여기서 끝 !!</p>

<p><br /></p>

<p><span style="color:#994C00"><strong>오늘의 커피량</strong></span>: ☕️ ☕️ ☕️<br />
<strong>오늘의 점심</strong>: 삼겹살, 라면, 밥</p>]]></content><author><name>LEE JAEHYEOK</name></author><category term="TIL" /><category term="TIL" /><category term="부트캠프" /><category term="코드스테이츠" /><summary type="html"><![CDATA[한 주가 끝나고 새로운 주가 시작되었다.]]></summary></entry><entry><title type="html">TIL) API Documentation 1</title><link href="http://localhost:4000/til/2022/11/11/til.html" rel="alternate" type="text/html" title="TIL) API Documentation 1" /><published>2022-11-11T00:00:00+09:00</published><updated>2022-11-11T00:00:00+09:00</updated><id>http://localhost:4000/til/2022/11/11/til</id><content type="html" xml:base="http://localhost:4000/til/2022/11/11/til.html"><![CDATA[<p>요번주도 한주가 지나간다.<br />
얼마 공부한 것 같은느낌이 아닌데 벌써<br />
월요일이지나 금요일이 되었다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AJc5JmQk4K8CSftTVVdvYx3CCxrYZD4T2BrAhtXL4imWit5EO503BT7GHs58m2U-u9Ff8-jqsP6WkToRyaKKm_g388y_S6IT=w3024-h1620" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>저번주에 본 리그오브레전드 월즈 결승전을 감명깊게 보아서 그런지  <br />
내 마음 한켠에 불안하고 안정적이지 못한 지금의 삶에<br />
많이 지쳐하고 있었는데, 많은 위로가 되었다.</p>

<p>‘중요한건 꺽이지 않는 마음’ 참 잘 만든 문구인 것 같다.<br />
나도 꺽이지 않고 나아가는 모습을 발견할 수있도록<br />
더욱더 노력해보아야겠다.</p>

<hr />
<p>3일간 JUnit에 대한 공부를 했다. <br />
여러 API를 사용해보면서 계층별로 단독으로<br />
테스트할 수 있는 Mockito라는 좋은 API를 배웠다.</p>

<p>오늘은 이것에 연장선상인 API 문서화에 대해 공부해보는 날이다.</p>

<p><br /></p>

<h2 id="spring-rest-docs">Spring Rest Docs</h2>

<p>API 문서화라고하면<br />
클라이언트에서 REST API 백엔드 애플리케이에<br />
요청을 전송하기 위해서 알아 되는 요청 정를 문서로 정리한 것이다.<br />
(URI, request body, query parameter 등..)</p>

<p>Spring Rest Docs는 이 문서를 자동으로 만들어주는 API이다.<br />
기존에는 Swagger 오픈 API를 많이 이용하였다고 한다.</p>

<p>Spring Rest Docs 문서 생성 흐름<br />
테스트 코드 작성</p>
<ol>
  <li>test 테스크 실행</li>
  <li>테스트 결과 Passed / Failed 1번으로 복귀</li>
  <li>API 문서 스니펫 생성(.adoc)</li>
  <li>API 문서 생성(.adoc)</li>
  <li>API 문서 -&gt; HTML로 변환</li>
</ol>

<p>위와 같은 흐름으로 API 문서가 생성되며<br />
테스트 케이스에 통과한 테스트의 API 문서 <strong>스니핏</strong>이 생성된다.<br />
*스니핏: 문서의 일부 조각이라 생각하면 된다.</p>

<p>Spring Rest Docs를 사용하기 위해 사전 작업을 하여야한다.<br />
build.gradle의 설정해주자</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plugins</span> <span class="o">{</span>
	<span class="n">id</span> <span class="s">"org.asciidoctor.jvm.convert"</span> <span class="n">version</span> <span class="s">"3.3.2"</span>
        <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>

<span class="n">ext</span> <span class="o">{</span>
	<span class="n">set</span><span class="o">(</span><span class="err">'</span><span class="n">snippetsDir</span><span class="err">'</span><span class="o">,</span> <span class="n">file</span><span class="o">(</span><span class="s">"build/generated-snippets"</span><span class="o">))</span>    <span class="c1">// 스니펫 생성 경로 설정</span>
<span class="o">}</span>

<span class="n">configurations</span> <span class="o">{</span>
	<span class="n">asciidoctorExtensions</span> <span class="c1">// AsciiDoctor 의존그룹 지정            </span>
<span class="o">}</span>

<span class="n">dependencies</span> <span class="o">{</span>
    <span class="c1">// 의존라이브러리 추가 </span>
	<span class="n">testImplementation</span> <span class="err">'</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">restdocs</span><span class="o">:</span><span class="n">spring</span><span class="o">-</span><span class="n">restdocs</span><span class="o">-</span><span class="n">mockmvc</span><span class="err">'</span>                         
	<span class="n">asciidoctorExtensions</span> <span class="err">'</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">restdocs</span><span class="o">:</span><span class="n">spring</span><span class="o">-</span><span class="n">restdocs</span><span class="o">-</span><span class="n">asciidoctor</span><span class="err">'</span>
        <span class="o">...</span>
<span class="o">}</span>

<span class="c1">// test task실행 시, API 문서 생성 스니핏 경로를 설정</span>
<span class="n">tasks</span><span class="o">.</span><span class="na">named</span><span class="o">(</span><span class="err">'</span><span class="n">test</span><span class="err">'</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">outputs</span><span class="o">.</span><span class="na">dir</span> <span class="n">snippetsDir</span>
	<span class="nf">useJUnitPlatform</span><span class="o">()</span>
<span class="o">}</span>

<span class="c1">// Asciidoctor 기능을 사용하기 위한 설정</span>
<span class="n">tasks</span><span class="o">.</span><span class="na">named</span><span class="o">(</span><span class="err">'</span><span class="n">asciidoctor</span><span class="err">'</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">configurations</span> <span class="s">"asciidoctorExtensions"</span>
	<span class="n">inputs</span><span class="o">.</span><span class="na">dir</span> <span class="n">snippetsDir</span>
	<span class="n">dependsOn</span> <span class="n">test</span>
<span class="o">}</span>

<span class="c1">// index.html copy</span>
<span class="n">task</span> <span class="nf">copyDocument</span><span class="o">(</span><span class="nl">type:</span> <span class="nc">Copy</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">dependsOn</span> <span class="n">asciidoctor</span>         
	<span class="n">from</span> <span class="nf">file</span><span class="o">(</span><span class="s">"${asciidoctor.outputDir}"</span><span class="o">)</span>  
	<span class="n">into</span> <span class="nf">file</span><span class="o">(</span><span class="s">"src/main/resources/static/docs"</span><span class="o">)</span>  
<span class="o">}</span>

<span class="c1">// copyDocument가 먼저 실행되도록 설정</span>
<span class="n">build</span> <span class="o">{</span>
	<span class="n">dependsOn</span> <span class="n">copyDocument</span> 
<span class="o">}</span>

<span class="c1">// bootJar task 설정</span>
<span class="n">bootJar</span> <span class="o">{</span>
	<span class="n">dependsOn</span> <span class="n">copyDocument</span>   
	<span class="nf">from</span> <span class="o">(</span><span class="s">"${asciidoctor.outputDir}"</span><span class="o">)</span> <span class="o">{</span> 
		<span class="n">into</span> <span class="err">'</span><span class="kd">static</span><span class="o">/</span><span class="n">docs</span><span class="err">'</span>    
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>build.gradle 설정이 끝났다면 이제 코드를 작성해보자</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@WebMvcTest</span><span class="o">(</span><span class="nc">MemberController</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@MockBean</span><span class="o">(</span><span class="nc">JpaMetamodelMappingContext</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="c1">//@Transactional</span>
<span class="c1">//@SpringBootTest</span>
<span class="c1">//@AutoConfigureMockMvc</span>
<span class="nd">@AutoConfigureRestDocs</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberControllerRestDocsTest</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">MockMvc</span> <span class="n">mockMvc</span><span class="o">;</span>

    <span class="nd">@MockBean</span>
    <span class="kd">private</span> <span class="nc">MemberService</span> <span class="n">memberService</span><span class="o">;</span>

    <span class="nd">@MockBean</span>
    <span class="kd">private</span> <span class="nc">MemberMapper</span> <span class="n">mapper</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">Gson</span> <span class="n">gson</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postMemberTest</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">MemberDto</span><span class="o">.</span><span class="na">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MemberDto</span><span class="o">.</span><span class="na">Post</span><span class="o">(</span><span class="s">"dhfif718@naver.com"</span><span class="o">,</span> <span class="s">"이재혁"</span><span class="o">,</span> <span class="s">"010-1234-5678"</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">content</span> <span class="o">=</span> <span class="n">gson</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="n">post</span><span class="o">);</span>

        <span class="nc">MemberDto</span><span class="o">.</span><span class="na">response</span> <span class="n">responseDto</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MemberDto</span><span class="o">.</span><span class="na">response</span><span class="o">(</span>
                <span class="mi">1L</span><span class="o">,</span>
                <span class="s">"dhfif718@naver.com"</span><span class="o">,</span>
                <span class="s">"이재혁"</span><span class="o">,</span>
                <span class="s">"010-1234-5678"</span><span class="o">,</span>
                <span class="nc">Member</span><span class="o">.</span><span class="na">MemberStatus</span><span class="o">.</span><span class="na">MEMBER_ACTIVE</span><span class="o">,</span>
                <span class="k">new</span> <span class="nf">Stamp</span><span class="o">()</span>
        <span class="o">);</span>

        <span class="n">given</span><span class="o">(</span><span class="n">mapper</span><span class="o">.</span><span class="na">memberPostToMember</span><span class="o">(</span><span class="nc">Mockito</span><span class="o">.</span><span class="na">any</span><span class="o">(</span><span class="nc">MemberDto</span><span class="o">.</span><span class="na">Post</span><span class="o">.</span><span class="na">class</span><span class="o">))).</span><span class="na">willReturn</span><span class="o">(</span><span class="k">new</span> <span class="nc">Member</span><span class="o">());</span>
        <span class="n">given</span><span class="o">(</span><span class="n">memberService</span><span class="o">.</span><span class="na">createMember</span><span class="o">(</span><span class="nc">Mockito</span><span class="o">.</span><span class="na">any</span><span class="o">(</span><span class="nc">Member</span><span class="o">.</span><span class="na">class</span><span class="o">))).</span><span class="na">willReturn</span><span class="o">(</span><span class="k">new</span> <span class="nc">Member</span><span class="o">());</span>
        <span class="n">given</span><span class="o">(</span><span class="n">mapper</span><span class="o">.</span><span class="na">memberToMemberResponse</span><span class="o">(</span><span class="nc">Mockito</span><span class="o">.</span><span class="na">any</span><span class="o">(</span><span class="nc">Member</span><span class="o">.</span><span class="na">class</span><span class="o">))).</span><span class="na">willReturn</span><span class="o">(</span><span class="n">responseDto</span><span class="o">);</span>

        <span class="nc">ResultActions</span> <span class="n">actions</span> <span class="o">=</span> <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span>
                <span class="n">post</span><span class="o">(</span><span class="s">"/api/members"</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">contentType</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">content</span><span class="o">(</span><span class="n">content</span><span class="o">)</span>
        <span class="o">);</span>


        <span class="n">actions</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">isCreated</span><span class="o">())</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.data.email"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getEmail</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.data.name"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getName</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.data.phone"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getPhone</span><span class="o">()))</span>

                <span class="o">.</span><span class="na">andDo</span><span class="o">(</span><span class="n">document</span><span class="o">(</span>
                        <span class="s">"post-member"</span><span class="o">,</span>
                        <span class="n">getRequestPreProcessor</span><span class="o">(),</span>
                        <span class="n">getResponsePreProcessor</span><span class="o">(),</span>
                        <span class="n">requestFields</span><span class="o">(</span>
                                <span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
                                        <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"email"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">STRING</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"이메일"</span><span class="o">),</span>
                                        <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"name"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">STRING</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"이름"</span><span class="o">),</span>
                                        <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"phone"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">STRING</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"휴대폰 번호"</span><span class="o">)</span>
                                <span class="o">)</span>
                        <span class="o">),</span>
                        <span class="n">responseFields</span><span class="o">(</span>
                                <span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
                                        <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">OBJECT</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"결과 데이터"</span><span class="o">),</span>
                                        <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data.memberId"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">NUMBER</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"회원 식별자"</span><span class="o">),</span>
                                        <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data.email"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">STRING</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"이메일"</span><span class="o">),</span>
                                        <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data.name"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">STRING</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"이름"</span><span class="o">),</span>
                                        <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data.phone"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">STRING</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"휴대폰 번호"</span><span class="o">),</span>
                                        <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data.memberStatus"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">STRING</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"회원 상태"</span><span class="o">),</span>
                                        <span class="n">fieldWithPath</span><span class="o">(</span><span class="s">"data.stamp"</span><span class="o">).</span><span class="na">type</span><span class="o">(</span><span class="nc">JsonFieldType</span><span class="o">.</span><span class="na">NUMBER</span><span class="o">).</span><span class="na">description</span><span class="o">(</span><span class="s">"스탬프 갯수"</span><span class="o">)</span>
                                <span class="o">)</span>
                        <span class="o">)</span>
                <span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>기존 코드와 달라진점은 
@WebMvcTest(MemberController.class)          <br />
@MockBean(JpaMetamodelMappingContext.class)  <br />
어노테이션으로 변경하였다는 점이다.<br />
이전에 SpringBootTest와 AutoConfigureMockMvc를 사용했던 부분을<br />
변경하였다. WebMveTest로 변경 함으로써 Controller 계층에 사용하는<br />
Bean만 등록하기때문에 상대적으로 속도가 빠르다고 한다.</p>

<p>또한, @AutoConfigureRestDocs 어노테이션을 붙여주었고<br />
.andDo(docment())를 이용해 Rest Docs에 필요한 정보를 보내주었다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">restdocs</span><span class="o">.</span><span class="na">payload</span><span class="o">.</span><span class="na">PayloadDocumentation</span><span class="o">.*;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">restdocs</span><span class="o">.</span><span class="na">mockmvc</span><span class="o">.</span><span class="na">MockMvcRestDocumentation</span><span class="o">.</span><span class="na">document</span><span class="o">;</span>
</code></pre></div></div>
<p>document(), fieldWithPath(), requestFields() <br />
필요한 정보를 만드는 과정에서 위 api를 사용하기위해선<br />
PayloadDocumentation, MockMvcRestDocumentation을 import 해주어야한다.</p>

<p>그리고 patch 핸들러 메서드에 대해 path parameter를 이용할 경우</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">restdocs</span><span class="o">.</span><span class="na">request</span><span class="o">.</span><span class="na">RequestDocumentation</span><span class="o">.</span><span class="na">pathParameters</span><span class="o">;</span>
</code></pre></div></div>
<p>를 스태틱으로 import 해주면 사용이 가능하다.</p>

<p><br /></p>

<p>Document()의 매개변수로 전달하기위해 <br />
OperationRequestPreprocessor<br />
OperationResponsePreprocessor<br />
클래스를 이용해 인터페이스안에 정적 메서드를 만들어 구현하였다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ApiDocumentUtils</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="nc">OperationRequestPreprocessor</span> <span class="nf">getRequestPreProcessor</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">preprocessRequest</span><span class="o">(</span><span class="n">prettyPrint</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">static</span> <span class="nc">OperationResponsePreprocessor</span> <span class="nf">getResponsePreProcessor</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">preprocessResponse</span><span class="o">(</span><span class="n">prettyPrint</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>getRequestPreProcessor() <br />
getResponsePreProcessor()<br />
아리는 메서드를 만들었고 해당 내용엔 OperationPreprocessor 클래스의<br />
메서드인 prettyPrint()로 객체를 주입해주었다.</p>

<p>API 문서를 생성 전 전처리를 수행하는 기능이라는데<br />
해당 내용에 대해서는 조금더 깊은 학습이 필요해 보인다.</p>

<p>또한 Document() 매개변수인<br />
requestFields와 responseFields를 List.of로 <br />
문서화 시킬 내용을 설명과 함께 담아 전달하도록<br />
내용을 작성하였다.</p>

<p><br /></p>

<p>여기까지 작성후 테스트 케이스를 실행하면</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AJc5JmQkvJ4wiPE1h_7rk6WxVw-45PCgHTiM7tPBoXPQp9BI9-0QNhkyLJ9dvyFDgh1FIcoc9NAzwN1MqviHV234SBgKq-Fudw=w3024-h1620" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>우리가 build.gralde에서 ext로 설정해놓은 경로<br />
build/generated-snippets 안에 스니핏 식별자로<br />
post-member로 지정해여 해당 폴더안에 .adoc 파일이 생긴 모습을 볼 수 있다.</p>

<p>실제 내용을 확인해보면 우리가 원하는<br />
API 내용들이 담겨져있다.</p>

<p>그리고 Gradle 프로젝트의 경우<br />
src/docs/asciidoc 폴더 경로에서 index.adoc 파일을 생성한다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AJc5JmSP6yS5JEcQYvdmCiJBkQnCg6AjwPkGkEPL4LLA99PvGdapaJxSgq3S0yUGWaItGJc-VGK1hETfSnrBJQuxYueo82_6=w3024-h1620" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>index.adoc파일에 Asciidoc 문법으로<br />
템플릿 코드를 넣어 Gradle의 :build, :bootJar을  <br />
실행시켜주면 index.html</p>

<p>gradle의 설정했던 task copyDocument의 경로인<br />
src/main/resources/static/docs 안에 index.html 파일로  <br />
우리의 API문서가 변환된 모습을 볼 수 있다.</p>

<p>그리고 최종적으로 Spring Boot를 실행시켜<br />
index.html에 접근해보면</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AJc5JmRVSbop-au0zBS7T5VYwEbIIprDpuG7rQJQI3FpLPJncTS0N-xC6MLCi11JQdcFK3cWv2I50pjxUYkTgLFp5FArYVMaog=w3024-h1620" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>우리가 원하는 모습대로 API 문서가 작성된 모습을 확인해 볼 수 있다.<br />
(해당 템플릿 코드는 코드스테이츠 교육자료로 제공된 템플릿이므로<br />
템플릿 코드는 따로 올리지 않겠습니다!)</p>

<hr />

<p>이렇게 오늘은 간단한 것 같으면서도 어려운…<br />
SpringRestDocs를 사용하는 법을 알아보았고</p>

<p>초기 셋팅만 gradle에 잘 해놓고 템플릿 코드만 준비되어있다면<br />
크게 어려운점은 없었던 것 같다.</p>

<p>매우 유익했던 Test케이스를 이용한 API 자동화 작업.<br />
엄청 신기하고 재밌었다.</p>

<p>오늘 공부는 여기서 끝 !!</p>

<p><br /></p>

<p><span style="color:#994C00"><strong>오늘의 커피량</strong></span>: ☕️ ☕️<br />
<strong>오늘의 점심</strong>: 핫도그, 빵</p>]]></content><author><name>LEE JAEHYEOK</name></author><category term="TIL" /><category term="TIL" /><category term="부트캠프" /><category term="코드스테이츠" /><summary type="html"><![CDATA[요번주도 한주가 지나간다. 얼마 공부한 것 같은느낌이 아닌데 벌써 월요일이지나 금요일이 되었다.]]></summary></entry><entry><title type="html">TIL) JUnit 3</title><link href="http://localhost:4000/til/2022/11/10/til.html" rel="alternate" type="text/html" title="TIL) JUnit 3" /><published>2022-11-10T00:00:00+09:00</published><updated>2022-11-10T00:00:00+09:00</updated><id>http://localhost:4000/til/2022/11/10/til</id><content type="html" xml:base="http://localhost:4000/til/2022/11/10/til.html"><![CDATA[<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gPEtAIsYVHYZngjJKd7DhE7QvwO4nT5RQrbx3n7Hgtx83b5wSHcAK9fgNs42_a12-wjBXSB7EmmaORw8NUf4CEwXDJY2g=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>드이어 JUnit 관련해서 마지막 시간이다.<br />
테스트 프로그램을 작성하는 연습도 틈틈히 해둬야<br />
까먹지 않고 계층별 테스트가 원활하게 잘 될 것 같다.</p>

<p>새로운걸 알면알수록 재미있지만<br />
내 뇌용량의 초과로,,, 전에 배웠던 내용들이 슬슬<br />
휘발되기 시작한다 ㅋㅋ…</p>

<p>복습 하는시간도 마련해야 할 것 같은 느낌이다</p>

<hr />

<p>어제는 <a href="https://mycatlikeschuru.github.io/til/2022/11/09/til.html">계층별 테스트</a>에 대해서 간단하게 포스팅 해보았다.<br />
사실 계층별 테스트라고 작성을 했지만<br />
진정한 Slice 테스트가 되는 프로그램이 아니였고<br />
계층별 테스트를 위한 문법을 사전에 공부한느 시간이었다.</p>

<p>오늘은 정말 애플리케이션 계층별로 테스트를<br />
진행하려면 어떻게해야하는지?</p>

<p>테스팅 기술에 대해 배워보는 시간이다.</p>

<h2 id="mockito">Mockito</h2>

<p>오늘 공부할 api는 Mockito라는 테스트를 위한 api이다.</p>

<p>우리가 평상시에 Mock이라고하면 가짜를 얘기한다.<br />
목업폰과 같이 실제 기능은 없지는 모양만있는 가짜이다.</p>

<p>이와 같은 기술로 객체를 가짜로 만들어 계층별 테스트하는 방법이다.</p>

<p>너무나게 당연하게도 다른 계층을 접근하지 않으니<br />
테스트시간이 확실히 빨라지게되며<br />
계층별로 테스트를 해볼 수 있다는 장점이 있다.</p>

<h3 id="controller-계층-slice-test">Controller 계층 Slice Test</h3>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AJc5JmTnXpBWUcCganXkdulhuUs7yIiBV4jduubimbBhkIH1II-o-KZ6mUljknzsuWm-0Hf-czO1b7FkvAxK-aJEpMiHDGar9Q=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>간단하게 Controller 계층만 두고 얘기해보자<br />
어제 <a href="https://mycatlikeschuru.github.io/til/2022/11/09/til.html">JUnit 2</a> 챕터에서 테스트해보았던건<br />
왼쪽에서 보는 것과 같은 형태의 ‘통합 테스트’라고 볼 수 있다.</p>

<p>이유는 핸들러메서드를 호출해 Service -&gt; Repository 까지<br />
접근해 Controller 계층이 잘 실행되는지를 알아보았기 때문이다.</p>

<p>이제 우리가 해볼거는 Mock 객체를 만들어<br />
Test를 호출하면 Controller 계층만 독단적으로<br />
테스트할 수 있는 방법이다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Transactional</span>
<span class="nd">@SpringBootTest</span>
<span class="nd">@AutoConfigureMockMvc</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberControllerHomeworkTest</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">MockMvc</span> <span class="n">mockMvc</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">Gson</span> <span class="n">gson</span><span class="o">;</span>

    <span class="nd">@MockBean</span> <span class="c1">// 추가부분</span>
    <span class="kd">private</span> <span class="nc">MemberService</span> <span class="n">memberService</span><span class="o">;</span>

    <span class="nd">@Autowired</span> <span class="c1">// mppaer 사용을 위한 추가</span>
    <span class="kd">private</span> <span class="nc">MemberMapper</span> <span class="n">mapper</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">postMemberTest</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>코드를 예제로 살펴보자</p>

<p>이전과 달라진점은 @MockBean이 추가되었다는 점이다.<br />
SpringBoot를 사용하는 어노테이션을 달아주었기때문에</p>

<p>@MockBean을 필드변수에 붙여주면<br />
해당 객체에 Bean과 같은 타입의 객체가 DI된다.</p>

<p>즉 MemberService 클래스 객체가 주입되므로<br />
우리는 가짜로 만들어진 memberService 객체로 메서드들을 호출할 수 있다.</p>

<p>@Test 프로그램을 작성해보자</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kt">void</span> <span class="nf">postMemberTest</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="nc">MemberDto</span><span class="o">.</span><span class="na">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MemberDto</span><span class="o">.</span><span class="na">Post</span><span class="o">(</span>
            <span class="s">"dhfif718@naver.com"</span><span class="o">,</span>
            <span class="s">"이재혁"</span><span class="o">,</span>
            <span class="s">"010-1234-5678"</span>
    <span class="o">);</span>

    <span class="nc">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">memberPostToMember</span><span class="o">(</span><span class="n">post</span><span class="o">);</span>
    <span class="n">member</span><span class="o">.</span><span class="na">setStamp</span><span class="o">(</span><span class="k">new</span> <span class="nc">Stamp</span><span class="o">());</span>

    <span class="n">given</span><span class="o">(</span><span class="n">memberService</span><span class="o">.</span><span class="na">createMember</span><span class="o">(</span><span class="nc">Mockito</span><span class="o">.</span><span class="na">any</span><span class="o">(</span><span class="nc">Member</span><span class="o">.</span><span class="na">class</span><span class="o">))).</span><span class="na">willReturn</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>

    <span class="nc">String</span> <span class="n">content</span> <span class="o">=</span> <span class="n">gson</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="n">post</span><span class="o">);</span>

    <span class="nc">ResultActions</span> <span class="n">actions</span> <span class="o">=</span> <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span>
            <span class="n">post</span><span class="o">(</span><span class="s">"/api/members"</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">contentType</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">content</span><span class="o">(</span><span class="n">content</span><span class="o">)</span>
    <span class="o">);</span>

    <span class="nc">MvcResult</span> <span class="n">result</span> <span class="o">=</span> <span class="n">actions</span>
            <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">isCreated</span><span class="o">())</span>
            <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.data.email"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getEmail</span><span class="o">()))</span>
            <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.data.name"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getName</span><span class="o">()))</span>
            <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.data.phone"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getPhone</span><span class="o">()))</span>
            <span class="o">.</span><span class="na">andReturn</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>
<p>대부분은 자바 문법적인 요소이고<br />
중요한 부분은 given(); api 쪽이다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">mockito</span><span class="o">.</span><span class="na">BDDMockito</span><span class="o">.</span><span class="na">given</span><span class="o">;</span>
</code></pre></div></div>
<p>해당 라이브러리를 import 해야 사용이 가능하고</p>

<p>given(); 메서드를 통해서 우리는 가짜 객체를 만들 수 있다.</p>

<p>given() : 가짜로 만들 메서드 지정<br />
willRetrun() : 가짜로 만든 반환 값 지정<br />
이렇게 생각하면 간단 할 것 같다.</p>

<p>여기서 @MockBean을 통해 의존성 주입받은 객체의<br />
memberSerive.createMember()를 given()안에 넣어주었고<br />
해당 .createMember()의 매개변수가 Member.class 타입이므로<br />
Mockito.any(Member.class) 라고 설정을 해두었다.</p>

<p>여기서 만약 다른 타입일 경우에<br />
Mockito.anyInt()<br />
Mockito.anyLong()<br />
Mockito.anyString()<br />
등 여러가지 메서드들도 제공하고 있다.</p>

<p><br /></p>

<p>테스트 코드를 이렇게 작성하면<br />
가짜객체로 리턴값을 우리가 정해서 넘겨줄 수 있다.<br />
Controller 계층 프로그램을 봐보자</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@PostMapping</span>
<span class="kd">public</span> <span class="nc">ResponseEntity</span> <span class="nf">postMember</span><span class="o">(</span><span class="nd">@Valid</span> <span class="nd">@RequestBody</span> <span class="nc">MemberDto</span><span class="o">.</span><span class="na">Post</span> <span class="n">requestBody</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">memberPostToMember</span><span class="o">(</span><span class="n">requestBody</span><span class="o">);</span>
    <span class="n">member</span><span class="o">.</span><span class="na">setStamp</span><span class="o">(</span><span class="k">new</span> <span class="nc">Stamp</span><span class="o">());</span> <span class="c1">// homework solution 추가</span>

    <span class="nc">Member</span> <span class="n">createdMember</span> <span class="o">=</span> <span class="n">memberService</span><span class="o">.</span><span class="na">createMember</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nc">ResponseEntity</span><span class="o">&lt;&gt;(</span>
            <span class="k">new</span> <span class="nc">SingleResponseDto</span><span class="o">&lt;&gt;(</span><span class="n">mapper</span><span class="o">.</span><span class="na">memberToMemberResponse</span><span class="o">(</span><span class="n">createdMember</span><span class="o">)),</span>
            <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">CREATED</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>
<p>위에서 보듯이 memberService.createMember(member);<br />
메서드를 호출하는 시점에서 우리의 가짜 객체의 반환값이<br />
대신 createdMember 객체로 할당되게 되어진다.</p>

<p>그렇게 되면 Service 계층을 접근하지않고<br />
우리가 만든 Mock으로만으로 Controller를 테스트 해 볼 수 있는 것이다.</p>

<p><br /></p>

<h3 id="service-계층-slice-test">Service 계층 Slice Test</h3>

<p>Controller 계층을 테스트할 때에는 SpringBootTest를 이용했다.<br />
스프링 부트를 실행시키는 시간도 포함하면<br />
시간이 느려질 수 있는 단점이 있지만 Controller 계층은<br />
spring web servlet 기술을 사용하기에 포함시켰었다.</p>

<p>하지만 Service 계층은 SpringBoot 없이도<br />
Mockito API를 이용해 Serivce 계층만 테스트가 가능하다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AJc5JmT11Owrzo9GJ8WW4G2Oo2z7sh78eNqCI7yo5XbMPJ_0mlZQKHtsqqku8nDD_99cQhCgmaZ-OBsms1m9QJdQuPEvf_ijUw=w3024-h1620" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>위와 같이 테스트가 이루어지고<br />
Repository 계층과의 연결도 끊고 Mock 객체로만<br />
테스트를 할 수 있다는 점이 중요하다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ExtendWith</span><span class="o">(</span><span class="nc">MockitoExtension</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberServiceMockTest</span> <span class="o">{</span>

    <span class="nd">@Mock</span>
    <span class="kd">private</span> <span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">;</span>


    <span class="nd">@InjectMocks</span>
    <span class="kd">private</span> <span class="nc">MemberService</span> <span class="n">memberService</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">createMemberTest</span><span class="o">()</span>  <span class="o">{</span>
        <span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>Controller과는 다르게 @ExtendWith 어노테이션을 이용해<br />
Mockito API를 사용할 수 있다.</p>

<p>여기서 우리가 테스트할 계층은 memberService 계층이고<br />
가짜로 만들어야할 객체는 memberRepository이다</p>

<p>그런 개념에서 @Mock을 memberRepository에 붙이고 <br />
@InjectMocks를 memberService에 붙여주면</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Transactional</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberService</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">MemberService</span><span class="o">(</span><span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">memberRepository</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="o">...</span>
</code></pre></div></div>
<p>Service 계층의 Repository에 Mock객체가<br />
자동으로 의존성 주입이된다.</p>

<p>그리하여 우리가 Repository를 Mock 객체를 사용할 수 있는 것이다.</p>

<p><br /></p>

<p>이제 테스트 예제코드를 봐보자</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kt">void</span> <span class="nf">createMemberTest</span><span class="o">()</span>  <span class="o">{</span>
        <span class="nc">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">(</span><span class="s">"dhfif718@naver.com"</span><span class="o">,</span><span class="s">"이재혁"</span><span class="o">,</span><span class="s">"010-1234-5678"</span><span class="o">);</span>

        <span class="n">given</span><span class="o">(</span><span class="n">memberRepository</span><span class="o">.</span><span class="na">findByEmail</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">getEmail</span><span class="o">())).</span><span class="na">willReturn</span><span class="o">(</span><span class="nc">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">member</span><span class="o">));</span>
        <span class="c1">//given(memberRepository.findByEmail(Mockito.anyString())).willReturn(Optional.of(member));</span>

        <span class="n">assertThrows</span><span class="o">(</span><span class="nc">BusinessLogicException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">memberService</span><span class="o">.</span><span class="na">createMember</span><span class="o">(</span><span class="n">member</span><span class="o">));</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>검증을 어떻게하는지에 따라 달리지겠지만<br />
Member 객체를 생성하는 serive 클래스 메서드를 테스트하기위해<br />
새로운 Member 객체를 만들어 검증할 것이다.</p>

<p>given()으로 Controller 계층에서 했던것과 동일하게<br />
가짜로만들 메서드의 형식과 매개타입을 입력해준다음<br />
리턴값으로 어떤 객체를 받을지 정해주면된다.</p>

<p>최종적으로 동일한 Member가 발견되어<br />
Exception을 잡아 검증하는 프로그램으로 작성하였다.</p>

<p>우리가 잘라줘야하는부분은 Repositroy의 findByEmail();로 정의한 부분이다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">Member</span> <span class="nf">createMember</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">verifyExistsEmail</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">getEmail</span><span class="o">());</span>
    <span class="nc">Member</span> <span class="n">savedMember</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">savedMember</span><span class="o">;</span>
<span class="o">}</span>
<span class="kd">private</span> <span class="kt">void</span> <span class="nf">verifyExistsEmail</span><span class="o">(</span><span class="nc">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">member</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findByEmail</span><span class="o">(</span><span class="n">email</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">isPresent</span><span class="o">())</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">BusinessLogicException</span><span class="o">(</span><span class="nc">ExceptionCode</span><span class="o">.</span><span class="na">MEMBER_EXISTS</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>
<p>MemberService 로직은 너무 간단하게<br />
기존 member와 email을 비교해 같은 email이 존재하면<br />
throw Exception을 하게 되어있다.</p>

<p>우리는 위에서 메서드 호출할때의 매개변수 “dhfif718@naver.com”과<br />
결과로 반환된 객체의 email “dhfif718@naver.com” 결과적으로 같기 때문에<br />
if(member.isPresent()) 조건에 성립되<br />
Exception을 던지게되어 Serivce 로직을 검증해볼 수 있다.</p>

<p>자연스럽게 예외가 던져지므로 해당 Service 로직은 종료되고<br />
.save()까지 검증할 필요가 없어진다.<br />
save를 검증하는 것은 사실 비지니스로직을 검증하는 것보단<br />
Repository를 검증하는 것에 가깝기 때문에<br />
Serivce 계층에서 검증하는 로직을 굳이 작성하지 않아도 될 것 같다.</p>

<p><br /></p>

<h3 id="오늘-만난-에러">오늘 만난 에러</h3>

<p>이렇게 위에서 Controller과 Service 계층을 분리해서<br />
따로 따로 테스트할 수 있게 프로그램을 작성하고<br />
정상적으로 수행되는 모습을 볼 수 있었다.</p>

<p>Mockito라는 API를 처음 사용하다보니<br />
여러가지 에러들을 만났고 그중에 기억남는 에러를 적어본다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">cancelOrderTest</span><span class="o">(){</span>
    <span class="nc">Order</span> <span class="n">order</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Order</span><span class="o">();</span>
    <span class="kt">long</span> <span class="n">orderId</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>
    <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Order</span><span class="o">&gt;</span> <span class="n">findOrder</span> <span class="o">=</span> <span class="nc">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
    <span class="n">given</span><span class="o">(</span><span class="n">orderRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">order</span><span class="o">.</span><span class="na">getOrderId</span><span class="o">())).</span><span class="na">willReturn</span><span class="o">(</span><span class="n">findOrder</span><span class="o">);</span>
    <span class="n">assertThrows</span><span class="o">(</span><span class="nc">BusinessLogicException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">orderService</span><span class="o">.</span><span class="na">cancelOrder</span><span class="o">(</span><span class="n">orderId</span><span class="o">));</span>
<span class="o">}</span>
</code></pre></div></div>
<p>위와 같이 테스트 코드를 작성후 실행시켜 보았는데</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AJc5JmTitd8kl31KKTTaIB7nQrL7AvxwT54hIPaJEcnmdlC5BhBrezzcRcqyhYeyWzO1aK7O1OYjVG_yqk2EYkUVRD6lZHWCiw=w3024-h1620" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>misusing.PotentialStubbingProblem 이라는 에러를 만났다.<br />
잠재적인 Stubbing 문제라면서 예외가 잡혔다.</p>

<p>코드를 열심히 보다보니..<br />
given()안의 매개변수로 order.getOrderId()를 넣어주고 있었고<br />
cancelOrder();메서드 호출하는 매개변수에는 orderId를 넣어주고 있었다.</p>

<p>여기서 order객체가 만들어질때 Long타입으로 null로 만들어졌고<br />
타입이 잘못들어간 상태로 테스트 코드를 실행하니까 위와 같은 에러가 발생했다.</p>

<p>해결은</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">given</span><span class="o">(</span><span class="n">orderRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="nc">Mockito</span><span class="o">.</span><span class="na">anyLong</span><span class="o">())).</span><span class="na">willReturn</span><span class="o">(</span><span class="n">findOrder</span><span class="o">);</span>
</code></pre></div></div>
<p>위와 같이 타입을 Mockito.anyLong()을 붙여서 해결이 가능하고<br />
order.serOrderId(orderId);를 통해서 값을 넣어주어도<br />
문제가 해결이 가능하다.</p>

<hr />

<p>오늘 공부는 여기까지 했고<br />
JUnit관련해서 Slice 테스트에 대해 자세히 배울 수 있어서<br />
너무 유익한 시간이였다.</p>

<p>한가지 아쉬운점은 많은 api중에서도 한정적인 것만 사용해보았기에<br />
지식층이 얕은점..?이 조금 아쉬웠고<br />
이후에 프로젝트하기전에 테스트 관련 여러 메서드들을 공부한다음<br />
테스트 코드를 작성해봐야겠다.</p>

<p>오늘 공부는 여기서 끝 !</p>

<p><br /></p>

<p><span style="color:#994C00"><strong>오늘의 커피량</strong></span>: ☕️ ☕️ ☕️<br />
<strong>오늘의 점심</strong>: 카레, 라면, 밥</p>]]></content><author><name>LEE JAEHYEOK</name></author><category term="TIL" /><category term="TIL" /><category term="부트캠프" /><category term="코드스테이츠" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">TIL) JUnit 2</title><link href="http://localhost:4000/til/2022/11/09/til.html" rel="alternate" type="text/html" title="TIL) JUnit 2" /><published>2022-11-09T00:00:00+09:00</published><updated>2022-11-09T00:00:00+09:00</updated><id>http://localhost:4000/til/2022/11/09/til</id><content type="html" xml:base="http://localhost:4000/til/2022/11/09/til.html"><![CDATA[<p><img src="https://lh3.googleusercontent.com/drive-viewer/AJc5JmR_RuNelXZR9wXYkkDNPxOHlFm1gfwD72mlxFWutdJvtLpD7ODhrLzTuczuHNHObb4Iq-3wmnCTJcm2yUGGaGj76Ho1Xw=w3024-h1728" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>늘상 같은일의 반복이다.<br />
지루하면서도 행복한 일상의 반복이다.</p>

<p>반복적인 학습에 지치기도 하지만<br />
새로운 지식습득의 즐거움이 너무크기때문에<br />
오늘도 열심히 공부해보려한다.</p>

<hr />

<p>어제는 Test라는 개념과<br />
Spring Boot의 Default 프레워크인 JUnit에 대해서도<br />
간단히 사용하는 클래스와 어노테이션등을 알아보았다.</p>

<p>오늘은 웹애플리케이션 계층별로 테스트하는<br />
슬라이스 테스트에대해 알아볼 예정이다.</p>

<h2 id="controller-계층-테스트">Controller 계층 테스트</h2>
<p>Controller 계층을 테스트하기위해서는<br />
기본적으로 Postman으로 핸들러 매서드를 호출하여<br />
JSON 객체를 주고 응답받는 방식을 사용했었다.</p>

<p>하지만 이모든 것도 자동화시키고 더욱 프로그래머답게 테스트하기위해선<br />
테스트 코드로 Controller 계층을 테스트해볼 필요가 있다.</p>

<h3 id="mockmvc">MockMvc</h3>

<p><strong>@AutoConfigureMockMvc</strong> 어노테이션은 Controller 테스트를 위한 애플리케이션의<br />
자동 구성 작업을 해준다. 이중 우리는 MockMvc 같은 클래스의 기능을 사용할 것이다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootTest</span>    
<span class="nd">@AutoConfigureMockMvc</span>  
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ControllerTest</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">MockMvc</span> <span class="n">mockMvc</span><span class="o">;</span>
    
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postTest</span><span class="o">()</span> <span class="o">{</span>
        <span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>테스트 파일의 @SpringBootTest 어노테이션 붙여<br />
Application Context를 생성하고<br />
MockMvc클래스를 사용하기 위한 어노테이션 @AutoConfigureMockMvc를<br />
붙여준 다음 @Autowired로 의존성 주입을 시켜주면 된다.</p>

<p>그렇게 되면 .perfrom(); 이라는 메서드를 사용하여<br />
POST, GET, DELETE, PATCH 등<br />
핸들러 메서드들을 자유롭게 이용할 수 있게 되어진다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">ResultActions</span> <span class="n">actions</span> <span class="o">=</span>
        <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span>                       
            <span class="n">post</span><span class="o">(</span><span class="s">"/api/coffees"</span><span class="o">)</span> 
                <span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span> 
                <span class="o">.</span><span class="na">contentType</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span> 
                <span class="o">.</span><span class="na">content</span><span class="o">(</span><span class="n">content</span><span class="o">)</span> 
        <span class="o">);</span>
</code></pre></div></div>
<p>간단한 코드 예제를 살펴보자 perform을 통해<br />
uri와 핸들러 메서드 방식 설정을해주고<br />
응답받을 객체 타입 .accept();<br />
전송할 컨텐츠 타입 .contentType();<br />
전송할 컨텐츠 .content();<br />
를 호출하여 각각의 내용들을 담아주면 Controller에서 작성한<br />
api가 호출되게 되어진다.</p>

<p>여기서 반환된 객체는 <strong>ResultActions</strong>이라는 타입으로 반환되면<br />
후에 검증하는 용도로 사용되어진다.</p>

<p>핸들러 메서드(post(),get(),patech())를 사용하기 위해서는</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">test</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">request</span><span class="o">.</span><span class="na">MockMvcRequestBuilders</span><span class="o">.*;</span>
</code></pre></div></div>

<p>MockMvcRequestBuliders를 import해야 사용이 가능하다.</p>

<p><br /></p>

<h3 id="json-객체-받기">Json 객체 받기</h3>

<p>여기서 우리는 JSON 객체를 주고받는 것으로 설정했고<br />
Json 객체를 만들기 위해 Google Json 라이브러리를 사용했다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">implementation</span> <span class="err">'</span><span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">code</span><span class="o">.</span><span class="na">gson</span><span class="o">:</span><span class="nl">gson:</span><span class="mf">2.8</span><span class="o">.</span><span class="mi">7</span><span class="err">'</span>
</code></pre></div></div>

<p>사용법은 간단하다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Autowired</span>
<span class="kd">private</span> <span class="nc">Gson</span> <span class="n">gson</span><span class="o">;</span>
</code></pre></div></div>
<p>필드의 Gson 객체를 주입받도록 설정 후</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">CoffeeDto</span><span class="o">.</span><span class="na">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Coffee</span><span class="o">.</span><span class="na">Post</span><span class="o">(</span>
        <span class="s">"아메리카노"</span><span class="o">,</span>
        <span class="s">"Americano"</span><span class="o">,</span>
        <span class="mi">4500</span>
<span class="o">);</span>
<span class="nc">String</span> <span class="n">content</span> <span class="o">=</span> <span class="n">gson</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="n">post</span><span class="o">);</span>
</code></pre></div></div>
<p>우리가 Dto 용도로 만들었던 클래스의<br />
해당 타입의 맞는 객체를 gson.toJson(); 안에 넣어주면<br />
String 타입으로 반환되게 되어진다.</p>

<p>그렇게 반환된 객체로 .content();안에 담에주게 되면 끝이다.</p>

<p><br /></p>

<h3 id="mvcresult">MvcResult</h3>
<p>위에서 언급했던 ResultAction 타입의 객체로<br />
여러가지 검증 메서드들을 사용할 수 있다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">MvcResult</span> <span class="n">result</span> <span class="o">=</span> <span class="n">actions</span>
        <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">isCreated</span><span class="o">())</span>
        <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.data.korName"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getKorName</span><span class="o">()))</span>
        <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.data.engName"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getEngName</span><span class="o">()))</span>
        <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.data.price"</span><span class="o">).</span><span class="na">value</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getPrice</span><span class="o">()))</span>
        <span class="o">.</span><span class="na">andReturn</span><span class="o">();</span>
</code></pre></div></div>
<p>.andExpect(); 메서드로 검증을 할 수 있다.<br />
actions객체는 ResultAction 타입이며</p>

<p>status().isCreated() -&gt; 응답 상태에 대한 검증 (OK,NOT FOUND 등등..)<br />
jsonPath().value() -&gt; 응답받은 Json 객체의 데이터를 검증</p>

<p>추가로 .andReturn(); 메서드를 사용하게되면<br />
MvcResult 클래스 타입으로 반환되는데<br />
해당 클래스의 메서드로 Json 객체를 문자열로 출력하는 것도 가능하다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">getContentAsString</span><span class="o">());</span>
</code></pre></div></div>
<p>위와 같이 getResponse().getContentAsString(); 메서드를<br />
이용하여 실제 어떻게 응답받았는지 출력해볼 수 있다</p>

<p><br /></p>

<h2 id="service-계층-테스트">Service 계층 테스트</h2>

<p>데이터 엑세스 계층을 테스트하기 위해서는<br />
한 가지 규칙이있다.</p>

<p>DB의 상태를 테스트 케이스 실행 이전으로 되돌려 놓는다.<br />
라는 규칙이 있다.</p>

<p>이유는 말하지 않아도 알 수 있다.<br />
테스트케이스 실행을하는 데이터를 남겨둘 이유가 없기 때문이다.</p>

<p>가장 원초적인 방법으로는 <br />
@BeforeEach - 테스트 레코드 생성 , @AfterEach - 테스트 레코드 삭제<br />
정도 생각해볼 수 있을 것 같다. 하지만 데이터 생성 후<br />
로직에서 예외가 발생하거나하면 데이터가 잔존하는 문제가 생길 수도 있다.</p>

<p>@Transactional 애노테이션을 테스트 클래스에<br />
붙여놓고 Test를 진행하면, 테스트 완료후 rollback();이<br />
되어지기 때문에 편리하게 테스트를 할 수 있다.</p>

<h3 id="datajpatest">@DataJpaTest</h3>
<p>Spring에서 데이터 엑세스 계층을 테스트 하기 위해<br />
만들어둔 어노테이션이다.</p>

<p>해당 어노테이션을 추가함으로써, Jpa 기술을 사용하는<br />
Repository의 기능을 정상적으로 사용하기 위한<br />
Configuration을 Spring이 자동으로 해주게 된다.<br />
그리고 해당 어노테이션은 @Transactional을 포함하고 있기에<br />
위에서 설명했던 rollback 처리까지 되어진다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@DataJpaTest</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CoffeeRepositoryTest</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">CoffeeRepository</span> <span class="n">coffeeRepository</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test1</span><span class="o">(){</span>
        <span class="o">...</span>
    <span class="o">}</span>
    
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test2</span><span class="o">(){</span>
        <span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>사용 방법은 Controller보다 간단하다. <br />
JPA를 상속받는 Repository를 의존성 주입시킨 객체를 이용하고</p>

<p>@DataJpaTest를 클래스레벨에 붙여주면<br />
트랜잭션이 보장된 Service 계층 테스트가 가능한<br />
Test 클래스가 만들어 진다.</p>

<p><br /></p>

<hr />

<p>오늘은 Controller 계층을 테스트 하기위한<br />
여러가지 API들을 알아보았다.<br />
확실히 Postman으로 테스트할때는 눈으로 보이지만<br />
프로그램으로 테스트할때 예외발생이라든지, 오류발생이 생기면<br />
한눈에 문제파악하는게 쉽지는 않은 것 같고<br />
연습이 필요할 것 같다.</p>

<p>오늘 공부도 여기서 끝 !</p>

<p><br /></p>

<p><span style="color:#994C00"><strong>오늘의 커피량</strong></span>: ☕️ ☕️ ☕️<br />
<strong>오늘의 점심</strong>: 김치찌개, 밥</p>]]></content><author><name>LEE JAEHYEOK</name></author><category term="TIL" /><category term="TIL" /><category term="부트캠프" /><category term="코드스테이츠" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">TIL) JUnit 1</title><link href="http://localhost:4000/til/2022/11/08/til.html" rel="alternate" type="text/html" title="TIL) JUnit 1" /><published>2022-11-08T00:00:00+09:00</published><updated>2022-11-08T00:00:00+09:00</updated><id>http://localhost:4000/til/2022/11/08/til</id><content type="html" xml:base="http://localhost:4000/til/2022/11/08/til.html"><![CDATA[<p>오늘따라 눈을 뜨기가 힘들었다.</p>

<p><img src="https://lh3.googleusercontent.com/drive-viewer/AJc5JmRtGpeYtviYIzfeRp5N9UsAFv4DyoXncCtpBv_yEBy2yHuy6nlv2NoLtIhafrvn3BC3SJSlY-XIggHVKpNsrfQ-cfUeRQ=w1512-h808" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>오랜만에 잠에서 이겨내지 못하는 아침이었다…<br />
정말 한결같기는 진짜 어렵다는 생각도 들고<br />
참 나약하구나라는 생각도 든다.</p>

<p>그래도 오늘은 비교적 쉬운 주제이기 때문에<br />
열심히 공부해보자 !!</p>

<hr />
<p>어제는 트랜잭션에 대해 알아보았다.<br />
기본적으로 선언형 방식을 이용해보았다. 속성에 대해서는<br />
깊은 공부가 이루어지지는 않았다.<br />
트랜잭션의 기본 동작원리와 적용시 어떻게 처리가되는지?<br />
정도 확인을 해보았다.</p>

<p>오늘은 비교적 난이도가 쉬운 주제인 Testing에 대해 공부해볼 예정이다.</p>

<h2 id="test">TEST</h2>
<p>테스트는 여러가지 분야에서 많이 들어봤을 것 같다.<br />
무었이든지 출시하기전에는 검증과 테스트가 거쳐진다.</p>

<p>프로그램에서의 테스트는 내가 작성한 로직에 대한<br />
검증이고, 여러가지 예외상황을 가정해 테스트를 진행해볼 수 있다.</p>

<h3 id="unit-test">Unit Test</h3>
<p>단위테스트라고 직역할 수 있다.<br />
단위 테스트는 이름에서 오듯이 단위를 정해 테스트를 진행한는 것이다.<br />
비지니스 로직에서 사용하는 클래스들이 독립적으로 테스트하기<br />
가장 좋은 대상이기 때문에 단위테스트라고 부르는 경우가 많다.</p>

<p>우리가 작성한 메서드 단위로 테스트를 한다고 생각하면 될 것 같다.<br />
그 외에 전체단위로 보았을 때 여러 테스트가 있다.</p>

<ol>
  <li>기능 테스트
-&gt; 클라이언트, 애플리케이션, DB 까지 테스트하는 과정</li>
  <li>통합 테스트
-&gt; 애플리케이션, DB까지 테스트하는 과정</li>
  <li>슬라이드 테스트
-&gt; 애플리케이션 특정 계층을 쪼개어서 하는 테스트</li>
</ol>

<p><br /></p>

<h3 id="test-express">Test Express</h3>
<p>Given-When-Then 방식으로 표현을 한다.<br />
BDD(Behavior Driven Development)라는 테스트 방식의 용어이다.</p>

<p><strong>Given</strong><br />
-&gt; 테스트를 위한 준비과정을 명시<br />
-&gt; 테스트에 필요한 전제 조건들이 포함된다.</p>

<p><strong>When</strong><br />
-&gt; 테스트할 동작을 지정한다.<br />
-&gt; 테스트할 메서드 호출을 하는 부분이다.</p>

<p><strong>Then</strong><br />
-&gt; 테스트의 결과를 검증하는 영영이다.<br />
-&gt; Assertion과 같은 클래스로 검증을하는 부분이다.</p>

<p><br /></p>

<h3 id="junit">JUnit</h3>
<p>우리는 Java언어로 만들어진 애플리케이션을 테스트하기위해서<br />
오픈 소스 테스트 프레임워크인 JUnit을 사용하게 된다.<br />
(Spring Boot의 Default 테스트 프레임워크가 Junit이다)</p>

<p><img src="https://lh3.googleusercontent.com/drive-viewer/AJc5JmTUGtth7qi-Z3xGykSHbxfz7SkPIuHfT_kXClFjYRN9M2CbsLZ4nY0Eu-CfahjOSV00vSWx_g5kPmxUZDMn9iQdpfKttQ=w3024-h1728" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>위 사진과 같이 스프링 프로젝트를 만들 경우<br />
test 패키지가 생긴다 안에 패키지를 만들어 다양한 <br />
테스트 케이스를 만들어 로직을 검증해볼 수 있다.</p>

<p>기본적인 사용방법은 간단하다.</p>

<p>클래스를 만들어<br />
매서드에 @Test 어노테이션을 붙여 테스트 해볼 수 있다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JunitTest</span> <span class="o">{</span>
    
    <span class="nd">@Test</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"Test 1"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">assertionTest</span><span class="o">(){</span>
        <span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>어노테이션에 대해 공부한 것들을 적어본다</p>

<p>@BeforeEach<br />
-&gt; 테스트 실행중 먼저 실행되어지는 메서드에 붙여준다.<br />
-&gt; 각테스트 매서드가 실행되기전 실행한다.</p>

<p>@BeforeAll<br />
-&gt; 테스트 실행중 딱한번만 실행되어지는 메서드에 붙여준다.<br />
-&gt; Test 클래스 실행전 한번만 실행된다.<br />
-&gt; 그러므로 정적 메서드여야 한다 (static)</p>

<p>@AfterEach<br />
-&gt; 테스트 실행중 실행완료후 실행되어지는 메서드에 붙여준다.<br />
-&gt; 각테스트 메서드가 실행되고난후 실행한다.</p>

<p>@AfterAll<br />
-&gt; 위에 내용과 같으니 참조</p>

<p>@DisplayName(“”)<br />
-&gt; 메서드에 붙여주면, 해당 어노테이션의 이름을 커스터마이징 할 수 있다.</p>

<p>@SpringBootTest<br />
-&gt; 테스트 클래스에 붙여준다 <br />
-&gt; 테스트실행시, 스프링을 띄운다음 스프링을 사용할 수 있게된다.<br />
-&gt; 즉, 애플리케이션에서 컨테이너에 담아둔 빈들을 주입할 수 있다.</p>

<p>@TestConfiguration<br />
-&gt; 테스트 안에서 내부 클래스를 만들어서 사용하면서 이 어노태이션을 붙이면 <br />
스프링 부트가 자동으로 만들어주는 빈들에 추가로 필요한 스프링 빈들을 등록하고 테스트를 수행할 수 있다.</p>

<p>@AutoConfigureMockMvc<br />
-&gt; MockMvc 기능을 사용하기위한 애노테이션 <br />
-&gt; Controller 슬라이스 테스트를 진행한다고 가정하면 <br />
Controller 테스트를 위한 애플리케이션의 자동 구성 작업을 해준다.<br />
-&gt; 주입받은 객체는 .perform()을 이용해 http매세더 요청가능</p>

<p><br /></p>

<p>사용 방법을 알았으니 이제 검증하는 방법도 알아야한다.<br />
검증할때 사용하는 클래스들이 여러가지 있다.</p>

<p>1). Assertions 클래스<br />
-&gt; assertJ 패키지의 클래스를 가져와야 사용가능<br />
-&gt; .assertThat(); 같은 매서드로 검증해주는 기능들을 제공해줌</p>

<p>.assertThat();<br />
-&gt; 다양한 검증 메서드들을 제공</p>

<p>.assertThatThrownBy();<br />
-&gt; assertThat과 동일하게 메서드를 제공하지만 예외를 확인할 수 있다.</p>

<p>.isTure();<br />
-&gt; 앞의 내용이 참이면 테스트 성공</p>

<p>.isFalse();<br />
-&gt; 앞의 내용이 거짓이면 테스트 실패</p>

<p>.isEqualTo<br />
-&gt; 값이 동일하면 테스트 성공</p>

<p>2.) Assertions 클래스<br />
-&gt; jupiter 패키지의 클래스를 가져와야 사용가능</p>

<p>.assertEquals();<br />
-&gt; 기대값이 실제값과 같은지 비교<br />
-&gt; 좌측이 기대값, 우측이 실제값<br />
-&gt; ex) assertEquals(“a”,”a”);</p>

<p>.assertNotNull();<br />
-&gt; Null값이 아니면 검증 통과, 아니면 Fail<br />
-&gt; ex) assertNotNull(변수, 매세지);</p>

<p>.assertThrows();<br />
-&gt; 기대하는 Exception타입과 내용을 입력한다.  <br />
-&gt; 기대하는값이 Exception 타입과 맞지 않을 경우에는 테스트 실패<br />
반대로 타입과 같을경우에는 성공<br />
-&gt; ex) assertThrows(NullPointerException.class, ()-&gt; 호출메서드));</p>

<p>2). Assumption 클래스<br />
.assumeTrue();<br />
-&gt; 특정 조건에서 선택적인 테스트가 필요할때 사용</p>

<p>4). MatcherAssert 클래스<br />
   -&gt; JUnit 기반의 Assertion 프레임워크이다.<br />
   -&gt; 자연스러운 문장으로 이어지는 특성이있어 가독성 향상이 크다.<br />
   -&gt; hamcrest 패키지에 있음</p>

<p>.assertThat();<br />
-&gt; 다양한 검증 메서드를 제공해줌<br />
-&gt; ex) .assertThat(a, is(equalTo(null)));<br />
.is();<br />
.equalTo();<br />
.notNullValue();</p>

<p><br /></p>

<p>이 외에도 JUnit 기반으로 만들어진 프레임워크에서<br />
사용할 수 있는 클래스와 메서드들이 많이 있고<br />
이 부분은 지속적으로 테스트프로그램 작성하면서 습관을 들이면서<br />
지식의 범위를 늘려야할 것 같다.</p>

<hr />

<p><br /></p>

<p><span style="color:#994C00"><strong>오늘의 커피량</strong></span>: ☕️ ☕️<br />
<strong>오늘의 점심</strong>: 카레,밥</p>]]></content><author><name>LEE JAEHYEOK</name></author><category term="TIL" /><category term="TIL" /><category term="부트캠프" /><category term="코드스테이츠" /><summary type="html"><![CDATA[오늘따라 눈을 뜨기가 힘들었다.]]></summary></entry><entry><title type="html">TIL) Spring Transaction 2 , Event 비동기 적용</title><link href="http://localhost:4000/til/2022/11/07/til.html" rel="alternate" type="text/html" title="TIL) Spring Transaction 2 , Event 비동기 적용" /><published>2022-11-07T00:00:00+09:00</published><updated>2022-11-07T00:00:00+09:00</updated><id>http://localhost:4000/til/2022/11/07/til</id><content type="html" xml:base="http://localhost:4000/til/2022/11/07/til.html"><![CDATA[<p>날씨도 선선하니 기분좋은 월요일 시작이다.</p>

<p><img src="https://lh3.googleusercontent.com/drive-viewer/AJc5JmRr5ZBvzQfDcRqVd7ewr_sKrKf_aakwdPGUG0DNrGrEVbVty1HB4i1wRBumj0m52CTkK1XwtsJG106ORwGHwywrqfZjUg=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>주말에 공부하는게 습관이 되어지다보니<br />
게임을하는 빈도수가 부쩍 줄었다.<br />
하루도 빠짐없이하던 내가 주말에 아주 잠깐정도만 하는 쾌거를 이뤘다.</p>

<p>오늘 공부한 것도 정리하고 이외 공부도 해보자 !!</p>

<hr />
<p>오늘은 트랜잭션의 마지막 시간이다.<br />
트랜잭션의 개념자체는 어렵게 느껴지지 않는데<br />
그 안에 있는 커넥션이 어떻게 연결되어지는지..<br />
등등 DB의 접근 방법에 대해 구조를 명확히 파악하지 못했던 점이<br />
가장 힘들었던 것 같다.</p>

<p>어제는 DB를 이용해 commit(); rollback(); 쿼리를 보내<br />
실제로 세션마다 다르게 보이고 동작하는걸 확인해 볼 수 있었다.<br />
오늘은 실제 코드에 적용해서 하는법을 배워보자</p>

<h2 id="transactional">@Transactional</h2>

<h3 id="사용방법">사용방법</h3>

<p>해당 어노테이션으로 말할 것 같으면<br />
AOP 기능까지 추가된 트랜잭션이라고 보면 될 것 같다.</p>

<p>Serivce 로직, 즉 비지니스 로직에서 트랜잭션을 적용해<br />
하나의 그룹으로 묶어 최종적으로 완료하면 commit();<br />
예외가 발생하면 rollback();을 시켜주어야한다.</p>

<p>하나의 비지니스 로직 메서드에는 여러종류의 쿼리가 들어갈 수도있다.<br />
조회(findAll) 후 생성(save)을 할 수 도 있는 것이고<br />
로직에 따라 DB에 접근 수가 늘어날 수도 있다.<br />
이 모든걸 하나의 트랜잭션으로 묶어 모두성공=commit, 실패=rollback<br />
이라고 생각하면 간단할 것 같다.</p>

<p>옛날에는 트랜잭션 매니저를 이용해 직접 작성했다고한다.</p>

<p><img src="https://lh3.googleusercontent.com/drive-viewer/AJc5JmTUoJ37QEpejnf7c71VPSO_r3ZdbX7CNXRfzh0MNJMn-ooo0Lib8xwQrmY6RS-ZDopydl6GyJi4FTwb9ZWRKx8BfBYKUA=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>DB접근 방법에따라 트랜잭션매니저 구현체를 이용해<br />
트랜잭션을 커밋하고 롤백하며 관리했었다고 한다.</p>

<p><strong>예제)</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">accountTransfer</span><span class="o">(</span><span class="nc">String</span> <span class="n">fromId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">toId</span><span class="o">,</span> <span class="kt">int</span> <span class="n">money</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">SQLException</span> <span class="o">{</span>
    <span class="c1">// 트랜잭션 시작</span>
    <span class="nc">TransactionStatus</span> <span class="n">status</span> <span class="o">=</span> <span class="n">transactionManager</span><span class="o">.</span><span class="na">getTransaction</span><span class="o">(</span><span class="k">new</span> <span class="nc">DefaultTransactionDefinition</span><span class="o">());</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="c1">//비지니스 로직</span>
        <span class="n">bizLogic</span><span class="o">(</span><span class="n">fromId</span><span class="o">,</span> <span class="n">toId</span><span class="o">,</span> <span class="n">money</span><span class="o">);</span>
        <span class="n">transactionManager</span><span class="o">.</span><span class="na">commit</span><span class="o">(</span><span class="n">status</span><span class="o">);</span><span class="c1">// 성공시 커밋</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">transactionManager</span><span class="o">.</span><span class="na">rollback</span><span class="o">(</span><span class="n">status</span><span class="o">);</span> <span class="c1">// 실패시 롤백</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>하지만 이렇게될 경우 try, catch문이나<br />
트랜잭션 매니저부분의 commit,rollback 등 반복적인 코드와<br />
트랜잭션 매니저를 사용하기위한 객체를 얻어야해야해서<br />
순수한 비지니스로직의 코드만 남지 못하게되어진다.</p>

<p>이러한 배경에서 Spring AOP를 적용을 할 수도 있지만<br />
@Transactional 애노테이션을 붙여주면 AOP까지 <br />
적용되어 깔금한 코드로 변경할 수 있다.</p>

<p><strong>예제)</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">accountTransfer</span><span class="o">(</span><span class="nc">String</span> <span class="n">fromId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">toId</span><span class="o">,</span> <span class="kt">int</span> <span class="n">money</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">SQLException</span> <span class="o">{</span>
    <span class="n">bizLogic</span><span class="o">(</span><span class="n">fromId</span><span class="o">,</span> <span class="n">toId</span><span class="o">,</span> <span class="n">money</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>위와 같이 애노테이션을 붙여 트랜잭션을 적용하는 방법을<br />
<strong>선언형 방식의 트랜잭션 적용</strong>이라고한다.</p>

<p>클래스 레벨에 적용하는 방법과 매서드 레벨에 적용할 수 있고<br />
레벨에따른 적용범위가 결정되어진다.<br />
해당 애노테이션이 붙은 메서드와 클래스는<br />
자동적으로 트랜잭션 기능이 적용되어 서비스 로직 실행중<br />
Exception이 발생하게되어진다면 rollback();을 실행하게되어진다.</p>

<p><br /></p>

<h3 id="예외에-따른-처리">예외에 따른 처리</h3>

<p>하지만 Checked 예외와, Unchecked 예외가 서로 다르게 동작한다.</p>

<p><img src="https://lh3.googleusercontent.com/drive-viewer/AJc5JmTSLAOChGCHoy9NNwgmdECsc71qVVgUeTBzTSdKGAlH5tqp6IU6uhn2g81ChpPO6kV-uUGZ2-9bBermAPtxxrtbxdvTXw=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>rollback();에 대한 차이가 있고<br />
Checked 에외는 반드시 예외처리를 해주어야한다.</p>

<p><br /></p>

<h3 id="transaction-전파">Transaction 전파</h3>

<p>트랜잭션 전파는 트랜잭션 경계에서 진행중인<br />
트랜잭션이 존재할때 또는 존재하지 않을 때<br />
어떻게 동작할 것인지를 결정하는 방식을 의미한다.</p>

<p>ex) @Transactional(propagation = Propagation.REQUIRED)</p>

<ol>
  <li>
    <p>Propagation.REQUIRED<br />
-&gt; 현재 진행 중인 트랜잭션이 존재하면 해당 트랜잭션을 사용하고<br />
존재하지 않으면 새 트랜잭션을 생성하도록 해준는 속성이다<br />
즉,서로 다른 서비스에서 다른 트랜잭션을 실행시키지 않게해주는 역할</p>
  </li>
  <li>
    <p>Propagation.REQUIRES_NEW <br />
-&gt; 이미 진행중인 트랜잭션과 무관하게 새로운 트랜잭션이 시작된다.<br />
기존에 진행중이던 트랜잭션은 새로운 시작된 트랙잭션이 종료할 때까지 중지된다.</p>
  </li>
  <li>
    <p>Propagation.MANDATORY<br />
-&gt; 진행중인 트랜잭션이 없으면 예외를 발생시킨다.</p>
  </li>
  <li>
    <p>Propagation.NOT_SUPPORTED<br />
-&gt; 트랜잭션을 필요로 하지않음을 의미한다.<br />
-&gt; 트랜잭션이 있으면 메서드 실행이 종료될때까지 진행중인 트랜잭션은 중지되며<br />
메서드 실행이 종료되면 트랜잭션을 계속 진행한다.</p>
  </li>
  <li>
    <p>Propagation.NEVER<br />
-&gt; 트랜잭션을 필요로하지 않음을 의미한다.<br />
-&gt; 진행 중인 트랜잭션이 존재할 경우에는 예외를 발생시킨다.</p>
  </li>
</ol>

<h3 id="transaction-격리-수준">Transaction 격리 수준</h3>
<ol>
  <li>
    <p>UNCOMMITED  <br />
-&gt; 커밋되지 않은 읽기<br />
-&gt; 다른 트랜잭션에서 커밋하지 않은 데이터를 읽는 것을 허용</p>
  </li>
  <li>
    <p>READ COMMITTED<br />
-&gt; 커밋된 읽기  <br />
-&gt; 다른 트랜잭션에 의해 커밋된 데이터를 읽는 것을 허용합니다.</p>
  </li>
  <li>
    <p>REPEATABLE READ<br />
-&gt; 반복 가능한 읽기 <br />
-&gt; 트랜잭션 내에서 한 번 조회한 데이터를 반복해서 조회해도 같은 데이터가 조회되도록 합니다.</p>
  </li>
  <li>
    <p>SERIALIZABLE<br />
-&gt; 직렬화 가능<br />
-&gt; 동일한 데이터에 대해서 동시에 두 개 이상의 트랜잭션이 수행되지 못하도록 합니다.</p>
  </li>
</ol>

<p><br /></p>

<h2 id="event">Event</h2>
<h3 id="event-란">Event 란?</h3>
<p>Spring 내부에는 Evnet라는 매커니즘을 가지고 있다고한다.<br />
<strong>Bean과 Bean사이에 데이터를 전달하는 방법</strong>중 하나이다.</p>

<p>일반적으로는 스프링컨테이너의 빈을 주입할때 DI를 이용한다<br />
Evnet를 이용해 객체를 넘겨줄 수도 있다는 말이다.</p>

<p><br /></p>

<h3 id="evnet-사용방법">Evnet 사용방법</h3>
<p>사용방법은 간단하다</p>
<ol>
  <li>publisher(발행)로 이벤트를 발생시킨다</li>
  <li>listener로 이벤트를 받는다.</li>
</ol>

<p>publisher로 발행시키는 방법은 <br />
ApplicationEventPublisher 클래스의 .publishEvent();<br />
메서드를 통해서 발행시킬 수 있다.</p>

<p>트랜잭션과 연동시켜 한번 예제를 만들어보자</p>

<p>간단한 예제로 Member 클래스에는 여러가지 정보가 있다고 가정하고<br />
회원가입을 눌러 POST매서드를 통해 Service로직이 호출된다 가정해보자</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Slf4j</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="nd">@Transactional</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberService</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">ApplicationEventPublisher</span> <span class="n">publisher</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">Member</span> <span class="nf">createMember</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Member</span> <span class="n">savedMember</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
        <span class="n">publisher</span><span class="o">.</span><span class="na">publishEvent</span><span class="o">(</span><span class="k">new</span> <span class="nc">MemberCreatedEvent</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">savedMember</span><span class="o">));</span> <span class="c1">// 이벤트 발생시키기</span>
        <span class="k">return</span> <span class="n">savedMember</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>
<p>간단한 코드로 ApplicationEventPublisher 객체를 스프링컨테이너를 통해<br />
주입받은 객체 publisher로 이벤트를 발생시키는 메서드를 실행시킨다.<br />
해당 객체에는 Event 정보를 담은 객체가 들어있어야한다.</p>

<p>정보를 담은 객체를 따로 만들기위해 클래스를 만들었다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Getter</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberCreatedEvent</span> <span class="kd">extends</span> <span class="nc">ApplicationEvent</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Member</span> <span class="n">member</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">MemberCreatedEvent</span><span class="o">(</span><span class="nc">Object</span> <span class="n">source</span><span class="o">,</span> <span class="nc">Member</span> <span class="n">member</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">source</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">member</span> <span class="o">=</span> <span class="n">member</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>MemberCreatedEvent라는 객체를 Event하여<br />
우리는 이제 Listenr를 통해 객체를 받을 수 있다.</p>

<p>Listener 클래스를 만들어보자</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberCreatedEventListener</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">EmailSender</span> <span class="n">emailSender</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MemberService</span> <span class="n">memberService</span><span class="o">;</span>
    
    <span class="nd">@EventListener</span> <span class="c1">// EventListener로 Event 객체 가져옴</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">listener</span><span class="o">(</span><span class="nc">MemberCreatedEvent</span> <span class="n">event</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">String</span> <span class="n">message</span> <span class="o">=</span> <span class="s">"message test"</span><span class="o">;</span>
            <span class="n">emailSender</span><span class="o">.</span><span class="na">sendEmail</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">MailSendException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"MailSendException, rollback"</span><span class="o">);</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>@EventListener 어노테이션을 사용한<br />
메서드는 Event로 발행한 객체를 가져올 수 있다.</p>

<p>Service 로직이 실행되어질때 Evnet 메서드를 만나는 순간<br />
제어의 흐름이 Listener 클래스로 넘어오게 되어진다.</p>

<p>위에 예제는 간단하게 email을 보내는 예제로 작성하였고<br />
메서드를 실행하면 5초뒤에 MailSendException이라는<br />
Checked Exception을 발생하게 코드를 작성하였다.</p>

<p>실제 로직을 실행할 경우</p>
<ol>
  <li>Service로직에서 Event 발행하여 Listener 호출</li>
  <li>Listener 클래스에서 Event 타입과 맞는객체를 찾아 객체를 주입</li>
  <li>.sendEmail(message)에서 Checked Exception 발생</li>
  <li>Checked Exception은 rollback이 안되기때문에 Unchecked <br />
Exception으로 다시 예외처리(RuntimeException)</li>
  <li>최종적으로 rollback하여 기존에 처리되어진 작업 종료</li>
</ol>

<p>위와 같이 동작하는 모습을 볼 수 있다.</p>

<p><br /></p>

<h2 id="async">@Async</h2>
<p>스프링 프레임워크에서 지원하는 비동기 처리 방식이다.<br />
해당 어노테이션을 이해하기 위해선 멀티쓰레드, 동기, 비동기에<br />
이해가 필요하다.</p>

<p>정말 간단하게 정리하자면<br />
동기 - 하나의 쓰레드에서 같은 제어흐름을 가짐<br />
비동기 - 멀티쓰레드로 서로 다르게 제어흐름을가짐</p>

<p>이라고 생각해볼 수 있을 것 같다.</p>

<p>간단하게 위에서 보았던 코드 예제로 본다면<br />
MemberService에서 하나의 쓰레드로<br />
Event를 발행시키고 Listener 메서드로 호출되게 되어<br />
최종적으로 Unchecked Exception이 발생하여<br />
rollback(); 되어지는 모습을 확인할 수 있다.</p>

<p>만약 위에 코드에서 @Async를 적용하여<br />
해당 메서드를 비동기로 가져갈 수가 있다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="nd">@Slf4j</span>
<span class="nd">@EnableAsync</span> <span class="c1">// 비동기 사용가능하도록 설정</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemberCreatedEventListener</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">EmailSender</span> <span class="n">emailSender</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MemberService</span> <span class="n">memberService</span><span class="o">;</span>

    <span class="nd">@Async</span> <span class="c1">// 비동기로 이메일 전달하도록 변경</span>
    <span class="nd">@EventListener</span> 
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">listener</span><span class="o">(</span><span class="nc">MemberCreatedEvent</span> <span class="n">event</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">String</span> <span class="n">message</span> <span class="o">=</span> <span class="s">"message test"</span><span class="o">;</span>
            <span class="n">emailSender</span><span class="o">.</span><span class="na">sendEmail</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">MailSendException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"MailSendException, rollback"</span><span class="o">);</span>
            <span class="n">memberService</span><span class="o">.</span><span class="na">deleteMember</span><span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">getMember</span><span class="o">().</span><span class="na">getMemberId</span><span class="o">());</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>@EnableAsync , @Async 어노테이션을 이용해<br />
listenr라는 메서드는 비동기상태가 되었다.<br />
즉, MemberSerivce 로직에서 호출하여도 제어의 흐름은<br />
MemberSerivce는 본인 쓰레드대로 진행하고</p>

<p>listenr 메서드는 별도의 쓰레드가 생겨 진행하게된다.</p>

<hr />
<p>오늘은 이렇게 Evnet와 Transaction에 대해<br />
조금 더 알아보는 시간을 가졌다.</p>

<p>대략적인 내용과 이해는 어느정도 된 것 같다.<br />
하지만 트랜잭션 어노테이션이 해주는 기능이 너무 풍부하기때문에<br />
오히려 내지식의 한계가 보여지는 것 같다.</p>

<p>실제 내부에서 어떻게 동작하는지를 알아야<br />
트래잭션에 대해 완벽히 이해했다고 할 수 있을 것 같다.<br />
지금은 대략 적인 그림으로만 머릿속에서 그려지지만<br />
후에 어드밴스한 공부를 통해 트랜잭션을 다시 정복해보자</p>

<p>오늘 공부는 여기서 끝!!</p>

<p><br /></p>

<p><span style="color:#994C00"><strong>오늘의 커피량</strong></span>: ☕️ ☕️ ☕️<br />
<strong>오늘의 점심</strong>: 카레, 김치찌개</p>]]></content><author><name>LEE JAEHYEOK</name></author><category term="TIL" /><category term="TIL" /><category term="부트캠프" /><category term="코드스테이츠" /><summary type="html"><![CDATA[날씨도 선선하니 기분좋은 월요일 시작이다.]]></summary></entry></feed>