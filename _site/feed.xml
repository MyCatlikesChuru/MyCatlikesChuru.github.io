<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.3.0">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2022-12-29T22:27:40+09:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">LeeJellan</title><subtitle>안녕하세요!🙂 IT,여행,기타 등 기록을 남기기위한 블로그 입니다 !</subtitle><author><name>LEE JAEHYEOK</name></author><entry><title type="html">MySQL EC2에 설치후 WorkBench 접속하기</title><link href="http://localhost:4000/db/2022/12/28/db-mysqlEC2.html" rel="alternate" type="text/html" title="MySQL EC2에 설치후 WorkBench 접속하기" /><published>2022-12-28T00:00:00+09:00</published><updated>2022-12-28T00:00:00+09:00</updated><id>http://localhost:4000/db/2022/12/28/db-mysqlEC2</id><content type="html" xml:base="http://localhost:4000/db/2022/12/28/db-mysqlEC2.html"><![CDATA[<p>EC2에 MySQL을 설치한다음<br />
WorkBench로 접속하려는데 설정한 내용을 정리해보려한다.<br />
MySQL 설치과정은 생략하겠다.</p>

<p><br /></p>

<h4 id="-yml-파일-설정">📌 yml 파일 설정</h4>

<p>우선 EC2에 배포한 스프링 <code class="language-plaintext highlighter-rouge">.yml</code> 파일 설정이다.<br />
기존과 동일하게 <code class="language-plaintext highlighter-rouge">localhost:3306</code>으로 설정을 해주었고</p>

<p>스키마 이름은 stackover라는 이름으로지 지정했다.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">spring</span><span class="pi">:</span>
  <span class="na">datasource</span><span class="pi">:</span>
    <span class="na">driver-class-name</span><span class="pi">:</span> <span class="s">com.mysql.cj.jdbc.Driver</span>
    <span class="na">url</span><span class="pi">:</span> <span class="s">jdbc:mysql://localhost:3306/stackover?serverTimezone=Asia/Seoul</span> <span class="c1"># 포트넘버, 스키마이름</span>
    <span class="na">username</span><span class="pi">:</span> <span class="s">${MYSQL_ID}</span> <span class="c1"># 유저네임</span>
    <span class="na">password</span><span class="pi">:</span> <span class="s">${MYSQL_PASSWORD}</span> <span class="c1"># 비밀번호</span>
</code></pre></div></div>

<p>환경변수를 사용해 유저이름과 비밀번호를 지정해줬다.</p>

<p><br /></p>

<h4 id="-ec2-설정">📌 EC2 설정</h4>

<p><strong>첫번쨰</strong>로 EC2 보안그룹의 인바운드 규칙을 설정해줘야한다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gN095iTdhlGaDzXDoZONY9_byOM5RVo22mey2JsVdznjSR1iAFXH3SeeTRFq2MaN2FCRYRU7O8iAwqpF0rpulNSiOhkKg=w1920-h920" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>MYSQL을 선택하고 0.0.0.0/0 을 지정해주었다.</p>

<p><br /></p>

<p><strong>두번째</strong>로는 EC2의 <code class="language-plaintext highlighter-rouge">mysqld.cnf</code> 파일의 내용을 수정해줘야한다.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /etc/mysql/mysql.conf.d
</code></pre></div></div>
<p>해당 경로에 진입하면 <code class="language-plaintext highlighter-rouge">mysqld.conf</code> 파일을 열 수 있고</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>vi mysqld.cnf
</code></pre></div></div>
<p>sudo를 이용해야 저장이 가능하다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOPpSA6Dj0VxEP0QUnOJuYtmaV64BdOTsIT_o2mvPCkZHCKxSQaPSVtVXAc4UZqFLGDwoyFIrAOfKw8_9fq_2oG6lFG=w1920-h920" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>파일의 bind-address를 <code class="language-plaintext highlighter-rouge">0.0.0.0</code>으로 설정 해주었고<br />
mysqlx-bind-address는 주석처리를 해주었다.</p>

<p><br /></p>

<p><strong>세번째</strong>로는 User 계정을 생성하고<br />
해당 계정에 권한을 부여해주었다.</p>

<p>✅ <strong>mysql 접속</strong></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql <span class="nt">-u</span> root <span class="nt">-p</span>
</code></pre></div></div>
<p>처음에는 root 계정으로 진입하면 mysql에 접속이 가능하다.<br />
만약 root 계정에 비밀번호를 설정하지 않았을 경우에는</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql <span class="nt">-u</span> root
</code></pre></div></div>
<p>명령어로 접근한 다음에</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ALTER USER <span class="s1">'root'</span>@<span class="s1">'localhost'</span> IDENTIFIED WITH mysql_native_password BY <span class="s1">'yourPassword'</span><span class="p">;</span>
</code></pre></div></div>
<p>yourPassword에 원하는 비밀번호를 입력해 root 계정에<br />
비밀번호를 설정해 줄 수 있다.</p>

<p><br /></p>

<p>✅ <strong>유저 생성</strong><br />
이제 mysql에 접속이 완료되었다면</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT user,authentication_string,plugin,host FROM mysql.user<span class="p">;</span>
</code></pre></div></div>
<p>명령어로 등록된 user 정보를 확인할 수 있다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gO-FEGjAwEuSnVLX_OZnmrstM6XDpJZRgPzMGhUCNxJJmQ-ob0QO97XihuOkInNrM8Iy0-9WSM9bBu9z1kaeUmBM_cErg=w1920-h920" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>user가 현재 내가 만들어둔 계정이고 기본으로는 root가 있다.<br />
그리고 host를 %로 변경해주면 외부에서도 진입이 가능해진다.</p>

<p>이제 계정을 하나 만들어보자</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>create user 유저이름@‘%’ identified by ‘비밀번호’<span class="p">;</span>
</code></pre></div></div>
<p>유저이름과 비밀번호를 입력해 계정을 생성할 수 있다.<br />
만약 비밀번호를 변경하고 싶은경우 위에서 root계정 비밀번호를 변경할 때<br />
사용했던 명령어를 입력해주면 비밀번호를 변경할 수 있다.</p>

<p><br /></p>

<p>✅ <strong>유저 삭제</strong><br />
혹시나 유저를 삭제하고 싶은 경우에는</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>drop user 유저이름@localhost<span class="p">;</span>
</code></pre></div></div>
<p>과 같이 입력해주면 삭제가 가능핟.</p>

<p>✅ <strong>유저 권한부여</strong><br />
이제 유저를 만들었으니<br />
유저에 대한 권한을 설정해주면 된다.</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>grant all privileges on <span class="k">*</span>.<span class="k">*</span> to ‘유저이름’@‘%’<span class="p">;</span>
</code></pre></div></div>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>flush privileges<span class="p">;</span>
</code></pre></div></div>
<p>정상적으로 처리가 완료되었다면 쿼리가 날라갔다고 메세지가 나온다.</p>

<p>전부 완료를 하고나면 <code class="language-plaintext highlighter-rouge">quit</code>로 mysql을 나온다음에<br />
우분투 터미널에서</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl restart mysql
</code></pre></div></div>
<p>해당 명령어를 입력해 mysql을 재실행 시켜주자</p>

<p>위 과정이 전부 완료되었다면<br />
방금 만든 계정과 비밀번호, 그리고 EC2 공개 IP를 이용해</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gNtl81ccvr2i_SPrMZV_lXTrzZ82HmAX4GffSwHZ0ZRV69bgx16OnwlRwzCVC5YdY1AZL3XQU4lMfH71k-aaMFMmcaIOA=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>위와 같이 정상적으로 WorkBench에 접속할 수 있을 것이다!!!</p>

<p><br /></p>

<p>혹시나 아래와 같은 알람이 발생한 경우에는<br />
<code class="language-plaintext highlighter-rouge">Unable to connect to localhost</code></p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gNjgebqbY9sS3D33Pd29TXwqg6DDU4JIE9Go_c3XFDnw_1RgPPaIsywivrZapu1dPIvXURNgUn-mwRKe4kMYuh2uyuOGw=w1000-h920" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>나와 같은 경우에는 EC2 인바운드 규칙 설정과 <br />
<code class="language-plaintext highlighter-rouge">mysqld.conf</code> 설정한 값이 맞지 않아서 였다.<br />
혹시나 참고차 올려본다.</p>

<p><br /></p>

<p><a href="https://changun516.tistory.com/55">에러 해결 참고 레퍼런스</a>, <a href="https://velog.io/@woals4815/MySQL-%EC%99%B8%EB%B6%80-%EC%A0%91%EC%86%8D-%ED%95%98%EA%B8%B0MySQLWorkbench-%EC%9D%B4%EC%9A%A9">MySQL 외부 접속 참고 레퍼런스</a></p>]]></content><author><name>LEE JAEHYEOK</name></author><category term="DB" /><category term="DB" /><category term="MySQL" /><summary type="html"><![CDATA[EC2에 MySQL을 설치한다음 WorkBench로 접속하려는데 설정한 내용을 정리해보려한다. MySQL 설치과정은 생략하겠다.]]></summary></entry><entry><title type="html">GIT) pull rebase 사용해 병합하기</title><link href="http://localhost:4000/git/2022/12/27/git-rebase.html" rel="alternate" type="text/html" title="GIT) pull rebase 사용해 병합하기" /><published>2022-12-27T00:00:00+09:00</published><updated>2022-12-27T00:00:00+09:00</updated><id>http://localhost:4000/git/2022/12/27/git-rebase</id><content type="html" xml:base="http://localhost:4000/git/2022/12/27/git-rebase.html"><![CDATA[<p>자주 사용하는 <code class="language-plaintext highlighter-rouge">git pull --rebase</code>에 대해 정리해보려한다.</p>

<p>협업을 같이하다보면 지속적으로 업데이트를 하기 위해서<br />
pull을 하거나 remote를 가져오기위해 fetch를 진행한다.</p>

<p><code class="language-plaintext highlighter-rouge">dev/back</code> 이라는 브랜치가 백엔드끼리<br />
통합을 해서 사용하는 브랜치라고 가정하자.</p>

<p>내가 작업하는 브랜치는 <code class="language-plaintext highlighter-rouge">feat/BE/security</code>라고 하였을때<br />
누군가 <code class="language-plaintext highlighter-rouge">dev/back</code>에 작업을 하고 Pull Reqeust하여 Merge를 했다고<br />
가정을 해보면. 현재 <code class="language-plaintext highlighter-rouge">dev/back</code> 브랜치의 프로그램이 가장 최신본이다.</p>

<p>내가 작업하고있는 브랜치를 최신화 시키고 싶을때<br />
<code class="language-plaintext highlighter-rouge">dev/back</code>에 있는 브랜치를 Pull해오면 된다.</p>

<p><br /></p>

<p>❓ 하지만 다른 사람이 작업한 부분과, 내가 작업한 부분이 겹쳤다면 ❓</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git pull origin dev/back
</code></pre></div></div>
<p>위와 같이 명령을 해보아도 충돌이 나면서 작업이 진행 되지 않을 것이다.</p>

<p>그럴 경우에는</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git pull origin dev/back <span class="nt">--rebase</span>
</code></pre></div></div>
<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOqQhmglDI2UIHVJDTnu_WjQLPnk7ACMDkNhUQ8pUmoiPsPtl5a6FiYF24npWp_kUbadQXyjMgiXwYr8GY8sO1zc7DT=w1000-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>위와 같이 입력을 해주면, 파일이 합쳐진 것이고<br />
이제 합쳐진 파일에서 겹친 부분을 수정을 해주면 된다. <br />
참고로 브랜치 이름이 e1604ec 이렇게 바뀐 모습을 볼 수 있다.</p>

<p>수정을 다완료 하고 나면</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git rebase <span class="nt">--continue</span>
</code></pre></div></div>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOWB8ml5xWzFozG2oMTnw1eaXLbQ1b_QIq1MrWs-tKPmPDH2ZmzkNog4m6Cc6uanCpaDIl1sM7xJdtwTbHSXZzfm_oaZw=w1000-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>를 입력해줘서 다음 rebase할 커밋으로 넘어가주면 된다.<br />
만약 다음에 수정할게 없다면</p>

<p><br /></p>

<p>아래와 같이 원래 브랜치 <code class="language-plaintext highlighter-rouge">feat/BE/security</code>로 바뀐 모습을 볼 수 있다. <br />
이제 rebase완료된 파일을 <code class="language-plaintext highlighter-rouge">feat/BE/security</code> 브랜치로 올려주면 된다.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git push origin feat/BE/security
</code></pre></div></div>
<p>를 입력해주면 push를 할 수 있는데</p>

<p>아래와 같은 에러에 마주하였을 경우에는</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOdfaYWqeGvo785fk05WiwizoOoQKdb9R5ikh015iBPfyVqi-YAhsbhv-Quy79xtXbxja6tJxRaWX_QyBbvp_I_sGBj0A=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>합쳐진게 전부 잘 수정했다고 가정하면</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git push origin feat/BE/security <span class="nt">-ff</span>
</code></pre></div></div>
<p>를 입력해 레파지토리에 강제로 push할 수 있다.</p>

<p><br />
<br />
<br /></p>]]></content><author><name>LEE JAEHYEOK</name></author><category term="GIT" /><category term="GIT" /><category term="GITHUB" /><summary type="html"><![CDATA[자주 사용하는 git pull --rebase에 대해 정리해보려한다.]]></summary></entry><entry><title type="html">Spring) Security Test 코드 작성시 UserDetails 설정</title><link href="http://localhost:4000/spring/2022/12/27/spring-JunitSecure.html" rel="alternate" type="text/html" title="Spring) Security Test 코드 작성시 UserDetails 설정" /><published>2022-12-27T00:00:00+09:00</published><updated>2022-12-27T00:00:00+09:00</updated><id>http://localhost:4000/spring/2022/12/27/spring-JunitSecure</id><content type="html" xml:base="http://localhost:4000/spring/2022/12/27/spring-JunitSecure.html"><![CDATA[<p>오늘 겪은 문제를 정리해보려한다.<br />
Spring Security + JWT + OAuth2 인증,인가를 사용하여<br />
정상적으로 API 작동까지 Postman으로 마친 상태이다.</p>

<p>문제는 Rest Docs를 적용하기 위해<br />
Test 코드를 작성중 Spring Security 문제와 부딪히게 된 것 !!</p>

<p><br /></p>

<h4 id="-문제-발생-403-forbidden">📌 문제 발생 (403 Forbidden)</h4>

<p>기존과 동일하게 POST 요청을 보내 보았다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nd">@Test</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"질문 작성 API : createQuestion"</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">createQuestion</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

        <span class="nc">QuestionPostDto</span> <span class="n">questionPostDto</span> <span class="o">=</span> <span class="o">(</span><span class="nc">QuestionPostDto</span><span class="o">)</span> <span class="nc">StubData</span><span class="o">.</span><span class="na">MockQuestion</span><span class="o">.</span><span class="na">getRequestBody</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">);</span>
        <span class="nc">Question</span> <span class="n">question</span> <span class="o">=</span> <span class="nc">StubData</span><span class="o">.</span><span class="na">MockQuestion</span><span class="o">.</span><span class="na">getSingleResponseBody</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tag</span><span class="o">&gt;</span> <span class="n">tagList</span> <span class="o">=</span> <span class="nc">StubData</span><span class="o">.</span><span class="na">MockTag</span><span class="o">.</span><span class="na">getSingleResponseBody</span><span class="o">();</span>
        <span class="nc">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="nc">StubData</span><span class="o">.</span><span class="na">MockMember</span><span class="o">.</span><span class="na">getSingleResponseBody</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>

        <span class="n">given</span><span class="o">(</span><span class="n">tagService</span><span class="o">.</span><span class="na">findTags</span><span class="o">(</span><span class="nc">Mockito</span><span class="o">.</span><span class="na">any</span><span class="o">(</span><span class="nc">QuestionPostDto</span><span class="o">.</span><span class="na">class</span><span class="o">))).</span><span class="na">willReturn</span><span class="o">(</span><span class="n">tagList</span><span class="o">);</span>
        <span class="n">given</span><span class="o">(</span><span class="n">memberService</span><span class="o">.</span><span class="na">findByMember</span><span class="o">(</span><span class="nc">Mockito</span><span class="o">.</span><span class="na">anyLong</span><span class="o">())).</span><span class="na">willReturn</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
        <span class="n">given</span><span class="o">(</span><span class="n">questionService</span><span class="o">.</span><span class="na">postQuestion</span><span class="o">(</span><span class="nc">Mockito</span><span class="o">.</span><span class="na">any</span><span class="o">(</span><span class="nc">Question</span><span class="o">.</span><span class="na">class</span><span class="o">))).</span><span class="na">willReturn</span><span class="o">(</span><span class="n">question</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">content</span> <span class="o">=</span> <span class="n">toJsonContent</span><span class="o">(</span><span class="n">questionPostDto</span><span class="o">);</span>
        <span class="nc">ResultActions</span> <span class="n">actions</span> <span class="o">=</span> <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">postRequestBuilder</span><span class="o">(</span><span class="n">getUrlCreateQuestion</span><span class="o">(),</span> <span class="n">content</span><span class="o">));</span>

        <span class="n">actions</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">isOk</span><span class="o">());</span>
    <span class="o">}</span>
</code></pre></div></div>
<p>복잡해보일 수 있겠지만… 단순히 메서드화 시켜서<br />
여러군대에서 범용성있게 사용하려고 나타낸 것이다.</p>

<p>중요한 부분은 <code class="language-plaintext highlighter-rouge">mockMvc.perform();</code>에서 Json 객체를 담고<br />
Url을 만들어 보내준다. 내용을 살펴 보면</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ControllerTestHelper</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="o">...</span>

    <span class="k">default</span> <span class="nc">RequestBuilder</span> <span class="nf">postRequestBuilder</span><span class="o">(</span><span class="nc">String</span> <span class="n">url</span><span class="o">,</span>
                                              <span class="nc">String</span> <span class="n">content</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">post</span><span class="o">(</span><span class="n">url</span><span class="o">)</span>
                <span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
                <span class="o">.</span><span class="na">contentType</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
                <span class="o">.</span><span class="na">content</span><span class="o">(</span><span class="n">content</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>
<p>이렇게 단순히 인터페이스로 만들어 사용하고 있다.<br />
URL 같은 경우는 다른 클래스에서 <code class="language-plaintext highlighter-rouge">getUrlCreateQuestion()</code><br />
메서드를 이용해 만들어 넘기도록 했다.</p>

<p>메세지는 아래와 같이 요청과 응답이 왔다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">MockHttpServletRequest:</span>
      <span class="no">HTTP</span> <span class="nc">Method</span> <span class="o">=</span> <span class="no">POST</span>
      <span class="nc">Request</span> <span class="no">URI</span> <span class="o">=</span> <span class="o">/</span><span class="n">questions</span><span class="o">/</span><span class="n">ask</span><span class="o">/</span><span class="n">post</span>
       <span class="nc">Parameters</span> <span class="o">=</span> <span class="o">{}</span>
          <span class="nc">Headers</span> <span class="o">=</span> <span class="o">[</span><span class="nc">Content</span><span class="o">-</span><span class="nl">Type:</span><span class="s">"application/json;charset=UTF-8"</span><span class="o">,</span> <span class="nl">Accept:</span><span class="s">"application/json"</span><span class="o">,</span> <span class="nc">Content</span><span class="o">-</span><span class="nl">Length:</span><span class="s">"187"</span><span class="o">]</span>
             <span class="nc">Body</span> <span class="o">=</span> <span class="o">{</span><span class="s">"email"</span><span class="o">:</span><span class="s">"dhfif718@gmail.com"</span><span class="o">,</span><span class="s">"questionTitle"</span><span class="o">:</span><span class="s">"질문 제목 입니다."</span><span class="o">,</span><span class="s">"questionProblemBody"</span><span class="o">:</span><span class="s">"질문 내용 1"</span><span class="o">,</span><span class="s">"questionTryOrExpectingBody"</span><span class="o">:</span><span class="s">"질문 내용 2"</span><span class="o">,</span><span class="s">"tag"</span><span class="o">:[{</span><span class="s">"tagName"</span><span class="o">:</span><span class="s">"java"</span><span class="o">}]}</span>
    <span class="nc">Session</span> <span class="nc">Attrs</span> <span class="o">=</span> <span class="o">{</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">csrf</span><span class="o">.</span><span class="na">HttpSessionCsrfTokenRepository</span><span class="o">.</span><span class="na">CSRF_TOKEN</span><span class="o">=</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">csrf</span><span class="o">.</span><span class="na">DefaultCsrfToken</span><span class="err">@</span><span class="mi">25</span><span class="n">f14e93</span><span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">MockHttpServletResponse:</span>
           <span class="nc">Status</span> <span class="o">=</span> <span class="mi">403</span>
    <span class="nc">Error</span> <span class="n">message</span> <span class="o">=</span> <span class="nc">Forbidden</span>
          <span class="nc">Headers</span> <span class="o">=</span> <span class="o">[</span><span class="no">X</span><span class="o">-</span><span class="nc">Content</span><span class="o">-</span><span class="nc">Type</span><span class="o">-</span><span class="nl">Options:</span><span class="s">"nosniff"</span><span class="o">,</span> <span class="no">X</span><span class="o">-</span><span class="no">XSS</span><span class="o">-</span><span class="nl">Protection:</span><span class="s">"1; mode=block"</span><span class="o">,</span> <span class="nc">Cache</span><span class="o">-</span><span class="nl">Control:</span><span class="s">"no-cache, no-store, max-age=0, must-revalidate"</span><span class="o">,</span> <span class="nl">Pragma:</span><span class="s">"no-cache"</span><span class="o">,</span> <span class="nl">Expires:</span><span class="s">"0"</span><span class="o">,</span> <span class="no">X</span><span class="o">-</span><span class="nc">Frame</span><span class="o">-</span><span class="nl">Options:</span><span class="s">"DENY"</span><span class="o">]</span>
     <span class="nc">Content</span> <span class="n">type</span> <span class="o">=</span> <span class="kc">null</span>
             <span class="nc">Body</span> <span class="o">=</span> 
    <span class="nc">Forwarded</span> <span class="no">URL</span> <span class="o">=</span> <span class="kc">null</span>
   <span class="nc">Redirected</span> <span class="no">URL</span> <span class="o">=</span> <span class="kc">null</span>
          <span class="nc">Cookies</span> <span class="o">=</span> <span class="o">[]</span>
</code></pre></div></div>
<p>여기서 이제 403 <code class="language-plaintext highlighter-rouge">Forbidden</code> 문제가 발생했고…<br />
어떻게 해결을 할지 찾아 보던 중  <code class="language-plaintext highlighter-rouge">@WithMockUser</code>어노테이션을<br />
이용해 인증을 통과시켜 줄 수 있고, <code class="language-plaintext highlighter-rouge">mockMvc.perform()</code> 메서드에<br />
<code class="language-plaintext highlighter-rouge">post</code>호출시 <code class="language-plaintext highlighter-rouge">.with(csrf();</code>를 붙여주면 csrf 토큰을 생성할 수 있다.</p>

<p><br /></p>

<h4 id="-withmockuser-withcsrf-설정">📌 @WithMockUser, with(csrf()); 설정</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nd">@Test</span>
    <span class="nd">@WithMockUser</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"질문 작성 API : createQuestion"</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">createQuestion</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

        <span class="nc">QuestionPostDto</span> <span class="n">questionPostDto</span> <span class="o">=</span> <span class="o">(</span><span class="nc">QuestionPostDto</span><span class="o">)</span> <span class="nc">StubData</span><span class="o">.</span><span class="na">MockQuestion</span><span class="o">.</span><span class="na">getRequestBody</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">);</span>
        <span class="nc">Question</span> <span class="n">question</span> <span class="o">=</span> <span class="nc">StubData</span><span class="o">.</span><span class="na">MockQuestion</span><span class="o">.</span><span class="na">getSingleResponseBody</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tag</span><span class="o">&gt;</span> <span class="n">tagList</span> <span class="o">=</span> <span class="nc">StubData</span><span class="o">.</span><span class="na">MockTag</span><span class="o">.</span><span class="na">getSingleResponseBody</span><span class="o">();</span>
        <span class="nc">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="nc">StubData</span><span class="o">.</span><span class="na">MockMember</span><span class="o">.</span><span class="na">getSingleResponseBody</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>

        <span class="n">given</span><span class="o">(</span><span class="n">tagService</span><span class="o">.</span><span class="na">findTags</span><span class="o">(</span><span class="nc">Mockito</span><span class="o">.</span><span class="na">any</span><span class="o">(</span><span class="nc">QuestionPostDto</span><span class="o">.</span><span class="na">class</span><span class="o">))).</span><span class="na">willReturn</span><span class="o">(</span><span class="n">tagList</span><span class="o">);</span>
        <span class="n">given</span><span class="o">(</span><span class="n">memberService</span><span class="o">.</span><span class="na">findByMember</span><span class="o">(</span><span class="nc">Mockito</span><span class="o">.</span><span class="na">anyLong</span><span class="o">())).</span><span class="na">willReturn</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
        <span class="n">given</span><span class="o">(</span><span class="n">questionService</span><span class="o">.</span><span class="na">postQuestion</span><span class="o">(</span><span class="nc">Mockito</span><span class="o">.</span><span class="na">any</span><span class="o">(</span><span class="nc">Question</span><span class="o">.</span><span class="na">class</span><span class="o">))).</span><span class="na">willReturn</span><span class="o">(</span><span class="n">question</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">content</span> <span class="o">=</span> <span class="n">toJsonContent</span><span class="o">(</span><span class="n">questionPostDto</span><span class="o">);</span>
        <span class="nc">ResultActions</span> <span class="n">actions</span> <span class="o">=</span> <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">postRequestBuilder</span><span class="o">(</span><span class="n">getUrlCreateQuestion</span><span class="o">(),</span> <span class="n">content</span><span class="o">));</span>

        <span class="n">actions</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">isOk</span><span class="o">());</span>
    <span class="o">}</span>
</code></pre></div></div>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ControllerTestHelper</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="o">...</span>

    <span class="k">default</span> <span class="nc">RequestBuilder</span> <span class="nf">postRequestBuilder</span><span class="o">(</span><span class="nc">String</span> <span class="n">url</span><span class="o">,</span>
                                              <span class="nc">String</span> <span class="n">content</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">post</span><span class="o">(</span><span class="n">url</span><span class="o">)</span>
                <span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
                <span class="o">.</span><span class="na">contentType</span><span class="o">(</span><span class="nc">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
                <span class="o">.</span><span class="na">content</span><span class="o">(</span><span class="n">content</span><span class="o">)</span>
                <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">csrf</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>
<p>위에 클래스에서 <code class="language-plaintext highlighter-rouge">@WithMockUser</code>를 테스트 메서드에 붙여주고<br />
<code class="language-plaintext highlighter-rouge">mockMvc.perform()</code>의 <code class="language-plaintext highlighter-rouge">post()</code>의 <code class="language-plaintext highlighter-rouge">.with(csrf());</code>를 붙여 주었다.</p>

<p>테스트를 실행 시켜 보면<br />
아래와 같은 요청 응답 메세지가 만들어진다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">MockHttpServletRequest:</span>
      <span class="no">HTTP</span> <span class="nc">Method</span> <span class="o">=</span> <span class="no">POST</span>
      <span class="nc">Request</span> <span class="no">URI</span> <span class="o">=</span> <span class="o">/</span><span class="n">questions</span><span class="o">/</span><span class="n">ask</span><span class="o">/</span><span class="n">post</span>
       <span class="nc">Parameters</span> <span class="o">=</span> <span class="o">{</span><span class="n">_csrf</span><span class="o">=[</span><span class="n">b9be6017</span><span class="o">-</span><span class="mi">6</span><span class="n">b52</span><span class="o">-</span><span class="mi">464</span><span class="n">b</span><span class="o">-</span><span class="n">b5e1</span><span class="o">-</span><span class="mi">6</span><span class="n">f480569099b</span><span class="o">]}</span>
          <span class="nc">Headers</span> <span class="o">=</span> <span class="o">[</span><span class="nc">Content</span><span class="o">-</span><span class="nl">Type:</span><span class="s">"application/json;charset=UTF-8"</span><span class="o">,</span> <span class="nl">Accept:</span><span class="s">"application/json"</span><span class="o">,</span> <span class="nc">Content</span><span class="o">-</span><span class="nl">Length:</span><span class="s">"187"</span><span class="o">]</span>
             <span class="nc">Body</span> <span class="o">=</span> <span class="o">{</span><span class="s">"email"</span><span class="o">:</span><span class="s">"dhfif718@gmail.com"</span><span class="o">,</span><span class="s">"questionTitle"</span><span class="o">:</span><span class="s">"질문 제목 입니다."</span><span class="o">,</span><span class="s">"questionProblemBody"</span><span class="o">:</span><span class="s">"질문 내용 1"</span><span class="o">,</span><span class="s">"questionTryOrExpectingBody"</span><span class="o">:</span><span class="s">"질문 내용 2"</span><span class="o">,</span><span class="s">"tag"</span><span class="o">:[{</span><span class="s">"tagName"</span><span class="o">:</span><span class="s">"java"</span><span class="o">}]}</span>
    <span class="nc">Session</span> <span class="nc">Attrs</span> <span class="o">=</span> <span class="o">{</span><span class="no">SPRING_SECURITY_CONTEXT</span><span class="o">=</span><span class="nc">SecurityContextImpl</span> <span class="o">[</span><span class="nc">Authentication</span><span class="o">=</span><span class="nc">UsernamePasswordAuthenticationToken</span> <span class="o">[</span><span class="nc">Principal</span><span class="o">=</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">userdetails</span><span class="o">.</span><span class="na">User</span> <span class="o">[</span><span class="nc">Username</span><span class="o">=</span><span class="n">user</span><span class="o">,</span> <span class="nc">Password</span><span class="o">=[</span><span class="no">PROTECTED</span><span class="o">],</span> <span class="nc">Enabled</span><span class="o">=</span><span class="kc">true</span><span class="o">,</span> <span class="nc">AccountNonExpired</span><span class="o">=</span><span class="kc">true</span><span class="o">,</span> <span class="n">credentialsNonExpired</span><span class="o">=</span><span class="kc">true</span><span class="o">,</span> <span class="nc">AccountNonLocked</span><span class="o">=</span><span class="kc">true</span><span class="o">,</span> <span class="nc">Granted</span> <span class="nc">Authorities</span><span class="o">=[</span><span class="no">ROLE_USER</span><span class="o">]],</span> <span class="nc">Credentials</span><span class="o">=[</span><span class="no">PROTECTED</span><span class="o">],</span> <span class="nc">Authenticated</span><span class="o">=</span><span class="kc">true</span><span class="o">,</span> <span class="nc">Details</span><span class="o">=</span><span class="kc">null</span><span class="o">,</span> <span class="nc">Granted</span> <span class="nc">Authorities</span><span class="o">=[</span><span class="no">ROLE_USER</span><span class="o">]]]}</span>
</code></pre></div></div>
<p>Parameters를 확인해보면 csrf로 토큰이 생긴것을 확인할 수 있다. <br />
설정하지 않고 하였을때는 위에의 Parameters를 보면 알 수 있듯이<br />
비어있는 모습을 볼 수 있다.</p>

<p>하지만 여기서 또 하나의 문제가 발생한다.<br />
UserDetails의 설정이 되지 않아</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ClassCastException</span>
</code></pre></div></div>
<p>클래스 타입 관련 에러가 발생했고…</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">MockHttpServletResponse:</span>
           <span class="nc">Status</span> <span class="o">=</span> <span class="mi">500</span>
    <span class="nc">Error</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">null</span>
          <span class="nc">Headers</span> <span class="o">=</span> <span class="o">[</span><span class="nl">Vary:</span><span class="s">"Origin"</span><span class="o">,</span> <span class="s">"Access-Control-Request-Method"</span><span class="o">,</span> <span class="s">"Access-Control-Request-Headers"</span><span class="o">,</span> <span class="nc">Content</span><span class="o">-</span><span class="nl">Type:</span><span class="s">"application/json"</span><span class="o">,</span> <span class="no">X</span><span class="o">-</span><span class="nc">Content</span><span class="o">-</span><span class="nc">Type</span><span class="o">-</span><span class="nl">Options:</span><span class="s">"nosniff"</span><span class="o">,</span> <span class="no">X</span><span class="o">-</span><span class="no">XSS</span><span class="o">-</span><span class="nl">Protection:</span><span class="s">"1; mode=block"</span><span class="o">,</span> <span class="nc">Cache</span><span class="o">-</span><span class="nl">Control:</span><span class="s">"no-cache, no-store, max-age=0, must-revalidate"</span><span class="o">,</span> <span class="nl">Pragma:</span><span class="s">"no-cache"</span><span class="o">,</span> <span class="nl">Expires:</span><span class="s">"0"</span><span class="o">,</span> <span class="no">X</span><span class="o">-</span><span class="nc">Frame</span><span class="o">-</span><span class="nl">Options:</span><span class="s">"DENY"</span><span class="o">]</span>
     <span class="nc">Content</span> <span class="n">type</span> <span class="o">=</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>
             <span class="nc">Body</span> <span class="o">=</span> <span class="o">{</span><span class="s">"status"</span><span class="o">:</span><span class="mi">500</span><span class="o">,</span><span class="s">"message"</span><span class="o">:</span><span class="s">"Internal Server Error"</span><span class="o">,</span><span class="s">"fieldErrors"</span><span class="o">:</span><span class="kc">null</span><span class="o">,</span><span class="s">"violationErrors"</span><span class="o">:</span><span class="kc">null</span><span class="o">}</span>
    <span class="nc">Forwarded</span> <span class="no">URL</span> <span class="o">=</span> <span class="kc">null</span>
   <span class="nc">Redirected</span> <span class="no">URL</span> <span class="o">=</span> <span class="kc">null</span>
          <span class="nc">Cookies</span> <span class="o">=</span> <span class="o">[]</span>
</code></pre></div></div>
<p>응답 메세지에는 Error Handler로 작업한<br />
Body가 담겨져 500번 상태코드로 오류가 발생한 것을 볼 수있다..</p>

<p><br /></p>

<h4 id="-왜-예외가-발생했을까">📌 왜 예외가 발생했을까?</h4>

<p>UserDetails를 테스트 코드 패키지에 설정하지 않으면</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>java.lang.ClassCastException: class org.springframework.security.core.userdetails.User cannot be cast to class com.example.stackoverflowclone.global.security.auth.dto.TokenPrincipalDto (org.springframework.security.core.userdetails.User and com.example.stackoverflowclone.global.security.auth.dto.TokenPrincipalDto are in unnamed module of loader 'app')
</code></pre></div></div>
<p>위와 같은 에러가 발생할 수 있다. 그 이유는<br />
기존에 시큐리티 프로그램을 작성할 때</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebConfig</span> <span class="kd">implements</span> <span class="nc">WebMvcConfigurer</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addArgumentResolvers</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">HandlerMethodArgumentResolver</span><span class="o">&gt;</span> <span class="n">resolvers</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">resolvers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">LoginMemberIdResolver</span><span class="o">());</span>
        <span class="n">resolvers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">LoginMemberEmailResolver</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addCorsMappings</span><span class="o">(</span><span class="nc">CorsRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">registry</span>
                <span class="o">.</span><span class="na">addMapping</span><span class="o">(</span><span class="s">"/**"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">allowedOrigins</span><span class="o">(</span><span class="s">"*"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">allowedMethods</span><span class="o">(</span><span class="s">"*"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">WebMvcConfigurer</code>를 상속받아 <code class="language-plaintext highlighter-rouge">addArgumentResolvers()</code>를 <br />
오버라이딩해 어노테이이션을 만들어 구현해주었었다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginMemberIdResolver</span> <span class="kd">implements</span> <span class="nc">HandlerMethodArgumentResolver</span> <span class="o">{</span>

    <span class="o">...</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">resolveArgument</span><span class="o">(</span><span class="nc">MethodParameter</span> <span class="n">parameter</span><span class="o">,</span> <span class="nc">ModelAndViewContainer</span> <span class="n">mavContainer</span><span class="o">,</span>
                                  <span class="nc">NativeWebRequest</span> <span class="n">webRequest</span><span class="o">,</span> <span class="nc">WebDataBinderFactory</span> <span class="n">binderFactory</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

        <span class="nc">Object</span> <span class="n">principal</span> <span class="o">=</span> <span class="nc">SecurityContextHolder</span><span class="o">.</span><span class="na">getContext</span><span class="o">().</span><span class="na">getAuthentication</span><span class="o">().</span><span class="na">getPrincipal</span><span class="o">();</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">principal</span> <span class="o">==</span> <span class="s">"anonymousUser"</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1L</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nc">TokenPrincipalDto</span> <span class="n">castedPrincipal</span> <span class="o">=</span> <span class="o">(</span><span class="nc">TokenPrincipalDto</span><span class="o">)</span> <span class="n">principal</span><span class="o">;</span> <span class="c1">// &lt;---- ClassCast 예외 발생 지점</span>

        <span class="k">return</span> <span class="n">castedPrincipal</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>해당 클래스에서 예외 발생지점은 위에 주석처리한 부분이다.<br />
Test 코드를 실행할 경우에<br />
기본적으로 <code class="language-plaintext highlighter-rouge">User</code> 객체가 담겨져서 오게된다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">core</span><span class="o">.</span><span class="na">userdetails</span><span class="o">.</span><span class="na">User</span> <span class="o">[</span><span class="nc">Username</span><span class="o">=</span><span class="n">user</span><span class="o">,</span> <span class="nc">Password</span><span class="o">=[</span><span class="no">PROTECTED</span><span class="o">],</span> <span class="nc">Enabled</span><span class="o">=</span><span class="kc">true</span><span class="o">,</span> <span class="nc">AccountNonExpired</span><span class="o">=</span><span class="kc">true</span><span class="o">,</span> <span class="n">credentialsNonExpired</span><span class="o">=</span><span class="kc">true</span><span class="o">,</span> <span class="nc">AccountNonLocked</span><span class="o">=</span><span class="kc">true</span><span class="o">,</span> <span class="nc">Granted</span> <span class="nc">Authorities</span><span class="o">=[</span><span class="no">ROLE_USER</span><span class="o">]]</span>
</code></pre></div></div>
<p>와 같은 형태로 객체가 출력되었다.</p>

<p>나는 <code class="language-plaintext highlighter-rouge">TokenPrincipalDto</code>라는 클래스를 만들어</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TokenPrincipalDto</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">email</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Authentication</span> <span class="n">authentication</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UsernamePasswordAuthenticationToken</span><span class="o">(</span><span class="k">new</span> <span class="nc">TokenPrincipalDto</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">email</span><span class="o">),</span> <span class="kc">null</span><span class="o">,</span> <span class="n">authorities</span><span class="o">);</span>
</code></pre></div></div>
<p>과 같은 방식으로 Principal을 만들어 주었는데<br />
테스트 코드에서는 해당 부분이 설정되어 있지 않아 발생하는<br />
ClassCastException 타입변환 예외 였다.</p>

<p><br /></p>

<h4 id="-test-코드-작성시-userdetails-하기">📌 Test 코드 작성시 UserDetails 하기</h4>

<p>그렇다면 테스트 환경에서도 동일하게<br />
Principal에 <code class="language-plaintext highlighter-rouge">TokenPrincipalDto</code>객체를 만들어 넣어주면 된다.</p>

<p>만드는 방법을 차근차근 알아보자</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="nd">@WithSecurityContext</span><span class="o">(</span><span class="n">factory</span> <span class="o">=</span> <span class="nc">WithMockCustomUserSecurityContextFactory</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">WithMockCustomUser</span> <span class="o">{</span>
    <span class="nc">String</span>  <span class="nf">username</span><span class="o">()</span> <span class="k">default</span> <span class="s">"dhfif718@naver.com"</span><span class="o">;</span>

<span class="o">}</span>
</code></pre></div></div>
<p>우선 어노테이션을 만들어 커스터 마이징해줬다.<br />
우선 username에 대한 정보를 강제로 입력해 두었다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WithMockCustomUserSecurityContextFactory</span> <span class="kd">implements</span> <span class="nc">WithSecurityContextFactory</span><span class="o">&lt;</span><span class="nc">WithMockCustomUser</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">SecurityContext</span> <span class="nf">createSecurityContext</span><span class="o">(</span><span class="nc">WithMockCustomUser</span> <span class="n">customUser</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SecurityContext</span> <span class="n">context</span> <span class="o">=</span> <span class="nc">SecurityContextHolder</span><span class="o">.</span><span class="na">createEmptyContext</span><span class="o">();</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">GrantedAuthority</span><span class="o">&gt;</span> <span class="n">grantedAuthorities</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">();</span>
        <span class="n">grantedAuthorities</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">SimpleGrantedAuthority</span><span class="o">(</span><span class="s">"USER"</span><span class="o">));</span>
        <span class="nc">UsernamePasswordAuthenticationToken</span> <span class="n">authentication</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UsernamePasswordAuthenticationToken</span><span class="o">(</span>
                <span class="k">new</span> <span class="nf">TokenPrincipalDto</span><span class="o">(</span><span class="mi">1L</span> <span class="o">,</span> <span class="n">customUser</span><span class="o">.</span><span class="na">username</span><span class="o">()),</span> <span class="kc">null</span><span class="o">,</span> <span class="n">grantedAuthorities</span><span class="o">);</span>
        <span class="n">authentication</span><span class="o">.</span><span class="na">setDetails</span><span class="o">(</span><span class="n">customUser</span><span class="o">.</span><span class="na">username</span><span class="o">());</span>
        <span class="n">context</span><span class="o">.</span><span class="na">setAuthentication</span><span class="o">(</span><span class="n">authentication</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">context</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">WithSecurityContextFactory</code>를 상속받아<br />
<code class="language-plaintext highlighter-rouge">createSecurityContext();</code>를 구현해준다음에</p>

<p>우리가 테스트하려고 했던 메서드에</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nd">@Test</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"질문 작성 API : createQuestion"</span><span class="o">)</span>
    <span class="nd">@WithMockCustomUser</span>
<span class="c1">//    @WithMockUser</span>
    <span class="kt">void</span> <span class="nf">createQuestion</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

        <span class="nc">QuestionPostDto</span> <span class="n">questionPostDto</span> <span class="o">=</span> <span class="o">(</span><span class="nc">QuestionPostDto</span><span class="o">)</span> <span class="nc">StubData</span><span class="o">.</span><span class="na">MockQuestion</span><span class="o">.</span><span class="na">getRequestBody</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">);</span>
        <span class="nc">Question</span> <span class="n">question</span> <span class="o">=</span> <span class="nc">StubData</span><span class="o">.</span><span class="na">MockQuestion</span><span class="o">.</span><span class="na">getSingleResponseBody</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Tag</span><span class="o">&gt;</span> <span class="n">tagList</span> <span class="o">=</span> <span class="nc">StubData</span><span class="o">.</span><span class="na">MockTag</span><span class="o">.</span><span class="na">getSingleResponseBody</span><span class="o">();</span>
        <span class="nc">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="nc">StubData</span><span class="o">.</span><span class="na">MockMember</span><span class="o">.</span><span class="na">getSingleResponseBody</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>

        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"questionPostDto = {}"</span><span class="o">,</span> <span class="n">questionPostDto</span><span class="o">);</span>

        <span class="n">given</span><span class="o">(</span><span class="n">tagService</span><span class="o">.</span><span class="na">findTags</span><span class="o">(</span><span class="nc">Mockito</span><span class="o">.</span><span class="na">any</span><span class="o">(</span><span class="nc">QuestionPostDto</span><span class="o">.</span><span class="na">class</span><span class="o">))).</span><span class="na">willReturn</span><span class="o">(</span><span class="n">tagList</span><span class="o">);</span>
        <span class="n">given</span><span class="o">(</span><span class="n">memberService</span><span class="o">.</span><span class="na">findByMember</span><span class="o">(</span><span class="nc">Mockito</span><span class="o">.</span><span class="na">anyLong</span><span class="o">())).</span><span class="na">willReturn</span><span class="o">(</span><span class="n">member</span><span class="o">);</span>
        <span class="n">given</span><span class="o">(</span><span class="n">questionService</span><span class="o">.</span><span class="na">postQuestion</span><span class="o">(</span><span class="nc">Mockito</span><span class="o">.</span><span class="na">any</span><span class="o">(</span><span class="nc">Question</span><span class="o">.</span><span class="na">class</span><span class="o">))).</span><span class="na">willReturn</span><span class="o">(</span><span class="n">question</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">content</span> <span class="o">=</span> <span class="n">toJsonContent</span><span class="o">(</span><span class="n">questionPostDto</span><span class="o">);</span>
        <span class="nc">ResultActions</span> <span class="n">actions</span> <span class="o">=</span> <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">postRequestBuilder</span><span class="o">(</span><span class="n">getUrlCreateQuestion</span><span class="o">(),</span> <span class="n">content</span><span class="o">));</span>

        <span class="n">actions</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">isOk</span><span class="o">());</span>
    <span class="o">}</span>
</code></pre></div></div>
<p>기존에 쓰던 <code class="language-plaintext highlighter-rouge">@WithMockUser</code>를 주석처리해주고, 커스터마이징해서 만든<br />
어노테이션은 <code class="language-plaintext highlighter-rouge">@WithMockCustomUser</code>를 테스트 메서드에 붙여주면<br />
테스트가 정상적으로 진행되는 모습을 볼 수 있을 것이고</p>

<p>MockHttpServletRequest 요청에<br />
Session Attrs에 아래와 같이 우리가 만든<br />
<code class="language-plaintext highlighter-rouge">TokenPrincipalDto</code> 객체로 만들어진 모습을 볼 수 있다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Session</span> <span class="nc">Attrs</span> <span class="o">=</span> <span class="o">{</span>
        <span class="no">SPRING_SECURITY_CONTEXT</span><span class="o">=</span><span class="nc">SecurityContextImpl</span> 
        <span class="o">[</span><span class="nc">Authentication</span><span class="o">=</span><span class="nc">UsernamePasswordAuthenticationToken</span> 
            <span class="o">[</span><span class="nc">Principal</span><span class="o">=</span><span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">stackoverflowclone</span><span class="o">.</span><span class="na">global</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">auth</span><span class="o">.</span><span class="na">dto</span><span class="o">.</span><span class="na">TokenPrincipalDto</span><span class="err">@</span><span class="mi">3</span><span class="n">dd591b9</span><span class="o">,</span> <span class="nc">Credentials</span><span class="o">=[</span><span class="no">PROTECTED</span><span class="o">],</span><span class="nc">Authenticated</span><span class="o">=</span><span class="kc">true</span><span class="o">,</span> <span class="nc">Details</span><span class="o">=</span><span class="n">dhfif718</span><span class="nd">@naver</span><span class="o">.</span><span class="na">com</span><span class="o">,</span> <span class="nc">Granted</span> <span class="nc">Authorities</span><span class="o">=[</span><span class="no">USER</span><span class="o">]]</span>
        <span class="o">]</span>
<span class="o">}</span>
</code></pre></div></div>

<p><br />
<br />
<br /></p>

<p><a href="https://sejoung.github.io/2020/11/2020-11-19-spring-security/#spring-security-test-code-%EC%9E%91%EC%84%B1%EC%8B%9C-UserDetails%EA%B0%80-%ED%95%84%EC%9A%94%ED%95%A0%EB%95%8C">Test코드 작성시 UserDetails 참고 레퍼런스</a>, <a href="https://jungguji.github.io/2020/06/09/Spring-Controller-Test%EC%8B%9C-CSRF-%EC%84%A4%EC%A0%95/">csrf 설정 참고 레퍼런스</a></p>]]></content><author><name>LEE JAEHYEOK</name></author><category term="Spring" /><category term="Spring" /><category term="JUnit" /><summary type="html"><![CDATA[오늘 겪은 문제를 정리해보려한다. Spring Security + JWT + OAuth2 인증,인가를 사용하여 정상적으로 API 작동까지 Postman으로 마친 상태이다.]]></summary></entry><entry><title type="html">MySQL EER 다이어그램 만드는법</title><link href="http://localhost:4000/db/2022/12/19/db-mysqlEER.html" rel="alternate" type="text/html" title="MySQL EER 다이어그램 만드는법" /><published>2022-12-19T00:00:00+09:00</published><updated>2022-12-19T00:00:00+09:00</updated><id>http://localhost:4000/db/2022/12/19/db-mysqlEER</id><content type="html" xml:base="http://localhost:4000/db/2022/12/19/db-mysqlEER.html"><![CDATA[<p>mysql을 로컬로 연결한 다음<br />
연관관계 맵핑이 제대로 되어진지 확인을 하고 싶어<br />
EER 다이어 그램을 그려주는 기능을 사용해보려한다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOYP0fQrmNAzvt44jM3q1Et2sG_V4E9GqAJGCu-W4sKhMubVYnEcUGzis00H57nfRzdoVy5xVSXQv4X_vAbgIxBcTgP=w1109-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>워크 밴치에서 Database -&gt; Reverse Engineer를 클릭해준다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gP0zs_9MFTLo-MHuS9FPm_HsJ6_YNUggGHBwOxhN61Ft7SbD6ic_M14WrgWHI8UME4DxG0RHdUomxyTraJIR7NzvNxSkQ=w1109-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>설정을 진행한 다음에 continue를 눌러준다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gPscP5oY0PMeTDUsQS1kKvD1r3hG10L-PEHzW7pTZK6Xot231dfv96wzKIxO2kqzO9WXLa0pxu6TIWxyDcsos1GVFVYZQ=w1109-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>쭉쭉 진행</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gPcPaDrNT08DemVCSislXXYTO9rc4w2qQjwuOKirkbzqYzvTW4TAAOVKJ9r7sT8h7W0DwuZgfVn1FpJlZimjzNqchNkHA=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>EER 다이어그램으로 표시하고 싶은<br />
스키마를 선택해줍니다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOCcK5kxVJ7annhfMjE_M9fU6TKrpLb_oq0w1Q9uPoyPC1HUF2tStTOzOQyJoGqPN00zG-3p5w-AqAhsin33u3E0cHh=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>계속 진행해주시면 됩니다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gPMJUuXItWoog3cNtrvYUCmRuZIQE_6lX5Dj2r0PTxtX54xWDIVIza67950MG8VublQ_4Il2JjaQCQJTikDQltUtOIclQ=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>Excute를 눌러줍니다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gPBfp0S8a2KUpRBbzLTcRLCKe5FUetyQDEvUZKKt_c3ecwA5Mbpye2UsIw7FZxq55FSS21KMJrerY6aSy6bNwJ31-k8dQ=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>Continue 버튼을 눌러줍니다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gMVJw0WqySpUAV7fD1xhefV-vo4mDPIOupuzYdz9-Vc4O3KS9yjd7Epj3AcUq4lnc345g23GckEg0RtZdOQO2diYL1q=w1109-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>그러면 최종적으로 EER Diagram 화면이 표시되는 모습을 볼 수 있습니다.<br />
@ManyToOne, @OneToMany 등으로 연관관계 맵핑을<br />
제대로 진행했는지 다이어그램으로 확인해 볼 수 있다.</p>]]></content><author><name>LEE JAEHYEOK</name></author><category term="DB" /><category term="DB" /><category term="MySQL" /><summary type="html"><![CDATA[mysql을 로컬로 연결한 다음 연관관계 맵핑이 제대로 되어진지 확인을 하고 싶어 EER 다이어 그램을 그려주는 기능을 사용해보려한다.]]></summary></entry><entry><title type="html">H2 Database 다운로드 및 실행</title><link href="http://localhost:4000/db/2022/12/19/db-h2setting.html" rel="alternate" type="text/html" title="H2 Database 다운로드 및 실행" /><published>2022-12-19T00:00:00+09:00</published><updated>2022-12-19T00:00:00+09:00</updated><id>http://localhost:4000/db/2022/12/19/db-h2setting</id><content type="html" xml:base="http://localhost:4000/db/2022/12/19/db-h2setting.html"><![CDATA[<p>오늘은 로컬에서 테스트할때 자주 사용하는<br />
H2 Database를 다운받아 설정해보려한다.</p>

<p><a href="http://www.h2database.com/html/main.html">h2 database 홈페이지</a>에 접속하면</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gPOrBmDtNszJ_Se_BYJ0vhdj-G60PCOB3B50Ji348fVE1atvLYUpkqGJ0N3UIoVdUdQJi6ntxmw2_tX-ptIe5Vzm4kz-Q=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>위와 같은 화면이 나오는데<br />
나는 MacOS를 쓰고있어 All Platforms를 눌러주면된다.<br />
그럼 zip파일 하나가 다운받아진다. <br />
여기서 버젼확인을 꼭해주자. 의존라이브러리를 추가할때 해당버젼과 일치해야한다.</p>

<p><strong>Gradle의 경우</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">runtimeOnly</span> <span class="err">'</span><span class="n">com</span><span class="o">.</span><span class="na">h2database</span><span class="o">:</span><span class="nl">h2:</span><span class="mf">2.1</span><span class="o">.</span><span class="mi">214</span><span class="err">'</span>
</code></pre></div></div>
<p>와 같이 설정해 줄 수있다. 일반적으로 버전을 제외하고</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">runtimeOnly</span> <span class="err">'</span><span class="n">com</span><span class="o">.</span><span class="na">h2database</span><span class="o">:</span><span class="n">h2</span>
</code></pre></div></div>
<p>로 설정하면 자동으로 가장 최신의 버전이 추가되는 것 같다.</p>

<p><br /></p>

<p><strong>Maven의 경우</strong></p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;dependencies&gt;</span>
        <span class="c">&lt;!-- H2 데이터베이스 --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.h2database<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>h2<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.1.214<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div></div>
<p>와 같은식으로 설정해줄 수 있다.</p>

<p>해당 zip파일을 풀면 폴더하나가 나오게되는데<br />
그안에서 bin -&gt; h2.sh 스크립트를 실행 시켜주면된다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gNFlqigR274WJL2PPsEN4JlD7veQFTYLJYTVb8j7I5GyT6XrqeEGzG4Mb0D9CUpT_kRJ1fmVmzGr155UxFE0eUMn4L9WQ=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>해당 파일 위치에서</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./h2.sh
</code></pre></div></div>
<p>를 실행 시켜주면 h2 data base 팝업이 발생하고  <br />
<img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gODtoeY1H6bGiUOZQj8oP90Qh8CXysYw8Yu6BZ8MowLG0_yUB2ClmKn464zQMWxzYpitSiaI6ktPMoRVMZ1dDX72Npngg=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /> 아이콘이 상단에 떠있을 것이다.</p>

<p>만약 종료시키고 싶으면 <code class="language-plaintext highlighter-rouge">Ctrl + C</code>를 눌러주면된다.</p>

<p>만약 스크립트가 권한에 의해 실행되지 않는다면 chmod 명령어로 권한을 <br />
부여해주면 쉽게 해결할 수 있다.</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ll
</code></pre></div></div>
<p>권한 확인 진행을 먼저해주고</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chmod </span>755 h2.sh
</code></pre></div></div>
<p>를 해주게되면 정상적으로 진입할 수 있을 것이다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gMidCvQtnMFbQLRjWIfa1fgZLuIwDoOjR6himZX4bWnbhTxm4nKQEIfD20j3PcwRSuHB4kUfP1o8IMDOdHUObIgPKYHTA=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>접속 URL 같은 정보들의 경우는<br />
gradle과 maven에 따라다르지만 resources에 정보를 설정해주면된다.<br />
혹시나 만약 해당 화면이 발생하지 않고 하얀화면만 나오면서<br />
진입이 안되는 분이 있으시다면<br />
포트번호 <code class="language-plaintext highlighter-rouge">:8082</code>앞에 localhost를 붙여보면 접속이 가능할 것이다.</p>

<p>gradle 같은 경우에는</p>
<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.datasource.url</span><span class="p">=</span><span class="s">jdbc:h2:tcp://localhost/~/test</span>
<span class="py">spring.datasource.username</span><span class="p">=</span><span class="s">sa</span>
<span class="py">spring.datasource.password</span><span class="p">=</span>
</code></pre></div></div>
<p>application.properties 설정을 통해<br />
접속 관련 정보를 설정해주면 된다.</p>

<p><br /></p>

<p>Maven 같은 경우에도 마찬가지다</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;persistence</span> <span class="na">version=</span><span class="s">"2.2"</span>
             <span class="na">xmlns=</span><span class="s">"http://xmlns.jcp.org/xml/ns/persistence"</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
             <span class="na">xsi:schemaLocation=</span><span class="s">"http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_2.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;persistence-unit</span> <span class="na">name=</span><span class="s">"hello"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;properties&gt;</span>
            <span class="c">&lt;!-- 필수 속성 --&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"javax.persistence.jdbc.driver"</span> <span class="na">value=</span><span class="s">"org.h2.Driver"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"javax.persistence.jdbc.user"</span> <span class="na">value=</span><span class="s">"sa"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"javax.persistence.jdbc.password"</span> <span class="na">value=</span><span class="s">""</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"javax.persistence.jdbc.url"</span> <span class="na">value=</span><span class="s">"jdbc:h2:tcp://localhost/~/test"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.dialect"</span> <span class="na">value=</span><span class="s">"org.hibernate.dialect.H2Dialect"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;/persistence-unit&gt;</span>
<span class="nt">&lt;/persistence&gt;</span>
</code></pre></div></div>
<p>과 같은 방식으로 <code class="language-plaintext highlighter-rouge">persistence.xml</code> 설정을 통해<br />
정보를 입력해줄 수 있다.</p>]]></content><author><name>LEE JAEHYEOK</name></author><category term="DB" /><category term="DB" /><category term="H2" /><summary type="html"><![CDATA[오늘은 로컬에서 테스트할때 자주 사용하는 H2 Database를 다운받아 설정해보려한다.]]></summary></entry><entry><title type="html">TIL) PreProject 진행, 팀장일지 (22.12.15 ~ 23.01.02)</title><link href="http://localhost:4000/til/2022/12/15/til.html" rel="alternate" type="text/html" title="TIL) PreProject 진행, 팀장일지 (22.12.15 ~ 23.01.02)" /><published>2022-12-15T00:00:00+09:00</published><updated>2022-12-15T00:00:00+09:00</updated><id>http://localhost:4000/til/2022/12/15/til</id><content type="html" xml:base="http://localhost:4000/til/2022/12/15/til.html"><![CDATA[<p>모든 교육이 끝나고 프리 프로젝트를 시작했다.<br />
프로젝트에 대한 기대가 너무 컸고, 얼른 내가 알고있는 기술들을<br />
사용해보면서 구현을 해보고 싶었다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gM7IwaAHpSs2lWQYI6BcrMZcXkn_DBo79TmhoStn5-uQdph_KvSSgobXbkXQnqLaqKHyV1uR_VTXtXj6doGp_jWLEEmGQ=w1920-h921" alt="image" class="align-left" style="max-width: 50%" /></p>

<p>그런 마음에서 그런지 이번 프리프로젝트에서는 무조건 <strong>팀장</strong>을 해야겠다고 <br />
생각했었고, 프론트엔드 쪽에서 진행되는 상황이나 팀적으로 <br />
어떻게 프로세스를 진행해야 원할할지에 대한 고민을 많이해보고 싶었다.</p>

<p>프리프로젝트가 끝나고는 메인프로젝트에서는 기능개발의<br />
중점을 두어 팀원으로 새로 모르는 기술에 대한 탐구와 적용에 대한<br />
고민을 주로 해볼 것 같다.</p>

<hr />

<p>다행히 팀원들에 동의를 받아<br />
이번 프로젝트는 내가 팀장으로 진행하게 되었다.<br />
부담감은 물론있다. 하지만 그만큼 열심히해서 잘할 자신도 있다.</p>

<p>그때그때 감정과 팀장으로서의 역할을 제대로 수행하고있는지?<br />
프로젝트 진행상황과 여러가지를 적어가보려고한다.</p>

<p><br /></p>

<h3 id="20221215-목">2022.12.15 (목)</h3>

<h4 id="팀-빌딩과-시작">팀 빌딩과 시작</h4>

<p>팀 빌딩이 시작되는 날이었다.<br />
기술적인 능력은 부족하지만, 어필을 통해 팀장을 해보려한다.<br />
(그렇다고 프로세스를 아예 모르는것도 아니라고 생각한다 ㅎ;)</p>

<p>Frontend 3명, Backend 3명<br />
이렇게 인원 배정을 받았고 모두 처음만나 너무나도 어색한상황..</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOQudLSy7P_TZzLCcIJmbtfqdFJ6woTP9ODYtA-5bifd3cOr8WgKWJkC94ezFJNbP1UdVMDUYwZuex5wBbRhPNdntVgug=w1920-h864" alt="image" class="align-left" style="max-width: 40%" /></p>

<p>이런 어색함을 참지 못하 나는 자체적으로 사회자가 되어버렸다 ㅋㅋ<br />
사회자가 된김에 팀장을 정하는 시간에 하고싶다는 의사를 표했고<br />
우리 팀원분들은 대부분이 내향적인 분들이 많아, 자연스럽게 하고싶었던 내가 팀장이되었다.</p>

<p>지난 회사생활 7년간 가장 중요했던 의사소통 관련해서<br />
외향적인 내가 내향적인분들과 소통하는건 항상 쉽지는 않았다.<br />
이해를 해주고 기다려줘야하는 부분도 많았고, 원하는 의견의 표출에 소극적이었던 것을 <br />
많이 경험했어서, 여러 충돌이 있었던 경험도 있다.</p>

<p>이러한 부분을 잘 조율해서 팀원의 성격을 먼저 천천히 파악해보고<br />
그에 맞는 소통방식을 찾아 프로젝트를 진행해보려한다.</p>

<p><br /></p>

<h4 id="협업에-대한-셋팅">협업에 대한 셋팅</h4>

<p>처음 만나고 진행할 일은 어느 플랫폼을 이용해서 소통할지 였다.<br />
<code class="language-plaintext highlighter-rouge">Slack</code>,<code class="language-plaintext highlighter-rouge">ZEP</code>,<code class="language-plaintext highlighter-rouge">Discord</code>,<code class="language-plaintext highlighter-rouge">Google Meet</code>,<code class="language-plaintext highlighter-rouge">Zoom</code>등 여러가지 얘기가 나왔는데<br />
우선은 프로젝트에 대한 집중이 중요다는 팀원들의 만장일치로 Discord를 사용하기로 했다.</p>

<p>그리고 기본적으로 notion을 이용해 팀 프로젝트에 대한 정리를 하기로 했다.<br />
예를들어 컨벤션에 대한 정리라든가, 일정에 대한 정보, 회의록 등.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gMPekYO6zZLz9f4INnHGhUgXXdwGoNnAb-1nfr1EM0mZ60FBvs1g9weSpzPjXBvPpMC-eGt4vHBVxOZ1Sfz3wayxhQI=w1920-h864" alt="image" class="align-left" style="max-width: 100%" /></p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gPBqfazQbtLum7WVBESroZ2q5rm7QI6Racu11IOWAE_R5gWYKhl5AR2JLibpvfPJhxsqjGCUwxd-mOOz8uk63OlYdE3TA=w1920-h864" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>위와 같은식으로 하나씩 정리해갈 예정이다.</p>

<p>팀명은 37℃ 라는 이름으로 정했다. 
큰 의미는 없었다 배정받은 조가 37조였고<br />
사람의 정상체온인 37도만큼만 하자라는 의미를 담았다.</p>

<p><br /></p>

<p>그리고 디스코드 방을 개설했다.<br />
전체적인 소통과 공지, 회의는 디스코드로 진행할 예정이고<br />
해당 내용들을 notion에 정리하는 느낌으로하려한다.</p>

<p>차가운 분위기를 바꾸기 위해서 디스코드 팀방 아이콘을 바꾸면 그래도<br />
기분이 살아날 것 같아서 간단한 그림을 그려 팀방 아이콘을 꾸몄다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gPGDw8Eo9qmjsoawvmOXI5p3vfhSDZkTAq_76poy7sygTwXAfzk-0oquEnfJcO32XLjhZEpgG7epGZIHUSJM1vgc0rgGw=w1920-h864" alt="image" class="align-left" style="max-width: 70%" /></p>

<p>정말 아무런 의미도없지만 디스코드 입장할때 한번씩 보면 그래도<br />
상징적인 것을 두면 단합이 더이루어지지 않을까?라는 소망이였다.</p>

<p>그리고 Discord 기능 중 웹후크라는 기능이 있다. <br />
GitHub와 연동해서 우리가 프로젝트로 사용하는 Repository의<br />
Push가 이루어질 때마다 Discord에 알림을 주는 봇을 만들었다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOJcqlxn5j6wdoGyu8V-IiJHZNtJ3wfGm82UpaXns7Jr6KRZM_hws75-M-RfLeGfGzmZTG-OXadGhSEBxrI3dy_yYIqxA=w1920-h921" alt="image" class="align-left" style="max-width: 70%" /></p>

<p>혹시나 누군가 실수로 Push를 계속한다든가, 아직 초보자인 우리들이<br />
어떻게 작업을 할지 모르기 때문에 최소한 알림이라도 오도록 추가해두었다.</p>

<p>이렇게 첫날은 지나갔고<br />
내일 부터는 모두 Github 협업에 대한 개인적인 공부시간을 가지는 날이다.<br />
정확히 일정은 다음주 월요일 오후부터 시작될 것 같다.</p>

<p><br /></p>

<h3 id="20221216-금">2022.12.16 (금)</h3>

<h4 id="github-관련-협업-지식습득">GitHub 관련 협업 지식습득</h4>

<p>오늘은 코드스테이츠측에서 제공하는 GitHub 협업 프로세스에 대한 공부를 하는 날이다.<br />
나는 코스과정중 스터디원들이랑 친해져 같이 미리 협업 연습을 여러번 했었다. <br />
그래서 어느정도 익숙했고 지금 팀원들이랑 합을 맞춰보는게 중요하다고 생각했다.</p>

<p>Project 칸반과 issue를 잘 이용하는 것을 목적으로 둘 것이고<br />
브랜치 전략을 정해 어떻게 진행할지 의견을 맞춰보는게 핵심이다.<br />
다음주 월요일에 어떤 브랜치 전략으로 해볼지 얘기해보고 최종으로 정해보려한다.<br />
(Git관련 컨벤션도 마찬가지)</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gM-1VdH_kFqctfjRS6-B8tYK4FNPMHYUnZIp6UgjW1eOU0rNyuPYH1DCxJNVBtAbZyobQGsmzJtE9fEEc9uo7oBshdphw=w1920-h864" alt="image" class="align-left" style="max-width: 70%" /></p>

<p>issue를 라벨할 수 있게 우선 파트별로 간단하게 나누었다.</p>

<p>그리고 브랜치 전략은 여러 사이트를 돌아디니다 보면서</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gPRcd6ABuDdMcynR6HuiG9x19VUEIEgZ22ux_TWOCwIbb_0bOlWJc1Ka7Ut_ljdzInElTXQf-IT1A-UnqGNjx5CTdse=w1920-h864" alt="image" class="align-left" style="max-width: 70%" /></p>

<p>내가 직접 그려가지고 이렇게 작업해보면 어떨까? 하는 생각이 들었다.<br />
백엔드와 프론트엔드가 다른 브랜치에서 개발하다가 <br />
통합 릴리즈 브랜치에 merge를 하여 확인후에 최종적으로 main 브랜치에<br />
통합하는 방식으로 진행하는 방식이다.</p>

<p>사실 이렇게 하는 방법이 맞는지는 모르겠다.<br />
워낙 작은 규모의 프로젝트이고 어떻게 적용을 해야된다는 답을 찾지는 못했지만<br />
우선은 이렇게 먼저 그려보고 팀원과 의견을 나눠보면 어떨가싶었다.</p>

<p>모두가 Github을 이용한 협업을 처음해보기 때문에<br />
합을 마춰보면 어떨가하여 오늘 저녁 7시에 가능한분들만<br />
위 브랜치 전략대로 연습하는 시간을 가지면 어떨까하여 공지를 했었다.</p>

<p><br /></p>

<h4 id="첫번째-모임과-github-협업-연습">첫번째 모임과 GitHub 협업 연습</h4>

<p>갑작스러운 모임 요청이었고, 가능하신분들만 연락을 달라고 조심스럽게 얘기를 했는데<br />
6명중 5분이 참여해주셨다. 정말이지 너무 감사했다. <br />
어떻게 보면 비공식적으로 모두가 만나서 처음 합을 맞춰보는 과정이었다.</p>

<p>결과는 대만족.<br />
오늘 처음으로 같이 얘기해보면서 어떻게 할지?<br />
순서를 정하고 퍼즐맞추듯이 진행을 해보았는데<br />
너무 합이 잘맞게 진행을 했고, 저녁늦은시간까지 다들 지친기색없이<br />
배움에 재미에빠져서 몰두하다보니 늦은시간까지 계속 작업을 했다.  ㅎ</p>

<p>위있는 전략을 적용하기전에<br />
main, develop, feat 브랜치로만 구성해 각자 개발해보면서 <br />
PR 보내고, Merge도 진행하면서 테스트를 했다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gNEZSbt1PzTLzvvmDqShzTLdqnan6wqOgNt_H-dPSuMGY9AVOoVCyrElw0k0WeIONLxpND79iJGIBrtX83_XTFE9nq-1g=w1920-h921" alt="image" class="align-left" style="max-width: 70%" /></p>

<p>처음에 살짝 삐걱대긴 했지만 어느정도 모두 감을 익히는데는 충분했다.<br />
아직 Git 컨벤션 관련해 정의한 것이 없기때문에<br />
이름은 막지으면서 스터디를 했지만 다음주 월요일 부터는 <br />
FM으로 이름을 정하고 진행하기로 얘기를 마무리했다.</p>

<p>갑작스러운 요청에도 다들 모여서 이렇게 연습을 할 수 있었다는 것에<br />
너무 팀원들에게 감사했고 처음으로 맞춰보는 합이 잘맞아서 시작이 좋은 것 같다.</p>

<p>시작이 반이라는데 이미 반 이상을 넘어온 것 같은 느낌이다.</p>

<p><br /></p>

<h3 id="20221218-일">2022.12.18 (일)</h3>

<p>다음주부터 본격적인 협업이 시작될 것 같으니<br />
미리 준비해서 팀원들과 소통일 잘되어야할 것 같아<br />
미리 여러 컨벤션을 어떻게 사용할지?<br />
정리가 필요할 것 같아 주말을 이용해 정리를 해보았다.</p>

<p>정확히 어떻게 해야하는 것이 맞는 것인지?를 가늠하지 못해<br />
여러 선배기수의 프로젝트를 탐방하기 시작했다.</p>

<p>어느정도 비스한 형태안에서 컨벤션을 사용하는 것을 보았고<br />
첫번째 프로젝트인 만큼 가장 많이 사용하는 컨벤션 느낌으로 팀원에게 제안해보려한다.</p>

<h4 id="github-관련-정리">GitHub 관련 정리</h4>

<p>첫번째로 Git Commit 컨벤션이다.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[feat] : 새로운 기능을 추가할 경우
[fix] : 버그를 고친 경우
[design] : CSS 등 사용자 UI 디자인 변경
[!breaking change] : 커다란 API 변경의 경우
[!hotfix] : 치명적인 버그를 고쳐야하는 경우
[style] : 코드 포맷변경, 세미콜론 누락, 코드수정이 없는 경우.
[refactor] : 프로덕션 코드 리펙토링할 경우
[comment] : 필요한 주석 추가 및 변경
[docs] : 문서를 수정한 경우
[test] : 테스 추가 테스트 리펙토링
[chore] : 빌드 테스트 업데이트, 패키지 매니저를 설정하는 경우
[rename] : 파일 혹은 폴더명을 수정하거나 옮기는 작업만 하는 경우
[remove] : 파일을 삭제하는 작업만 수행한 경우
</code></pre></div></div>
<p>커밋에 대한 규칙이 필요하기 때문에 앞에 이러한 형식으로<br />
작업 내용에 대한 구분을 하는 것이 좋을 것 같다고 생각했다.</p>

<p><br /></p>

<p>두번째로는 Git Branch 컨벤션이다.</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>main : 메인 배포 브랜치 
release : 릴리즈 브랜치
dev_front : 프론트엔드 브랜치
dev_back : 백엔드 브랜치
feat_프로젝약자+번호 : 기능개발 브랜치 ex) feat_STC001
</code></pre></div></div>
<p>금요일에 팀원들 거의 전부가 브랜치 전략으로 내가 구성한 전략을<br />
사용하기로 거의 채택?이 되어진 느낌이었다.<br />
그래서 해당 브랜치 전략으로 Git Branch 컨벤션을 만들었다.<br />
아마 기능 개발구현 feat에 대한 내용만 잘 통일시키면 큰 문제는 없어 보인다.</p>

<p><br /></p>

<p>세번째로는 GitHub Issue 컨벤션이다.<br />
우리는 GitHub를 이용해 칸반보드를 관리할 생각이다.<br />
Issue를 이용해 라벨을 붙여 작업내용에 대한 내용과 정리를 할 수 있어<br />
칸반보드에 사용하기 유용하다고 판단해 Issue 제목 작성에 대한 컨벤션이 필요해 보였다.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[FE] 해야할 작업 제목 or 이슈 제목 ex) [FE] 회원가입 화면 구현
[BE] 해야할 작업 제목 or 이슈 제목 ex) [BE] OAuth2 인증 구현
</code></pre></div></div>

<p>제목은 프론트엔드와 벡엔드 작업으로 구분하려한다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gPPj9_5nw9srv0aXXeZ-ulIZy-Cw9svEZ01OaqvC3MpGSv962jD-R5H_7RBHr87E_DGlVL35Gpfyr70zW4628NHEV12=w1920-h975" alt="image" class="align-left" style="max-width: 80%" /></p>

<p>상세 내용은 작성자의 이름 라벨과 어떠한 작업인지 표시해주는 라벨을<br />
붙여서 issue에 대한 내용을 관리하려고 한다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gMu6ih-YmXAN-eKxRdDb6d5E-n-CxkPPLmpJhGpTZg6KojPCU8mE6rTuYfBQ0GkgQfMQUWppWg94tOPGq2igqF_oBdKTw=w1920-h975" alt="image" class="align-left" style="max-width: 100%" /></p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gPlAg-qlvom9hlzDG9GSZ9tQCk8NAKWq6rbAGY4jNlS6k_gkcCMWdkM-JnX4vsLKfsW87tv-Tp_2L-77iWpqycOif2Mdw=w1920-h975" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>대략 이러한 느낌으로 관리를 진행해보려한다.<br />
우선 나의 생각으로만 준비한 것이기 때문에, 월요일에 팀원들의 의견을 들어보고<br />
더 여러가지 방향으로 컨벤션관리하는 것을 적용해보려한다.</p>

<p><br /></p>

<h4 id="java-컨벤션-정리">Java 컨벤션 정리</h4>

<p>마지막으로 Java 컨벤션 관련이다.<br />
클라이언트 컨벤션관련해서는 프론트엔드 측에 우선 얘기는 해두었다.<br />
아무래도 내가 프론트엔드쪽 지식이 풍부하지 않다보니… 프론트엔드 인원에서<br />
우선 정의를 해보고 같이 의논해보는게 좋을 것 같다.</p>

<p>Java 컨벤션 관련해서는 <a href="https://naver.github.io/hackday-conventions-java/">자바 컨벤션 정리 사이트</a>를 참조해서<br />
적어 보았다. 우선 간단한 컨벤션들만 먼저 정리해두었다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gMftLqoXCoYCbYxdbxGYh-mmCDo5av5JiMiwQIBMIYq7UN5XI1Tv1a-uVPyGyc60cg0eKsy8MFl-eYkSLouva99kSeL=w1920-h975" alt="image" class="align-left" style="max-width: 70%" /></p>

<p>그리고 알아보니까 컨벤션관련해서<br />
SonarLint라는 좋은 Plugin이 있는 것 같아<br />
팀원들끼리 같이 사용해보면 어떨까? 라는 생각이 들어 정리했다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gNXf0fjuWaSX475JeJFOgpA07CpvmLxcEmy8CoxOQi1_a23PcmloY9a8U5CVDEAcZPo24-TlGJTPlo-l62UQn9GB7fgUQ=w1920-h975" alt="image" class="align-left" style="max-width: 70%" /></p>

<p>한번 사용해보니 콘솔로 위치를 알려주고 노란색으로 밑줄도 그어줘서<br />
처음에 컨벤션이 헷갈리는 우리들에게는 정말 좋은 플러그인이 아닐까?<br />
라는 생각을 해봤다.</p>

<p><br /></p>

<p>이렇게 주말에 잠깐 간단하게 컨벤션을 정리했고<br />
월요일에 다같이 회의할때 차질없는 진행을 하고싶어 미리 정리를 하였다.<br />
어느정도 정리하고나니까 마음이 편안.. 이제 다음주에 회의를 통해<br />
컨벤션을 확정시키고, 협업에 대한 룰을 각자 지키면서 어플리케이션을 작업하는<br />
일만 남은 것 같아 어느정도 속이 후련해졌다.</p>

<p><br /></p>

<h3 id="20221219-월">2022.12.19 (월)</h3>

<p>팀원한분이 오늘 작업과정에 참가하질 못하셨다.<br />
여러가지 이유로 공부하기가 힘든 상황이라고 하셨다.<br />
코드스테이츠측이랑 상담을 진행 중이라고 연락이 오셨다.</p>

<p>프론트엔드분이셨고, 만약 하차를하게 되신다면 프론트측에는<br />
2명으로 진행해야 부담이 가는 상황이 발생했다…ㅠ</p>

<p>우선 최소한의 작업으로 참가해서 가능하시다면 같이 프로젝트를 마무리하자고는<br />
얘기를 드려보았지만, 아무래도 본인의 선택이기 때문에 우리는 팀원분의<br />
선택을 기다리면서 여러작업들을 미리해야할 것 같다.</p>

<h4 id="프로젝트를-위한-문서-작성">프로젝트를 위한 문서 작성</h4>

<p>오늘부터는 프로젝트를 위한 사용자 요구사항 정의서를 작성해야한다.<br />
정의서와 API 명세서, 테이블 명세서를 작성해야한다.</p>

<p>한번씩 배웠지만 실제로 적용해보려니까 어떻게 해야할지 손이 안떨어졌다.<br />
우리의 주제는 Stackoverflow 클론코딩이였다.</p>

<p>해당 사이트를 먼저 분석하고, 어떤 기능들이 있을지 정의서에 작성을 먼저했다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gMkTbOFfSOQUwznqIv1z-MCAl2CDgpG3eh_ippjEPsnuiRKmmrDtOp6_g6Kf3GPE2H7EJifUEP7-8A3-ZKiErzidEq0=w1777-h864" alt="image" class="align-left" style="max-width: 60%" /></p>

<p>정의서 작성은 위의 큰 토클을 주제로 만들어<br />
작은단위로 쪼개 가면서 정의서 작업을 진행했다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gP8E-XiipPGjBKsugF861qw1MPhx67QrxFO9iD-a92Thsr_ek1oZ7yRkU5zW6k7DdvOmv74BqyurkbKgZ2-Xe-o9P_a=w1920-h921" alt="image" class="align-left" style="max-width: 60%" /></p>

<p>안에 작은 내용들을 상세하게 적지는 않았고<br />
우선은 요구사항명, 요구사항 설명, 중요도, 비고 등에 대한 내용을 위주로 적어 나갔다.</p>

<p>예를들면 아래와 같은 형식으로 적어 나갔다.</p>

<ul>
  <li>설명: <strong>사용자의 정보를 입력받아 회원 가입을 진행한다.</strong></li>
  <li>회원가입 정보: 이름/ e-mail / password /  <strong>(Captcha Todo)</strong></li>
  <li>비고
    <ul>
      <li>구글, 깃허브, 페이스북 로그인과 관련한 <strong>OAuth 2.0로 구현한다.(Todo)</strong></li>
    </ul>
  </li>
</ul>

<p>상세한 정의서 작업은 수요일까지 진행 될 것 같다.</p>

<p>그리고 백엔드 팀원끼리 저녁에 모여<br />
테이블 명세서 관련해서 어떻게 작업을 하는게 좋을지?<br />
생각해보고 연관관계를 ERD를 통해 그려보는 시간을 가졌다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOERMWQxsDR2cI06lnHZkwFr-HwvfMiVjQy3XC6aQW_C5tU55yrPsSuMv05oBzZJEZ5pwFNfmL0nDPp7ov7rLcJq2AK=w1777-h864" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>테이블 안에있에 있는 내용은 아직 제대로 정하지 않았지만<br />
연관관계 맵핑에 집중해서 그려보았다.</p>

<p>팀원분들 2분과 저녁 4시간동안 머리를 써가며 그렸는데<br />
확신도 없고, 이게 맞는지 안맞는지에 대한? 여부도 판단하기 너무 힘들다.</p>

<p>저녁까지 시간을 계속 사용해서 공부를 해야할 필요성을 느꼈다.<br />
정말 알면알수록 공부할게 너무 많아져서 일분일초가 부족한 느낌이 든다.</p>

<p><br /></p>

<h3 id="20221220-화">2022.12.20 (화)</h3>

<p>오늘은 사용자 정의서 작성을 완성하고 <br />
프론트엔드는 화면 정의서 작성과<br />
백엔드는 테이블 명세서, API 명세서를 만들기로 했다.</p>

<p>팀원들과 얘기를 맞춰 화요일,수요일 이렇게 이틀은 문서작업에<br />
힘을 써보기로했다. 어느정도 우리도 작성하는 법에 익숙해져야하고<br />
처음에 체계를 잡 갖춰놓고 충분히 토론해가며 정리하다보면<br />
프로그램을할 때 덜 뜯어고치지 않을까?라는 생각이었다.</p>

<p><br /></p>

<h4 id="사용자-정의서-작성">사용자 정의서 작성</h4>

<p>어제 노션을 통해서 크게 어떻게 사용자 정의서를 작성할지?<br />
기능을 구분해주어서 정리를 완료했었다.</p>

<p>정리해둔 내용을 오늘은 엑셀 스프레드시트를 이용해 표로 정리하기로 하였다.<br />
원래는 노션의 내용만 정리하려고 했으나, 가독성이 떨어지는 관계로<br />
팀원들과 스프레드시트 작업을 진행했다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOsZHx5fyHzaOWO2BqGZKoMJ6wTT5ZDi-LG5JC1rPiR8sCYrRMJ8IjfOqeRy20DFW2aKKM1wx_AxskKhQUrKnge5qxR9w=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>적어가다보니 내용이 엄청 많아졌다.<br />
이 내용을 짧은 프로젝트 기간안에 전부 처리할 수 있을지는 의문이다.</p>

<p>그래서 조금 제거하는 작업을해야할 것 같다는 생각이 들었고<br />
프론트엔드, 백엔드에서 나머지 명세서같은걸 작업한 후에<br />
범위가 너무 넓다 생각하면 하나씩 없애기로 얘기하였다.</p>

<p>아마 내용을 제거하는 작업은 내일 마무리하지 않을까 싶다.</p>

<p><br /></p>

<h4 id="화면-정의서-작성">화면 정의서 작성</h4>

<p>사용자 정의서를 토대로 우리가 만들기로 했던 내용을<br />
화면정의서로 만들어본 사진이다. 프론트엔드쪽에서 만들어주었고<br />
figma라는 사이트를 이용해서 작업을 했다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gN6UrAt4Hh28p_fYfHED8ddmhMZQTKn-IayPjD5tr0aaWitAku9UOOjfPPc3WNuO0wRC3vI7NYFSLOp1DbRdZBuuC7GOA=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>화면이 총 16개정도 나왔고, 한분이 계속 불참을 하고계셔서<br />
2명에서 작업을해야하는 상황인데, 상당히 많은 양이 나와버려서<br />
몇개의 작업을 선정해 보류로 우선 빼두었다.</p>

<p>애플리케이션의 완성을하는 것도 중요하지만<br />
이번 프로젝트의 진정한 의미는 우리가 협업에 대한 프로세스를 익히는 것과<br />
많은 기능을 구현하기보다는 현재 가능한한 할 수 있는 만큼의<br />
구현의 기술을 집중해서 체득하는 것이라 생각한다.</p>

<p><br /></p>

<h4 id="테이블-명세서-작성">테이블 명세서 작성</h4>

<p>어제 정리하지 못한 테이블 연관관계 맵핑을 진행했다.<br />
어느정도 정리가 되었고, 우선 우리가 생각한 이론대로 맵핑을 진행했는데<br />
후에 프로그램을 작성하다가 잘못된 관계가 발견될 것 같다는 전제를 두었다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gNtHIEU2S4ekKbWaXu-ElgBvs6eccpDK--Qy_wtKKZfkT8C9XUx8aO7Ds836M-vTB8gMZIyq-4BCQViUAOqjoemQPyg_g=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>이제 테이블에 대한 연관관계 맵핑을 정리하였으니</p>

<p>해당 테이블을 정리할 테이블 명세서를 작성하기로 했다.<br />
마찬가지로 구글 스프레드시트로 진행하기로 했고</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gNyuo0Fg1ErL7DiQBA3t9Y8lLRwyJV2w9TYF7DzHOgb7y8fFvvECF0TvcmYIRmrd2JjKbJ28D8KzQyhkLLTfyYXQIZ_yQ=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>일부분만 캡처하긴했지만 아래에 우리가만든 테이블에 대한 내용을 쭉 적어내려갔다. <br />
작성하면서 느낀건데 Type, Length 부터 Default에 어떤값이<br />
들어가야하는지 등등… 우리가 대충은 알지만 작성하려고하니<br />
손인 안떨어졌고 모르는 내용들이 너무 많았던 것 이다…</p>

<p>어떻게 하다보니 1차적으로는 작성을 완료했고<br />
이후에 여러사람들의 레퍼런스를 보면서 틀린게 있으면 수정할 생각이다.</p>

<h3 id="20221221-수">2022.12.21 (수)</h3>

<h4 id="오전-회의">오전 회의</h4>

<p>오늘은 프론트엔드 쪽은 화면정의서 작성 완성과<br />
백엔드는 API 명세서 작성을 완료하면 된다.<br />
오전에 잠깐모여서, 오늘의 일정을 공지하고 어떻게 진행방향을 갈지<br />
팀원과 합의를 마친다음 프론트,백엔드 각각 팀으로 나뉘어 작업하기 시작했다.</p>

<p><br /></p>

<h4 id="api-명세서-작성">API 명세서 작성</h4>

<p>백엔드 쪽에서는 API 명세서를 작업하기로 했다.<br />
처음에는 테스트 코드를 작성해 Restdocs를 이용해 문서 자동화를 하려했다.<br />
하지만 문서자동화도 좋지만 수기로 작성해보고 고민해보고 싶어 팀원들과 직접 하나씩<br />
페이지를 보면서 작성해보기로 했다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gODonrpZjMY4DhDDhk-lxaFI9lUGsTYcLbrBpPhcNM_ecbLOc87jQDk9L2QCf0eDbtCw8wkZqd_qCH94EzcgM-iH8VD5A=w1109-h920" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>50%정도 작업을 완료했고 나머지는 내일 마무리 짓기로 했다.<br />
그리고 오늘 저녁은 프로젝트 기본 셋팅과 엔티티 작업들을 진행하려한다.</p>

<p><br /></p>

<h4 id="프론트엔드-측-상황-정리">프론트엔드 측 상황 정리</h4>

<p>프론트엔드 측도 화면 정의서를 전부 작업완료했고<br />
개발에 들어가기 시작했다. 개발을 하기전에 정리해둔<br />
GitHub 컨벤션을 재정의했고, 브랜치도 이름을 다시 통일 시켰다.</p>

<p>프론트엔드 인원은 총 3명인데, 어제 얘기했던 것과 같이 <br />
현재까지 프로젝트에 대한 미참석을 하고계신 상태이다…<br />
프론트엔드 2분에게 부하가 많이 갈 것 같고, 해당 인원분은 스킬적인 문제 때문에<br />
코드스테이츠측과 상담을 진행 중 이다. 오늘 상담이 마무리되셔서</p>

<p>우선 복귀를 하셨는데, 가장 난이도가 낮은 작업 1개부터 맡기기로<br />
프론트엔드 분들과 얘기를 정리했다. 아무래도 처음부터 끝까지<br />
현재 계셔주신 2분이 고생을 많이 할 것 같아 걱정이다 🥲</p>

<p><br /></p>

<h4 id="회의록-및-정리">회의록 및 정리</h4>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>📢  공통

1. 사용자요구정의서 제출 완료
2. Github Repo release 브랜치 생성 완료

🖥  프론트엔드 작업

1. 화면 정의서 작성 완료
2. 칸반 보드 정리 및 마일스톤 작성 완료
3. 깃헙 dev/front 브랜치 생성 및 초기설정 완료
4. 연환 ) → feat/FE/Right Sidebar 진행시작
   혜원) → feat/FE/Header 진행시작
    

🔙  백엔드 작업

- 금일 수행사항
1. 테이블 명세서 및 ERD 작성 완료
2. API명세서 현 50% 작성 진행 중 

- 향후계획
1. 태스크에 따른 칸반 보드 정리 및 마일스톤 작성 필요
2. API명세서 명일(’22. 12. 22.) 내 작성완료 예정
3. 백엔드 프로그램 프로젝트 생성 및 기본 셋팅 진행 예정 (금일 19:30~)

금일 토의 사항

- REST API Response 더미데이터 추가 작성 및 누락된 property 확인 시 요청 요망
- User 기본이미지 표시
    - image 경로 지정은 DB에 하고 실제 이미지 파일은 AWS S3 버킷에 저장여부 토의
- 질문게시글 등록(Ask question)
    - 스택오버플로우 상 질문 작성 영역(Body)은 2개로 나눠어짐
    - 하나의 Body로 POST 할 지 두개의 Body로 나눠 POST 할지 논의
</code></pre></div></div>
<p>오늘 정리한 회의록이다.<br />
하루에 17:00~18:00까지 오늘 한 것에 대한 브리핑과<br />
백엔드,프론트엔드와 상의할 내용을 공유하기로 했다.</p>

<p>이렇게 3일 동안 문서만 작성했지만<br />
이제 얼추 정리되어 뭔가 하나씩 진행되는 느낌이든다 !!</p>

<p><br /></p>

<h3 id="20221222-목">2022.12.22 (목)</h3>

<p>오늘은 프론트엔드 백엔드 각각 파트에 맞춰서 작업을 진행하는 날이다.<br />
오전부터 백엔드끼리 모여서 작업을 진행하기로 했다.</p>

<h4 id="일정-및-todo-리스트-정리">일정 및 TODO 리스트 정리</h4>

<p>서로의 역할에 대한 내용을 Issue에 적어 마일스톤과 칸반보드로<br />
일정을 관리하기로 협의를 했다. 우선 프론트 엔드쪽만 마무리하였다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gPJkJMgcyfcKSzCEONpslxef22hwXt_s7YKJ7SaQaH7mYrGBYBOryBrEQjVt8pQyzEkuCnnKByVmPbhjRe_wII3izVcsQ=w1184-h1728" alt="image" class="align-left" style="max-width: 100%" /></p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gNo37uyzwTPU1Q0f-cBVDRzcbTI1OWdxbWkroNwhwXxBvW057IiQRF3EctxzFfb8JlPr_ht7JJtGvhYNsEM-NZ2sw44=w3024-h1728" alt="image" class="align-left" style="max-width: 100%" /></p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gM8k4Y80lxCH4rV29YwWmYXies5WwcY7Aiy0GWXf_xvzl0xdzZFHtD9G4u1d7BtTaPKmW4Aqdqr6V9c3vGPr_P_DXVnHA=w3024-h1728" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>쭉 해야하는 일을 전부 정리해 Todo로 올려놓고<br />
진행중인 것들은 In Progress에 <br />
완료한 것들은 Done에 올려 놓기로 하였다.</p>

<p>일정상 뒤로 미뤄놓은 기능은 Back Log에 두었다.<br />
일찍 개발을 마친다면 진행해볼 예정이다. 프론트엔드 일정정리를 마친다음에</p>

<p>백엔드쪽도 API 명세서를 다시 작업을 하기 시작했다.<br />
오전에 모든 API 명세서를 작성 완료하였고<br />
명세서가 있으니 작업을 서로 어떤걸할지 뭔가 명확하게 나눠지는 느낌을 받았다.</p>

<p>내용을 보고 우선 팀원들에게 의견을 물어보고<br />
작업을 분배해드렸다. 오후 부터는 이제 개인 코딩의 시간이고<br />
모르는 거나, 정해야할게 있을 수 있으니 디스코드에 상주하는 룰을 세웠다. (14:00~18:00)<br />
그리고 이제 백엔드도 일정과 역할 분담을위해 마일스톤과 칸반 보드 작업을 진행했다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gNHzo8QKU5q1pZKBkWyECrVLJ04_acxAmmk7RIeeiDfqufoKurNQBBDFJx5S5A_a_8upZ1gu7Plp8qpNO4p2EIxX-lYaQ=w3024-h1728" alt="image" class="align-left" style="max-width: 100%" /></p>

<p><br /></p>

<h4 id="백엔드-서버-프로그래밍을-위한-기초-셋팅">백엔드 서버 프로그래밍을 위한 기초 셋팅</h4>

<p>API별로 서로 개입없는 엔티티를 기준으로 우선 나누었다.<br />
아마 서로 겹치는 부분들이 많아질 수도 있을 것 같아 지속적인 소통이 필요할 것 같고</p>

<p>초기셋팅을 위한 프로그램을 IntelliJ 원격 연결을 이용해<br />
작업을하기로 진행했다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gPFNe6AXD1aS3Ev1wLR7w4PJYK5w9WACMXowgbll4DTMNW_de1dhfGxm9pZ1CaONUbuuQ2BA43mY4Re3nGIAHTcWigpGA=w3024-h1728" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>원격으로 연결한 JetBrain Client의 화면 모습이다.<br />
3명이 동시에 접속에 코드를 수정하기도 라이브로 지켜보는 것도 가능하다.<br />
우선 의존라이브러리 관련 설정을 마친다음에 ERD와 테이블 명세서를 바탕으로<br />
기본적은 Entity 필드를 채우고 연관관계 맵핑을 진행했다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gPBtCw37Mhr56u8T5sg3cuwWHqujObk-9xOfthj6g95L9aQa7yE8dQ8P0GNI7I1BBoXeGOEM2MK06RBEhYyHd4z-E8B4A=w3024-h1728" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>연관관계 맵핑완료한다음 mysql을 로컬로 접속한다음에<br />
ER 다이어그램을 그려주는 툴을 이용해 자동생성해 보았는데<br />
이전에 우리가 ERD에서 설계한 모습과 동일하게 뽑혔다.</p>

<p>왠지모르게 우리가 설계한대로 딱 들어맞으니까 기분이 좋았고<br />
방향성을 잘 잡고 가고있구나? 라는 느낌을 받았다 ㅎㅎ..</p>

<p>이렇게 오늘은 기초셋팅을 끝낸다음에<br />
내일부터 각자의 분량을 feat 브랜치로 만들어 작업하기로했다.</p>

<p><br /></p>

<h4 id="회의록-및-정리-1">회의록 및 정리</h4>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>📢  공통

- 릴리즈 시 모두 git pull
- 오후 시간 14:00 ~ 18:00 내 회의방 접속 유지

🖥  프론트엔드 작업

1) Header 컴포넌트 디자인 및 레이아웃 작성 + 반응형 디자인 구현 완료    
2) All Questions 컴포넌트 작업 진행 (우측 네비게이션바 등)  
3) Sign up 페이지 레이아웃 작성 완료  
4) right sidebar 컴포넌트 레이아웃 작성 완료    
5) main page 레이아웃 작성중 (오늘 중 완료 예정)

🔙  백엔드 작업

- API 명세서 1차 작성 완료(Backlog : grey color로 표기)
- API Controller 개발관련 백엔드 업무분장 완료(Github 내 이슈 및 칸반 업데이트 완료)
</code></pre></div></div>

<p><br /></p>

<h3 id="20221223-금">2022.12.23 (금)</h3>

<h4 id="개인-코딩-집중-시간">개인 코딩 집중 시간</h4>

<p>오늘은 본격적으로 각자 프로그램을 하면서<br />
API 명세서를 통해 각자 담당한 프로그램을 작성하는 날이다.</p>

<p>역할분담이 명확하게 나눠져서 얼추 시작하는데는 무리가 없을 것 같다.<br />
이제 프로그램을 작성해가면서 uri 혹은 Json 안에 내용들이 조금씩 변경 될 것 같긴하다.<br />
그래도 가이드라인이 있으니 뭔가 빨리할 것 같은 느낌이다 ㅎㅎ</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gPh3zpX0pmXcE808V1qStyobrWYWEnrWROQ7NbFSuY3VvG0Z6GmIxrMXR-C3uot3knXYIl8rDIyyT4NZlOpDW5SOpIr=w1000-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>GitHub Insights의 Network로 Branch 작업이 잘되는지 확인이 가능하다.
모두가 각자 역할에 맞게 작업을 진행하고 있다.</p>

<p>초반에 컨벤션과 브랜치 전략을 잘 정하고<br />
연습하는 시간을 다 같이 가져가서 그런지<br />
모두들 실수없이 작업을 잘해주고 있는 모습이다.</p>

<p>내가 맡은 기능 중 오늘 작업을 완료한 것은<br />
질문 포스팅하기, 질문한 포스팅 조회, 답변 포스팅하기 이다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gMoFw8zCVFy4P5w_gkzX6uk9k1dZcqlHOBGV1hSzKJw6lyfsK6fda8oPnF97CC3xCQNxC99FNLzKYTW31FP7TBC_cOSlw=w1000-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>위에 내용들은 우선 작업을 끝냈다.<br />
작업하면서 태그 관련 내용도 겹쳐서 그부분 관련해서도 완료를 해버렸다.<br />
그렇게 오늘 작업을 어느정도 끝마치고 클라이언트에서 로그인된 사용자로<br />
게시글 포스팅, 답변 포스팅에 foreign key로 객체를 지정해줘야하는데<br />
현재 Spring Security 부분을 프로그램하지 않아 Mock 데이터로 먼저 넣어두었다.</p>

<p>기본적인 Spring Security 틀을 작성하였고 <br />
나머지는 내일 마무리 해보려한다.</p>

<p><br /></p>

<h4 id="회의록-및-정리-2">회의록 및 정리</h4>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>📢  공통 토의사항

- 기본 유저 이미지 저장방법 검토 및 URL 전달 방식 확인 필요
- 로그인 인증 방법
    1. 유저네임, 패스워드 프→백으로 전달
    2. 백엔드 패스워드 암호화 및 백→프로 JWT토큰 전달
    3. 추후 요청시 JWT토큰 포함하여 프 →백으로 전달
    4. 백엔드 JWT토큰으로 유저 일치 판단

🖥  프론트엔드 작업

- Ask a Question 페이지 레이아웃 / 반응형 구현 완료
- 메인페이지 일부 수정 및 반응형 구현 완료
- Sign up 페이지 반응형 구현 완료
- Header 모바일 페이지 사이즈 반응형 구현 완료(버그 픽스)
- Left Nav 레이아웃 작성 중
- Footer 레이아웃 영역 확보

🔙  백엔드 작업

- API기능 구현 완료
    - 회원가입(signup)
    - 질문 게시글  작성 및 확인
    - Tags  화면 이동및 페이지네이션
    - Users 화면 이동 및 페이지네이션
    - 개인 프로필
- API기능 구현 진행
    - Spring Security 로그인 기능 및 인증 구현 중
    - Home 화면 구현 진행 예정
        
        
- 프론트 요청사항
    - Tag, User 이동 화면 내 페이지네이션 더미데이터 최대 100개 추가 요망(5~6page)
</code></pre></div></div>

<p><br /></p>

<h3 id="20221224-토">2022.12.24 (토)</h3>

<h4 id="spring-security-적용">Spring Security 적용</h4>

<p>오늘 정규 코딩 시간은 끝이났고<br />
이제 남은 API를 작성하면 되는데, 작성하기 전에<br />
Spring Security를 먼저 작업해야겟다고 생각했다.</p>

<p>기본적인 메서드에 대한 권한과 인증, 인가 관련해<br />
Spring Security + JWT 기본 뼈대를 잡아갔다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gP8jsOJ7ahKbNsP4G_8VxcOGOF3oBrk8kCSfK9e3Dy8RnXfFzd5x1_U16a_p2PmzwpcvdC9be0GTe-fYqgca1CDEepm=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>회원 가입 -&gt; 로그인 하였을 때, 가입된 사용자의<br />
username과 password가 일치하면 JWT를 Header에 담아 응답해줬다.</p>

<p>후에 사용자가 어떤요청을 할때 request에 JWT를 담아서 보내주면<br />
해당 정보로 우리가 어떤 사용자인지 판단하고, 인가과정을 진행한다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gNJZmCtAcRUTaKAKeTp5lWFLn90IKJaHhk619eiTnlHtkVhsWB58voqE48m_X7IwKRW_yJsZGeAX9s6qc57g8asHfCpUQ=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>PAYLOAD안에 권한과, MemberId를 넣어 두었고<br />
sub에는 이메일 정보를 넣어놓았다. (사실 sub에 어떤걸 넣어야 잘 만든 토큰인지 아직모르겠음)<br />
해당 memberId로 JWT가 담긴 요청이 왔을 경우 애노테이션을 커스터마이징해<br />
받을 수 있도록 추가해줬다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">SecurityFilterChain</span> <span class="nf">filterChain</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">http</span>
                <span class="o">.</span><span class="na">headers</span><span class="o">().</span><span class="na">frameOptions</span><span class="o">().</span><span class="na">sameOrigin</span><span class="o">()</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
                <span class="o">.</span><span class="na">csrf</span><span class="o">().</span><span class="na">disable</span><span class="o">()</span>
                <span class="o">.</span><span class="na">cors</span><span class="o">(</span><span class="nc">Customizer</span><span class="o">.</span><span class="na">withDefaults</span><span class="o">())</span> <span class="c1">// corsConfigurationSource라는 이름으로 등록된 Bean을 사용한다고 정의</span>
                <span class="o">.</span><span class="na">sessionManagement</span><span class="o">().</span><span class="na">sessionCreationPolicy</span><span class="o">(</span><span class="nc">SessionCreationPolicy</span><span class="o">.</span><span class="na">STATELESS</span><span class="o">)</span> <span class="c1">// 세션 정책 추가 (JWT사용으로 STATELESS로 설정)</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
                <span class="o">.</span><span class="na">formLogin</span><span class="o">().</span><span class="na">disable</span><span class="o">()</span> <span class="c1">// CSR 방식사용으로 formLogin 비활성화</span>
                <span class="o">.</span><span class="na">httpBasic</span><span class="o">().</span><span class="na">disable</span><span class="o">()</span> <span class="c1">// UsernamePasswordAuthenticationFilter 등 비활성화</span>
                <span class="o">.</span><span class="na">exceptionHandling</span><span class="o">()</span> <span class="c1">// 예외처리 기능이 작동</span>
                <span class="o">.</span><span class="na">authenticationEntryPoint</span><span class="o">(</span><span class="k">new</span> <span class="nc">MemberAuthenticationEntryPoint</span><span class="o">())</span>  <span class="c1">// 인증 실패시 처리</span>
                <span class="o">.</span><span class="na">accessDeniedHandler</span><span class="o">(</span><span class="k">new</span> <span class="nc">MemberAccessDeniedHandler</span><span class="o">())</span> <span class="c1">// 인증 실패시 처리</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
                <span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="k">new</span> <span class="nc">CustomFilterConfigurer</span><span class="o">())</span> <span class="c1">// 커스터마이징한 필터를 추가할 수 있음</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
                <span class="o">.</span><span class="na">authorizeHttpRequests</span><span class="o">(</span><span class="n">authorize</span> <span class="o">-&gt;</span> <span class="n">authorize</span>
                        <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">,</span> <span class="s">"/users/**"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span> <span class="s">"/users/**"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">PATCH</span><span class="o">,</span> <span class="s">"/users/**"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"USER"</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">DELETE</span><span class="o">,</span> <span class="s">"/users/**"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"USER"</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">,</span> <span class="s">"/questions/**"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"USER"</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span> <span class="s">"/questions/**"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">PATCH</span><span class="o">,</span> <span class="s">"/questions/**"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"USER"</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">DELETE</span><span class="o">,</span> <span class="s">"/questions/**"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"USER"</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">,</span> <span class="s">"/tags/**"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"USER"</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span> <span class="s">"/tags/**"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">PATCH</span><span class="o">,</span> <span class="s">"/tags/**"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"USER"</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">DELETE</span><span class="o">,</span> <span class="s">"/tags/**"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"USER"</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">,</span> <span class="s">"/answers/**"</span><span class="o">).</span><span class="na">hasAnyRole</span><span class="o">(</span><span class="s">"USER"</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span> <span class="s">"/answers/**"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">PATCH</span><span class="o">,</span> <span class="s">"/answers/**"</span><span class="o">).</span><span class="na">hasAnyRole</span><span class="o">(</span><span class="s">"USER"</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">DELETE</span><span class="o">,</span> <span class="s">"/answers/**"</span><span class="o">).</span><span class="na">hasAnyRole</span><span class="o">(</span><span class="s">"USER"</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">permitAll</span><span class="o">()</span>
                <span class="o">);</span>
        <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>로그인 사용자에 맞게 권한 설정도 완료하여 테스트까지 끝 !!!</p>

<p>오늘은 Spring Security 작업을 다 끝낸 것만해도<br />
너무 만족스러운 하루였고.. 직접 다시 짜보기 시작하니까 (거의 복붙이지만)<br />
다시 머릿속에 적립이 되어지는 느낌을 받아 너무 좋았다.</p>

<p><br /></p>

<h3 id="20221225-일">2022.12.25 (일)</h3>

<p>오늘은 크리스마스~ 🎄<br />
오전, 점심 내내 놀다가 저녁이 되서야 작업을 해본다..</p>

<h4 id="투표-기능-개발">투표 기능 개발</h4>

<p>어제 Spring Security 관련 테스트를 완료했고<br />
오늘은 투표 기능을 전부 마무리하려한다. (게시글, 답변 투표 up,down)</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Service</span>
<span class="nd">@Transactional</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">QuestionVoteService</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">QuestionVoteRepository</span> <span class="n">questionVoteRepository</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">increaseVote</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">,</span> <span class="nc">Question</span> <span class="n">question</span><span class="o">){</span>
        <span class="nc">QuestionVote</span> <span class="n">questionVote</span> <span class="o">=</span> <span class="n">findQuestionVote</span><span class="o">(</span><span class="n">member</span><span class="o">,</span> <span class="n">question</span><span class="o">);</span>

        <span class="k">if</span><span class="o">(</span><span class="n">questionVote</span><span class="o">.</span><span class="na">getStatus</span><span class="o">().</span><span class="na">toString</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"UP"</span><span class="o">)){</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">BusinessLogicException</span><span class="o">(</span><span class="nc">ExceptionCode</span><span class="o">.</span><span class="na">VOTE_NOT_ALLOW</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">questionVote</span><span class="o">.</span><span class="na">getStatus</span><span class="o">().</span><span class="na">toString</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"NONE"</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">questionVote</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="nc">VoteStatus</span><span class="o">.</span><span class="na">UP</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">questionVote</span><span class="o">.</span><span class="na">getStatus</span><span class="o">().</span><span class="na">toString</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"DOWN"</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">questionVote</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="nc">VoteStatus</span><span class="o">.</span><span class="na">NONE</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">question</span><span class="o">.</span><span class="na">setQuestionVoteCount</span><span class="o">(</span><span class="n">question</span><span class="o">.</span><span class="na">getQuestionVoteCount</span><span class="o">()</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">decreaseVote</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">,</span> <span class="nc">Question</span> <span class="n">question</span><span class="o">){</span>
        <span class="nc">QuestionVote</span> <span class="n">questionVote</span> <span class="o">=</span> <span class="n">findQuestionVote</span><span class="o">(</span><span class="n">member</span><span class="o">,</span> <span class="n">question</span><span class="o">);</span>

        <span class="k">if</span><span class="o">(</span><span class="n">questionVote</span><span class="o">.</span><span class="na">getStatus</span><span class="o">().</span><span class="na">toString</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"DOWN"</span><span class="o">)){</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">BusinessLogicException</span><span class="o">(</span><span class="nc">ExceptionCode</span><span class="o">.</span><span class="na">VOTE_NOT_ALLOW</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">questionVote</span><span class="o">.</span><span class="na">getStatus</span><span class="o">().</span><span class="na">toString</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"NONE"</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">questionVote</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="nc">VoteStatus</span><span class="o">.</span><span class="na">DOWN</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">questionVote</span><span class="o">.</span><span class="na">getStatus</span><span class="o">().</span><span class="na">toString</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"UP"</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">questionVote</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="nc">VoteStatus</span><span class="o">.</span><span class="na">NONE</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">question</span><span class="o">.</span><span class="na">setQuestionVoteCount</span><span class="o">(</span><span class="n">question</span><span class="o">.</span><span class="na">getQuestionVoteCount</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">QuestionVote</span> <span class="nf">findQuestionVote</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">,</span> <span class="nc">Question</span> <span class="n">question</span><span class="o">){</span>
        <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">QuestionVote</span><span class="o">&gt;</span> <span class="n">findQuestionVote</span> <span class="o">=</span> <span class="n">questionVoteRepository</span><span class="o">.</span><span class="na">findByMemberAndQuestion</span><span class="o">(</span><span class="n">member</span><span class="o">,</span> <span class="n">question</span><span class="o">);</span>
        <span class="k">return</span> <span class="o">!</span><span class="n">findQuestionVote</span><span class="o">.</span><span class="na">isPresent</span><span class="o">()</span> <span class="o">?</span> <span class="n">createVote</span><span class="o">(</span><span class="n">member</span><span class="o">,</span> <span class="n">question</span><span class="o">)</span> <span class="o">:</span> <span class="n">findQuestionVote</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">QuestionVote</span> <span class="nf">createVote</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">,</span> <span class="nc">Question</span> <span class="n">question</span><span class="o">){</span>
        <span class="nc">QuestionVote</span> <span class="n">questionVote</span> <span class="o">=</span> <span class="nc">QuestionVote</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="nc">VoteStatus</span><span class="o">.</span><span class="na">NONE</span><span class="o">)</span>
                <span class="o">.</span><span class="na">member</span><span class="o">(</span><span class="n">member</span><span class="o">)</span>
                <span class="o">.</span><span class="na">question</span><span class="o">(</span><span class="n">question</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">questionVoteRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">questionVote</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>서비스 로직 작성에는 그렇게 큰 어려움을 겪지는 않았다.<br />
다만 JPA가 아직 익숙하지가 않아… 쿼리를 어떻게 작성하지? 라는 <br />
의문이 계속생겼고… 내가 원하는 엔티티의 데이터를 정리해서 가져오는 일은<br />
그렇게 쉬운 일이 아니였다고 느꼈다…</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">QuestionVoteRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">QuestionVote</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">QuestionVote</span><span class="o">&gt;</span> <span class="nf">findByMemberAndQuestion</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">,</span> <span class="nc">Question</span> <span class="n">question</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>
<p>어떤 사용자가 눌럿는지와 어떤 질문에 눌럿는지를 확인하기 위해서<br />
<code class="language-plaintext highlighter-rouge">findByMemberAndQuestion</code>으로 만들어 쿼리를 날려주었다.<br />
두개의 객체와 동일한 데이터만 가져오고 싶었기 때문이다.</p>

<p>JPA관련 공부를 계속하면서… 아…<br />
내가 제대로 이해하지 못하고 사용하는 부분이 많았구나 느끼는 하루였다.  <br />
조금더 사용에 익숙해지도록 지식습득을 계속 해야할 것 같다.</p>

<p>이제 게시글, 답변 삭제,편집에 대한 API 기능만 처리해주면<br />
얼추 사용하는데 무리없이 진행이될 것 같다.<br />
삭제할 경우에는 연관관계되어있는 부분을 모두 제거해줘야하므로 <br />
<code class="language-plaintext highlighter-rouge">CascadeType.REMOVE</code>에 대한 공부가 조금 필요할 것 같다는 생각이 든다.</p>

<p><br /></p>

<h3 id="20221226-월">2022.12.26 (월)</h3>

<p>프로젝트가 어느덧 절반을 달려왔다.<br />
이제 요번주만 작업을 하면 다음주까지 제출해야하므로<br />
이번주부터는 정말 할일이 많아질 것 같다.</p>

<p>우선 배포하는 부분에 대해 … 비용이 나올 수 있어서 AWS관련 정독을 얼른 해봐야하고<br />
테스트케이스와 유효성 검증관련된 부분은 아직 손도 못댄 상태이다.<br />
얼른 오늘 API 개발을 마무리하고 이제 부수적인 작업들을 들어가야할 것 같다.</p>

<p><br /></p>

<h4 id="oauth2-적용">OAuth2 적용</h4>

<p>저번에주 Spring Security + JWT를 이용해 인증과 인가를 구현했었다.   <br />
TODO로 미뤄두었던 OAuth2 소셜로그인을 구현해보려한다.<br />
일전에 Github, kakao, naver 등 구현해본 경험이 있었고</p>

<p>미리 만들어둔 템플릿으로 어찌저찌 빠른 시간안에 구현을 하였다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOfygJtsu0SVkEF87j_quI5eodo2b0DWwbsso-KyzGIRWRqjQ8GlLYQ15SkbuO78d0QYvd6wHDIt3gbPnSQ6VAGeVdp9w=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>Github 로그인도 추가하고 싶지만…<br />
이유를 모르겠지만 scope 범위에 email이 포함되지 않는<br />
문제가 발생해… 시간을 엄청 투자했지만 진전이 없어<br />
구글 로그인만 우선 사용하기로 결정했다.
추후 TODO로 다른 소셜 로그인 정보를 가져오는 방법을 시도해봐야겠다.</p>

<p>우선 구글 계정으로 로그인하면 우리 DB에 정보를 저장하도록 했다.<br />
그리고 가입된 memberId로 어느 사용자가 사용중인지 구분하도록 판단했다.<br />
얼추 동작 확인도 전부 잘 끝났고 실제 배포환경에서 테스트해보는 일만 남은 것 같다.</p>

<p>이제 오늘 저녁에는 Test 프로그램을 작성할 예정이고<br />
Mockito를 이용해 Controller 계층만 테스트할 수 있도록 분리 후<br />
Restdocs를 이용해 API 자동 문서화를 진행할 예정이다.</p>

<p><br /></p>

<h4 id="회의록-및-정리-3">회의록 및 정리</h4>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>📢  공통

1. 로그아웃 관련 브라우저에서 JWT 토큰을 삭제하는 방식으로
2. 게시글, 답변 삭제 버튼은 추가 (API는 TODO로 설계 예정)
→ 로그인된 유저에게만 버튼이 보이도록 추가.
3. 사용자 기본 이미지 관련되서 url로 처리 시도해볼 것
→ 실패할 경우 폴더 경로로 지정 예정.


진행 일정 (12.26~12.30)  
1. 12.26 : API 개발 전수 완료 예정
2. 12.27 : Testing 기능 작성, 클라이언트 API 테스트 진행 가능
3. 12.28 : AWS 배포 과정 진행
4. 12.29 ~ 12.30 : AWS 배포 및 테스팅 완료


🖥  프론트엔드 작업

1. Profile 페이지 제외 레이아웃 작성 완료
2. API 명세서를 보고 더미 데이터 작성 후 클라이언트에 반영 예정
3. Profile 페이지에서 default 까지만 작성( Edit, Delete Todo)


🔙  백엔드 작업

1. 홈화면 이동 API 작성 진행중
2. Users, Tags 화면 이동 작성 완료
3. 질문 투표, 답변 투표 기능 추가 완료
4. OAuth2 구글 로그인 인증 완료
5. 프로필 API 마무리 작업 진행중
</code></pre></div></div>

<p><br /></p>

<h3 id="20221227-화">2022.12.27 (화)</h3>

<p>하루하루 지날때 마다 작업이 되어간다는게 체감이 더해지는 것 같다.  <br />
큰 뼈대기능은 전부 완료했고, 이제 짜잘짜잘하게 부가적인 기능과<br />
API 유효성 검토를 계속 진행해보면 될 것 같다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gNdIFsbWObg2yMRCKlVtR6v3_d5I4l70sggUo6h-FewVvD3AR7gRtwlbYogz2doml2xf_Un2v3yBGEalkIofrxIbzOFOg=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>클라이언트 쪽도 2명에서 계속 작업을 하고 계시는데도<br />
작업속도가 엄청 빠르시고, 저녁늦게까지 다들 열심히해줘서 너무 기쁘다.<br />
사실 대학교 조별과제처럼… 어려운 팀원분들도 있을거라고 생각했지만</p>

<p>다행히 우리팀에는 시간약속을 어긴다거나, 일정을 공유하지 않는다거나<br />
이런 기본적인 팀원에대한 예티켓을 안지키시는 분은 없다.<br />
처음 프로젝트를 해보는데 이정도면 축북받은 것 아닐까라는 생각을 잠시해본다 ㅎㅎ..</p>

<p><br /></p>

<h4 id="테스트-프로그램-작성">테스트 프로그램 작성</h4>

<p>이제 테스팅 프로그램을 작성하면 된다.<br />
계층별로 팀원들이 테스트 할 수 있게, 미리 패키지 정리와 준비를 끝냈다. <br />
기존과 동일하게 <code class="language-plaintext highlighter-rouge">Mockito</code>를 이용해 계층별 테스트가 가능하게 <br />
작성하고 진행중 엄청 큰 난관에 봉착했다…..</p>

<p>테스트 프로그램 실행히 403 Fobidden 부터.. Security 관련된 에러가<br />
연속적으로 발생하는 현상이 생겼다.</p>

<p>하나해결하면 하나가 나오고… 너무 어지러운 상황속에서  <br />
새벽 4시까지 컴퓨터랑 싸우면서 어찌저찌 해결을 했다.<br />
<a href="https://mycatlikeschuru.github.io/spring/2022/12/27/spring-JunitSecure.html">Spring Security 테스트 코드 작성시 설정</a>관련해서 내가 작성한 글이고 <br />
밤새 고민해본걸 적어보긴했지만 사실 이게 맞는지에 대한 공부는 더필요해 보인다.</p>

<p>어찌저찌 테스트 코드 기반은 전부 완료했고<br />
진짜 테스트 계층만 작업하면 API 문서도 자동화할 수 있다.</p>

<p>다행이 해결을해서 남은 팀원들이 편하게<br />
테스트 프로그램을 작성할 수 있다는 것에,, 너무 큰 안도감이 몰려왔다.</p>

<p><br /></p>

<h4 id="이미지-관리를-어떻게-할지">이미지 관리를 어떻게 할지?</h4>

<p>우선 파일 업로드 관련해서는 TODO로 넘기기로 했다.<br />
프로필 화면에서 본인의 서진을 바꾸는 기능이고..</p>

<p>기본적으로 회원가입을 하면 Dummy 이미지로 셋팅이 되어진다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gMd-AEg9mIR0jDwj3KU8oCbEtaD1eMKMYYFHUmSYCtMS2qQ1AHOkZIS_ZAUIj4SkkiDAnIZrD6r_VE0HFKhcSoDXUNS=w1000-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>몇개를 따와서 구글 드라이브에 우선 저장해놓았고<br />
해당 URL을 회원가입할때 String 값으로 저장해두게했다.</p>

<p>처음에는 클라이언트쪽의 경로를 저장하려고 했지만<br />
어떤 방법이 맞는지?에 대한 판단이 서질 않아서<br />
우선 구글 OAuth2 인증시에 가져오는 이미지도 url이기 때문에<br />
사진에 대한 정보는 이미지 주소로 통일하기로 프론트 쪽과 얘기를 마쳤다.</p>

<p>이후에 사진관리, 파일 관리에 대한 공부를 계속 해봐야할 것 같다…</p>

<p><br /></p>

<h4 id="회의록-및-정리-4">회의록 및 정리</h4>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>👥  참여 인원 : 이재혁, 이동우, 박종식, 김연환, 김혜원, 박평환

📢  공통

1. 수요일 AWS 배포 설정 진행
2. API 테스트 지속적 검증 필요

🖥  프론트엔드 작업

1. 프로필 EDIT,DELETE 보류 (👤 김혜원)
2. 로그인 페이지 유효성 검증 작업 중 (👤 김혜원)
3. 게시글 페이지 질문 삭제버튼 추가 (👤 김혜원)
4. 백엔드와 로직 맞춰서 데이터 받아오는 작업까지 구현 - 태그, 유저, 페이지네이션 등등 (👤 박연환)
5. footer 작업 진행 예정 (👤 박평환)

🔙  백엔드 작업

1. Pagenation → size 16로 수정할 것 (👤 이동우)
2. 기본로그인 이미지 랜덤화(14개) 및 구글로그인 자체이미지 반영 완료 (👤 이재혁)
3. 게시글 삭제 추가 예정 및 (👤 이재혁)
4. 테스트 기반으로 API 문서화 작업 자동으로 진행하도록 셋팅 진행 (👤 이재혁)
5. 상단 게시글 검색 기능 작업 완료 (부가 적인 user:1234 등의 기능 구현 예정) (👤 이동우)
6. 메인 화면 정렬 기능, 홈화면 이동기능 완료. (👤 이동우)
7. 시간 처리 작업 진행 (sec, min, hour, day, month, year) (👤 박종식)
</code></pre></div></div>

<p><br /></p>

<h4 id="레포지토리가-삭제되었다-">레포지토리가 삭제되었다 😰</h4>

<p>모든 일정이 끝나고 각자 작업을 진행하던중<br />
이전에 프로젝트에 참여가 적었던 클라이언트 측 분이<br />
실수로 Github 레포지토리를 삭제를 하였다….</p>

<p>얼른 긴급히 모여서 수복하는데 집중을 하였다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gM227vgAHW3CtlqLKiBKm9g0m_8C1Rmg1sc1RY1qfCsr0EybyAgRMWo3ENW62fuzvZCf57L2n3yh7PflUWbIwlOVipxIQ=w1114-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>코드스테이측 Organization에 속해있는 레포지토리라<br />
우리가 어떻게 만들고 할 수가 없는 상태였고…<br />
급하게 임시 대피 레포지토리를 내 계정에 파놓아서 <br />
코드를 취합하는데 집중했다.  다행히 로컬에 모두가 가지고 있는 프로그램을 <br />
푸쉬해서 PR하여 합치는데 큰 무리는 없었고, 최종적으로 합쳐진 프로그램을 가지고<br />
브랜치를 나눠 작업을하다가, 다음날 코드스테이츠 측에서 답변이 오면 <br />
후속 조치를 하기로하고 각자 다시 작업에 들어갔다.</p>

<p>너무 깜짝놀라기도했고,, 이런 상황을 겪고나니 어떻게 대처를 해야할지?<br />
경험하게되는 좋은(?)시간이 었던 것 같다.<br />
팀원들이 저녁에 다들 바쁠텐데 전부모여서 작업을해줘서 너무 고마웠고</p>

<p><br /></p>

<h3 id="20221228-수">2022.12.28 (수)</h3>

<h4 id="aws-셋팅">AWS 셋팅</h4>

<p>오늘은 오전부터 AWS 셋팅을 진행할 것 같다. <br />
비용이 나오면 안되기 때문에 S3, EC2, RDS 프리티어를 꼼꼼히<br />
팀원들과 읽어보기로 하였다. 우선 팀장인 내계정으로 만들기로 정했고<br />
너무 많이 사용하기보다는 우선 EC2 인스턴스를 만들어, 클라이언트, DB를 해결하려한다.</p>

<p>EC2에 스프링 톰캣서버를 사용해 서버를 배포하고<br />
Nginx를 사용해 클라이언트와 서버를 연결할 생각이다.<br />
DB는 EC2에 mysql을 다운받아 사용하려한다.</p>

<p>오늘은 EC2에 mysql을 다운 받고<br />
스프링 빌드파일을 배포해 DB에 저장과 연결되는 것 까지는 완료했다.<br />
<a href="https://mycatlikeschuru.github.io/db/2022/12/28/db-mysqlEC2.html">EC2 mysql과 WorkBench 연결</a>에 문제가 있어<br />
문제 해결방법을 포스팅 해두었다.</p>

<p>이번에 배포를 해보면서 정말 많은걸 배웠고, 계속 오류가 발생하니<br />
찾고 해결하고 진행하고를 무한 반복한 것 같다..</p>

<p>그래도 Mysql을 EC2에 사용할 수 있도록 셋팅하는거 하나는 확실히<br />
배운 것 같아 뿌듯 했다.</p>

<p><br /></p>

<h4 id="회의록-및-정리-5">회의록 및 정리</h4>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>👥  참여 인원 : 이재혁, 이동우, 박종식, 박연환, 김혜원, 박평환

📢  공통

- EC2 퍼블릭 IPv4 주소 매일 변동 가능성 인지
- EC2 MySQL 상 더미데이터 주입
- 클라이언트 간단한 빌드파일 프→백으로 전달 및 백엔드 cors 테스트 진행예정
- API테스트 가능시간 아직 미정

🖥  프론트엔드 작업

1. Ask questions 페이지 유효성 검사
2. signup input 유효성 검사 (백엔드에서 보내준 정규표현식이 통과 안 되는 이슈 있음)
3. Post 페이지 로그아웃 상태에서도 게시물을 볼 수 있게 수정
4. 로그인 페이지 로직 구현중 ( + 로그인 토큰 유효기간 30분에 따른 로그인/로그아웃 구현 필요)
5. 푸터 작업 진행 

🔙  백엔드 작업

1. AWS EC2 인스턴스 생성

📌  AWS 작업전 체크 사항

*AWS 자료 조사

1. 프리티어 무료 제공 범위 체크
2. GitHub에 인스턴스 관련된 키 등등 (❌  절대 올리지 말것 ❌ )
- 운영환경 설정 내역:
    - EC2
        - Ubuntu, 22.04 LTS (HVM), SSD Volume Type , 64비트(x86)
        - t2.mirco
        - 스토리지(볼륨) - 30GiB
        - IO 2백만개, 스냅샷 1GB, 대역폭 100GB
    

✅  인스턴스 초기 셋팅 

- Git Setting &amp; Github Connecting
    - ssh키 생성 : ssh-keygen
    - 공개키 github 계정 내 등록 : Setting → SSH and GPG keys 
    `cat ~/.ssh/id_rsa.pub`
    - Repository clone
- Java installation
    - Open JDK 설치
        - `sudo apt update`
        - `sudo apt install openjdk-11-jre-headless`
- Build
    - `./gradlew build`
    - 에러 발생 →`./gradlew` → `sudo chmod 777 ./gradlew`
    무한 반복 → FileZilla로 직접 build 파일 넣어줌
    - java -jar build/libs/stackoverflowclone-0.0.1-SNAPSHOT.jar
    - 환경 변수 설정 `vi ~/.bshrc` 파일 설정(JWT, OAuth 2.0)
- EC2 인바운드 설정
    - 사용자 TCP 8080
    - HTTP 80
    - HTTPS 443
    - MySQL 3306
- MySQL 설치
    - `sudo apt-get install mysql-server`
    - `mysql --version`
    - `sudo systemctl start mysql`
    - MySql 계정: root, user
    - 실행: `mysql -uroot -p` : mysql -u root team37
    - name : seb password : team37 (seb)
- MySQL 환경설정
    - application-server.yml 생성 후 JDBC datasource 설정
        - db 스키마, username, password 작성
    - 외부접속 허용
        - cd/etc/mysql/mysql.conf.d
        - sudo vi mysqld.cnf
        - bind-address 127.0.0.1 → 0.0.0.0 수정
        - sudo systemctl restart mysql
    - MySQL 계정생성 및 권한 부여(외부접속 허용)
    - EC2 인바운드 추가
        - 
    - 

*코드 적으로 변경해야할 것

1. 불필요한 시스템로그 주석처리, 삭제
2. profile 설정을 해야함 (배포용, 로컬용 분리)
3. DB 변경 → yml 설정 변경 필요

✅  아키텍쳐 구성

방법1. S3 ↔  EC2 ↔  RDS

방법2. EC2 사용. (NginX, mysql 다운)
</code></pre></div></div>

<p>오늘 구성, 진행 과정을 회의록에 적어보면서 기록을 하였다.<br />
추후에 내 블로그에 여러 방법들에 대한 포스팅을 해야<br />
정말로 내가 잘 찾아쓸 수 있을 것 같다.</p>

<p><br /></p>

<h3 id="20221229-목">2022.12.29 (목)</h3>

<h4 id="nginx-도메인-연결">NginX 도메인 연결</h4>

<p>클라이언트를 연결하기 위해 빌드된 파일을 클라이언트에서 전달해줬다. <br />
서버쪽에서는 NginX 서버를 EC2에 다운 받아 도메인과 연결해줬다.</p>

<p>도메인은 ‘내 도메인 한국’이라는 곳에서 받았고<br />
EC2 클라우딩 컴퓨터의 주소를 연결해두었다.</p>

<p>설치하는 과정은 간단했지만… 셋팅하는 과정은 쉽지않았다..<br />
팀원들과 여러가지 시도를 계속해보고 바꿔가면서 테스트를 해보았고<br />
최종적으로는 Nginx에서 클라이언트 화면이 잘표시되었고<br />
API를 요청할때 스프링 톰켓서버로 API 요청이 정상적으로 잘 들어왔다.</p>

<p><br /></p>

<h4 id="cors-에러-조치">CORS 에러 조치</h4>

<p>하지만… CORS에러가 발생했고… 이를 해결하는데 정말 <br />
많은 시간와 의논을 나누며 테스트를 해보았던 것 같다.</p>

<p>최종적으로는 CorsFilter를 빈으로 등록하고 구현해주었다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityCorsConfig</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">CorsFilter</span> <span class="nf">corsFilter</span><span class="o">(){</span>
        <span class="nc">UrlBasedCorsConfigurationSource</span> <span class="n">source</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UrlBasedCorsConfigurationSource</span><span class="o">();</span>
        <span class="nc">CorsConfiguration</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CorsConfiguration</span><span class="o">();</span>
        <span class="n">config</span><span class="o">.</span><span class="na">setAllowCredentials</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">config</span><span class="o">.</span><span class="na">addAllowedOriginPattern</span><span class="o">(</span><span class="s">"http://localhost:3000"</span><span class="o">);</span>
        <span class="n">config</span><span class="o">.</span><span class="na">addAllowedOriginPattern</span><span class="o">(</span><span class="s">"http://stackoverflowpre.p-e.kr"</span><span class="o">);</span>
        <span class="n">config</span><span class="o">.</span><span class="na">addAllowedHeader</span><span class="o">(</span><span class="s">"*"</span><span class="o">);</span> <span class="c1">//특정 header만 허용</span>
        <span class="n">config</span><span class="o">.</span><span class="na">addAllowedMethod</span><span class="o">(</span><span class="s">"*"</span><span class="o">);</span> <span class="c1">//특정 메소드만 허용 //</span>
        <span class="n">config</span><span class="o">.</span><span class="na">addExposedHeader</span><span class="o">(</span><span class="s">"Authorization"</span><span class="o">);</span>
        <span class="n">source</span><span class="o">.</span><span class="na">registerCorsConfiguration</span><span class="o">(</span><span class="s">"/**"</span><span class="o">,</span> <span class="n">config</span><span class="o">);</span> <span class="c1">//corsConfiguration으로 등록</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nf">CorsFilter</span><span class="o">(</span><span class="n">source</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>로컬에서 테스트하고 있는 클라이언트 주소와 EC2 도메인 주소<br />
그리고 addExposedHeader를 추가해주었다.</p>

<p>addExposedHeader를 추가하지 않았을 때에는 JWT 토큰이<br />
response Header에 담기기는 하지만… 클라이언트 측에서<br />
undefined가 받아와진다고하여 추가해주게 되었다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomFilterConfigurer</span> <span class="kd">extends</span> <span class="nc">AbstractHttpConfigurer</span><span class="o">&lt;</span><span class="nc">CustomFilterConfigurer</span><span class="o">,</span><span class="nc">HttpSecurity</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">builder</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
      <span class="nc">AuthenticationManager</span> <span class="n">authenticationManager</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">getSharedObject</span><span class="o">(</span><span class="nc">AuthenticationManager</span><span class="o">.</span><span class="na">class</span><span class="o">);</span> <span class="c1">// AuthenticationManager 객체얻기</span>
  
      <span class="nc">JwtAuthenticationFilter</span> <span class="n">jwtAuthenticationFilter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JwtAuthenticationFilter</span><span class="o">(</span><span class="n">authenticationManager</span><span class="o">,</span> <span class="n">jwtTokenizer</span><span class="o">);</span> <span class="c1">// JwtAuthenticationFilter 객체만들기 (생성하면서 DI하기)</span>
  
      <span class="n">jwtAuthenticationFilter</span><span class="o">.</span><span class="na">setFilterProcessesUrl</span><span class="o">(</span><span class="s">"/users/login"</span><span class="o">);</span>
      <span class="n">jwtAuthenticationFilter</span><span class="o">.</span><span class="na">setAuthenticationSuccessHandler</span><span class="o">(</span><span class="k">new</span> <span class="nc">MemberAuthenticationSuccessHandler</span><span class="o">());</span>
      <span class="n">jwtAuthenticationFilter</span><span class="o">.</span><span class="na">setAuthenticationFailureHandler</span><span class="o">(</span><span class="k">new</span> <span class="nc">MemberAuthenticationFailureHandler</span><span class="o">());</span>
  
      <span class="nc">JwtVerificationFilter</span> <span class="n">jwtVerificationFilter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JwtVerificationFilter</span><span class="o">(</span><span class="n">jwtTokenizer</span><span class="o">,</span> <span class="n">authorityUtils</span><span class="o">);</span>
  
      <span class="n">builder</span>
              <span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="n">corsFilter</span><span class="o">)</span> <span class="c1">// &lt;- corsFilter 추가</span>
              <span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="n">jwtAuthenticationFilter</span><span class="o">)</span>
              <span class="o">.</span><span class="na">addFilterAfter</span><span class="o">(</span><span class="n">jwtVerificationFilter</span><span class="o">,</span> <span class="nc">OAuth2LoginAuthenticationFilter</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>최종적으로 SecurityFilter에 CorsFilter를 DI받아 추가를 진행해주었다.<br />
이렇게 설정을 완료하고나니까 CORS 에러가 말끔히 사라졌다!! <br />
이전에 @CrossOrigin 어노테이션 사용밖에 해보지않았는데 <br />
이런 방법으로 CorsFilter를 사용해 하는 방법도 있구나 세삼 새로웠다.</p>

<p><br /></p>

<h3 id="20221230-금">2022.12.30 (금)</h3>]]></content><author><name>LEE JAEHYEOK</name></author><category term="TIL" /><category term="TIL" /><category term="부트캠프" /><category term="코드스테이츠" /><summary type="html"><![CDATA[모든 교육이 끝나고 프리 프로젝트를 시작했다. 프로젝트에 대한 기대가 너무 컸고, 얼른 내가 알고있는 기술들을 사용해보면서 구현을 해보고 싶었다.]]></summary></entry><entry><title type="html">TIL) 네달차 회고</title><link href="http://localhost:4000/til/2022/12/14/til.html" rel="alternate" type="text/html" title="TIL) 네달차 회고" /><published>2022-12-14T00:00:00+09:00</published><updated>2022-12-14T00:00:00+09:00</updated><id>http://localhost:4000/til/2022/12/14/til</id><content type="html" xml:base="http://localhost:4000/til/2022/12/14/til.html"><![CDATA[<p>4달 동안의 교육과정이 끝났다. <br />
아직 2달이라는 프로젝트 기간이 남았지만<br />
코드스테이츠의 정식적인 교육 기간은 종료되었다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gMPl-U5WSVnl2X_QlCFUFldb2dx62RGh-lw8AoRL2iVdE009mPfIjWddWnl9JK--dj78_kgJ-GdjDTkk40rN2z6SM7UMg=w3024-h1614" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>길면 길었고 짧으면 짧았지만 4개월간 새로운 내용들을<br />
계속해서 배워가고 찾아보고 공부하는 과정이 정말 즐거웠다.</p>

<p>평일,주말 가릴 것 없이 수업 진도를 따라가기 위해서<br />
거의 점심,저녁 먹는 시간을 제외하고는<br />
계속 공부했던 것 같다. 주말에는 조금 더쉬긴 했지만<br />
공부하는 습관이 길들여진게 가장 중요한 것 같다.</p>

<p>아직 배울 것도 까마득하고.. 시간이 모자라다는 생각이 정말 많이 들었다. <br />
프로젝트에 앞서 어떤 기술을 배웠는지 회고해보고<br />
어떻게 이용할 수 있을지? 공부를 앞으로 어떻게 할지를 적어보려한다.</p>

<hr />

<h3 id="네달차에는-어떤걸-배웠었지">네달차에는 어떤걸 배웠었지?</h3>

<p>섹션1 에서는 웹에 대한 CS지식과 Java에 익숙해지기<br />
섹션2 에서는 Java를 활용한 알고리즘 풀이와 Spring 맛보기<br />
섹션3 에서는 Spring을 씹고 뜯으면서 즐기기<br />
섹션4 에서는 Spring에 대한 인증과 보안에 대해 공부했고<br />
빌드와 배포 과정을 배우면서 여태 배운걸 모든걸 적용해 웹을 만들고 배포하는<br />
그러한 시간을 한달동안 가졌었다.</p>

<p>이번 섹션에서는 정말로… Spring Security를 배우면서<br />
배움의 깊이가 깊어지고 어떻게 공부를 해야할지 깨닫는 시간이었다.</p>

<p><br /></p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gMb-GiTXNgFjwEFGssz9apOx8arCoSKe-OLIvTZ8FApzMK52-lE-5lXWb9LnJatBaqnGYRBIop7J17uy-uFoOOFVkuuDQ=w3024-h1614" alt="image" class="align-left" style="max-width: 60%" /></p>

<p>사실 이전까지는 그냥 만들어진 기능만 잘 사용하면 그만아닌가? 라는 생각을 했다. <br />
Spring Seucrity를 배우면서 내가 사용하려는 프레임워크에 대한 이해도가 깊어야<br />
비로소 내가 구현하고자하는 것을 자유롭게 사용할 수 있다라는걸 느꼈다.</p>

<p>보안관련된 부분과 CI/CD에 대해 배웠었는데<br />
모든걸 당장 적용해보라하면 당연히 할 수 없다.<br />
하지만 이번에 확실히 배운건.. 보안과 CI/CD에서 몰랏던 용어들이 친숙해진점과<br />
어떤 기능들이 어디에 있는지..? 그림이 머릿속에 그려지는 것, 그리고<br />
이제는 어떤 것을 찾아봐야하는지 안다는 점이다.</p>

<p><br /></p>

<h3 id="여태까지의-회고-앞으로의-계획">여태까지의 회고, 앞으로의 계획</h3>

<p>네달이라는 긴 시간동안 공부하면서<br />
한번도 빠지지 않고 지킨 것들이 2개가 있다.</p>

<ul>
  <li><strong>하루에 한번씩 커밋하기</strong> 🌱</li>
</ul>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gMZ4F4mz3R-zJl8c9FppemfvEnqseVjc7mmB0bGlDHpZjio9pwt_lZVQJr1PM5BBMTdRiwOt_jIBXqYRUno7OIEZXpbCQ=w3024-h1728" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>정말 평일 주말 빠짐없이 커밋을 했다. (물론 의미있는 내용으로 !!) <br />
주로한 커밋은 섹션중 배운 코드 정리한 내용들과 Github 블로그 커밋<br />
그리고 알고리즘 풀이 커밋 등이 있었다.<br />
앞으로도 계속 잔디를 심어갈 예정이다.</p>

<p><br /></p>

<ul>
  <li><strong>TIL 꾸준히 작성하기</strong> 📖</li>
</ul>

<p>TIL 작성하느라 대부분 시간을 쏟은 것 같다.<br />
정규시간이 끝나면 배운내용 정리하는 일이 정말 쉬운일이 아니였다.<br />
하지만 내가 오늘 배운 내용을 다시 정리해보는 일은<br />
대충 넘어갔던 내용이라든가 제대로 이해하지 못했던 것들이라든가..<br />
개념을 다시한번 정립하는 시간을 가짐으로서 기초가 조금더 탄탄해진 느낌이 들었다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gNO2ubkWSA2QpXYZeuEW9qjrZow1SA61qggtuXAJsTN7eOZYUryE0HZJSPt1VTDrtCWB9yYUw92K7w9x4_j6vIr_RpWvA=w3024-h1728" alt="image" class="align-left" style="max-width: 70%" /></p>

<p>오늘 글을 기점으로 TIL은 종료하려고한다.<br />
부트캠프에서 배우는 내용을 정리하고자 시작했던 일이었고<br />
이제 프로젝트때 공부한 내용이라든가, 에러 처리 글이라든가<br />
각각 카테고리에 맞게 글을 써서 작성해보려한다.</p>

<p>다시말해 이제는 정말 프로젝트에 집중해 기술을 익히고 공부해서<br />
정리가 필요하다고 생각하는 부분만 정리하려는 것이다.</p>

<p><br /></p>

<p>모두가 공감하겠지만…<br />
사람이 정말 부지런하고 꾸준하다는 것은 정말 힘든 것 같다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOP9T1JWo1M3EWlE2ddf1M5nv446f916LELnYwnbL7L23TGpLExKsbBfp9uNkCTKh2WhQdLOXpEg0dKWmj2Y-hOXOH1MA=w3024-h1728" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>몸이 자꾸 침대로 먼저 가있는 나를 보면서.. 정말 나태하구나<br />
라는 생각을 했던적이 많은 것 같다.</p>

<p>처음엔 뭐든 할 것 같은 포부로 덤벼들 었지만 2~3달차가 정말 고비였다.<br />
물론 게을리 놀고만 있진 않았지만, 시간을 내서 공부하는일이 쉽지는 않았다.</p>

<p>회의감이 들 때 쯔음에 정신을 바짝 차리고 강의라도 듣자는 마음에<br />
큰돈을 들여 인프런 강의를 구매했다. 돈을 주고 구매했다보니<br />
계속 듣는 습관이 생기고 지속적으로 나를 그러한 환경에 노출시키다 보니<br />
어느 순간 내가 알아서 찾아서 공부하는 단계까지 온 것 같다.</p>

<p>아마 혼자 계속 공부를 했으면 정말 힘들었을 것 같다.<br />
다행이 우리 1일1커밋 스터디원들과 떠들기도 하고<br />
지식공유도하고 서로 의견들 나눠가면서 공부를 하다보니까<br />
동기부여도되고 앞으로 나아가는데 추진력을 준 것 같아서 스터디 활동하길 잘했다고 생각했다.</p>

<p><br /></p>

<p>이제는 본격적으로 프로젝트에서 사용하는 기능들을<br />
체득해야하는 시간이 다가왔다. 여태까지는 한번씩 사용해보고 <br />
머리로만 이해를 했다면, 이제는 사용해보고 체득해야한다.</p>

<p>앞으로의 2달을 알차게 보내기 위해<br />
내가 정말 깊이있게 공부해보고 자연스럽게 사용하고 싶은 항목들을 쭉 적어본다.</p>

<ol>
  <li><strong>Spring MVC</strong><br />
-. Spring MVC 계층에 대한 깊은 공부 ex) DispatcherServlet, HandlerMapping …등<br />
-. 항상 사용하는 어노테이션과 클래스 외에 여러 방법으로 처리해보기</li>
  <li><strong>Spring JPA</strong><br />
-. 연관관계 맵핑하는 것이 자연스러워 질때까지 연습과 공부<br />
-. Transaction에 대한 깊은 이해<br />
-. JPA 기술을 이용하지않고 구현해보는 연습 ex) JDBC만 이용하기.. 등  <br />
-. JPA - JDBC - DataBase 까지의 관계도를 그려보고 큰 아키텍쳐를 깊숙히 이해해보기</li>
  <li><strong>Spring AOP</strong><br />
-. AOP 기술 적용을 자연스럽게할 수 있을때까지 체득하고 공부하기<br />
-. 아직 어색한 포인트컷 지시자에 대해 공부</li>
  <li><strong>Spring Validation</strong><br />
-. 유효성 검증에 대한 어노테이션 및 문법을 체득할떄까지 연습<br />
-. 정규 표현식에 대한 공부</li>
  <li><strong>JUnit</strong><br />
-. 계층별 테스트에 대한 코드를 익숙하게 작성할 수 있게 연습<br />
-. API 문서 자동화에 대한 연습</li>
  <li><strong>Docker</strong><br />
-. Docker를 이용하는 법이 익숙하게 체득하여 여러가지 용도로 활용해보고 싶음<br />
(로컬환경 통일화, 프론트엔드 테스트 이미지 전송하여 테스트하도록.. 등)</li>
  <li><strong>CI/CD</strong><br />
-. AWS S3, EC2, RDS 등 인스턴스 만드는 것이 자유롭도록 연습<br />
-. 수동으로 배포하는 과정을 수시로 연습 및 EC2 초기 환경에 필요한 목록들 정리<br />
-. GitHub Action을 통한 빌드, 배포 자동화하는 과정에 대한 깊은 이해하기<br />
-. 여유가 된다면 AWS 파이프라인까지 공부</li>
</ol>

<p><br /></p>

<p>이렇게 크게 파트를 나눠서 적어보긴 했지만 분명 더 공부해야하는 범위들이 생길 것이다.  <br />
내가 이렇게 적어놓은 이유는 적어도 2달동안 위에 있는 내용들에 대해<br />
자연스럽게 술술 코드를 작성하거나 잠깐만 찾아봐도 할 수 있는 정도까지 체득하려고하는 것이다.<br />
그래야 앞으로 더 깊이있는 내용을 공부할 수 있을 것 같고<br />
추가적인 사항에 대한 공부를 지속할 수 있을 것 같기 떄문이다.</p>

<p>위에 있는 7가지의 목표를 가지고 2달동안 진짜 죽어라 다시 공부에 전념해볼 생각이다.<br />
이상 여태까지 부트캠프에 대한 회고와 앞으로의 계획을 적어보았다.</p>

<p><br /></p>]]></content><author><name>LEE JAEHYEOK</name></author><category term="TIL" /><category term="TIL" /><category term="부트캠프" /><category term="코드스테이츠" /><summary type="html"><![CDATA[4달 동안의 교육과정이 끝났다. 아직 2달이라는 프로젝트 기간이 남았지만 코드스테이츠의 정식적인 교육 기간은 종료되었다.]]></summary></entry><entry><title type="html">TIL) Ngrok 사용하여 로컬에서 서버 실행</title><link href="http://localhost:4000/til/2022/12/13/til.html" rel="alternate" type="text/html" title="TIL) Ngrok 사용하여 로컬에서 서버 실행" /><published>2022-12-13T00:00:00+09:00</published><updated>2022-12-13T00:00:00+09:00</updated><id>http://localhost:4000/til/2022/12/13/til</id><content type="html" xml:base="http://localhost:4000/til/2022/12/13/til.html"><![CDATA[<p>오늘은 어제 만들었던 TODO List 프로젝트를<br />
로컬환경에 띄우고 외부에서 접속할 수 있도록 하려한다.<br />
AWS EC2같은 클라우딩 서비스에 배포를 하지 않아도<br />
외부에서 접속이가능하니 프론트엔드쪽과 협업할때 매우 좋을 것 같다.</p>

<h3 id="ngrok-설치-및-사용">Ngrok 설치 및 사용</h3>

<p>우리가 사용중인 네트워크 방화벽과 NAT를 손보면<br />
외부IP에서 우리의 로컬환경에 접속이 가능하다. 하지만 그렇게 될 경우<br />
보안적으로는 매우 위험할 것이고, 이러한 상황에 Ngrok라는 툴을 사용하면<br />
상대적으로 안전하게 개발환경을 구축할 수 있다.</p>

<p>Ngrok은 네트워크 설정을 하지 않아도<br />
방화벽을 넘어 외부에서 로컬 환경에 접근할 수 있게 해주는 터널링 프로그램이다.<br />
무료 플랜의 경우 연결 세선이 2시간 가량 유지 된다고한다.</p>

<p><a href="https://ngrok.com/download">Ngrok 설치</a>방법은 하이퍼링크를 참조하자.<br />
Mac 유저인 경우는 homebrew로 설치도 가능하고<br />
ZIP파일을 다운받아 사용도 가능하다.</p>

<p>ZIP파일을 다운 받으면 다운받은 경로에서 <br />
관리자 권한으로 unzip을 해주면 된다.</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo unzip ~/Downloads/ngrok-v3-stable-darwin-amd64.zip -d /usr/local/bin
</code></pre></div></div>
<p>나와 같은 경우는 <code class="language-plaintext highlighter-rouge">~/Desktop/Download</code>의 경로에 파일이 있었기에<br />
앞에 경로만 변경해서 <code class="language-plaintext highlighter-rouge">sudo unzip</code>을 실행해주면 된다.</p>

<p>설치가 완료되고</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ngrok <span class="nt">-h</span>
</code></pre></div></div>
<p>를 입력하면 옵션에 대한 설명이 나올 것이다.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gObsmscGnFyEnA0dNsZKusGOpCI7AOhWbFj1xP9TzarKyjkfZMV-kWxLwuaaRfu64X9e7Q1sSuOtTyx8BVyQ9p_5EUkrQ=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>그렇다면 정상적으로 설치가 완료된 것이다.</p>

<p>터미널에서</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ngrok http 8080
</code></pre></div></div>
<p>을 입력해주게 되면 <code class="language-plaintext highlighter-rouge">http://localhost:8080</code>로 연결해주는</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOjwMrGdUi75T-RxvGdlsyritWRjFkORgi8EGTcO4k5XEjRyV_7wWkDoXIAkOjbTp5yImsdeNeBI5fcDNuEaklMf9u4iQ=w1920-h888" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>url을 하나 제공해준다. 해당 url로 협업하는 프론트엔드 측에<br />
서버를 띄워주면 이것으로 임시적으로 테스트가 가능하다.</p>

<p>해당 세션은 2시간이고, 종료했다 다시 시작하면 2시간이 채워지니<br />
한번씩 껏다키는 번거로움을 제외하고는 정말 좋은 프로그램인 것 같다.</p>

<p><code class="language-plaintext highlighter-rouge">http://127.0.0.1:4040/</code> 로 접속하게 된다면<br />
현재 요청,응답에 대한 내용들이 보기 편하게 나오니 참고해보면 좋을 것 같다.</p>

<p><br /></p>

<h3 id="tomcat-서버-띄우기">Tomcat 서버 띄우기</h3>

<p>위에서 Ngrok를 사용해 외부에서 내 로컬서버로 터널링하는 것을 배웠다.<br />
근데 만약 내가 개발중이라면 계속 스프링 부트 애플리케이션을 실행 시켜놓을 수는<br />
없는 셈이다.. 그래서 톰캣 서버를 하나 띄워 임시 애플리케이션을 배포해두면<br />
프론트엔드 측에서도 API 요청 체크가 가능하고, 백엔드 쪽에서도 개발을 진행할 수 있다.</p>

<p><a href="https://tomcat.apache.org/download-90.cgi">톰캣 공식 사이트</a>에서  <code class="language-plaintext highlighter-rouge">tar.gz (pgp, sha512)</code>를 다운받으면 된다.<br />
(나는 MacOS를 사용하므로 위에 파일을 받은 것이다)</p>

<p><br /></p>

<p><code class="language-plaintext highlighter-rouge">bin</code>폴더에 스크립트 파일을 이용해 톰캣서버를 실행시킬 수 있다.</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./startup.sh
</code></pre></div></div>

<p><br /></p>

<p>종료시에는 아래 스크립트를 실행시키면 된다.</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./shutdown.sh
</code></pre></div></div>

<p>톰캣서버가 실행되면 기본 포트는 <code class="language-plaintext highlighter-rouge">localhost:8080</code>으로 접속이 가능하다.</p>

<p>톰캣서버의 설정을 변경하는 경로는 아래와 같다.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conf &gt; server.xml
</code></pre></div></div>
<p>해당 xml파일을 열어 포트번호를 변경한다든가… 혹은<br />
내가 빌드한 <code class="language-plaintext highlighter-rouge">.war</code>파일의 경로를 설정한다든가 할 수 있다.</p>

<p>우선 포트번호를 변경하는 방법이다.<br />
아래와 같이 <code class="language-plaintext highlighter-rouge">Connector</code> 태그로 기존에 코드가 작성되어있다.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;Connector</span> <span class="na">port=</span><span class="s">"8090"</span> <span class="na">protocol=</span><span class="s">"HTTP/1.1"</span> <span class="na">connectionTimeout=</span><span class="s">"20000"</span> <span class="na">redirectPort=</span><span class="s">"8443"</span> <span class="nt">/&gt;</span>
</code></pre></div></div>
<p>변경하고자하는 포트로 변경. (8080-&gt;8090)<br />
이제 <code class="language-plaintext highlighter-rouge">localhost:8090</code>으로 서버를 띄울 수 있다.</p>

<p>그리고 webapps 폴더에 내가만든<br />
애플리케이션을 놓고 해당 애플리케이션을 실행 시키고 싶을 경우<br />
기존에 작성되어있는 <code class="language-plaintext highlighter-rouge">Host</code>태그를 찾아서 코드를 추가해야한다.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="nt">&lt;Host</span> <span class="na">name=</span><span class="s">"localhost"</span>  <span class="na">appBase=</span><span class="s">"webapps"</span>
            <span class="na">unpackWARs=</span><span class="s">"true"</span> <span class="na">autoDeploy=</span><span class="s">"true"</span><span class="nt">&gt;</span>
            <span class="c">&lt;!-- webapps 내 War파일 실행 --&gt;</span>
            <span class="nt">&lt;Context</span> <span class="na">path=</span><span class="s">"/"</span> <span class="na">docBase=</span><span class="s">"todolist-0.0.1-SNAPSHOT"</span>  <span class="na">reloadable=</span><span class="s">"false"</span> <span class="nt">&gt;</span> <span class="nt">&lt;/Context&gt;</span>

        <span class="c">&lt;!-- SingleSignOn valve, share authentication between web applications
             Documentation at: /docs/config/valve.html --&gt;</span>
        <span class="c">&lt;!--
        &lt;Valve className="org.apache.catalina.authenticator.SingleSignOn" /&gt;
        --&gt;</span>

        <span class="c">&lt;!-- Access log processes all example.
             Documentation at: /docs/config/valve.html
             Note: The pattern used is equivalent to using pattern="common" --&gt;</span>
        <span class="nt">&lt;Valve</span> <span class="na">className=</span><span class="s">"org.apache.catalina.valves.AccessLogValve"</span> <span class="na">directory=</span><span class="s">"logs"</span>
               <span class="na">prefix=</span><span class="s">"localhost_access_log"</span> <span class="na">suffix=</span><span class="s">".txt"</span>
               <span class="na">pattern=</span><span class="s">"%h %l %u %t &amp;quot;%r&amp;quot; %s %b"</span> <span class="nt">/&gt;</span>

      <span class="nt">&lt;/Host&gt;</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">&lt;!-- webapps 내 War파일 실행 --&gt;</code>이라고 적힌 아래의<br />
<code class="language-plaintext highlighter-rouge">Context</code>태그의 내용을 추가해주면 된다.<br />
여기서 <code class="language-plaintext highlighter-rouge">docBase</code>의 이름은 내가 빌드한 <code class="language-plaintext highlighter-rouge">.war</code>파일의 이름이다.</p>

<p><br /></p>

<p>마지막으로 정리해보자면</p>
<ol>
  <li>내가 만든 어플리케이션을 빌드</li>
  <li>빌드한 파일을 톰켓 서버하나를 만들어 배포 (localhost:8090)</li>
  <li>Ngrok을 이용해 로컬과 터널링하여 연결</li>
  <li>프론트엔드쪽에서 API 요청 테스트가 가능</li>
</ol>

<p><br /></p>

<hr />

<p>오늘은 이렇게 만든 애플리케이션을<br />
프론트엔드에서 사용할 수 있게 터널링을 해주는 방법을 배웠다.<br />
docker를 이용해 사용을 해줄 수도있을 것 같다는 생각이든다.</p>

<p>오늘 공부는 여기서 끝!</p>

<p><br /></p>

<p><span style="color:#994C00"><strong>오늘의 커피량</strong></span>: ☕️<br />
<strong>오늘의 점심</strong>: 라면, 밥</p>]]></content><author><name>LEE JAEHYEOK</name></author><category term="TIL" /><category term="TIL" /><category term="부트캠프" /><category term="코드스테이츠" /><summary type="html"><![CDATA[오늘은 어제 만들었던 TODO List 프로젝트를 로컬환경에 띄우고 외부에서 접속할 수 있도록 하려한다. AWS EC2같은 클라우딩 서비스에 배포를 하지 않아도 외부에서 접속이가능하니 프론트엔드쪽과 협업할때 매우 좋을 것 같다.]]></summary></entry><entry><title type="html">Spring) CORS 설정하기</title><link href="http://localhost:4000/spring/2022/12/12/spring-cors.html" rel="alternate" type="text/html" title="Spring) CORS 설정하기" /><published>2022-12-12T00:00:00+09:00</published><updated>2022-12-12T00:00:00+09:00</updated><id>http://localhost:4000/spring/2022/12/12/spring-cors</id><content type="html" xml:base="http://localhost:4000/spring/2022/12/12/spring-cors.html"><![CDATA[<p>오늘은 CORS에 대한 내용을 간단하게 적어보려한다.</p>

<p><br /></p>

<p><a href="https://todobackend.com">TODO List 연습 클라이언트</a>를 이용해 로컬톰켓서버와<br />
연결 시 CORS문제가 발생해 해결했던 코드를 올려 본다.</p>

<p><strong>1). 어노테이션으로 설정하는 방법</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@CrossOrigin</span><span class="o">(</span><span class="n">origins</span> <span class="o">=</span> <span class="s">"https://todobackend.com"</span><span class="o">)</span>
<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoListController</span> <span class="o">{</span>
    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<p><br /></p>

<p><strong>2). 빈 객체를 만들어 설정하는 방법</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodolistApplication</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">TodolistApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
	<span class="o">}</span>
	<span class="nd">@Bean</span>
	<span class="kd">public</span> <span class="nc">WebMvcConfigurer</span> <span class="nf">corsConfigurer</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">new</span> <span class="nf">WebMvcConfigurer</span><span class="o">()</span> <span class="o">{</span>
			<span class="nd">@Override</span>
			<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addCorsMappings</span><span class="o">(</span><span class="nc">CorsRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
				<span class="n">registry</span><span class="o">.</span><span class="na">addMapping</span><span class="o">(</span><span class="s">"/**"</span><span class="o">).</span><span class="na">allowedOrigins</span><span class="o">(</span><span class="s">"https://todobackend.com/"</span><span class="o">);</span>
			<span class="o">}</span>
		<span class="o">};</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>]]></content><author><name>LEE JAEHYEOK</name></author><category term="Spring" /><category term="Spring" /><category term="cors" /><summary type="html"><![CDATA[오늘은 CORS에 대한 내용을 간단하게 적어보려한다.]]></summary></entry><entry><title type="html">TIL) 프로젝트 연습, 준비</title><link href="http://localhost:4000/til/2022/12/12/til.html" rel="alternate" type="text/html" title="TIL) 프로젝트 연습, 준비" /><published>2022-12-12T00:00:00+09:00</published><updated>2022-12-12T00:00:00+09:00</updated><id>http://localhost:4000/til/2022/12/12/til</id><content type="html" xml:base="http://localhost:4000/til/2022/12/12/til.html"><![CDATA[<p>드디어 정규과정이 다 끝이 났다.<br />
4개월이란 짧은 시간에 정말 많은 것을 배웠고<br />
모든 기술을 구현할 수 있는 능력은 없지만<br />
작은 프로젝트부터 시작해 경험을 이제 쌓아올려보려한다.</p>

<p>프로젝트때 내가 중점적으로 적용하고 공부해보려는 것은</p>
<ol>
  <li>Spring MVC</li>
  <li>Spring AOP</li>
  <li>Spring JPA</li>
  <li>Spring Security(JWT, OAuth2)</li>
  <li>계층별 테스트코드 작성</li>
  <li>API 문서 자동화</li>
  <li>배포 자동화</li>
  <li>docker를 이용한 배포환경 통일화</li>
</ol>

<p>이렇게 8개 정도를 정말 숙달할 정도로 연습해보려한다.<br />
현재 1번~4번까지는 어느정도 연습이 되어있지만<br />
자세한 계층구조를 파악하는 목적을 두고 있다.</p>

<p>5~8번까지는 실제 애플리케이션 동작들을 간편하게 사용하는 목적으로<br />
이용할 가능성이크고 특히 아직 익숙하지 않은 docker에 대해선<br />
팀원들과 상의해 정말 꼭 통일된 환경을 만들어서 작업을 해보고 싶다.</p>

<p>이렇게 프로그램 작성과 적용하여 내부내용까지 정말 <br />
이번 기회에 확실히 체득하고 내 것으로 만들 계획이다.</p>

<p><br /></p>

<h3 id="간단한-프로젝트-만들어서-해보기">간단한 프로젝트 만들어서 해보기</h3>

<p>본격적으로 팀원이 정해지기전에<br />
혼자 어느정도 만들어보는 시간을 가지는 시간이 주어졌다.</p>

<p>오늘은 Todo List를 구현하는 프로그램을 만들어 보려한다.<br />
클라이언트는 이미 오픈으로 제공되어 있는 <a href="https://todobackend.com/">Todo-Backend</a>사이트를 이용해<br />
서버와 H2 데이터베이스를 이용해 작성해볼 생각이다.</p>

<p>로컬 환경에서 테스트를 하고자한다면</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://todobackend.com/client/index.html?http://localhost:8080
</code></pre></div></div>
<p>해당 URL로 접속 시 TODO LIST에 대한 GET 요청이 이루어질 것이다.<br />
GET,POST,PATCH,DELETE 까지 적용해보자</p>

<p>우선 먼저 내가 사용할 기술들에 대한<br />
의존 라이브러리를 추가해주었다.<br />
내장 톰켓 서버를 사용할 것이고, H2를 사용할 거다.<br />
그리고 Mapper를 이용할 것이고, DB에 접근하는 기술은 JPA를 사용할 것이다.<br />
그리고 편의를 위한 롬복과, 테스트 코드 작성을 위한 의존라이브러리</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dependencies</span> <span class="o">{</span>
	<span class="n">implementation</span> <span class="err">'</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">boot</span><span class="o">:</span><span class="n">spring</span><span class="o">-</span><span class="n">boot</span><span class="o">-</span><span class="n">starter</span><span class="o">-</span><span class="n">data</span><span class="o">-</span><span class="n">jpa</span><span class="err">'</span>
	<span class="n">implementation</span> <span class="err">'</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">boot</span><span class="o">:</span><span class="n">spring</span><span class="o">-</span><span class="n">boot</span><span class="o">-</span><span class="n">starter</span><span class="o">-</span><span class="n">web</span><span class="err">'</span>
	<span class="n">implementation</span> <span class="err">'</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">boot</span><span class="o">:</span><span class="n">spring</span><span class="o">-</span><span class="n">boot</span><span class="o">-</span><span class="n">starter</span><span class="o">-</span><span class="n">validation</span><span class="err">'</span>
	<span class="n">implementation</span> <span class="err">'</span><span class="n">org</span><span class="o">.</span><span class="na">mapstruct</span><span class="o">:</span><span class="nl">mapstruct:</span><span class="mf">1.4</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="na">Final</span><span class="err">'</span>
	<span class="n">implementation</span> <span class="err">'</span><span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">code</span><span class="o">.</span><span class="na">gson</span><span class="o">:</span><span class="n">gson</span><span class="err">'</span>

	<span class="n">compileOnly</span> <span class="err">'</span><span class="n">org</span><span class="o">.</span><span class="na">projectlombok</span><span class="o">:</span><span class="n">lombok</span><span class="err">'</span>
	<span class="n">runtimeOnly</span> <span class="err">'</span><span class="n">com</span><span class="o">.</span><span class="na">h2database</span><span class="o">:</span><span class="n">h2</span><span class="err">'</span>
	<span class="n">annotationProcessor</span> <span class="err">'</span><span class="n">org</span><span class="o">.</span><span class="na">projectlombok</span><span class="o">:</span><span class="n">lombok</span><span class="err">'</span>
	<span class="n">annotationProcessor</span> <span class="err">'</span><span class="n">org</span><span class="o">.</span><span class="na">mapstruct</span><span class="o">:</span><span class="n">mapstruct</span><span class="o">-</span><span class="nl">processor:</span><span class="mf">1.4</span><span class="o">.</span><span class="mi">2</span><span class="o">.</span><span class="na">Final</span><span class="err">'</span>

	<span class="n">testImplementation</span> <span class="err">'</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">boot</span><span class="o">:</span><span class="n">spring</span><span class="o">-</span><span class="n">boot</span><span class="o">-</span><span class="n">starter</span><span class="o">-</span><span class="n">test</span><span class="err">'</span>
<span class="o">}</span>
</code></pre></div></div>
<p>이 정도를 추가해볼 수 있을 것 같다.</p>

<p><br /></p>

<p>이제 의존라이브러리 설정을 다해주었으니<br />
웹 애플리케이션 계층 구조를 Controller, Service, Repository로 만들어<br />
적절한 구현과 역할을 나눠주자.</p>

<p>우선 Controller 부터 작성 했다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Slf4j</span><span class="err">\</span>
<span class="nd">@RestController</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoListController</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">TodoListService</span> <span class="n">todoListService</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">TodoListMapper</span> <span class="n">todoListMapper</span><span class="o">;</span>

    <span class="nd">@PostMapping</span>
    <span class="kd">public</span> <span class="nc">ResponseEntity</span> <span class="nf">createList</span><span class="o">(</span><span class="nd">@Valid</span> <span class="nd">@RequestBody</span> <span class="nc">TodoListDto</span> <span class="n">todoListDto</span><span class="o">){</span>

        <span class="nc">TodoList</span> <span class="n">todoList</span> <span class="o">=</span> <span class="n">todoListService</span><span class="o">.</span><span class="na">createTodoList</span><span class="o">(</span><span class="n">todoListMapper</span><span class="o">.</span><span class="na">todoListDtoToTodoList</span><span class="o">(</span><span class="n">todoListDto</span><span class="o">));</span>
        <span class="nc">TodoListResponseDto</span> <span class="n">todoListResponseDto</span> <span class="o">=</span> <span class="n">todoListMapper</span><span class="o">.</span><span class="na">todoListToTodoListResponseDto</span><span class="o">(</span><span class="n">todoList</span><span class="o">);</span>

        <span class="k">return</span> <span class="k">new</span> <span class="nf">ResponseEntity</span><span class="o">(</span><span class="n">todoListResponseDto</span><span class="o">,</span> <span class="nc">HttpStatus</span><span class="o">.</span><span class="na">CREATED</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span>
    <span class="kd">public</span> <span class="nc">ResponseEntity</span> <span class="nf">getLists</span><span class="o">(){</span>

        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">TodoList</span><span class="o">&gt;</span> <span class="n">todoLists</span> <span class="o">=</span> <span class="n">todoListService</span><span class="o">.</span><span class="na">getLists</span><span class="o">();</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">ResponseEntity</span><span class="o">(</span><span class="n">todoLists</span><span class="o">,</span><span class="nc">HttpStatus</span><span class="o">.</span><span class="na">OK</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/{listId}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">ResponseEntity</span> <span class="nf">getList</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="nc">Long</span> <span class="n">listId</span><span class="o">){</span>

        <span class="nc">TodoList</span> <span class="n">todoList</span> <span class="o">=</span> <span class="n">todoListService</span><span class="o">.</span><span class="na">getList</span><span class="o">(</span><span class="n">listId</span><span class="o">);</span>
        <span class="nc">TodoListResponseDto</span> <span class="n">todoListResponseDto</span> <span class="o">=</span> <span class="n">todoListMapper</span><span class="o">.</span><span class="na">todoListToTodoListResponseDto</span><span class="o">(</span><span class="n">todoList</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">ResponseEntity</span><span class="o">(</span><span class="n">todoListResponseDto</span><span class="o">,</span><span class="nc">HttpStatus</span><span class="o">.</span><span class="na">OK</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@PatchMapping</span><span class="o">(</span><span class="s">"/{listId}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">ResponseEntity</span> <span class="nf">updateList</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="nc">Long</span> <span class="n">listId</span><span class="o">,</span>
                                     <span class="nd">@RequestBody</span> <span class="nc">TodoListDto</span> <span class="n">todoListDto</span><span class="o">){</span>

        <span class="nc">TodoList</span> <span class="n">todoList</span> <span class="o">=</span> <span class="n">todoListService</span><span class="o">.</span><span class="na">changeTodoList</span><span class="o">(</span><span class="n">listId</span><span class="o">,</span> <span class="n">todoListMapper</span><span class="o">.</span><span class="na">todoListDtoToTodoList</span><span class="o">(</span><span class="n">todoListDto</span><span class="o">));</span>
        <span class="nc">TodoListResponseDto</span> <span class="n">todoListResponseDto</span> <span class="o">=</span> <span class="n">todoListMapper</span><span class="o">.</span><span class="na">todoListToTodoListResponseDto</span><span class="o">(</span><span class="n">todoList</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">ResponseEntity</span><span class="o">(</span><span class="n">todoListResponseDto</span><span class="o">,</span><span class="nc">HttpStatus</span><span class="o">.</span><span class="na">OK</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@DeleteMapping</span>
    <span class="kd">public</span> <span class="nc">ResponseEntity</span> <span class="nf">deleteLists</span><span class="o">(){</span>

        <span class="n">todoListService</span><span class="o">.</span><span class="na">deleteTodoLists</span><span class="o">();</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">ResponseEntity</span><span class="o">(</span><span class="nc">HttpStatus</span><span class="o">.</span><span class="na">NO_CONTENT</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@DeleteMapping</span><span class="o">(</span><span class="s">"/{listId}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">ResponseEntity</span> <span class="nf">deleteList</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="nc">Long</span> <span class="n">listId</span><span class="o">){</span>

        <span class="n">todoListService</span><span class="o">.</span><span class="na">deleteTodoList</span><span class="o">(</span><span class="n">listId</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">ResponseEntity</span><span class="o">(</span><span class="nc">HttpStatus</span><span class="o">.</span><span class="na">NO_CONTENT</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>크게 어려운 기술들은 없다.<br />
총 6개의 API로 가장 간단한 동작들만하는 메서드이다.</p>

<p>Entity 클래스 작성이다.<br />
JPA기술을 사용하기 때문에 해당 관련 설정을 해주어야한다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="nd">@NoArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoList</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">todoOrder</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">completed</span><span class="o">;</span>


    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">getCompleted</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">completed</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>
<p>4개의 필드변수가 존재하고 <br />
테이블을 4개만 사용할 예정이다.</p>

<p>Repository 계층이다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoListRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">TodoList</span><span class="o">,</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>
<span class="o">}</span>
</code></pre></div></div>
<p>JpaRepository를 상속받고, 우리가 Entity클래스로 지정한 <br />
<code class="language-plaintext highlighter-rouge">TodoList</code>와 Id 타입인 <code class="language-plaintext highlighter-rouge">Long</code>을 타입매개변수로 넣어주자</p>

<p>이제 Controller에서 주고받는 데이터를<br />
맵핑해주는 Dto 클래스를 만들어보자</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoListDto</span> <span class="o">{</span>

    <span class="nd">@NotBlank</span><span class="o">(</span><span class="n">message</span> <span class="o">=</span> <span class="s">"제목은 공백이 아니어야 합니다."</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">order</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">completed</span><span class="o">;</span>


    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">getCompleted</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">completed</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoListResponseDto</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">todoOrder</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">completed</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>
<p>첫번째 Dto는 Json객체로 요청이 왔을때<br />
맵핑을하도록 작성해주었다.<br />
아직 Valid 대한 예외처리는 적용하지 못한 상태이다.</p>

<p>두번째 Dto는 최종적으로 Reponse의 Body로 응답해줄<br />
Json객체를 만들기위해 맵핑해주는 Dto객체이다.</p>

<p>그리고 Mapper 클래스를 만들어보자</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Mapper</span><span class="o">(</span><span class="n">componentModel</span> <span class="o">=</span> <span class="s">"spring"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TodoListMapper</span> <span class="o">{</span>
    <span class="k">default</span> <span class="nc">TodoList</span> <span class="nf">todoListDtoToTodoList</span><span class="o">(</span><span class="nc">TodoListDto</span> <span class="n">todoListDto</span><span class="o">){</span>
        <span class="k">if</span> <span class="o">(</span> <span class="n">todoListDto</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nc">TodoList</span> <span class="n">todoList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TodoList</span><span class="o">();</span>

        <span class="n">todoList</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span> <span class="n">todoListDto</span><span class="o">.</span><span class="na">getTitle</span><span class="o">()</span> <span class="o">);</span>
        <span class="n">todoList</span><span class="o">.</span><span class="na">setTodoOrder</span><span class="o">(</span><span class="n">todoListDto</span><span class="o">.</span><span class="na">getOrder</span><span class="o">());</span>
        <span class="n">todoList</span><span class="o">.</span><span class="na">setCompleted</span><span class="o">(</span> <span class="n">todoListDto</span><span class="o">.</span><span class="na">getCompleted</span><span class="o">());</span>

        <span class="k">return</span> <span class="n">todoList</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nc">TodoListResponseDto</span> <span class="nf">todoListToTodoListResponseDto</span><span class="o">(</span><span class="nc">TodoList</span> <span class="n">todoList</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>
<p>Mapper를 통해서 <code class="language-plaintext highlighter-rouge">TodoListDto</code>객체를 <code class="language-plaintext highlighter-rouge">TodoList</code> 클래스로<br />
<code class="language-plaintext highlighter-rouge">TodoList</code>객체를 <code class="language-plaintext highlighter-rouge">TodoListResponseDto</code>클래스로 변경해준다.</p>

<p>이제 간단한 서비스로직에 대한 예외처리를 위한<br />
클래스를 만들어 보자</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">ExceptionCode</span> <span class="o">{</span>
    <span class="no">LIST_NOT_FOUND</span><span class="o">(</span><span class="mi">404</span><span class="o">,</span><span class="s">"TodoList Not Found"</span><span class="o">);</span>

    <span class="nd">@Getter</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">status</span><span class="o">;</span>

    <span class="nd">@Getter</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">message</span><span class="o">;</span>

    <span class="nc">ExceptionCode</span><span class="o">(</span><span class="kt">int</span> <span class="n">code</span><span class="o">,</span> <span class="nc">String</span> <span class="n">message</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">status</span> <span class="o">=</span> <span class="n">code</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServiceLogicException</span> <span class="kd">extends</span> <span class="nc">RuntimeException</span><span class="o">{</span>
    <span class="nd">@Getter</span>
    <span class="kd">private</span> <span class="nc">ExceptionCode</span> <span class="n">exceptionCode</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">ServiceLogicException</span><span class="o">(</span><span class="nc">ExceptionCode</span> <span class="n">exceptionCode</span><span class="o">){</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">exceptionCode</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
        <span class="k">this</span><span class="o">.</span><span class="na">exceptionCode</span> <span class="o">=</span> <span class="n">exceptionCode</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>이제 해당 커스텀 코드로 예외를 발생시킬 것이다.<br />
리스트의 존재여부와 같은 예외가 발생하면<br />
해당 예외를 발생시켜 추후에 Advice로 잡아서 처리해줄 수 있다.</p>

<p>이제 마지막으로 Service 로직을 작성해보자</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Service</span>
<span class="nd">@Transactional</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TodoListService</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">TodoListRepository</span> <span class="n">todoListRepository</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">TodoList</span> <span class="nf">createTodoList</span><span class="o">(</span><span class="nc">TodoList</span> <span class="n">todoList</span><span class="o">){</span>
        <span class="k">return</span> <span class="nf">saveTodoList</span><span class="o">(</span><span class="n">todoList</span><span class="o">);</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">TodoList</span> <span class="nf">getList</span><span class="o">(</span><span class="nc">Long</span> <span class="n">listId</span><span class="o">){</span>
        <span class="k">return</span> <span class="nf">findTodoList</span><span class="o">(</span><span class="n">listId</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">TodoList</span><span class="o">&gt;</span> <span class="nf">getLists</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">todoListRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">TodoList</span> <span class="nf">changeTodoList</span><span class="o">(</span><span class="nc">Long</span> <span class="n">listId</span><span class="o">,</span> <span class="nc">TodoList</span> <span class="n">todoList</span><span class="o">){</span>
        <span class="nc">TodoList</span> <span class="n">findTodoList</span> <span class="o">=</span> <span class="n">findTodoList</span><span class="o">(</span><span class="n">listId</span><span class="o">);</span>

        <span class="nc">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">todoList</span><span class="o">.</span><span class="na">getTitle</span><span class="o">()).</span><span class="na">ifPresent</span><span class="o">(</span><span class="n">title</span> <span class="o">-&gt;</span> <span class="n">findTodoList</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="n">title</span><span class="o">));</span>
        <span class="nc">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">todoList</span><span class="o">.</span><span class="na">getTodoOrder</span><span class="o">()).</span><span class="na">ifPresent</span><span class="o">(</span><span class="n">todoOrder</span> <span class="o">-&gt;</span> <span class="n">findTodoList</span><span class="o">.</span><span class="na">setTodoOrder</span><span class="o">(</span><span class="n">todoOrder</span><span class="o">));</span>
        <span class="nc">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">todoList</span><span class="o">.</span><span class="na">getCompleted</span><span class="o">()).</span><span class="na">ifPresent</span><span class="o">(</span><span class="n">completed</span> <span class="o">-&gt;</span> <span class="n">findTodoList</span><span class="o">.</span><span class="na">setCompleted</span><span class="o">(</span><span class="n">completed</span><span class="o">));</span>

        <span class="k">return</span> <span class="nf">saveTodoList</span><span class="o">(</span><span class="n">findTodoList</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteTodoLists</span><span class="o">(){</span>
        <span class="n">todoListRepository</span><span class="o">.</span><span class="na">deleteAll</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteTodoList</span><span class="o">(</span><span class="nc">Long</span> <span class="n">listId</span><span class="o">){</span>
        <span class="n">findTodoList</span><span class="o">(</span><span class="n">listId</span><span class="o">);</span>
        <span class="n">todoListRepository</span><span class="o">.</span><span class="na">deleteById</span><span class="o">(</span><span class="n">listId</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="kd">private</span> <span class="nc">TodoList</span> <span class="nf">findTodoList</span><span class="o">(</span><span class="nc">Long</span> <span class="n">listId</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">TodoList</span><span class="o">&gt;</span> <span class="n">findTodoList</span> <span class="o">=</span> <span class="n">todoListRepository</span><span class="o">.</span><span class="na">findById</span><span class="o">(</span><span class="n">listId</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">findTodoList</span><span class="o">.</span><span class="na">orElseThrow</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">ServiceLogicException</span><span class="o">(</span><span class="nc">ExceptionCode</span><span class="o">.</span><span class="na">LIST_NOT_FOUND</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">TodoList</span> <span class="nf">saveTodoList</span><span class="o">(</span><span class="nc">TodoList</span> <span class="n">todoList</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">todoListRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">todoList</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>
<p>아주 기본적인 서비스로직을 구현했다.<br />
트랜잭션 전파관련해 건드릴 만한 서비스도 존재하지 않아<br />
클래스단에 @Transactional을 붙여주었다.</p>

<p>JPA 기술을 이용해 <code class="language-plaintext highlighter-rouge">TodoList</code>객체만 보내주면<br />
DB에 맵핑이 되어진다.</p>

<p><br /></p>

<p>이렇게 간단하게 API요청과 응답에 대한 내용은<br />
전부 처리가 완료되었다.</p>

<p>이제부터 좀더 다듬어야할 부분은</p>
<ol>
  <li>유효성 검증에 처리 추가</li>
  <li>유효성 검증 실패에 따른 Advice 클래스 작성 필요</li>
  <li>계층별 테스트 케이스 만들기</li>
  <li>API 문서 자동화 해보기</li>
</ol>

<p>이렇게 코드를 추가해 볼 수 있을 것 같다.<br />
그리고 현재 로컬서버에서만 작동할 수 있게 되어있는데<br />
Ngrok를 이용해 로컬 환경에 접근할 수 있게 터널링 해주는 프로그램도<br />
이용해 볼 수 있을 것 같다.</p>

<p>우선적으로 터널링을 이용해 테스트를 해본다음<br />
위에 4가지 기능들을 구현할 시간이 주어진다면 내일 이어서 작업해볼 예정이다.</p>

<p><br /></p>

<hr />

<p>오늘은 이렇게 간단하게 웹계층을 만들어보는 시간을 가졌다.<br />
Spring MVC관련 계층 프로그램은 이제<br />
다른 프로그램을 보지않고도 할 수 있는 정도가 되었다.</p>

<p>하지만 예외를 처리하는 Advice 클래스 구현이라든가<br />
테스트 관련 계층은 문법이 생각나지않아 한번씩 보면서 작성을 해야한다…</p>

<p>오늘 공부는 여기서 끝 !!</p>

<p><br /></p>

<p><span style="color:#994C00"><strong>오늘의 커피량</strong></span>: ☕️ ☕️<br />
<strong>오늘의 점심</strong>: 제육볶음, 스팸부침, 밥</p>]]></content><author><name>LEE JAEHYEOK</name></author><category term="TIL" /><category term="TIL" /><category term="부트캠프" /><category term="코드스테이츠" /><summary type="html"><![CDATA[드디어 정규과정이 다 끝이 났다. 4개월이란 짧은 시간에 정말 많은 것을 배웠고 모든 기술을 구현할 수 있는 능력은 없지만 작은 프로젝트부터 시작해 경험을 이제 쌓아올려보려한다.]]></summary></entry></feed>