<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.3.0">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2022-11-28T16:31:47+09:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">LeeJellan</title><subtitle>ì•ˆë…•í•˜ì„¸ìš”!ğŸ™‚ IT,ì—¬í–‰,ê¸°íƒ€ ë“± ê¸°ë¡ì„ ë‚¨ê¸°ê¸°ìœ„í•œ ë¸”ë¡œê·¸ ì…ë‹ˆë‹¤ !</subtitle><author><name>LEE JAEHYEOK</name></author><entry><title type="html">TIL) Spring Security, JWT , OAuth 2 ì¸ì¦</title><link href="http://localhost:4000/til/2022/11/28/til.html" rel="alternate" type="text/html" title="TIL) Spring Security, JWT , OAuth 2 ì¸ì¦" /><published>2022-11-28T00:00:00+09:00</published><updated>2022-11-28T00:00:00+09:00</updated><id>http://localhost:4000/til/2022/11/28/til</id><content type="html" xml:base="http://localhost:4000/til/2022/11/28/til.html"><![CDATA[<p><img src="" alt="image" class="align-left" style="max-width: 100%" /></p>

<hr />

<h2 id="oauth2-ì¸ì¦-í•˜ê¸°">OAuth2 ì¸ì¦ í•˜ê¸°</h2>

<p>ì €ë²ˆì£¼ì— ë°°ì› ë˜ ì´ë¡ ì„ í† ëŒ€ë¡œ <br />
OAuth2 ì¸ì¦ì„ ì‹¤ì œë¡œ ì ìš©í•´ ë³´ì</p>

<p>ìš°ì„  Frontendì™€ Backendê°€ ë¶„ë¦¬ë˜ì–´ìˆëŠ”<br />
CSR ë°©ì‹ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ Google OAuth2 ì¸ì¦ì„ ê¸°ì¤€ìœ¼ë¡œ<br />
ì ìš©í•´ë³¼ ìƒê°ì´ë‹¤. Frontend ìª½ ì• í”Œë¦¬ì¼€ì´ì…˜ì€<br />
Apache ì›¹ ì„œë²„ë¥¼ ì´ìš©í•´ í…ŒìŠ¤íŠ¸ í•  ê²ƒì´ë‹¤.</p>

<p>ê·¸ë¦¬ê³  ì €ë²ˆì£¼ì— ì‚¬ì „ì— ì¤€ë¹„í–ˆë˜ <a href="https://console.cloud.google.com/apis">êµ¬ê¸€ API ì½˜ì†”</a> ì• í”Œë¦¬ì¼€ì´ì…˜ì„<br />
ë¯¸ë¦¬ ë§Œë“¤ì–´ë‘ì–´ì•¼ í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥í•˜ë‹¤.</p>

<p><strong>1). êµ¬ê¸€ OAuth2 ë¡œê·¸ì¸ ì¸ì¦í•˜ê¸°</strong></p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gPYCl2OOAe2LzCPgn7AQnO8UlsiBuNOeltWAqxTW2abHw4z1QBzsc0U4uLd_c6l4a6Aw6wBcn-AxXgMyQCDUjStijQcAg=w1299-h920" alt="image" class="align-left" style="max-width: 120%" /></p>

<p>ì´ì œ ê°€ì¥ ì¤‘ìš”í•œ ì²˜ë¦¬ íë¦„ì— ëŒ€í•´ ì´í•´í•´ì•¼í•œë‹¤.<br />
í˜„ì¬ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ë˜ì–´ìˆëŠ” ë¶€ë¶„ì€ ìš°ë¦¬ê°€ êµ¬í˜„í•´ì¤˜ì•¼í•˜ëŠ” ë¶€ë¶„ì´ê³ <br />
íŒŒë€ìƒ‰ ë¶€ë¶„ì€ êµ¬í˜„í•˜ì§€ ì•Šì•„ë„ Spring Securityì—ì„œ ì²˜ë¦¬í•´ì¤€ë‹¤.</p>

<p>ì²˜ìŒìœ¼ë¡œ (1)ë²ˆ ë¡œê·¸ì¸ ë§í¬ë¥¼ Frontend ì„œë²„ì—ì„œ í´ë¦­ì„í•˜ë©´</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gNEUrb0C3R5OQ64jxKBOQ2RZmo0stTpPeSGsr_TD-oZb_u8a1K9qBDeExZ7GR8XUZ8quM1L1S9_A3lwrcxbQlf-PyVTZg=w1920-h920" alt="image" class="align-left" style="max-width: 100%" /><br />
(í…ŒìŠ¤íŠ¸ ìš©ë„ë¡œ Apache ì›¹ì„œë²„ì— í•´ë‹¹ htmlì„ ë§Œë“¤ì—ˆë‹¤.)</p>

<p>(2)ë²ˆê³¼ ê°™ì€ í˜•ì‹ì˜ ì¸ì¦ URIë¡œ request ì „ì†¡ì„ í•´ì¤˜ì•¼í•œë‹¤.<br />
<code class="language-plaintext highlighter-rouge">OAuth2LoginAuthenticationFilter</code> í´ë˜ìŠ¤ê°€ ì´ë¶€ë¶„ì„ ì²˜ë¦¬í•´ì¤€ë‹¤.<br />
í•´ë‹¹ í´ë˜ìŠ¤ë„ <code class="language-plaintext highlighter-rouge">UsernamePasswordAuthenticationFilter</code>ì™€ ê°™ì´<br />
<code class="language-plaintext highlighter-rouge">AbstractAuthenticationProcessingFilter</code> ì¶”ìƒ í´ë˜ìŠ¤ë¥¼ ìƒì†í•˜ê³  ìˆë‹¤.<br />
ì¦‰ í•„í„°ê°€ ì‹œì‘ë˜ë©´ ì¶”ìƒí´ë˜ìŠ¤ì— ì •ì˜ëœ <code class="language-plaintext highlighter-rouge">doFilter();</code>ë©”ì„œë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ë‹¤.</p>

<p>ê·¸ë¦¬ê³  (3)ë²ˆì—ì„œ Googleì„ ë¡œê·¸ì¸ í™”ë©´ì„ ìš”ì²­í•˜ëŠ” URIë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•œë‹¤.<br />
ë˜í•œ Authorization Serverê°€ Backend ì• í”Œë¦¬ì¼€ì´ì…˜ ìª½ìœ¼ë¡œ<br />
Authorization Codeë¥¼ ì „ì†¡í•  Redirect URI(<code class="language-plaintext highlighter-rouge">http://localhost:8080/login/oauth2/code/google</code>)ë¥¼<br />
ì¿¼ë¦¬ íŒŒë¦¬ë¯¸í„°ë¡œ ì „ë‹¬í•´ì¤€ë‹¤. Redirect URIëŠ” Spring Securityê°€ ë‚´ë¶€ì ìœ¼ë¡œ ì œê³µí•´ì¤€ë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gPPdDAGDY39IwFa0FL10w8N0wMvZKXU62PSF8IeM9KDaMb5N48amtymQFMn9uQ8JpkmTFtCWgUkev_Xt-7gr4iPANG1-g=w1920-h920" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>ì¦‰, <code class="language-plaintext highlighter-rouge">https://accounts.google.com/o/oauth2/v2/auth/oauthchooseaccount?redirect_uri=http://localhost:8080/login/oauth2/code/google</code><br />
ì™€ ê°™ì€ í˜•ì‹ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜í•´ (4)ë²ˆì¸ ë¡œê·¸ì¸ í™”ë©´ì„ ë³´ì—¬ì¤€ë‹¤. ì´ì™¸ì— ì¿¼ë¦¬ë“¤ë„ ìˆì§€ë§Œ ë”°ë¡œ ì ì§€ëŠ” ì•Šê² ë‹¤.</p>

<p>ê·¸ëŸ¬ë©´ ì´ì œ êµ¬ê¸€ ë¡œê·¸ì¸ í™”ë©´ì´ Resource Ownerí•œí…Œ ë³´ì¼í…Œë‹ˆ<br />
(5)ë²ˆ ë¡œê·¸ì¸ì„ í•´ì£¼ë©´ ëœë‹¤. ê·¸ë ‡ê²Œ ë˜ë©´ Backend ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì—ì„œ<br />
ìœ„ì—ì„œ ë°›ì€ Redirect URIë¡œ Authorization Codeë¥¼ ìš”ì²­í•˜ê³ <br />
ê·¸ëŸ¼ê³¼ ê°™ì€ ìˆœì„œëŒ€ë¡œ Access Tokenì„ ë°›ê³ , Resource Serverì—<br />
ìš”ì²­í•˜ì—¬ ë°ì´í„°ë¥¼ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œë˜ëŠ” ê²ƒì´ë‹¤.</p>

<p>ê·¸ë¦¬ê³  ë§ˆì§€ë§‰ìœ¼ë¡œ ì „ì†¡ë°›ìœ¼ë©´ ë¡œê·¸ì¸ ì™„ë£Œ Redirectë¥¼ ì§„í–‰í• <br />
URIë¥¼ ë§Œë“¤ì–´ Frontend ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ë˜ì ¸ì£¼ë©´<br />
OAuth2 ë¡œê·¸ì¸ ì¸ì¦ êµ¬í˜„ì—ëŠ” ëë‚œë‹¤.<br />
(JWT í† í°ë„ ë§Œë“¤ì–´ í•¨ê»˜ ë³´ë‚¸ë‹¤)</p>

<p><br /></p>

<p>ì½”ë“œë¡œ í•œë²ˆ ì‚´í´ë³´ì</p>

<p>ìš°ì„  JWTë¥¼ ë§Œë“¤ì–´ì£¼ëŠ” í´ë˜ìŠ¤ë¥¼ ë¨¼ì € ì‘ì„±í•´ë³´ì<br />
ì´ì „ì— JWT ì½”ë“œì™€ ë™ì¼í•˜ë‹¤</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JwtTokenizer</span> <span class="o">{</span>

    <span class="nd">@Getter</span>
    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${jwt.key.secret}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">securityKey</span><span class="o">;</span>

    <span class="nd">@Getter</span>
    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${jwt.access-token-expiration-minutes}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">accessTokenExpirationMinutes</span><span class="o">;</span>

    <span class="nd">@Getter</span>
    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${jwt.refresh-token-expiration-minutes}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">refreshTokenExpirationMinutes</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">encodeBase64SecretKey</span><span class="o">(</span><span class="nc">String</span> <span class="n">securityKey</span><span class="o">){</span>
        <span class="k">return</span> <span class="nc">Encoders</span><span class="o">.</span><span class="na">BASE64</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">securityKey</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="nc">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">generateAccessToken</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span> <span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">claims</span><span class="o">,</span> <span class="nc">String</span> <span class="n">subject</span><span class="o">,</span> <span class="nc">Date</span> <span class="n">expiration</span><span class="o">,</span> <span class="nc">String</span> <span class="n">base64EncodedSecretKey</span><span class="o">){</span>

        <span class="nc">Key</span> <span class="n">key</span> <span class="o">=</span> <span class="n">getKeyFromBase64EncodedKey</span><span class="o">(</span><span class="n">base64EncodedSecretKey</span><span class="o">);</span>

        <span class="k">return</span> <span class="nc">Jwts</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">setSubject</span><span class="o">(</span><span class="n">subject</span><span class="o">)</span>
                <span class="o">.</span><span class="na">setClaims</span><span class="o">(</span><span class="n">claims</span><span class="o">)</span>
                <span class="o">.</span><span class="na">setIssuedAt</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getTime</span><span class="o">())</span>
                <span class="o">.</span><span class="na">setExpiration</span><span class="o">(</span><span class="n">expiration</span><span class="o">)</span>
                <span class="o">.</span><span class="na">signWith</span><span class="o">(</span><span class="n">key</span><span class="o">)</span>
                <span class="o">.</span><span class="na">compact</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">generateRefreshToken</span><span class="o">(</span><span class="nc">String</span> <span class="n">subject</span><span class="o">,</span> <span class="nc">Date</span> <span class="n">expiration</span><span class="o">,</span> <span class="nc">String</span> <span class="n">base64EncodedSecretKey</span><span class="o">){</span>

        <span class="nc">Key</span> <span class="n">key</span> <span class="o">=</span> <span class="n">getKeyFromBase64EncodedKey</span><span class="o">(</span><span class="n">base64EncodedSecretKey</span><span class="o">);</span>

        <span class="k">return</span> <span class="nc">Jwts</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">setSubject</span><span class="o">(</span><span class="n">subject</span><span class="o">)</span>
                <span class="o">.</span><span class="na">setIssuedAt</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getTime</span><span class="o">())</span>
                <span class="o">.</span><span class="na">setExpiration</span><span class="o">(</span><span class="n">expiration</span><span class="o">)</span>
                <span class="o">.</span><span class="na">signWith</span><span class="o">(</span><span class="n">key</span><span class="o">)</span>
                <span class="o">.</span><span class="na">compact</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Jws</span><span class="o">&lt;</span><span class="nc">Claims</span><span class="o">&gt;</span> <span class="nf">getClaims</span><span class="o">(</span><span class="nc">String</span> <span class="n">jws</span><span class="o">,</span> <span class="nc">String</span> <span class="n">base64EncodedSecretKey</span><span class="o">){</span>

        <span class="nc">Key</span> <span class="n">key</span> <span class="o">=</span> <span class="n">getKeyFromBase64EncodedKey</span><span class="o">(</span><span class="n">base64EncodedSecretKey</span><span class="o">);</span>

        <span class="nc">Jws</span><span class="o">&lt;</span><span class="nc">Claims</span><span class="o">&gt;</span> <span class="n">claimsJws</span> <span class="o">=</span> <span class="nc">Jwts</span><span class="o">.</span><span class="na">parserBuilder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">setSigningKey</span><span class="o">(</span><span class="n">key</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">()</span>
                <span class="o">.</span><span class="na">parseClaimsJws</span><span class="o">(</span><span class="n">jws</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">claimsJws</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Date</span> <span class="nf">getTokenExpiration</span><span class="o">(</span><span class="kt">int</span> <span class="n">expirationMinutes</span><span class="o">){</span>
        <span class="nc">Calendar</span> <span class="n">instance</span> <span class="o">=</span> <span class="nc">Calendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
        <span class="n">instance</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">MINUTE</span><span class="o">,</span> <span class="n">expirationMinutes</span><span class="o">);</span>
        <span class="nc">Date</span> <span class="n">expiration</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="na">getTime</span><span class="o">();</span>

        <span class="k">return</span> <span class="n">expiration</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Key</span> <span class="nf">getKeyFromBase64EncodedKey</span><span class="o">(</span><span class="nc">String</span> <span class="n">base64EncodedSecretKey</span><span class="o">){</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">keyBytes</span> <span class="o">=</span> <span class="nc">Decoders</span><span class="o">.</span><span class="na">BASE64</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">base64EncodedSecretKey</span><span class="o">);</span>
        <span class="k">return</span> <span class="nc">Keys</span><span class="o">.</span><span class="na">hmacShaKeyFor</span><span class="o">(</span><span class="n">keyBytes</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>ë‹¬ë¼ì§„ì ì€ ì—†ê³ , í›„ì— JWTë¥¼ ë§Œë“¤ë•Œ DIë°›ì•„ ì‚¬ìš©í•´ì£¼ë©´ ëœë‹¤.</p>

<p><br /></p>

<p>ë‘ë²ˆì§¸ë¡œëŠ” SecurityFilterChainì„ êµ¬ì„±í•´ë³´ì</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@EnableWebSecurity</span><span class="o">(</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfigurationV2</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">JwtTokenizer</span> <span class="n">jwtTokenizer</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">CustomAuthorityUtils</span> <span class="n">authorityUtils</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MemberService</span> <span class="n">memberService</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">SecurityConfigurationV2</span><span class="o">(</span><span class="nc">JwtTokenizer</span> <span class="n">jwtTokenizer</span><span class="o">,</span> <span class="nc">CustomAuthorityUtils</span> <span class="n">authorityUtils</span><span class="o">,</span> <span class="nc">MemberService</span> <span class="n">memberService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">jwtTokenizer</span> <span class="o">=</span> <span class="n">jwtTokenizer</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">authorityUtils</span> <span class="o">=</span> <span class="n">authorityUtils</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">memberService</span> <span class="o">=</span> <span class="n">memberService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">SecurityFilterChain</span> <span class="nf">filterChain</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">http</span>
                <span class="o">.</span><span class="na">headers</span><span class="o">().</span><span class="na">frameOptions</span><span class="o">().</span><span class="na">sameOrigin</span><span class="o">()</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
                <span class="o">.</span><span class="na">csrf</span><span class="o">().</span><span class="na">disable</span><span class="o">()</span>
                <span class="o">.</span><span class="na">cors</span><span class="o">(</span><span class="n">withDefaults</span><span class="o">())</span>
                <span class="o">.</span><span class="na">sessionManagement</span><span class="o">().</span><span class="na">sessionCreationPolicy</span><span class="o">(</span><span class="nc">SessionCreationPolicy</span><span class="o">.</span><span class="na">STATELESS</span><span class="o">)</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
                <span class="o">.</span><span class="na">formLogin</span><span class="o">().</span><span class="na">disable</span><span class="o">()</span>
                <span class="o">.</span><span class="na">httpBasic</span><span class="o">().</span><span class="na">disable</span><span class="o">()</span>
                <span class="o">.</span><span class="na">exceptionHandling</span><span class="o">()</span>
                <span class="o">.</span><span class="na">authenticationEntryPoint</span><span class="o">(</span><span class="k">new</span> <span class="nc">MemberAuthenticationEntryPoint</span><span class="o">())</span>
                <span class="o">.</span><span class="na">accessDeniedHandler</span><span class="o">(</span><span class="k">new</span> <span class="nc">MemberAccessDeniedHandler</span><span class="o">())</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
                <span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="k">new</span> <span class="nc">CustomFilterConfigurer</span><span class="o">())</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
                <span class="o">.</span><span class="na">authorizeHttpRequests</span><span class="o">(</span><span class="n">authorize</span> <span class="o">-&gt;</span> <span class="n">authorize</span> <span class="c1">// url authorization ì „ì²´ ì¶”ê°€</span>
                                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">,</span> <span class="s">"/*/coffees"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"ADMIN"</span><span class="o">)</span>
                                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">PATCH</span><span class="o">,</span> <span class="s">"/*/coffees/**"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"ADMIN"</span><span class="o">)</span>
                                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span> <span class="s">"/*/coffees/**"</span><span class="o">).</span><span class="na">hasAnyRole</span><span class="o">(</span><span class="s">"USER"</span><span class="o">,</span> <span class="s">"ADMIN"</span><span class="o">)</span>
                                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span> <span class="s">"/*/coffees"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span>
                                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">DELETE</span><span class="o">,</span> <span class="s">"/*/coffees"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"ADMIN"</span><span class="o">)</span>
                                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">,</span> <span class="s">"/*/orders"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"USER"</span><span class="o">)</span>
                                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">PATCH</span><span class="o">,</span> <span class="s">"/*/orders"</span><span class="o">).</span><span class="na">hasAnyRole</span><span class="o">(</span><span class="s">"USER"</span><span class="o">,</span> <span class="s">"ADMIN"</span><span class="o">)</span>
                                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span> <span class="s">"/*/orders/**"</span><span class="o">).</span><span class="na">hasAnyRole</span><span class="o">(</span><span class="s">"USER"</span><span class="o">,</span> <span class="s">"ADMIN"</span><span class="o">)</span>
                                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">DELETE</span><span class="o">,</span> <span class="s">"/*/orders"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"USER"</span><span class="o">)</span>
                                <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">permitAll</span><span class="o">()</span>
                <span class="o">)</span>
                <span class="o">.</span><span class="na">oauth2Login</span><span class="o">(</span><span class="n">oauth2</span> <span class="o">-&gt;</span> <span class="n">oauth2</span>
                        <span class="o">.</span><span class="na">successHandler</span><span class="o">(</span><span class="k">new</span> <span class="nc">OAuth2MemberSuccessHandler</span><span class="o">(</span><span class="n">jwtTokenizer</span><span class="o">,</span> <span class="n">authorityUtils</span><span class="o">,</span> <span class="n">memberService</span><span class="o">))</span>
                <span class="o">);</span>

        <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="nc">CorsConfigurationSource</span> <span class="nf">corsConfigurationSource</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">CorsConfiguration</span> <span class="n">configuration</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CorsConfiguration</span><span class="o">();</span>
        <span class="n">configuration</span><span class="o">.</span><span class="na">setAllowedOrigins</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"*"</span><span class="o">));</span>
        <span class="n">configuration</span><span class="o">.</span><span class="na">setAllowedMethods</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"GET"</span><span class="o">,</span><span class="s">"POST"</span><span class="o">,</span> <span class="s">"PATCH"</span><span class="o">,</span> <span class="s">"DELETE"</span><span class="o">));</span>
        <span class="nc">UrlBasedCorsConfigurationSource</span> <span class="n">source</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UrlBasedCorsConfigurationSource</span><span class="o">();</span>
        <span class="n">source</span><span class="o">.</span><span class="na">registerCorsConfiguration</span><span class="o">(</span><span class="s">"/**"</span><span class="o">,</span> <span class="n">configuration</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">source</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomFilterConfigurer</span> <span class="kd">extends</span> <span class="nc">AbstractHttpConfigurer</span><span class="o">&lt;</span><span class="nc">CustomFilterConfigurer</span><span class="o">,</span> <span class="nc">HttpSecurity</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">builder</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
            <span class="nc">JwtVerificationFilter</span> <span class="n">jwtVerificationFilter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JwtVerificationFilter</span><span class="o">(</span><span class="n">jwtTokenizer</span><span class="o">,</span> <span class="n">authorityUtils</span><span class="o">);</span>

            <span class="n">builder</span><span class="o">.</span><span class="na">addFilterAfter</span><span class="o">(</span><span class="n">jwtVerificationFilter</span><span class="o">,</span> <span class="nc">OAuth2LoginAuthenticationFilter</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>í•„í„°ì²´ì¸ êµ¬ì„±ë„ í¬ê²Œ ë°”ë€ê±´ ì—†ë‹¤.<br />
ë‹¬ë¼ì§„ì ì€ JWT ì¸ì¦ì„ ì‚¬ìš©í–ˆì„ ë•ŒëŠ”, <code class="language-plaintext highlighter-rouge">jwtAuthenticationFilter</code>ë¼ëŠ” í•„í„° í´ë˜ìŠ¤ë¥¼<br />
ìš°ë¦¬ê°€ ì§ì ‘ êµ¬í˜„í•´ì¤˜ì„œ, í•„í„°ì²´ì¸ì— ë“±ë¡í•´ì£¼ì—ˆì—ˆë‹¤. ê·¸ ë¶€ë¶„ì´ ì‚¬ë¼ì§€ê³ <br />
ìš°ë¦¬ëŠ” OAuth2 ì¸ì¦ì„ ì´ìš©í•˜ê¸° ìœ„í•´ <code class="language-plaintext highlighter-rouge">.oauth2Login()</code> ê°€ ì¶”ê°€ë˜ì—ˆê³ , ì¶”ê°€ë¨ì— ë”°ë¼  <br />
<code class="language-plaintext highlighter-rouge">OAuth2AuthorizationRequestRedirectFilter</code> ì™€ <br />
<code class="language-plaintext highlighter-rouge">OAuth2LoginAuthenticationFilter</code> ê°€ ì¶”ê°€ëœë‹¤. <br />
í•´ë‹¹ í•„í„°ë“¤ì´ ì¶”ê°€ë¨ì—ë”°ë¼ OAuth2 ì¸ì¦ì„ ì§„í–‰í•´ì£¼ê³ , ì¸ì¦ì— ì„±ê³µì‹œ
<code class="language-plaintext highlighter-rouge">AbstractAuthenticationProcessingFilter</code> í´ë˜ìŠ¤ì—ì„œ<br />
<code class="language-plaintext highlighter-rouge">successfulAuthentication();</code>ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ê²Œ ë˜ì–´ì§„ë‹¤.</p>

<p>í˜¸ì¶œë˜ë©´ ì¸ì¦ëœ ê°ì²´ê°€ <code class="language-plaintext highlighter-rouge">SecurityContext</code>ì— ì €ì¥ë˜ê³ <br />
<code class="language-plaintext highlighter-rouge">AuthenticationSuccessHandler</code> ì¸í„°í˜ì´ìŠ¤ì— <code class="language-plaintext highlighter-rouge">onAuthenticationSuccess();</code>ë¥¼ í˜¸ì¶œí•˜ê²Œëœë‹¤.<br />
ë§ì€ ì¦‰ìŠ¨ í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†í•´ êµ¬í˜„í•˜ëŠ” í´ë˜ìŠ¤ë¥¼ ìš°ë¦¬ê°€ ë§Œë“¤ì–´ì„œ Frontendìª½ ì„œë²„ë¡œ<br />
JWT í† í°ì„ ë§Œë“¤ì–´ì„œ ë³´ë‚¸ë‹¤ê±°ë‚˜, ë¦¬ë‹¤ì´ë ‰íŠ¸í•  URIë¥¼ ìƒì„±í•œë‹¤ë“ ê°€ ì¡°ì‘ì´ ê°€ëŠ¥í•˜ë‹¤ëŠ” ì ì´ë‹¤.</p>

<p>ê·¸ë ‡ê²Œ ì¡°ì‘í•˜ëŠ” í´ë˜ìŠ¤ë¥¼ ìš°ë¦¬ê°€ ë§Œë“¤ì–´ë³´ì</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OAuth2MemberSuccessHandler</span> <span class="kd">extends</span> <span class="nc">SimpleUrlAuthenticationSuccessHandler</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">JwtTokenizer</span> <span class="n">jwtTokenizer</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">CustomAuthorityUtils</span> <span class="n">authorityUtils</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MemberService</span> <span class="n">memberService</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">OAuth2MemberSuccessHandler</span><span class="o">(</span><span class="nc">JwtTokenizer</span> <span class="n">jwtTokenizer</span><span class="o">,</span> <span class="nc">CustomAuthorityUtils</span> <span class="n">authorityUtils</span><span class="o">,</span> <span class="nc">MemberService</span> <span class="n">memberService</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">jwtTokenizer</span> <span class="o">=</span> <span class="n">jwtTokenizer</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">authorityUtils</span> <span class="o">=</span> <span class="n">authorityUtils</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">memberService</span> <span class="o">=</span> <span class="n">memberService</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onAuthenticationSuccess</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">Authentication</span> <span class="n">authentication</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>
        <span class="c1">// ì¸ì¦ëœ ê°ì²´ë¡œ ë¶€í„° Resource Ownerì˜ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"# Redirect to Frontend"</span><span class="o">);</span>
        <span class="nc">OAuth2User</span> <span class="n">oAuth2User</span> <span class="o">=</span> <span class="o">(</span><span class="nc">OAuth2User</span><span class="o">)</span> <span class="n">authentication</span><span class="o">.</span><span class="na">getPrincipal</span><span class="o">();</span>
        <span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="n">oAuth2User</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span>
        <span class="nc">String</span> <span class="n">email</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>

        <span class="cm">/*
         * í”Œë«í¼ì— ë”°ë¥¸ email ê°€ì ¸ì˜¤ê¸°
         * */</span>
        <span class="k">if</span><span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"ì‚­ì œ"</span><span class="o">)){</span> <span class="c1">// í•´ë‹¹ ë¶€ë¶„ì€ getName();ì˜ ë²ˆí˜¸ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë¶€ë¶„ìœ¼ë¡œ ë¹„êµí•¨. í˜¹ì‹œ ëª°ë¼ì„œ ë²ˆí˜¸ëŠ” ì‚­ì œ</span>
            <span class="c1">// êµ¬ê¸€</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"# Google ë¡œê·¸ì¸ ì‹¤í–‰"</span><span class="o">);</span>
            <span class="n">email</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">oAuth2User</span><span class="o">.</span><span class="na">getAttributes</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">"email"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"ì‚­ì œ"</span><span class="o">)){</span>
            <span class="c1">//ì¹´ì¹´ì˜¤</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"# Kakao ë¡œê·¸ì¸ ì‹¤í–‰"</span><span class="o">);</span>
            <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">attributes</span> <span class="o">=</span> <span class="n">oAuth2User</span><span class="o">.</span><span class="na">getAttributes</span><span class="o">();</span>
            <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">kakao_account</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;)</span> <span class="n">attributes</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"kakao_account"</span><span class="o">);</span>
            <span class="n">email</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">kakao_account</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"email"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span><span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"ì‚­ì œ"</span><span class="o">)){</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"# GitHub ë¡œê·¸ì¸ ì‹¤í–‰"</span><span class="o">);</span>
            <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">attributes</span> <span class="o">=</span> <span class="n">oAuth2User</span><span class="o">.</span><span class="na">getAttributes</span><span class="o">();</span>
            <span class="n">email</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">attributes</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"login"</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"# Naver ë¡œê·¸ì¸ ì‹¤í–‰"</span><span class="o">);</span>
            <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">attributes</span> <span class="o">=</span> <span class="n">oAuth2User</span><span class="o">.</span><span class="na">getAttributes</span><span class="o">();</span>
            <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">naver_account</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;)</span> <span class="n">attributes</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"response"</span><span class="o">);</span>
            <span class="n">email</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">naver_account</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"email"</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">// ê°•ì œ admin ê¶Œí•œ ë¶€ì—¬ (í…ŒìŠ¤íŠ¸ ìš©ë„)</span>
        <span class="nc">String</span> <span class="n">adminCheck</span> <span class="o">=</span> <span class="s">"admin@gmail.com"</span><span class="o">;</span>
        <span class="c1">// ì–»ì€ email ì£¼ì†Œë¡œ ê¶Œí•œ List ë§Œë“¤ê¸°</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">authorities</span> <span class="o">=</span> <span class="n">authorityUtils</span><span class="o">.</span><span class="na">createRoles</span><span class="o">(</span><span class="n">adminCheck</span><span class="o">);</span>

        <span class="c1">// emailì„ í† ëŒ€ë¡œ Member ê°ì²´ ë§Œë“¤ì–´ì„œ DBì— ì €ì¥</span>
        <span class="c1">// í˜„ì¬ëŠ” ì €ì¥ì•ˆí•˜ë„ë¡ í…ŒìŠ¤íŠ¸ë§Œì§„í–‰</span>
<span class="c1">//        saveMember(email);</span>

        <span class="c1">// ë¦¬ë‹¤ì´ë ‰íŠ¸ë¥¼ í•˜ê¸°ìœ„í•œ ì •ë³´ë“¤ì„ ë³´ë‚´ì¤Œ</span>
        <span class="n">redirect</span><span class="o">(</span><span class="n">request</span><span class="o">,</span><span class="n">response</span><span class="o">,</span><span class="n">email</span><span class="o">,</span><span class="n">authorities</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">redirect</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">String</span> <span class="n">username</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">authorities</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="c1">// ë°›ì€ ì •ë³´ë¥¼ í† ëŒ€ë¡œ AccessToken, Refresh Tokenì„ ë§Œë“¬</span>
        <span class="nc">String</span> <span class="n">accessToken</span> <span class="o">=</span> <span class="n">delegateAccessToken</span><span class="o">(</span><span class="n">username</span><span class="o">,</span> <span class="n">authorities</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">refreshToken</span> <span class="o">=</span> <span class="n">delegateRefreshToken</span><span class="o">(</span><span class="n">username</span><span class="o">);</span>

        <span class="c1">// Tokenì„ í† ëŒ€ë¡œ URIë¥¼ ë§Œë“¤ì–´ì„œ Stringìœ¼ë¡œ ë³€í™˜</span>
        <span class="nc">String</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">createURI</span><span class="o">(</span><span class="n">accessToken</span><span class="o">,</span> <span class="n">refreshToken</span><span class="o">).</span><span class="na">toString</span><span class="o">();</span>

        <span class="c1">// ë§Œë“  URIë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë³´ëƒ„</span>
        <span class="n">getRedirectStrategy</span><span class="o">().</span><span class="na">sendRedirect</span><span class="o">(</span><span class="n">request</span><span class="o">,</span><span class="n">response</span><span class="o">,</span><span class="n">uri</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="nf">delegateAccessToken</span><span class="o">(</span><span class="nc">String</span> <span class="n">username</span><span class="o">,</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">authorities</span><span class="o">){</span>

        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">claims</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">claims</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"username"</span><span class="o">,</span><span class="n">username</span><span class="o">);</span>
        <span class="n">claims</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"roles"</span><span class="o">,</span><span class="n">authorities</span><span class="o">);</span>

        <span class="nc">String</span> <span class="n">subject</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
        <span class="nc">Date</span> <span class="n">expiration</span> <span class="o">=</span> <span class="n">jwtTokenizer</span><span class="o">.</span><span class="na">getTokenExpiration</span><span class="o">(</span><span class="n">jwtTokenizer</span><span class="o">.</span><span class="na">getAccessTokenExpirationMinutes</span><span class="o">());</span>
        <span class="nc">String</span> <span class="n">base64EncodedSecretKey</span> <span class="o">=</span> <span class="n">jwtTokenizer</span><span class="o">.</span><span class="na">encodeBase64SecretKey</span><span class="o">(</span><span class="n">jwtTokenizer</span><span class="o">.</span><span class="na">getSecurityKey</span><span class="o">());</span>

        <span class="nc">String</span> <span class="n">accessToken</span> <span class="o">=</span> <span class="n">jwtTokenizer</span><span class="o">.</span><span class="na">generateAccessToken</span><span class="o">(</span><span class="n">claims</span><span class="o">,</span> <span class="n">subject</span><span class="o">,</span> <span class="n">expiration</span><span class="o">,</span> <span class="n">base64EncodedSecretKey</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">accessToken</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="nf">delegateRefreshToken</span><span class="o">(</span><span class="nc">String</span> <span class="n">username</span><span class="o">){</span>

        <span class="nc">String</span> <span class="n">subject</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
        <span class="nc">Date</span> <span class="n">expiration</span> <span class="o">=</span> <span class="n">jwtTokenizer</span><span class="o">.</span><span class="na">getTokenExpiration</span><span class="o">(</span><span class="n">jwtTokenizer</span><span class="o">.</span><span class="na">getRefreshTokenExpirationMinutes</span><span class="o">());</span>
        <span class="nc">String</span> <span class="n">base64EncodedSecretKey</span> <span class="o">=</span> <span class="n">jwtTokenizer</span><span class="o">.</span><span class="na">encodeBase64SecretKey</span><span class="o">(</span><span class="n">jwtTokenizer</span><span class="o">.</span><span class="na">getSecurityKey</span><span class="o">());</span>
        <span class="nc">String</span> <span class="n">refreshToken</span> <span class="o">=</span> <span class="n">jwtTokenizer</span><span class="o">.</span><span class="na">generateRefreshToken</span><span class="o">(</span><span class="n">subject</span><span class="o">,</span> <span class="n">expiration</span><span class="o">,</span> <span class="n">base64EncodedSecretKey</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">refreshToken</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="no">URI</span> <span class="nf">createURI</span><span class="o">(</span><span class="nc">String</span> <span class="n">accessToken</span><span class="o">,</span> <span class="nc">String</span> <span class="n">refreshToken</span><span class="o">){</span>
        <span class="nc">MultiValueMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">queryParams</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LinkedMultiValueMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">queryParams</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"access_token"</span><span class="o">,</span> <span class="n">accessToken</span><span class="o">);</span>
        <span class="n">queryParams</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"refresh_token"</span><span class="o">,</span> <span class="n">refreshToken</span><span class="o">);</span>

        <span class="k">return</span> <span class="nc">UriComponentsBuilder</span>
                <span class="o">.</span><span class="na">newInstance</span><span class="o">()</span>
                <span class="o">.</span><span class="na">scheme</span><span class="o">(</span><span class="s">"http"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">host</span><span class="o">(</span><span class="s">"localhost"</span><span class="o">)</span>
<span class="c1">//                .port(80) // ê¸°ë³¸ í¬íŠ¸ê°€ 80ì´ê¸° ë•Œë¬¸ì— ê´œì°®ë‹¤</span>
                <span class="o">.</span><span class="na">path</span><span class="o">(</span><span class="s">"/receive-token.html"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">queryParams</span><span class="o">(</span><span class="n">queryParams</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">()</span>
                <span class="o">.</span><span class="na">toUri</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">SimpleUrlAuthenticationSuccessHandler</code>í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ê³  ìˆë‹¤.<br />
í•´ë‹¹ í´ë˜ìŠ¤ëŠ” <code class="language-plaintext highlighter-rouge">AuthenticationSuccessHandler</code> ì¸í„°ì´ìŠ¤ë¥¼ ìƒì†ë°›ê³ ìˆë‹¤.<br />
ìœ„ì—ì„œ ì–˜ê¸°í–ˆë“¯ì´ ì¸ì¦ì— ì„±ê³µì‹œ í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ì˜ <code class="language-plaintext highlighter-rouge">onAuthenticationSuccess();</code>ê°€<br />
í˜¸ì¶œë˜ì–´ì§€ê³ , ì´ ë©”ì„œë“œë¥¼ Overridingí•˜ì—¬ êµ¬í˜„í•˜ë©´ ëœë‹¤.</p>

<p>êµ¬í˜„ ë‚´ìš©ì€ ì¸ì¦ëœ ê°ì²´ì—ì„œ ìš°ì„  ì •ë³´ë¥¼ êº¼ë‚´ë„ë¡í–ˆë‹¤.<br />
email ì •ë³´ë¥¼ êº¼ë‚´ì„œ ì¶”í›„ì— DBì— ê´€ë¦¬í•œë‹¤ë©´ ì €ì¥í•  ì˜ˆì •ì´ë‹¤.<br />
ë˜í•œ ì—¬ëŸ¬ê°€ì§€ Google,Kakao,Github,Kakao ë“±ì„ êµ¬ë³„í•˜ê¸°ìœ„í•´<br />
<code class="language-plaintext highlighter-rouge">getName();</code>ì˜ ê°’ì„ ì‚¬ìš©í–ˆì§€ë§Œâ€¦ ì´ë¶€ë¶„ì€ ë”°ë¡œ headerì—ì„œ êµ¬ë¶„í•  ìˆ˜ ìˆëŠ”<br />
ë¬´ì–¸ê°€ë¥¼ ê°€ì ¸ì™€ì•¼í•  ê²ƒ ê°™ì€ ëŠë‚Œì´ë“ ë‹¤. (ì•„ì§ í•´ê²°ëª»í•œ ìˆ™ì œë‹¤)</p>

<p>ê·¸ë˜ë„ ìš°ì„  êµ¬í˜„í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ nameê°’ìœ¼ë¡œ ì¼€ì´ìŠ¤ë¥¼ ë‚˜ëˆ <br />
<code class="language-plaintext highlighter-rouge">getAttributes();</code> ì•ˆì—ìˆëŠ” email ì •ë³´ë¥¼ êº¼ë‚´ì„œ ì €ì¥í•˜ëŠ” ê²ƒì„ êµ¬í˜„í–ˆë‹¤.</p>

<p>ê·¸ë¦¬ê³  ê°€ì¥ ì¤‘ìš”í•œ ë¶€ë¶„ì¸ Redirect ë¶€ë¶„ì¸ë°<br />
í˜„ì¬ êµ¬ê¸€ ì¸ì¦ì´ ì •ìƒì ìœ¼ë¡œ ì´ë£¨ì–´ì ¸ íë¦„ì´ ì´ìª½ìœ¼ë¡œ ë„˜ì–´ì˜¨ ê²ƒì´ê³ <br />
ì´ì œ ìš°ë¦¬ëŠ” ë¡œê·¸ì¸ì„ ì™„ë£Œí–ˆìœ¼ë‹ˆ ë‹¤ë¥¸í˜ì´ì§€ë¥¼ Redirect í•´ì•¼í•˜ë©°<br />
JWTì„ ë§Œë“¤ì–´ì„œ headerì— ì‹¦ì–´ì£¼ëŠ” ì½”ë“œë¥¼ êµ¬í˜„í•´ì•¼í•œë‹¤.</p>

<p>ê·¸ êµ¬í˜„ ë¶€ë¶„ì´ <code class="language-plaintext highlighter-rouge">redirect();</code>ìœ¼ë¡œ ì‘ì„±í–ˆê³ <br />
í•´ë‹¹ ë‚´ìš©ì€ accessToken, refreshTokenì„ ë§Œë“¤ê³ <br />
UriComponentsBuilderë¥¼ í†µí•´ì„œ ìš°ë¦¬ê°€ Redirectí•  ì£¼ì†Œì™€<br />
queryParamsë¡œ ì¶”ê°€í•´ì„œ URIë§Œë“¤ì—ˆë‹¤.</p>

<p>ì´ì œ Redirectë§Œ ì§„í–‰í•˜ë©´ëœë‹¤. <code class="language-plaintext highlighter-rouge">getRedirectStrategy().sendRedirect();</code>ë¥¼ êµ¬í˜„í•´<br />
Redirectë¥¼ ì§„í–‰í•˜ë„ë¡í–ˆê³  í•´ë‹¹ ë©”ì„œë“œëŠ” <code class="language-plaintext highlighter-rouge">AbstractAuthenticationTargetUrlRequestHandler</code> <br />
ì¸í„°í˜ì´ìŠ¤ì˜ ë©”ì„œë“œë¡œ ë§ˆì°¬ê°€ì§€ë¡œ <code class="language-plaintext highlighter-rouge">SimpleUrlAuthenticationSuccessHandler</code>ì™€ ìƒì†ê´€ê³„ë¼<br />
Overridingí•˜ì—¬ ìš°ë¦¬ê°€ êµ¬í˜„ì´ ê°€ëŠ¥í•œ ë¶€ë¶„ì´ë‹¤. ë§¤ê°œ ë³€ìˆ˜ë¡œëŠ”</p>

<p>HttpServletRequest ê°ì²´, HttpServletResponse ê°ì²´, String uri<br />
ì´ë ‡ê²Œ ë§¤ê°œë³€ìˆ˜ë¡œ ë„˜ê²¨ì£¼ë©´ Redirectí•˜ê²Œ ë˜ì–´ì§€ëŠ” ê²ƒì´ë‹¤.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">spring</span><span class="pi">:</span>
  <span class="na">security</span><span class="pi">:</span>
    <span class="na">oauth2</span><span class="pi">:</span>
      <span class="na">client</span><span class="pi">:</span>
        <span class="na">registration</span><span class="pi">:</span>
          <span class="na">google</span><span class="pi">:</span>
            <span class="na">clientId</span><span class="pi">:</span> <span class="s">${G_CLIENT_ID}</span> <span class="c1"># êµ¬ê¸€ APIì½˜ì†”ë¡œ ë°œê¸‰ë°›ì€ ID</span>
            <span class="na">clientSecret</span><span class="pi">:</span> <span class="s">${G_CLIENT_SECRET}</span> <span class="c1"># êµ¬ê¸€ APIì½˜ì†”ë¡œ ë°œê¸‰ë°›ì€ SECRET</span>
            <span class="na">scope</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="s">email</span>
              <span class="pi">-</span> <span class="s">profile</span>
</code></pre></div></div>
<p>ì´ì œ ë§ˆì§€ë§‰ìœ¼ë¡œ .yml íŒŒì¼ì— í•„ìš”í•œ ì„¤ì •ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ë©´<br />
Springn Securityì—ì„œ ìë™ìœ¼ë¡œ ì§„í–‰í•´ì¤€ë‹¤.</p>

<p>ì •ë§ ëŒ€ë‹¨í•˜ë‹¤â€¦ ë‚´ê°€ ì§ì ‘êµ¬í˜„í•œ ì½”ë“œëŠ” ì™„ì „ ê·¹íˆ ì¼ë¶€ì¼í…ë°<br />
ì´ëª¨ë“ ê±¸ ìë™í™”ì‹œì¼œë†“ê³  ìš°ë¦¬ê°™ì€ ì´ˆì§œ ê°œë°œìë„ ì´ìš©í•  ìˆ˜ ìˆë‹¤ëŠ”ê²Œâ€¦<br />
í›„ì— ì‹¤ì œ Filter ë™ì‘ì— ë””ë²„ê·¸ë¥¼ ê±¸ì–´ë†“ê³  ì–´ë–»ê²Œ OAuth2 ì¸ì¦ ê³¼ì •ì„<br />
ê±°ì¹˜ê°€ëŠ”ì§€ëŠ” ë©´ë°€í•œ íŒŒì•…ì´ í•„ìš”í•  ê²ƒ ê°™ë‹¤.</p>

<p><br /></p>

<p>ì´ë ‡ê²Œ êµ¬í˜„ì„ ì™„ë£Œí•œ ë‹¤ìŒì—<br />
ì‹¤ì œë¡œ ë¡œê·¸ì¸ì„ ì§„í–‰í•´ë³´ì•˜ì„ ë•Œ, êµ¬ê¸€ ë¡œê·¸ì¸ ì™„ë£Œ í›„ì—</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gMsRfmFlCV2832vUEdC9XNM1u89sACuHGq-cKq-QfuuzyoTLPQDhc32NXsUg5dDd33-8J3tJXvUQ1V14h3ailY1wbfrjg=w1920-h920" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>ê°œë°œìë„êµ¬ë¡œ ì›í•˜ëŠ” í˜ì´ì§€ì— ë¦¬ë‹¤ì´ë ‰ì…˜ì´ ë˜ì—ˆê³ <br />
ìš°ë¦¬ê°€ ë§Œë“¤ì–´ì¤€ accessTokenê³¼ refreshTokenì´ ì •ìƒì ìœ¼ë¡œ<br />
ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ë‹´ê²¨ìˆëŠ” ëª¨ìŠµì„ í™•ì¸í•´ ë³¼ ìˆ˜ ìˆë‹¤.</p>

<p>ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ë‹´ê¸´ ì´ìœ ëŠ” Frontend ìª½ ì„œë²„ì—<br />
javaScriptì–¸ì–´ë¡œ ì €ì¥í•˜ë„ë¡ ì½”ë“œë¥¼ ì¶”ê°€í•´ë†“ì•„ì„œ ì €ì¥ë˜ì–´ì§€ëŠ” ê²ƒì´ë‹¤.<br />
ë¬¼ë¡  <code class="language-plaintext highlighter-rouge">response.setHeader();</code>ë©”ì„œë“œë¥¼ í†µí•´ì„œ headerë¡œ ì „ì†¡í•  ìˆ˜ë„ ìˆë‹¤.</p>

<p><br /></p>

<p><strong>2). ì¹´ì¹´ì˜¤í†¡ OAuth2 ë¡œê·¸ì¸ ì¸ì¦í•˜ê¸°</strong></p>

<p>êµ¬ê¸€ ë¡œê·¸ì¸ ì¸ì¦ì„ ì™„ë£Œí•´ ë³´ì•˜ìœ¼ë‹ˆ<br />
ë‹¤ë¥¸ ë¡œê·¸ì¸ë„ í•œë²ˆ ì‹œë„í•´ë³´ê³  ì‹¶ì—ˆë‹¤.</p>

<p>ìœ„ì— ì½”ë“œëŠ” ì „ë¶€ ê·¸ëŒ€ë¡œ ë‘ê³  .yml ì„¤ì • íŒŒì¼ì˜ ì„¤ì • ì •ë³´ë§Œ ë³€ê²½í•˜ë©´ ë˜‘ê°™ì´ ì¸ì¦ì´ ê°€ëŠ¥í•˜ë‹¤.</p>

<p>êµ¬ê¸€ ì½˜ì†” APIì²˜ëŸ¼ ì¹´ì¹´ì˜¤í†¡ë„ <a href="https://developers.kakao.com/docs/latest/ko/kakaologin/common">ì¹´ì¹´ì˜¤í†¡ ë¡œê·¸ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜</a>ì„ ë§Œë“¤ì–´ ì¤˜ì•¼í•œë‹¤.<br />
í•´ë‹¹ ì‚¬ì´íŠ¸ì— ë“¤ì–´ê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ê³ </p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gMNQi6w61DyZV6ZpqvZm6pPcQJYYnsPc7iY0O_zUDGz-JTOT5txnrrNGQNFkUn52am_j-h4ZDHflC0zWCl5wQPJcc5S1A=w1299-h920" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>client-idì™€ client-secretë¥¼ ë°œê¸‰ ë°›ìœ¼ë©´ ëœë‹¤.<br />
ê·¸ ì™¸ì— scope ì •ë³´ ë™ì˜ ì„¤ì •ë“¤ë„ ê°€ëŠ¥í–ˆë‹¤.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">spring</span><span class="pi">:</span>
  <span class="na">security</span><span class="pi">:</span>
    <span class="na">oauth2</span><span class="pi">:</span>
      <span class="na">client</span><span class="pi">:</span>
        <span class="na">registration</span><span class="pi">:</span>
          <span class="na">google</span><span class="pi">:</span>
            <span class="na">clientId</span><span class="pi">:</span> <span class="s">${G_CLIENT_ID}</span> <span class="c1"># êµ¬ê¸€ APIì½˜ì†”ë¡œ ë°œê¸‰ë°›ì€ ID</span>
            <span class="na">clientSecret</span><span class="pi">:</span> <span class="s">${G_CLIENT_SECRET}</span> <span class="c1"># êµ¬ê¸€ APIì½˜ì†”ë¡œ ë°œê¸‰ë°›ì€ SECRET</span>
            <span class="na">scope</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="s">email</span>
              <span class="pi">-</span> <span class="s">profile</span>
          <span class="na">kakao</span><span class="pi">:</span>
            <span class="na">client-id</span><span class="pi">:</span> <span class="s">${K_CLIENT_ID}</span> <span class="c1"># ì•± ì„¤ì • -&gt; ì•± í‚¤ -&gt; REST API í‚¤</span>
            <span class="na">client-secret</span><span class="pi">:</span> <span class="s">${K_CLIENT_SECRET}</span>  <span class="c1"># ì œí’ˆ ì„¤ì • -&gt; ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ -&gt; ë³´ì•ˆ -&gt; Client Secret</span>
            <span class="na">redirect-uri</span><span class="pi">:</span> <span class="s">http://localhost:8080/login/oauth2/code/kakao</span>
            <span class="na">authorization-grant-type</span><span class="pi">:</span> <span class="s">authorization_code</span>
            <span class="na">client-authentication-method</span><span class="pi">:</span> <span class="s">POST</span>
            <span class="na">client-name</span><span class="pi">:</span> <span class="s">Kakao</span>
            <span class="na">scope</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="s">profile_nickname</span>
              <span class="pi">-</span> <span class="s">profile_image</span>
              <span class="pi">-</span> <span class="s">account_email</span>
        <span class="na">provider</span><span class="pi">:</span>
          <span class="na">kakao</span><span class="pi">:</span>
            <span class="na">authorization-uri</span><span class="pi">:</span> <span class="s">https://kauth.kakao.com/oauth/authorize</span>
            <span class="na">token-uri</span><span class="pi">:</span> <span class="s">https://kauth.kakao.com/oauth/token</span>
            <span class="na">user-info-uri</span><span class="pi">:</span> <span class="s">https://kapi.kakao.com/v2/user/me</span>
            <span class="na">user-name-attribute</span><span class="pi">:</span> <span class="s">id</span>
</code></pre></div></div>

<p>ê¸°ì¡´ êµ¬ê¸€ì„¤ì •ì— ë°‘ì— ì¹´ì¹´ì˜¤ê´€ë ¨ ì„¤ì •ì„ ë„£ì–´ì£¼ê³ </p>

<p>Frontend ì„œë²„ì—ì„œ <code class="language-plaintext highlighter-rouge">http://localhost:8080/oauth2/authorization/kakao</code> ë¡œ ìš”ì²­ì„ ë³´ë‚´ì£¼ë©´</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gPAV4LBZQ-47VonDS63Xdnq372ABlm7MY1RK4wselyaycZ2FsH9ZGokzqYFMESSg8Qk8DGXiK5CfZcn55FoQ1xLok2RAQ=w1920-h920" alt="image" class="align-left" style="max-width: 80%" /></p>

<p>ìš°ë¦¬ê°€ ì„¤ì •í•œëŒ€ë¡œ ì¹´ì¹´ì˜¤í†¡ ë¡œê·¸ì¸ ì¸ì¦ì´ ë™ì¼í•˜ê²Œ ì§„í–‰í•  ìˆ˜ ìˆë‹¤.</p>

<p><br /></p>

<p><strong>3). ë„¤ì´ë²„ OAuth2 ë¡œê·¸ì¸ ì¸ì¦í•˜ê¸°</strong></p>

<p>ë„¤ì´ë²„ë„ ë§ˆì°¬ê°€ì§€ë‹¤ <a href="https://developers.naver.com/products/login/api/api.md">ë„¤ì´ë²„ ë¡œê·¸ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜</a>ì— ë“¤ì–´ê°€  <br />
ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ì–´ì¤€ë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gNKLUTpN-9m9o5CXOIedRwYXZbs5uBcW6AxtCgKUjRgT1qAjRtU7vDZfTgjaQiOQ5Jj_3aq_zmAas4fzv67DLhASES5=w1920-h920" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>ë™ì¼í•˜ê²Œ idì™€ secretKeyë¥¼ ë°›ì•˜ì„ ê²ƒì´ë‹¤.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">spring</span><span class="pi">:</span>
  <span class="na">security</span><span class="pi">:</span>
      <span class="na">oauth2</span><span class="pi">:</span>
        <span class="na">client</span><span class="pi">:</span>
          <span class="na">registration</span><span class="pi">:</span>
            <span class="na">google</span><span class="pi">:</span>
              <span class="na">clientId</span><span class="pi">:</span> <span class="s">${G_CLIENT_ID}</span> <span class="c1"># êµ¬ê¸€ APIì½˜ì†”ë¡œ ë°œê¸‰ë°›ì€ ID</span>
              <span class="na">clientSecret</span><span class="pi">:</span> <span class="s">${G_CLIENT_SECRET}</span> <span class="c1"># êµ¬ê¸€ APIì½˜ì†”ë¡œ ë°œê¸‰ë°›ì€ SECRET</span>
              <span class="na">scope</span><span class="pi">:</span>
                <span class="pi">-</span> <span class="s">email</span>
                <span class="pi">-</span> <span class="s">profile</span>
            <span class="na">kakao</span><span class="pi">:</span>
              <span class="na">client-id</span><span class="pi">:</span> <span class="s">${K_CLIENT_ID}</span> <span class="c1"># ì•± ì„¤ì • -&gt; ì•± í‚¤ -&gt; REST API í‚¤</span>
              <span class="na">client-secret</span><span class="pi">:</span> <span class="s">${K_CLIENT_SECRET}</span>  <span class="c1"># ì œí’ˆ ì„¤ì • -&gt; ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ -&gt; ë³´ì•ˆ -&gt; Client Secret</span>
              <span class="na">redirect-uri</span><span class="pi">:</span> <span class="s">http://localhost:8080/login/oauth2/code/kakao</span>
              <span class="na">authorization-grant-type</span><span class="pi">:</span> <span class="s">authorization_code</span>
              <span class="na">client-authentication-method</span><span class="pi">:</span> <span class="s">POST</span>
              <span class="na">client-name</span><span class="pi">:</span> <span class="s">Kakao</span>
              <span class="na">scope</span><span class="pi">:</span>
                <span class="pi">-</span> <span class="s">profile_nickname</span>
                <span class="pi">-</span> <span class="s">profile_image</span>
                <span class="pi">-</span> <span class="s">account_email</span>
            <span class="na">naver</span><span class="pi">:</span>
              <span class="na">client-id</span><span class="pi">:</span> <span class="s">${N_CLIENT_ID}</span>
              <span class="na">client-secret</span><span class="pi">:</span> <span class="s">${N_CLIENT_SECRET}</span>
              <span class="na">redirect-uri</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{baseUrl}/{action}/oauth2/code/{registrationId}"</span> <span class="c1"># (== http://localhost:8080/login/oauth2/code/naver)</span>
              <span class="na">authorization-grant-type</span><span class="pi">:</span> <span class="s">authorization_code</span>
              <span class="na">scope</span><span class="pi">:</span> <span class="s">name, email, profile_image</span>
              <span class="na">client-name</span><span class="pi">:</span> <span class="s">Naver</span>
          <span class="na">provider</span><span class="pi">:</span>
            <span class="na">kakao</span><span class="pi">:</span>
              <span class="na">authorization-uri</span><span class="pi">:</span> <span class="s">https://kauth.kakao.com/oauth/authorize</span>
              <span class="na">token-uri</span><span class="pi">:</span> <span class="s">https://kauth.kakao.com/oauth/token</span>
              <span class="na">user-info-uri</span><span class="pi">:</span> <span class="s">https://kapi.kakao.com/v2/user/me</span>
              <span class="na">user-name-attribute</span><span class="pi">:</span> <span class="s">id</span>
            <span class="na">naver</span><span class="pi">:</span>
              <span class="na">authorization_uri</span><span class="pi">:</span> <span class="s">https://nid.naver.com/oauth2.0/authorize</span>
              <span class="na">token_uri</span><span class="pi">:</span> <span class="s">https://nid.naver.com/oauth2.0/token</span>
              <span class="na">user-info-uri</span><span class="pi">:</span> <span class="s">https://openapi.naver.com/v1/nid/me</span>
              <span class="na">user_name_attribute</span><span class="pi">:</span> <span class="s">response</span>
</code></pre></div></div>

<p>ë„¤ì´ë²„ë„ ë™ì¼í•˜ê²Œ ì„¤ì •ì„ ì™„ë£Œí•´ì£¼ê³ <br />
Frontend ì„œë²„ì—ì„œ <code class="language-plaintext highlighter-rouge">http://localhost:8080/oauth2/authorization/naver</code> ë¡œ ìš”ì²­ì„ ë³´ë‚´ì£¼ë©´</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOzNDUxcjFONc6GXx7sdUQHD8X7MyLz6P4HC8egracTxzybn6-6Ik4dC1jcgxtySNbwe7ueB3K3vvpz-jXu1jrpC9l-=w1299-h920" alt="image" class="align-left" style="max-width: 80%" /></p>

<p>ìœ„ì™€ ê°™ì´ ë„¤ì´ë²„ ë¡œê·¸ì¸ ì¸ì¦ì„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œëœë‹¤.</p>

<p><br /></p>

<p><strong>4). Github OAuth2 ë¡œê·¸ì¸ ì¸ì¦í•˜ê¸°</strong></p>

<p>ë§ˆì§€ë§‰ìœ¼ë¡œ Github OAuth2ë„ ì ìš©í•´ë³´ê³  ì‹¶ì–´ ì‹œë„í•´ë´¤ë‹¤.</p>

<p>GitHub í™ˆí˜ì´ì§€ì—ì„œ<br />
<code class="language-plaintext highlighter-rouge">Setting -&gt; Developer settings -&gt; OAuth Apps</code><br />
ê²½ë¡œë¡œ ì ‘ì†í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ìˆ˜ ìˆëŠ” í™”ë©´ì´ ë‚˜ì˜¨ë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gO851leSPchx-qwjJ_xI7KGIzTiarPVJUFY6-Ix1iWnh7kyS2RqWZBzZqGbLXiqoUnvcaFzV8jSvKNtDivX-r6hHmyIZA=w1920-h920" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>ë‚˜ëŠ” practiceë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ì—ˆë‹¤.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">spring</span><span class="pi">:</span>
  <span class="na">security</span><span class="pi">:</span>
      <span class="na">oauth2</span><span class="pi">:</span>
        <span class="na">client</span><span class="pi">:</span>
          <span class="na">registration</span><span class="pi">:</span>
            <span class="na">google</span><span class="pi">:</span>
              <span class="na">clientId</span><span class="pi">:</span> <span class="s">${G_CLIENT_ID}</span> <span class="c1"># êµ¬ê¸€ APIì½˜ì†”ë¡œ ë°œê¸‰ë°›ì€ ID</span>
              <span class="na">clientSecret</span><span class="pi">:</span> <span class="s">${G_CLIENT_SECRET}</span> <span class="c1"># êµ¬ê¸€ APIì½˜ì†”ë¡œ ë°œê¸‰ë°›ì€ SECRET</span>
              <span class="na">scope</span><span class="pi">:</span>
                <span class="pi">-</span> <span class="s">email</span>
                <span class="pi">-</span> <span class="s">profile</span>
            <span class="na">kakao</span><span class="pi">:</span>
              <span class="na">client-id</span><span class="pi">:</span> <span class="s">${K_CLIENT_ID}</span> <span class="c1"># ì•± ì„¤ì • -&gt; ì•± í‚¤ -&gt; REST API í‚¤</span>
              <span class="na">client-secret</span><span class="pi">:</span> <span class="s">${K_CLIENT_SECRET}</span>  <span class="c1"># ì œí’ˆ ì„¤ì • -&gt; ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ -&gt; ë³´ì•ˆ -&gt; Client Secret</span>
              <span class="na">redirect-uri</span><span class="pi">:</span> <span class="s">http://localhost:8080/login/oauth2/code/kakao</span>
              <span class="na">authorization-grant-type</span><span class="pi">:</span> <span class="s">authorization_code</span>
              <span class="na">client-authentication-method</span><span class="pi">:</span> <span class="s">POST</span>
              <span class="na">client-name</span><span class="pi">:</span> <span class="s">Kakao</span>
              <span class="na">scope</span><span class="pi">:</span>
                <span class="pi">-</span> <span class="s">profile_nickname</span>
                <span class="pi">-</span> <span class="s">profile_image</span>
                <span class="pi">-</span> <span class="s">account_email</span>
            <span class="na">naver</span><span class="pi">:</span>
              <span class="na">client-id</span><span class="pi">:</span> <span class="s">${N_CLIENT_ID}</span>
              <span class="na">client-secret</span><span class="pi">:</span> <span class="s">${N_CLIENT_SECRET}</span>
              <span class="na">redirect-uri</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{baseUrl}/{action}/oauth2/code/{registrationId}"</span> <span class="c1"># (== http://localhost:8080/login/oauth2/code/naver)</span>
              <span class="na">authorization-grant-type</span><span class="pi">:</span> <span class="s">authorization_code</span>
              <span class="na">scope</span><span class="pi">:</span> <span class="s">name, email, profile_image</span>
              <span class="na">client-name</span><span class="pi">:</span> <span class="s">Naver</span>
            <span class="na">github</span><span class="pi">:</span>
              <span class="na">clientId</span><span class="pi">:</span> <span class="s">${H_CLIENT_ID}</span>
              <span class="na">clientSecret</span><span class="pi">:</span> <span class="s">${H_CLIENT_SECRET}</span>
              <span class="na">redirect-uri</span><span class="pi">:</span> <span class="s2">"</span><span class="s">{baseUrl}/{action}/oauth2/code/{registrationId}"</span> <span class="c1"># (== http://localhost:8080/login/oauth2/code/google)</span>
              <span class="na">authorization-grant-type</span><span class="pi">:</span> <span class="s">authorization_code</span>
              <span class="na">client-name</span><span class="pi">:</span> <span class="s">GitHub</span>
              <span class="na">scope</span><span class="pi">:</span>
                <span class="pi">-</span> <span class="s">email</span>
                <span class="pi">-</span> <span class="s">profile</span>
          <span class="na">provider</span><span class="pi">:</span>
            <span class="na">kakao</span><span class="pi">:</span>
              <span class="na">authorization-uri</span><span class="pi">:</span> <span class="s">https://kauth.kakao.com/oauth/authorize</span>
              <span class="na">token-uri</span><span class="pi">:</span> <span class="s">https://kauth.kakao.com/oauth/token</span>
              <span class="na">user-info-uri</span><span class="pi">:</span> <span class="s">https://kapi.kakao.com/v2/user/me</span>
              <span class="na">user-name-attribute</span><span class="pi">:</span> <span class="s">id</span>
            <span class="na">naver</span><span class="pi">:</span>
              <span class="na">authorization_uri</span><span class="pi">:</span> <span class="s">https://nid.naver.com/oauth2.0/authorize</span>
              <span class="na">token_uri</span><span class="pi">:</span> <span class="s">https://nid.naver.com/oauth2.0/token</span>
              <span class="na">user-info-uri</span><span class="pi">:</span> <span class="s">https://openapi.naver.com/v1/nid/me</span>
              <span class="na">user_name_attribute</span><span class="pi">:</span> <span class="s">response</span>
</code></pre></div></div>

<p>ìœ„ì—ì„œ í–ˆë˜ êµ¬ê¸€,ì¹´ì¹´ì˜¤,ë„¤ì´ë²„ì™€ ë™ì¼í•˜ê²Œ<br />
.yml íŒŒì¼ì— ì„¤ì • ì •ë³´ë§Œ ì¶”ê°€í•´ì£¼ë©´ ì¸ì¦ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ê³ </p>

<p>Frontend ì„œë²„ì—ì„œ <code class="language-plaintext highlighter-rouge">http://localhost:8080/oauth2/authorization/github</code> ë¡œ ìš”ì²­ì„ ë³´ë‚´ì£¼ë©´</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOaC_iiUM1AFkW7zDZbf4FANkrFWyZsicq-OxPRG3aqYGgXWLsZYCi_DzPa-aTNW8OWIfJnoVBC5-Ze7u6eXct9r5ch=w1299-h920" alt="image" class="align-left" style="max-width: 70%" /></p>

<p>ë™ì¼í•˜ê²Œ ë¡œê·¸ì¸ ìš”ì²­ì„ ë³´ë‚´ë©´<br />
ì •ìƒì ìœ¼ë¡œ ì¸ì¦ì´ë˜ê³  AccessTokenê³¼ Refresh Tokenì´ ë°œê¸‰ë˜ëŠ”<br />
ëª¨ìŠµì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<p><br /></p>

<hr />

<p>ì´ë ‡ê²Œ ì˜¤ëŠ˜ì€ OAuth2 ì¸ì¦ì— ëŒ€í•œ<br />
ì—¬ëŸ¬ê°€ì§€ ë²¤ë”ë“¤ì˜ ë¡œê·¸ì¸ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ ë³´ì•˜ë‹¤.<br />
ì‹¤ì§ˆì ìœ¼ë¡œ ì–´ë–¤ íšŒì‚¬ëƒì— ë”°ë¼ ë³€ê²½í•˜ëŠ” ë¶€ë¶„ì€ í¬ê²Œ ì–´ë µì§€ ì•Šì€ ê²ƒ ê°™ë‹¤.</p>

<p>í•˜ì§€ë§Œ Springì´ ìƒë‹¹íˆ ë§ì€ ë¶€ë¶„ì„ ì‘ì—…í•´ì£¼ê³ <br />
ë‚´ê°€ êµ¬í˜„í•˜ëŠ” ë¶€ë¶„ì¸ ì •ë§ ê·¹íˆ ì¼ë¶€ì´ê¸° ë•Œë¬¸ì—<br />
OAuth2ì— ëŒ€í•œ ì™„ë²½í•œ ì´í•´ê°€ ë˜ì—ˆë‹¤ê³ ëŠ” í•  ìˆ˜ ì—†ì„ ê²ƒ ê°™ë‹¤.</p>

<p>ê³„ì† ê³µë¶€í•˜ë©´ì„œ ëŠë¼ëŠ” ê²ƒì€ í”„ë ˆì„ì›Œí¬ì— ëŒ€í•œ ì„¸ë¶€ ë‚´ìš©<br />
ì´í•´í•˜ëŠ” ê²ƒì´ ì •ë§ ì¤‘ìš”í•˜ë‹¤ê³  ëŠë¼ê³ <br />
ì¶”í›„ì— ì´ë¶€ë¶„ì— ëŒ€í•œ íë¦„ë“¤ì€ ë”°ë¡œ ê³µë¶€ë¥¼í•˜ë ¤ê³ í•œë‹¤.</p>

<p>ì˜¤ëŠ˜ ê³µë¶€ëŠ” ì—¬ê¸°ì„œ ë !</p>

<p><br /></p>

<p><span style="color:#994C00"><strong>ì˜¤ëŠ˜ì˜ ì»¤í”¼ëŸ‰</strong></span>: â˜•ï¸ â˜•ï¸<br />
<strong>ì˜¤ëŠ˜ì˜ ì ì‹¬</strong>: ë¼ë©´, ë°¥</p>]]></content><author><name>LEE JAEHYEOK</name></author><category term="TIL" /><category term="TIL" /><category term="ë¶€íŠ¸ìº í”„" /><category term="ì½”ë“œìŠ¤í…Œì´ì¸ " /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">macOs) Apache ì›¹ ì„œë²„ AH00558 Could not reliable determine the serverâ€™s fully qualified domain name ..</title><link href="http://localhost:4000/macos/2022/11/27/OS-macOs-4.html" rel="alternate" type="text/html" title="macOs) Apache ì›¹ ì„œë²„ AH00558 Could not reliable determine the serverâ€™s fully qualified domain name .." /><published>2022-11-27T00:00:00+09:00</published><updated>2022-11-27T00:00:00+09:00</updated><id>http://localhost:4000/macos/2022/11/27/OS-macOs-4</id><content type="html" xml:base="http://localhost:4000/macos/2022/11/27/OS-macOs-4.html"><![CDATA[<p>ì˜¤ëŠ˜ ê³µë¶€í•˜ë‹¤ê°€ ë§‰í˜”ë˜ ë¶€ë¶„ì´ ìˆì–´ì„œ <br />
ë„ì›€ì´ ë ê¹Œ ì‹¶ì–´ ì ì–´ë³¸ë‹¤.</p>

<h3 id="apache-ì›¹-ì„œë²„">APACHE ì›¹ ì„œë²„</h3>

<p>ì•„íŒŒì¹˜ HTTP ì„œë²„(Apache HTTP Server)ëŠ” <br />
ì•„íŒŒì¹˜ ì†Œí”„íŠ¸ì›¨ì–´ ì¬ë‹¨ì—ì„œ ê´€ë¦¬í•˜ëŠ” ì˜¤í”ˆ ì†ŒìŠ¤, í¬ë¡œìŠ¤ í”Œë«í¼ HTTP ì›¹ ì„œë²„ ì†Œí”„íŠ¸ì›¨ì–´ë‹¤. <br />
BSD, ë¦¬ëˆ…ìŠ¤ ë“± ìœ ë‹‰ìŠ¤ ê³„ì—´ ë¿ ì•„ë‹ˆë¼ ë§ˆì´í¬ë¡œì†Œí”„íŠ¸ ìœˆë„ìš°ë‚˜ ë…¸ë²¨ ë„·ì›¨ì–´ <br />
ê°™ì€ ê¸°ì¢…ì—ì„œë„ ë¬´ë£Œë¡œ ìš´ìš©í•  ìˆ˜ ìˆë‹¤ê³  í•œë‹¤. <strong>[<a href="https://ko.wikipedia.org/wiki/%EC%95%84%ED%8C%8C%EC%B9%98_HTTP_%EC%84%9C%EB%B2%84">ì¶œì²˜ - ìœ„í‚¤ë°±ê³¼</a>]</strong></p>

<p>Mac í™˜ê²½ì—ì„œ Apache ì›¹ì„œë²„ë¥¼ ì‚¬ìš©í•´ë³´ë ¤í•˜ë‹¤ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤.<br />
ì˜¤ë¥˜ë¥¼ ì–˜ê¸°í•˜ê¸°ì „ ìš°ì„  ì„¤ì¹˜ ê³¼ì •ì„ ì•„ë˜ì˜ ì‚¬ì´íŠ¸ë¥¼ ì°¸ê³ í–ˆë‹¤.<br />
<strong>[<a href="https://www.javatpoint.com/how-to-install-apache-on-mac">Apache ì„¤ì¹˜ ë°©ë²• - ì°¸ê³ ì‚¬ì´íŠ¸</a>]</strong></p>

<p><br /></p>

<p>homebrewë¥¼ ì´ìš©í•œ ì„¤ì¹˜ë°©ë²•ì´ê³ <br />
Mac ì‚¬ìš© ìœ ì €ë¼ë©´ ìµíˆ ì•Œê³  ìˆì„ ê²ƒì´ë‹¤.</p>

<p>ì„¤ì¹˜ë¥¼ ì™„ë£Œí•œë‹¤ìŒ <br />
ë¬¸ì œëŠ” ì•„íŒŒì¹˜ ì„œë²„ë¥¼ ì‹¤í–‰/ì¢…ë£Œ ì‹œí‚¤ê¸°ìœ„í•´ì„œ<br />
<code class="language-plaintext highlighter-rouge">sudo apachectl start</code> ëª…ë ¹ì–´ì™€ <code class="language-plaintext highlighter-rouge">sudo apachectl stop</code> ëª…ë ¹ì–´ë¥¼<br />
ì‚¬ìš©í•˜ê²Œ ë˜ëŠ”ë°â€¦ AH00558 ì½”ë“œë¡œëœ ì•ŒëŒì´ ë°œìƒí–ˆë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gMPblHp1IrHpidEB8NNOHDrTqEx8Q_JW9oJb7H4iCMDJNIKJUgNoYoQPhx8afmEEUw_UNIczBB2e98aG8ey3dT_HzWk=w3024-h1620" alt="image" class="align-left" style="max-width: 100%" /></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AH00558: httpd: Could not reliably determine the server<span class="s1">'s fully qualified domain name, using MacBook-Pro.local. Set the '</span>ServerName<span class="s1">' directive globally to suppress this message
</span></code></pre></div></div>

<p>ì˜¤ë¥˜ëŠ” ê·¸ë ‡ë‹¤ ì³ë„, ê¸°ë³¸ ì ìœ¼ë¡œ localhostì— ì ‘ì†í•˜ë©´<br />
<code class="language-plaintext highlighter-rouge">It works!</code> í™”ë©´ì´ ë…¸ì¶œë˜ì§€ ì•Šì•˜ë‹¤.<br />
localhost:8080ì— ì ‘ì†í•´ì•¼ì§€ë§Œ í™”ë©´ì´ ë…¸ì¶œë˜ì—ˆê³ <br />
ì„¤ì •ì„ ë°”ê¿€ í•„ìš”ê°€ ìˆë‹¤ê³  ëŠê»´ì¡Œë‹¤.</p>

<p><br /></p>

<p><strong>1). httpd.conf íŒŒì¼ ì°¾ê¸°</strong></p>

<p>ì„¤ì •ì„ ë³€ê²½í•˜ê¸° ìœ„í•´ì„œëŠ” <code class="language-plaintext highlighter-rouge">httpd.conf</code> íŒŒì¼ì„ ìˆ˜ì •í•´ì¤˜ì•¼í•œë‹¤.<br />
í•´ë‹¹ íŒŒì¼ ê²½ë¡œë¥¼ ì°¾ê¸°ìœ„í•´ ì—¬ëŸ¬ê°€ì§€ ë¸”ë¡œê·¸ë¥¼ ì°¾ì•„ë³´ì•˜ëŠ”ë°</p>

<p>ì‚¬ëŒë§ˆë‹¤ ì—¬ëŸ¬ê°€ì§€ ê²½ë¡œë¡œ ìˆ˜ì •ì„ í•˜ëŠ”ê±¸ ë³´ì•˜ë‹¤.</p>

<p><code class="language-plaintext highlighter-rouge">/etc/apache2/httpd.conf</code><br />
<code class="language-plaintext highlighter-rouge">/private/etc/apache2/httpd.conf</code><br />
ì™€ ê°™ì€ ê²½ë¡œë¡œ ìˆ˜ì •í•œ ì‚¬ëŒë“¤ë„ ìˆëŠ” ê²ƒ ê°™ë‹¤.<br />
í•˜ì§€ë§Œ ë‚˜ì™€ ê°™ì€ ê²½ìš°ëŠ” ì œëŒ€ë¡œ ë°˜ì˜ë˜ì§€ ì•Šì•˜ê³ â€¦</p>

<p>ì–´ë– í•œ ì°¨ì´ì¸ì§€ëŠ” ì•„ì§ ë¶ˆë¶„ëª…í•˜ì§€ë§Œ ë‚´ê°€ ìˆ˜ì •í–ˆë˜ ê²½ë¡œëŠ” ì•„ë˜ì™€ ê°™ë‹¤.  <br />
ğŸ“Œ<code class="language-plaintext highlighter-rouge">/opt/homebrew/etc/httpd/httpd.conf</code>ğŸ“Œ <br />
ì•„ë§ˆ homebrewë¥¼ í†µí•´ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì´ì§€ ì•Šì„ê¹Œ? ë¼ëŠ” ìƒê°ì„ í•´ë³¸ë‹¤.</p>

<p><code class="language-plaintext highlighter-rouge">httpd.conf</code> íŒŒì¼ì„ ì°¾ëŠ”ë° ì²˜ìŒì— ì• ë¨¹ì–´ì„œ ì‹œê°„ì„ ë§ì´ ì“´ ê²ƒ ê°™ë‹¤.</p>

<p>íŒŒì¼ì„ ì°¾ì•˜ìœ¼ë©´ ì´ì œ shellì—ì„œ vi í¸ì§‘ê¸°ë¡œ ê°’ì„ ìˆ˜ì •í•´ì£¼ë©´ëœë‹¤.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi /opt/homebrew/etc/httpd/httpd.conf
</code></pre></div></div>

<p><br /></p>

<p><strong>2). Port 80 ìœ¼ë¡œ ë³€ê²½í•˜ê¸°</strong></p>

<p>í¸ì§‘ê¸°ë¥¼ ì—´ê³  ì•„ë˜ì™€ ê°™ì€ Listenì„ ì°¾ì•„ì¤€ë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gPzEEFalQYxag6NQ4wOJV1AuBpyHFHn9LwAi4g0PY8YljuKfpiPQY-9H1mOU1Vxqa-0reRKR1itloqQ_nXt8n7xKAh8=w3024-h1620" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>ì•„ë§ˆ ê¸°ë³¸ì ìœ¼ë¡œ 8080ìœ¼ë¡œ ì„¤ì •ë˜ì–´ìˆì„ ê²ƒì´ë‹¤.<br />
#ìœ¼ë¡œ ì£¼ì„ì²˜ë¦¬ë¥¼ í•´ì¤€ë‹¤ìŒ, ì•„ë˜ì—ì„œ <code class="language-plaintext highlighter-rouge">Listen 80</code>ìœ¼ë¡œ ì„¤ì •í•´ì£¼ì—ˆë‹¤.</p>

<p><br /></p>

<p><strong>3). localhostë¡œ ë³€ê²½ í•˜ê¸°</strong></p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gO9rZHRQQQ0HI4HBe-UBcgFt4ZMl91uomBFpsZLjsruipSi2KrdWjR89J1rptKW4mQSwI7iFSbjmpV5PgPfGLj88BO4yw=w3024-h1620" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>ìœ„ì˜ ì‚¬ì§„ê³¼ ê°™ì´ ServerNameì„ localhostë¡œ ì„¤ì •í•´ì£¼ë©´ ëœë‹¤.</p>

<p><br /></p>

<p><strong>4). ê²°ê³¼ í™•ì¸í•˜ê¸°</strong></p>

<p>ì•„íŒŒì¹˜ ì›¹ì„œë²„ ì‹¤í–‰ ëª…ë ¹ì–´ì¸<br />
<code class="language-plaintext highlighter-rouge">sudo apachectl start</code>,<code class="language-plaintext highlighter-rouge">sudo apachectl stop</code>ë¥¼ ì…ë ¥í•´ë„</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gMxycEEiyoGZsXP0ZAh9sdmRXbB9ucK6Ar42OXNGDH3-OZW4FNBlpa68ehMFGULCDXcXODH-iLfmTYgK239LTRz134ZRg=w3024-h1620" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>ë” ì´ìƒ AH00558 ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ” ëª¨ìŠµì´ë‹¤.</p>

<p><br /></p>

<p>ì•„íŒŒì¹˜ ì›¹ì„œë²„ë¥¼ ì‹¤í–‰ ì‹œì¼œë†“ì€ ìƒíƒœì—ì„œ</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gMRbasfobijEvOlwe60oFwSiELjJ7dm4RE7huFv2fFxSceyEPbFWQtmJCGSotTjXhbdaHpxJMCUOK2eMNPAneRzzlNyKA=w3024-h1620" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>localhostë¥¼ ì…ë ¥í•˜ì—¬ ì ‘ì†í•  ê²½ìš°<br />
ì´ì œ ë“œë””ì–´ <code class="language-plaintext highlighter-rouge">It works</code> í™”ë©´ì„ ë³¼ ìˆ˜ ìˆê²Œ ëœë‹¤ !!</p>

<p><br /></p>

<p><strong>5). html íŒŒì¼ ë¡œë”©í•˜ê¸°</strong></p>

<p>ì´ ë¶€ë¶„ì€ ì°¸ê³ ì°¨ í•œë²ˆ ì ì–´ë³¸ë‹¤.<br />
ì•„íŒŒì¹˜ ì›¹ì„œë²„ì— ë‚´ê°€ ë§Œë“  html íŒŒì¼ì„ ì ìš© ì‹œí‚¤ê³ ì‹¶ì„ë•Œ</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gPcmo_lcNtNltnX94Eob3uyBQJybrqArcuxv2z-iwhwBK57y-p25jsZ_Ix3I54tn2Nd91TGqAAm2KLiE9OkCGh4SiZwgA=w3024-h1620" alt="image" class="align-left" style="max-width: 100%" /></p>

<p><code class="language-plaintext highlighter-rouge">httpd.conf</code> íŒŒì¼ì—ì„œ <code class="language-plaintext highlighter-rouge">DocumentRoot</code>ë¥¼ ìˆ˜ì •í•´ì£¼ë©´ html íŒŒì¼ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gPgBo-oGeeI700xa9M9BOdiv2Uw4FQKR_C_9gwzceG8GVhNMT8iTUzJBVJLLQpGRRA_itVQOTuAz3AQGnJ_c7Ci0c9m8A=w3024-h1620" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>ì˜ˆë¥¼ ë“¤ì–´ì„œ index.html ì´ë¼ëŠ” íŒŒì¼ì„ ë§Œë“¤ì–´ ìœ„ì˜ ê²½ë¡œì— íŒŒì¼ì„ ë‘ì—ˆì„ë•Œ</p>

<p>ê¸°ì¡´ì— localhost:80 ì ‘ì† ì‹œ <code class="language-plaintext highlighter-rouge">It wroks!</code>ë¡œ ë‚˜ì™”ë˜ í™”ë©´ì´<br />
ë‚´ê°€ ë§Œë“  í™”ë©´ìœ¼ë¡œ ëŒ€ì²´ëœ ëª¨ìŠµì„ ë³¼ ìˆ˜ ìˆë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gNlhfc-M7DRb35wAbT-xovzxuD54T512fR8OIeFZV-EtR0ngdJiUFt3vW4ToqBe3FzhdN8ZagQMmwTk5rt2syRzbW0dOA=w1782-h1620" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>ì´ í™”ë©´ì€ í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ ë§Œë“  í™”ë©´ì´ê³ <br />
ì •ìƒì ìœ¼ë¡œ íŒŒì¼ì´ ì ‘ì†ëœ ëª¨ìŠµì„ ë³¼ ìˆ˜ ìˆë‹¤.<br />
ì´í›„ ë¶€í„°ëŠ” í´ë”ê²½ë¡œë¥¼ ë§Œë“¤ì–´ html íŒŒì¼ì— ì ‘ê·¼í•˜ë©´ëœë‹¤.</p>

<p><br /></p>

<hr />

<p>í˜¹ì‹œë‚˜ ì‹¶ì–´ <a href="https://mainia.tistory.com/5490">WindowOS í•´ê²° ë°©ë²• - ì¶œì²˜ mainiaë‹˜</a> ì°¾ë‹¤ê°€ ì¢‹ì€ê¸€ì¸ ê²ƒ ê°™ì•„ ì˜¬ë ¤ë³¸ë‹¤.<br />
ì¢€ ë” ìì„¸í•œ ë‚´ìš©ì„ ë³´ê³ ì‹¶ë‹¤ë©´ <a href="https://velog.io/@diduya/macOS%EC%97%90-Homebrew%EB%A1%9C-Apache-%EC%84%A4%EC%B9%98%ED%95%98%EA%B8%B0">ë‚´ê°€ ì°¸ê³ í•œ í•´ê²° ë°©ë²• - ì¶œì²˜ diduyaë‹˜</a> í¬ìŠ¤íŒ…ì„ ë´ë„<br />
ì¢‹ì€ í•´ê²°ë²•ì´ë  ê²ƒ ê°™ë‹¤.</p>

<p><br />
<br /></p>]]></content><author><name>LEE JAEHYEOK</name></author><category term="macOs" /><category term="macOs" /><summary type="html"><![CDATA[ì˜¤ëŠ˜ ê³µë¶€í•˜ë‹¤ê°€ ë§‰í˜”ë˜ ë¶€ë¶„ì´ ìˆì–´ì„œ ë„ì›€ì´ ë ê¹Œ ì‹¶ì–´ ì ì–´ë³¸ë‹¤.]]></summary></entry><entry><title type="html">TIL) OAuth 2 ì¸ì¦ ê¸°ì´ˆ</title><link href="http://localhost:4000/til/2022/11/25/til.html" rel="alternate" type="text/html" title="TIL) OAuth 2 ì¸ì¦ ê¸°ì´ˆ" /><published>2022-11-25T00:00:00+09:00</published><updated>2022-11-25T00:00:00+09:00</updated><id>http://localhost:4000/til/2022/11/25/til</id><content type="html" xml:base="http://localhost:4000/til/2022/11/25/til.html"><![CDATA[<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gPDuT8mojlcwDj4isWJwyJvwaEPSsequtCg9insTbysDEVk6R7VRiRwBIm8ta5JK6J4r7ZDnBUypheW5SWHioLCJ0f8=w1920-h864" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>ì´ë²ˆì£¼ëŠ” ì •ë§ ê²Œìœ¼ë¥´ê²Œ ë³´ë‚¸ ê²ƒ ê°™ë‹¤.</p>

<p>ë¬¼ë¡  ì˜›ë‚ ì— ë¹„í•˜ë©´ ì—„ì²­ë‚œ ë°œì „ì´ì§€ë§Œâ€¦ ì—­ì‹œ í•œë²ˆ ì‰¬ë©´<br />
ê³„ì† ì‰¬ê³  ì‹¶ì€ ë§ˆìŒì´ ìƒê²¨ì„œ,, ì¡°ê¸ˆ ê²Œìœ¼ë¥´ê²Œ í•™ìŠµí•œ ëŠë‚Œì„ ë°›ì•˜ë‹¤.</p>

<p>ë‹¤ì‹œí•œë²ˆ ê°ì„±í•˜ì—¬ Spring ì„¸ì…˜ì„ ì˜ ë§ˆë¬´ë¦¬ í•´ë³´ì.</p>

<hr />

<h2 id="oauth-2">OAuth 2</h2>

<h3 id="oauth-2-ë€">OAuth 2 ë€?</h3>

<p>í”íˆ ìƒê°í•´ë³´ë©´, ìš°ë¦¬ê°€ ì›¹ì‚¬ì´íŠ¸ ë¡œê·¸ì¸ì„ í• ë•Œ<br />
ì†Œì…œ ë¡œê·¸ì¸(êµ¬ê¸€,ì¹´ì¹´ì˜¤í†¡ ë“±) ì¸ì¦ë°©ì‹ì„ ì‚¬ìš©í•´ ë¡œê·¸ì¸ì„ í•˜ëŠ”ë°<br />
ì´ëŸ° ì¸ì¦ë°©ì‹ë“¤ì€ OAuth2ë¼ëŠ” ê¸°ìˆ ì„ ë°”íƒ•ìœ¼ë¡œ êµ¬í˜„ì´ ëœë‹¤.</p>

<p>ìš°ë¦¬ê°€ ì•Œê³  ìˆëŠ” ì¼ë°˜ì ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì€<br />
ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” ì‚¬ìš©ìì— ëŒ€í•œ ì¸ì¦ì²˜ë¦¬ëŠ” í•´ë‹¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì§ì ‘í–ˆë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOtOEbcjSRPGtg0QXyV8y1h1SCQegF3vUKPYwVCv7sEcPex_-9W-jvRfU7gcNry-watl1K_E1i57hcZE0mSkiSjOoVg=w1920-h921" alt="image" class="align-left" style="max-width: 80%" /><br />
<strong><em>- í¬ë¦¬ë´ì…œì„ ì €ì¥í•˜ì§€ ì•ŠëŠ” ì•„í‚¤í…ì²˜ -</em></strong></p>

<p>OAuth2 ì¸ì¦ í”„í† í† ì½œì€ íŠ¹ì • ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©ìì˜ ì¸ì¦ì„ ì§ì ‘<br />
ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ì•„ë‹ˆë¼ ì‚¬ìš©ì ì •ë³´ë¥¼ ë³´ìœ í•˜ê³  ìˆëŠ” ì‹ ë¢°í•  ë§Œí•œ ì¨ë“œ íŒŒí‹°<br />
ì• í”Œë¦¬ì¼€ì´ì…˜(êµ¬ê¸€,ì¹´ì¹´ì˜¤í†¡ ë“±)ì—ì„œ ì¸ì¦ì„ ëŒ€ì‹  ì²˜ë¦¬í•´ì£¼ê³  Resourceì— ëŒ€í•œ<br />
ìê²© ì¦ëª…ìš© í† í°ì„ ë°œê¸‰í•œí›„, Clientê°€ í•´ë‹¹í† í°ì„ ì´ìš©í•´ ì¨ë“œíŒŒí‹° ì• í”Œë¦¬ì¼€ì´ì…˜ì˜<br />
ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê²Œ í•´ì£¼ëŠ” ë°©ì‹ì´ë‹¤.</p>

<p><br /></p>

<p><strong>*ì¨ë“œ íŒŒí‹°(3rd Party)ë€?</strong><br />
í”„ë¡œê·¸ë˜ë°ì„ ë„ì™€ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë§Œë“œëŠ” ì™¸ë¶€ ìƒì‚°ìë¥¼ ëœ»í•œë‹¤.</p>

<p>1st íŒŒí‹° ê°œë°œì : í•˜ë“œì›¨ì–´ ìƒìƒìê°€ â€˜ì§ì ‘â€™ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ê°œë°œí•˜ëŠ” ê²½ìš°<br />
2nd íŒŒí‹° ê°œë°œì : í•˜ë“œì›¨ì–´ ìƒì‚°ì§€ì¸ ê¸°ì—…ê³¼ ìì‚¬ê°„ì˜ ê´€ê³„ì— ì†í•œ ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œì<br />
3rd íŒŒí‹° ê°œë°œì : ì•„ë¬´ ê´€ë ¨ì—†ëŠ” ì œ3ì ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œì<br />
ì´ë ‡ê²Œ ì˜ˆë¥¼ ë“¤ì–´ë³¼ ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.</p>

<p><br /></p>

<h3 id="oauth-2-ì¸ì¦-ì»´í¬ë„ŒíŠ¸-ì—­í• ">OAuth 2 ì¸ì¦ ì»´í¬ë„ŒíŠ¸ ì—­í• </h3>

<p>ì‹œì‘ì— ì•ì„œ OAuth 2 ì¸ì¦ì„ ì²˜ë¦¬í•˜ëŠ” <br />
ì»´í¬ë„ŒíŠ¸ë“¤ì´ ë¬´ì—‡ì´ ìˆê³  ì–´ë– í•œ ì—­í• ì„í•˜ëŠ”ì§€ ì•Œì•„ë³´ì</p>

<ol>
  <li>Resource Owner<br />
-&gt; ì‚¬ìš©í•˜ê³ ì í•˜ëŠ” Resourceì˜ ì†Œìœ ìë¥¼ ì˜ë¯¸í•œë‹¤.</li>
  <li>Client<br />
-&gt; Resource Ownerë¥¼ ëŒ€ì‹ í•´ ë³´í˜¸ëœ Resourceì— ì—‘ì„¸ìŠ¤í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜</li>
  <li>Resource Server<br />
-&gt; Clientì˜ ìš”ì²­ì„ ìˆ˜ë½í•˜ê³  Resource Ownerì— í•´ë‹¹í•˜ëŠ” Resourceë¥¼ ì œê³µí•˜ëŠ” ì„œë²„</li>
  <li>Authorization Server<br />
-&gt; Clinetê°€ Resource Serverì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ” ì„œë²„</li>
</ol>

<p>ì´ë ‡ê²Œ ê¸€ë¡œë§Œ ì •ë¦¬í•˜ìë©´ ì‚¬ì‹¤ ì´í•´í•˜ê¸° í˜ë“¤ ê²ƒì´ë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOuRXi0z_GnyDCCDHETh73m4ATTFc7XkcLLrbwxEbd_Rd71mekz5lc9oxBxt5WGwp-6BLNg3GiMQ4jErSdSRIpCvj3kkw=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>ëŒ€ëµì ì¸ ì—­í• ì„ ë³´ë©´ ì´ë ‡ê²Œ ë‚˜ëˆ ë³¼ ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.<br />
ê¸°ì¡´ì— ìš°ë¦¬ê°€ ë¶ˆëŸ¬ì˜¤ë˜ Clientê°€ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ë¡œ<br />
ë³€ê²½ëœ ëª¨ìŠµì„ ë³¼ ìˆ˜ ìˆë‹¤.</p>

<p>Resource Ownerì˜ ëŒ€ë¦¬ì¸ìœ¼ë¡œì¨ êµ¬ê¸€ì— ì¸ì¦ê³¼ Resourceë¥¼<br />
ìš”ì²­í•˜ê³  ìˆê¸°ë•Œë¬¸ì— Clientë¼ê³  ë¶€ë¥¼ ìˆ˜ ìˆë‹¤</p>

<p><br /></p>

<h3 id="authorization-grant-ìœ í˜•">Authorization Grant ìœ í˜•</h3>
<p>Authorization GrantëŠ” Client ì• í”Œë¦¬ì¼€ì´ì…˜ì´ Access Tokenì„<br />
ì–»ê¸° ìœ„í•œ Resource Ownerì˜ ê¶Œí•œì„ í‘œí˜„í•˜ëŠ” í¬ë¦¬ë´ì…œ(Credential)ì„ ì˜ë¯¸í•œë‹¤.</p>

<p>ì¦‰, Access Tokenì„ ì–»ê¸° ìœ„í•œ ìˆ˜ë‹¨ì´ë‹¤.</p>

<p><strong><em>*Access Token ì´ë€?<br />
Clientê°€ Resource Serverì— ë³´í˜¸ëœ Resourceì—<br />
ì—‘ì„¸ìŠ¤í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ìê²© ì¦ëª…ìš© í† í°ì´ë‹¤.</em></strong></p>

<p><br /></p>

<p>ì´ 4ê°€ì§€ì˜ íƒ€ì…ì´ ìˆìœ¼ë‹ˆ ì•Œì•„ë³´ì</p>

<p><strong>1). Authorization Code Grant (ê¶Œí•œë¶€ì—¬ ìŠ¹ì¸ ì½”ë“œ ë°©ì‹)</strong> <br />
-. ê°€ì¥ ë§ì´ ì“°ì´ëŠ” ë°©ë²•ì´ê³  ê¸°ë³¸ì´ ë˜ëŠ” ë°©ì‹ì´ë‹¤.<br />
-. ê¶Œí•œ ë¶€ì—¬ ìŠ¹ì¸ì„ ìœ„í•´ ìì²´ ìƒì„±í•œ Authorization Codeë¥¼ ì „ë‹¬í•˜ëŠ” ë°©ì‹ì´ë‹¤.<br />
-. Refresh Tokenì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.<br />
-. ê¶Œí•œ ë¶€ì—¬ ìŠ¹ì¸ ìš”ì²­ì‹œ ì‘ë‹µ íƒ€ì…ì„ <code class="language-plaintext highlighter-rouge">code</code>ë¡œ ì§€ì •í•˜ì—¬ ìš”ì²­í•œë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gPgVHuUuCDajpaRydkqDrMFvzkbLFg3gep5w9RB8biTR9VOow-YfScef_SaV6QJH5cGhGZwcx6giLOKPrAC4ppHoW1TNQ=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p><br /></p>

<p><strong>2). Implicit Grant (ì•”ë¬µì  ìŠ¹ì¸ ë°©ì‹)</strong><br />
-. ë³„ë„ì˜ Authorization Code ì—†ì´ ë°”ë¡œ Access Tokenì„ ë°œê¸‰ë°›ëŠ” ë°©ì‹ì´ë‹¤.<br />
-. ìê²©ì¦ëª…ì„ ì•ˆì „í•˜ê²Œ ì €ì¥í•˜ê¸° í˜ë“  Clientì—ê²Œ ìµœì í™”ëœ ë°©ì‹ì´ë‹¤.<br />
-. Refresh Token ì‚¬ìš©ì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤.<br />
-. ê¶Œí•œ ë¶€ì—¬ ìŠ¹ì¸ ìš”ì²­ì‹œ ì‘ë‹µíƒ€ì…ì„ <code class="language-plaintext highlighter-rouge">token</code>ìœ¼ë¡œ ì§€ì •í•˜ì—¬ ìš”ì²­í•œë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gMa7L3zIQi3fKSZII9kd56k64SdaQpQJjnDrCev_ByGw1cuJYu3r61IXE0Ubx-pNNUJKs9tkNeOeQmBFZnGtOLekTEQCg=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p><br /></p>

<p><strong>3). Resource Owner Password Credential Grant (ìì› ì†Œìœ ì ìê²©ì¦ëª… ìŠ¹ì¸ë°©ì‹)</strong><br />
-. ë¡œê·¸ì¸ ì‹œ í•„ìš”í•œ ì •ë³´ë¡œ Access Tokenì„ ë°œê¸‰ ë°›ëŠ” ë°©ì‹ì´ë‹¤.<br />
-. ìì‹ ì˜ ì„œë¹„ìŠ¤ì—ì„œ ì œê³µí•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ê²½ìš°ì—ë§Œ ì‚¬ìš©ë˜ëŠ” ì¸ì¦ ë°©ì‹ì´ë‹¤.<br />
(Authorization Server, Resource Server, Clientê°€ ëª¨ë‘ ê°™ì€ ì‹œìŠ¤í…œì— ì†í•´ìˆì„ ê²½ìš°ì—ë§Œ ê°€ëŠ¥)<br />
-. Refresh Token ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gMijQTmGrLYDoKw37n3jPJRqt5i6JjFcp8XeFprwPcptgPdHdPvhscdpyh52SFQHU7ju84XmIWMYyJIR6TYVznjIuPpsw=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p><br /></p>

<p><strong>4). Client Credentials Grant (í´ë¼ì´ì–¸íŠ¸ ìê²©ì¦ëª… ìŠ¹ì¸ë°©ì‹)</strong><br />
-. Client ìì‹ ì´ ê´€ë¦¬í•˜ëŠ” Resource, Authorization Serverì— í•´ë‹¹ Clientë¥¼ ìœ„í•œ<br />
ì œí•œëœ Resource ì ‘ê·¼ ê¶Œí•œì´ ì„¤ì •ë˜ì–´ ìˆì„ ê²½ìš° ì‚¬ìš© ê°€ëŠ¥í•œ ë°©ì‹ì´ë‹¤.<br />
-. Refresh Tokenì˜ ì‚¬ìš©ì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOmLKEo6UjsefDdk3MWt5D0fLVXTDfA9dnjjHZibE6A55PjTKLDzqBn-NZTS3WsK-6ojytFXEXqtgqkjvuTIclhg3RH4w=w1299-h921" alt="image" class="align-left" style="max-width: 90%" /></p>

<p><br /></p>

<h3 id="ì‚¬ì „-ì¤€ë¹„">ì‚¬ì „ ì¤€ë¹„</h3>
<p>ìœ„ì—ì„œ ì–˜ê¸°í–ˆë“¯ì´ ìš°ë¦¬ëŠ” ì¨ë“œíŒŒí‹° ì• í”Œë¦¬ì¼€ì´ì…˜ ì¤‘<br />
OAuth 2 ì¸ì¦ í”„ë¡œí† ì½œì„ ì œê³µí•˜ëŠ” ë²¤ë”(êµ¬ê¸€, ì¹´ì¹´ì˜¤í†¡, í˜ì´ìŠ¤ë¶ ë“±)ë¥¼<br />
ì„ ì • í•œë‹¤ìŒ í”„ë¡œê·¸ë¨ì„ ì‘ì„±í•´ì•¼í•œë‹¤.</p>

<p>ê·¸ì¤‘ ìœ„ì—ì„œ ì˜ˆë¡œë“  êµ¬ê¸€ì˜ OAuth 2 í”„ë¡œí† ì½œì„ ì´ìš©í•´ë³¼ ì˜ˆì •ì´ê³ <br />
í”„ë¡œê·¸ë¨ ì‘ì„± ì „ì— ë¨¼ì € í´ë¼ì´ì–¸íŠ¸ IDì™€ Secretë¥¼ ìƒì„±í•´ì•¼í•œë‹¤.<br />
<a href="http://yoonbumtae.com/?p=2631">êµ¬ê¸€ API ì½˜ì†”ì—ì„œì˜ OAuth 2 ì„¤ì • - ì¶œì²˜: yoonbumtaeë‹˜</a>ì„ ë³´ê³ <br />
í´ë¼ì´ì–¸íŠ¸ IDì™€ Secretë¥¼ ìƒì„±í•˜ë©´ ì¤€ë¹„ëŠ” ëë‚œë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gO3kkRX35q-9PPahcVGwcdd2LGECoC7sez4uGlFClTNsVllR01dQocyQJSuF42Ej0tF7n3FIYHclCxtaNIefADUtJgiJw=w1920-h864" alt="image" class="align-left" style="max-width: 100%" /></p>

<p><br /></p>

<hr />

<p>ì˜¤ëŠ˜ì€ OAuth 2 ì—ëŒ€í•œ ê°„ë‹¨í•œ ì§€ì‹ì„ ì•Œì•„ë´¤ë‹¤.<br />
ì‚¬ì‹¤ ì´ë¡ ë§Œ ë³´ê¸°ì—ëŠ” ì½”ë“œë¥¼ ë³´ì§€ì•Šì•„ì„œ<br />
ëŠë‚Œì´ í™• ì™€ë‹¿ì§€ëŠ” ì•ŠëŠ”ë‹¤â€¦</p>

<p>í•˜ì§€ë§Œ í°ê·¸ë¦¼ì„ ë³´ê³  ì½”ë“œë¥¼ ë³´ë©´ ë” ëˆˆì— ì˜ë“¤ì–´ì˜¤ê¸° ë•Œë¬¸ì—<br />
í° ì•„í‚¤í…ì²˜ë¥¼ ìƒê°í•˜ê³  ì½”ë“œë¥¼ ë‹¤ì›€ì£¼ë¶€í„° ì—°ìŠµì„ í•´ë´ì•¼ê² ë‹¤.</p>

<p>ì˜¤ëŠ˜ ê³µë¶€ëŠ” ì—¬ê¸°ì„œ ë !</p>

<p><br /></p>

<p><span style="color:#994C00"><strong>ì˜¤ëŠ˜ì˜ ì»¤í”¼ëŸ‰</strong></span>: â˜•ï¸ â˜•ï¸<br />
<strong>ì˜¤ëŠ˜ì˜ ì ì‹¬</strong>: ê¹€ë°¥, ëœì¥ì°Œê°œ</p>]]></content><author><name>LEE JAEHYEOK</name></author><category term="TIL" /><category term="TIL" /><category term="ë¶€íŠ¸ìº í”„" /><category term="ì½”ë“œìŠ¤í…Œì´ì¸ " /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">Spring) Could not resolve placeholder â€˜í™˜ê²½ë³€ìˆ˜ëª…â€™ in value â€œ${í™˜ê²½ë³€ìˆ˜ëª…}â€ ì˜¤ë¥˜</title><link href="http://localhost:4000/spring/2022/11/25/spring-environment.html" rel="alternate" type="text/html" title="Spring) Could not resolve placeholder â€˜í™˜ê²½ë³€ìˆ˜ëª…â€™ in value â€œ${í™˜ê²½ë³€ìˆ˜ëª…}â€ ì˜¤ë¥˜" /><published>2022-11-25T00:00:00+09:00</published><updated>2022-11-25T00:00:00+09:00</updated><id>http://localhost:4000/spring/2022/11/25/spring-environment</id><content type="html" xml:base="http://localhost:4000/spring/2022/11/25/spring-environment.html"><![CDATA[<p>ì˜¤ëŠ˜ì€ ë‚´ê°€ ê²ªì€ í™˜ê²½ë³€ìˆ˜ì— ê´€ë ¨ëœ ì„¤ì •ê³¼ ì˜¤ë¥˜ë¥¼ <br />
ê¸°ë¡í•´ë³´ë ¤ê³ í•œë‹¤.</p>

<p><br /></p>

<h2 id="ë¬¸ì œ-ë‚´ìš©">ë¬¸ì œ ë‚´ìš©</h2>

<p>ìš°ì„  ë‚˜ëŠ” Macì„ ì‚¬ìš©í•˜ê³  Shellì€ zshë¥¼ ì‚¬ìš©í•œë‹¤.</p>

<p>ë¬¸ì œì˜ ì‹œì‘ì€ ì´ëŸ¬í•˜ë‹¤. JWTê´€ë ¨ ê³µë¶€ì¤‘ì´ì˜€ê³ <br />
ì½”ë“œì—ì„œ @Value ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ application.yml íŒŒì¼ì˜ <br />
ì„¤ì •ëœ ê°’ë“¤ì„ ì‚¬ìš©í•˜ë ¤ê³ í•˜ì˜€ë‹¤.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JwtTokenizer</span> <span class="o">{</span>

    <span class="nd">@Getter</span>
    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${jwt.secret-key}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">secretKey</span><span class="o">;</span>
    
    <span class="o">...</span> <span class="n">ì´í•˜</span> <span class="n">ìƒëµ</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ì‚¬ìš©í•˜ë ¤ê³  í•˜ëŠ” ëŒ€ìƒì€ SecretKeyì´ê³ <br />
ì¤‘ìš”í•œ ì •ë³´ì´ê¸° ë•Œë¬¸ì— <strong>ì‹œìŠ¤í…œ í™˜ê²½ë³€ìˆ˜</strong>ë¥¼ ì‚¬ìš©í•´<br />
ê°’ì„ ì‚¬ìš©í•˜ê³  ì‹¶ì–´ .yml íŒŒì¼ì— ê°’ì„ ì…‹íŒ…í•´ë‘ì—ˆë‹¤.</p>

<p><br /></p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">jwt</span><span class="pi">:</span>
  <span class="na">secret-key</span><span class="pi">:</span> <span class="s">${JWT_SECRET_KEY}</span>       <span class="c1"># í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •í–ˆìŒ</span>
  <span class="na">access-token-expiration-minutes</span><span class="pi">:</span> <span class="m">30</span>
  <span class="na">refresh-token-expiration-minutes</span><span class="pi">:</span> <span class="m">420</span>
</code></pre></div></div>

<p>ìœ„ì™€ ê°™ì´ ${í™˜ê²½ë³€ìˆ˜ëª…} ìœ¼ë¡œ ì§€ì •ì„í•˜ì˜€ê³ <br />
ë§Œì•½ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•œë‹¤ë©´ @Valueê°€ .ymlì˜ ê²½ë¡œë¥¼ ì°¾ì•„<br />
JWT_SECRET_KEYë¼ê³  ì„¤ì •ëœ í™˜ê²½ë³€ìˆ˜ë¥¼ ê°€ì ¸ì™€ì•¼í•œë‹¤.</p>

<p>í•˜ì§€ë§Œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í–ˆì„ë•Œ</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'jwtTokenizer': Injection of autowired dependencies failed; nested exception is java.lang.IllegalArgumentException: Could not resolve placeholder 'JWT_SECRET_KEY' in value "${JWT_SECRET_KEY}"
</code></pre></div></div>
<p>ìœ„ì™€ ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí–ˆê³ â€¦. ë¬´ì–¸ê°€ í™˜ê²½ë³€ìˆ˜ë¥¼<br />
ì œëŒ€ë¡œ ê°€ì ¸ì˜¤ì§€ ëª»í•œë‹¤ê³  ìƒê°ì´ ë“¤ì—ˆë‹¤.</p>

<p><br /></p>

<h2 id="ë¬¸ì œ-í™•ì¸-ë°-í•´ê²°">ë¬¸ì œ í™•ì¸ ë° í•´ê²°</h2>

<p>ì²«ë²ˆì§¸ë¡œ í•´ë‹¹ ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ëŒ€ë¶€ë¶„ì˜ ì´ìœ ëŠ”</p>
<ol>
  <li>application.yml í˜¹ì€ application.propertiesë¥¼ ì„¤ì •í•˜ì§€ ì•Šê±°ë‚˜ ê²½ë¡œë¥¼ í‹€ë¦¼</li>
  <li>í™˜ê²½ë³€ìˆ˜ ì„¤ì •ì— ë¬¸ì œê°€ ìˆì—ˆìŒ. (bash shell, zsh shell ë“±..)</li>
</ol>

<p>í•˜ì§€ë§Œ ë‚˜ëŠ” ìœ„ì— ìˆëŠ” ë‚´ìš©ì„ ì „ë¶€ ì¶©ì¡±í–ˆì§€ë§Œ ì™œ? ë„ëŒ€ì²´ ê°’ì„ ê°€ì ¸ì˜¤ì§€<br />
ëª»í•˜ëŠ”ì§€ ë¯¸ì³ë²„ë¦´ ì§€ê²½ì— ì´ë¥´ë €ì—ˆë‹¤.</p>

<p>ì‚¬ì‹¤ ë¬¸ì œ í•´ê²°ì€ ê°„ë‹¨í–ˆë‹¤.<br />
í•˜ì§€ë§Œ ë¬¸ì œ í•´ê²°ì„ ë¨¼ì € ì˜¬ë¦¬ê¸°ì „ì— í™˜ê²½ë³€ìˆ˜ ì„¤ì •ì— ëŒ€í•´ ì ì–´ë³¸ë‹¤.</p>

<p><br /></p>

<h3 id="macos-í™˜ê²½-ë³€ìˆ˜-ì ìš©ë²•">MacOS í™˜ê²½ ë³€ìˆ˜ ì ìš©ë²•</h3>

<p><strong>1). í˜„ì¬ ì‚¬ìš©í•˜ê³  ìˆëŠ” Shellì„ í™•ì¸</strong></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="nv">$SHELL</span>
</code></pre></div></div>
<p>ì‚¬ìš©í•˜ê³  ìˆëŠ” í„°ë¯¸ë„ì—ì„œ ìœ„ë¥¼ ì…ë ¥í•´ì¤€ë‹¤.</p>

<p>ë§Œì•½ zsh Shellì„ ì‚¬ìš©í•˜ê³  ìˆì„ ê²½ìš°ì—ëŠ”  -&gt; /bin/zsh<br />
bash Shellì„ ì‚¬ìš©í•˜ê³  ìˆì„ ê²½ìš°ì—ëŠ” -&gt; /bin/bash</p>

<p>ì•„ë§ˆ ëŒ€ë¶€ë¶„ ë§¥ë¶ìœ ì €ëŠ” zsh Shellì„ ì‚¬ìš©í•˜ê³  ìˆì„ ê²ƒ ê°™ë‹¤.</p>

<p><br /></p>

<p><strong>2). ì‚¬ìš©í•˜ê³  ìˆëŠ” Shellì— ë”°ë¥¸ ë“±ë¡</strong></p>

<p>vi í¸ì§‘ê¸° ì‚¬ìš©ë²•ì„ ì•Œê³ ìˆë‹¤ê³  ê°€ì •í•˜ê² ìŠµë‹ˆë‹¤.</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi ~/.zshrc
</code></pre></div></div>
<p>ë§Œì•½ zshë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ” ê²½ìš°ì—ëŠ” .zshrc íŒŒì¼ì— í™˜ê²½ ë³€ìˆ˜ë¥¼<br />
ë“±ë¡í•´ì¤˜ì•¼í•©ë‹ˆë‹¤.</p>

<p><br /></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vi ~/.bashrc
</code></pre></div></div>
<p>bashë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ” ê²½ìš°ì—ëŠ” .bashrc íŒŒì¼ì— ë“±ë¡!</p>

<p><br /></p>

<p><strong>3). í™˜ê²½ ë³€ìˆ˜ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.</strong></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo </span><span class="nv">JWT_SECRET_KEY</span><span class="o">=</span>LeeJaehyeok637637123231231231123
</code></pre></div></div>
<p>í˜„ì¬ ë‚´ê°€ ë“±ë¡í•˜ë ¤ëŠ” í™˜ê²½ë³€ìˆ˜ëŠ” <code class="language-plaintext highlighter-rouge">JWT_SECRET_KEY</code> ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ<br />
ìœ„ì—ì„œ ì„¤ì •í•œë‹¤ê³  ì–˜ê¸°í–ˆì—ˆê³ , í•´ë‹¹ ê°’ì€ ìœ„ì²˜ëŸ¼ <code class="language-plaintext highlighter-rouge">LeeJaehyeok637637123231231231123</code>ì„<br />
ì‚¬ìš©í•˜ë ¤ê³  ê°’ì„ ì„ì˜ë¡œ ì„¤ì •í•´ì„œ ë„£ì–´ì£¼ì—ˆë‹¤.</p>

<p><br /></p>

<p><strong>4). í™˜ê²½ ë³€ìˆ˜ í™•ì¸.</strong></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">printenv</span>
</code></pre></div></div>
<p>printenv ëª…ë ¹ì–´ë¥¼ ì…ë ¤í•˜ë©´ ìš°ì„  <br />
ì „ì²´ ì ìš©ëœ í™˜ê²½ë³€ìˆ˜ ëª©ë¡ì´ ë‚˜ì˜¨ë‹¤.<br />
ê·¸ ì¤‘ì— ìš°ë¦¬ê°€ ì ìš©í•œ JWT_SECRET_KEYê°€ ìˆìœ¼ë©´<br />
ì •ìƒì ìœ¼ë¡œ ì˜ ì ìš©ë˜ì—ˆë‹¤ê³  ë³¼ ìˆ˜ ìˆë‹¤.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="nv">$JWT_SECRET_KEY</span>
</code></pre></div></div>
<p>echo ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ë©´ ì§€ì •í•´ì„œ í™•ì¸ì´ ê°€ëŠ¥í•˜ë‹¤.<br />
ë‚´ê°€ ë“±ë¡í•œ í™˜ê²½ë³€ìˆ˜ëŠ” <code class="language-plaintext highlighter-rouge">JWT_SECRET_KEY</code>ë¡œ ë“±ë¡í–ˆê¸°ì—<br />
í•´ë‹¹ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ í‘œì‹œëœë‹¤ë©´ ì •ìƒì´ë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gPJh2n11ERgYKg0d3nAkDTsgg7LPqEe2CpPKYPF1Z_QrHIuceZwiBV8Yk3kndJG8x8yQFFPKWCfp-kBFUZAkkOK4WfrBg=w1512-h864" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>ê·¸ëŸ¼ ì—¬ê¸°ê¹Œì§€ ì„¤ì •í•˜ê³  ì¡°íšŒê¹Œì§€ í•´ë³´ì•˜ìœ¼ë©´<br />
í™˜ê²½ë³€ìˆ˜ ì„¤ì •ì—ëŠ” ë¬¸ì œê°€ ì—†ëŠ” ê²ƒì´ë‹¤.</p>

<p>í˜¹ì—¬ë‚˜ bash ì‚¬ìš©ìœ¼ë¡œ bash_profileì— ì„¤ì •í•˜ì…¨ëŠ”ë°<br />
í™˜ê²½ë³€ìˆ˜ê°€ ìê¾¸ ë¦¬ì…‹ëœë‹¤ëŠ” ë¬¸ì œë¥¼ ê²ªëŠ” ë¶„ë“¤ì€<br />
1ë²ˆ í•­ëª©ì— ì–´ë–¤ Shellì„ ì‚¬ìš©í•˜ëŠ”ì§€ ë‹¤ì‹œ í™•ì¸í•´ë³¼ í•„ìš”ê°€ ìˆë‹¤.</p>

<p><br /></p>

<h3 id="ê·¸ë˜ì„œí•´ê²°-ë°©ë²•">ê·¸ë˜ì„œí•´ê²° ë°©ë²•?</h3>

<p>ë¬¸ì œëŠ” ë„ˆë¬´ ê°„ë‹¨í–ˆë‹¤.<br />
ì‹¤ì œë¡œ í™˜ê²½ë³€ìˆ˜ëŠ” ì˜ ì ìš©ë˜ì–´ìˆì—ˆê³ <br />
í™˜ê²½ë³€ìˆ˜ê°€ ì ìš©ë˜ì§€ ì•Šì•˜ë˜ ì´ìœ ëŠ” <span style="color:#F04965"><strong>IDE Restart</strong></span>ë¥¼ í•˜ì§€ ì•Šì•˜ë˜ ë¬¸ì œì˜€ë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gNQCKU6FpLklbn9HwlXNB15z8k77FNAGe0aGtURuUgAQxxwBdQD5RP_qiE5wrluKo6XwD61r9x3JbIxnQlpzdIxb-tl4Q=w1512-h864" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>Restart í•˜ëŠ” ë°©ë²•ì€ ë¨¼ì € ìƒë‹¨ì˜ <code class="language-plaintext highlighter-rouge">File</code>ì—ì„œ<br />
<code class="language-plaintext highlighter-rouge">Invaildate Caches</code>ë¥¼ ëˆŒëŸ¬ì¤€ë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOq9qiFokRYmFR5OoFF3OVqGXqXL1QiRwBXUhE_PPCn1IiFPqGfYuDBF-wnApzQ99xla-dQA1B9WteBeCJ0OUEi3uGhUw=w1512-h864" alt="image" class="align-left" style="max-width: 60%" /></p>

<p>ê·¸ë¦¬ê³  <code class="language-plaintext highlighter-rouge">INVALIDATE AND RESTART</code> ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ë©´ ëœë‹¤.<br />
ê·¸ëŸ¬ë©´ IDEê°€ ìë™ì ìœ¼ë¡œ ì¬ì‹œì‘ë  ê²ƒì´ê³ <br />
ìŠ¤í”„ë§ ë¶€íŠ¸ì‹¤í–‰ì‹œ í•´ë‹¹ ì—ëŸ¬ëŠ” ë°œìƒí•˜ì§€ì•Šê³ , ì •ìƒì ìœ¼ë¡œ <br />
í™˜ê²½ë³€ìˆ˜ì˜ ê°’ì„ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ í™•ì¸ì´ ê°€ëŠ¥í•˜ë‹¤.</p>

<p>ì‹¤ì œë¡œ ì¶œë ¥í•´ì„œ í™•ì¸í•´ë³´ê³  ì‹¶ì„ ê²½ìš°</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JwtTokenizer</span> <span class="o">{</span>

    <span class="nd">@Getter</span>
    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${jwt.secret-key}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">secretKey</span><span class="o">;</span>

    <span class="o">...</span> <span class="n">ì¤‘ê°„</span> <span class="n">ìƒëµ</span>
    
    <span class="nd">@PostConstruct</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">secretKey</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="o">...</span> <span class="n">ì´í•˜</span> <span class="n">ìƒëµ</span>
<span class="o">}</span>
</code></pre></div></div>
<p>Spring Boot ì‹¤í–‰ì‹œ ì¶œë ¥ìœ¼ë¡œ ê°’ì„ í™•ì¸í•´ ë³¼ ìˆ˜ ìˆë‹¤.</p>

<p>í˜¹ì€ ì‹¤ì œë¡œ í™˜ê²½ë³€ìˆ˜ë¥¼ í´ë˜ìŠ¤ë¥¼ ì´ìš©í•´ ê°€ì ¸ì˜¤ê³  ì‹¶ë‹¤ë©´</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JwtTokenizer</span> <span class="o">{</span>
    
    <span class="o">...</span> <span class="n">ì´ìƒ</span> <span class="n">ìƒëµ</span>
            
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">Environment</span> <span class="n">environment</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">JwtTokenizer</span><span class="o">(</span><span class="nc">Environment</span> <span class="n">environment</span><span class="o">){</span>
        <span class="k">this</span><span class="o">.</span><span class="na">environment</span> <span class="o">=</span> <span class="n">environment</span><span class="o">;</span>
        <span class="nc">String</span> <span class="n">key</span> <span class="o">=</span> <span class="n">environment</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"JWT_SECRET_KEY"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="o">...</span> <span class="n">ì´í•˜</span> <span class="n">ìƒëµ</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">import org.springframework.core.env.Environment;</code> íŒ¨í‚¤ì§€ë¥¼ improtí•˜ì—¬<br />
<code class="language-plaintext highlighter-rouge">.getProperty();</code> ë©”ì„œë“œë¡œ í™˜ê²½ë³€ìˆ˜ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.</p>

<p><br /></p>

<hr />

<p><strong>ê¸°íƒ€ ì •ë³´(Shell ë³€ê²½)</strong></p>

<p>ë§Œì•½ zsh, bashë¥¼ ë³€ê²½í•´ë³´ê³  ì‹¶ìœ¼ì‹  ë¶„ì€<br />
1). zshë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©í•˜ê³  ì‹¶ì€ê²½ìš°</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chsh <span class="nt">-s</span> /bin/zsh
</code></pre></div></div>

<p>2). bashë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©í•˜ê³  ì‹¶ì€ê²½ìš°</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chsh <span class="nt">-s</span> /bin/bash
</code></pre></div></div>
<p>ì…ë ¥í›„ í˜„ì¬ ë…¸íŠ¸ë¶ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.</p>

<hr />]]></content><author><name>LEE JAEHYEOK</name></author><category term="Spring" /><category term="Spring" /><category term="zsh" /><summary type="html"><![CDATA[ì˜¤ëŠ˜ì€ ë‚´ê°€ ê²ªì€ í™˜ê²½ë³€ìˆ˜ì— ê´€ë ¨ëœ ì„¤ì •ê³¼ ì˜¤ë¥˜ë¥¼ ê¸°ë¡í•´ë³´ë ¤ê³ í•œë‹¤.]]></summary></entry><entry><title type="html">TIL) Spring Security, JWT ì‚¬ìš©í•˜ì—¬ ì¸ì¦í•˜ê¸°</title><link href="http://localhost:4000/til/2022/11/24/til.html" rel="alternate" type="text/html" title="TIL) Spring Security, JWT ì‚¬ìš©í•˜ì—¬ ì¸ì¦í•˜ê¸°" /><published>2022-11-24T00:00:00+09:00</published><updated>2022-11-24T00:00:00+09:00</updated><id>http://localhost:4000/til/2022/11/24/til</id><content type="html" xml:base="http://localhost:4000/til/2022/11/24/til.html"><![CDATA[<p>ë‚ ì”¨ê°€ ë§ì´ ìŒ€ìŒ€í•´ì¡Œë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOtphG8edbKbbvSASKsJ_-tJ0REdmM2lcBp23tquh_bZGuSnGZt9pJIqpz7InTIiLhjrD7ZaBJzmsPBW69wtFDH28VC=w3024-h1728" alt="image" class="align-left" style="max-width: 60%" /></p>

<p>ìš”ì¦˜ í•™ìŠµëŸ‰ì´ ëŠ˜ì–´ë‚˜ ìƒˆë²½ê¹Œì§€ ê³µë¶€í•˜ë‹¤ë³´ë‹ˆ<br />
ì»¨ë””ì…˜ ë‚œì¡°ê°€ ì‹¬í•˜ë‹¤.. ì¼ì°ìë ¤ê³ í•´ë„<br />
ì–´ë–»ê²Œ í•˜ë‹¤ë³´ë‹ˆê¹Œ í•´ì•¼í•  ê²ƒë“¤ì´ ë°€ë ¤ ëŠ¦ê²Œ ì ì„ ì²­í•˜ê²Œëœë‹¤.</p>

<p>ê·¸ëŸ¬ë‹¤ë³´ë‹ˆ ì•„ì¹¨,ì ì‹¬ì— ì •ì‹ ì„ ëª»ì°¨ë¦¬ê³  ê³µë¶€ë¥¼ ì œëŒ€ë¡œ ëª»í•˜ëŠ”..<br />
ì•…ìˆœí™˜ì˜ ë°˜ë³µì´ë‹¤. ì˜¤ëŠ˜ì€ ìµœëŒ€í•œ ì¼ì° ê³µë¶€ë¥¼ ë§ˆì¹˜ê³ <br />
ì›”ë“œì»µë„ ì‹œì‘ì´ë‹ˆ ì¼ì° ì ì„ ìì•¼ê² ë‹¤.</p>

<hr />

<p>ì–´ì œ <a href="https://mycatlikeschuru.github.io/til/2022/11/23/til.html">JWT ê¸°ì´ˆ</a> íŒŒíŠ¸ì—ì„œ JWTì— ëŒ€í•´ ê¸°ì´ˆì§€ì‹ì„<br />
ê³µë¶€í–ˆì—ˆê³ , ì‹¤ì œë¡œ AcessToken, RefreshTokenì„ ë§Œë“¤ì–´ë³´ê¸°ë„ í–ˆë‹¤.</p>

<p>ì´ì œ JWT í† í°ì„ ë§Œë“œëŠ” ë°©ë²•ì„ ì•Œì•˜ìœ¼ë‹ˆ<br />
ì´ í† í°ì„ ì–´ë–»ê²Œ Headersë¡œ ì „ì†¡í•˜ê³ <br />
Spring Securityë¥¼ ì´ìš©í•´ ì¸ì¦ê³¼ì •ì„ ê±°ì¹˜ê²Œ ë˜ëŠ”ì§€? ì— ëŒ€í•œ<br />
ë‚´ìš©ì„ ì˜¤ëŠ˜ ê³µë¶€í•´ë³´ë ¤ í•œë‹¤.</p>

<h2 id="jwtë¥¼-ì´ìš©í•œ-spring-security-ì¸ì¦">JWTë¥¼ ì´ìš©í•œ Spring Security ì¸ì¦</h2>

<h3 id="ì–´ë–»ê²Œ-ì¸ì¦ì„í•˜ì§€">ì–´ë–»ê²Œ ì¸ì¦ì„í•˜ì§€?</h3>

<p>ìš°ì„  <a href="https://mycatlikeschuru.github.io/til/2022/11/21/til.html">Spring Security ì¸ì¦ì²˜ë¦¬</a>ì— ëŒ€í•œ<br />
ì„ ìˆ˜ì§€ì‹ì„ ê°€ì§€ê³  ìˆì–´ì•¼ í•´ë‹¹ ë‚´ìš©ì„ ì´í•´í•  ìˆ˜ ìˆë‹¤.</p>

<p>JWTë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸ì¦ì„ ì§„í–‰í•˜ë ¤ë©´<br />
ê¸°ì¡´ì— ì¸ì¦ì²˜ë¦¬ì—ì„œ ì‚¬ìš©í•˜ëŠ” <code class="language-plaintext highlighter-rouge">UsernamePasswordAuthenticationFilter</code>ë¥¼<br />
ë¹„í™œì„±í™”ë¡œ ë³€ê²½í•œ í›„ì— ìƒì†ë°›ì•„ í´ë˜ìŠ¤ë¥¼ êµ¬í˜„í•´ ì¸ì¦ì„ ì²˜ë¦¬í•´ì¤„ ìˆ˜ ìˆë‹¤.<br />
(êµ¬í˜„í•˜ëŠ”ê±´ ì´ì œë¶€í„° ê°œë°œìê°€ í•´ì•¼í•˜ëŠ” ì˜ì—­)</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOQR4FMzSp9LHOptJF9_XBX4UQULmx47cZIefY8NeWpgeh2vTm3_WS04sbLy7xWlLrtlt4FbZfxdTdk501lzUyEOSykZQ=w1299-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>ê·¸ë¦¼ìœ¼ë¡œ í•œë²ˆ ì •ë¦¬í•´ë³´ì.</p>

<p><code class="language-plaintext highlighter-rouge">UsernamePasswordAuthenticationFilter</code>ë¥¼ ìƒì†ë°›ëŠ”<br />
<code class="language-plaintext highlighter-rouge">JwtAuthenticationFilter</code> ë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ êµ¬í˜„í•  ê²ƒì´ë‹¤.<br />
ê·¸ë¦¬ê³  ìš°ë¦¬ê°€ êµ¬í˜„í•œ í•„í„°ëŠ” ë“±ë¡í•´ë†“ì•„ì•¼í•˜ê³ , ê¸°ì¡´ì˜ <br />
<code class="language-plaintext highlighter-rouge">UsernamePasswordAuthenticationFilter</code> í•„í„°ëŠ” ë¹„í™œì„±í™”í•´ì¤˜ì•¼í•œë‹¤.</p>

<p>êµ¬í˜„í• ë•Œ ìœ ì˜í• ì ì€ ì¸ì¦ì„ ì´ê´„í•˜ëŠ” <code class="language-plaintext highlighter-rouge">AuthenticationManager</code>ì˜<br />
<code class="language-plaintext highlighter-rouge">.authenticate();</code>ë©”ì„œë“œë¥¼ ì´ìš©í•´ ì¸ì¦ ì²˜ë¦¬ë¥¼ ìœ„ì„í•´ì¤˜ì•¼í•œë‹¤.<br />
ê·¸ëŸ¬ë©´ ìš°ë¦¬ê°€ ìì£¼ë³´ì•˜ë˜ ì¸ì¦ì²˜ë¦¬ íë¦„ëŒ€ë¡œ ì½”ë“œê°€ ì§„í–‰ë˜ê³ </p>

<p>Spring Securityì—ì„œ êµ¬í˜„í–ˆë˜ <code class="language-plaintext highlighter-rouge">UserDetails</code> ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ<br />
<code class="language-plaintext highlighter-rouge">.loadUserByUsername();</code>ë©”ì„œë“œ í˜¸ì¶œì‹œ ë°˜í™˜ë§Œ í•´ì£¼ë©´<br />
êµ¬í˜„í•˜ëŠ” ë¶€ë¶„ì€ ëë‚œë‹¤.</p>

<p>ê·¸ë¦¬ê³  ì¸ì¦ì™„ë£Œëœ ê°ì²´ê°€ ëŒì•„ì˜¤ë©´, JWTë¥¼ ìƒì„± í›„ í´ë¼ì´ì–¸íŠ¸ì—<br />
Response Headerì— ë‹´ì•„ ë³´ë‚´ì£¼ë©´ëœë‹¤.</p>

<p><br /></p>

<p>ë‹¤ì‹œ í•œë²ˆ ì •ë¦¬í•´ë³´ìë©´ <br />
<code class="language-plaintext highlighter-rouge">JwtAuthenticationFilter</code> ì´ë¦„ìœ¼ë¡œ JWT Filterë¥¼ í•˜ë‚˜ ë§Œë“¤ ê²ƒì´ë‹¤.<br />
<code class="language-plaintext highlighter-rouge">AbstractAuthenticationProcessingFilter</code>ì¶”ìƒ í´ë˜ìŠ¤ë¥¼ ì—ì„œ filterê°€ ì‹œì‘ëœë‹¤.<br />
<code class="language-plaintext highlighter-rouge">UsernamePasswordAuthenticationFilter</code> í´ë˜ìŠ¤ë¥¼ ìƒì†í•˜ë©´, ìœ„ì— ì¶”ìƒí´ë˜ìŠ¤ë„<br />
ìƒì†ê´€ê³„ì´ê¸°ë•Œë¬¸ì— Overridingí•˜ì—¬ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.</p>

<p>Overridingí•œ ë©”ì„œë“œë¥¼ êµ¬í˜„í•´ì•¼í•˜ëŠ”ë° 2ê°€ì§€ë¥¼ êµ¬í˜„í•´ì•¼í•œë‹¤.</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">attemptAuthentication();</code> ë©”ì„œë“œ êµ¬í˜„<br />
-&gt; ì¸ì¦ì„ ìœ„ì„í•´ì£¼ê³  ì¸ì¦ì²˜ë¦¬ ì™„ë£Œëœ ê°ì²´ê°€ ë°˜í™˜ë˜ëŠ” ë©”ì„œë“œì´ë¯€ë¡œ<br />
ì¸ì¦ê³¼ ê´€ë ¨ëœ ì •ë³´ë¥¼ ë„˜ê²¨ì£¼ëŠ” ê²ƒì„ êµ¬í˜„í•´ì•¼í•¨.</li>
  <li><code class="language-plaintext highlighter-rouge">successfulAuthentication();</code> ë©”ì„œë“œ êµ¬í˜„<br />
-&gt; ì¸ì¦ ì™„ë£Œ í›„ JWT í† í°ì„ ë§Œë“¤ì–´ Headerì— ë‹´ì•„ì£¼ëŠ” í´ë˜ìŠ¤ë¥¼ êµ¬í˜„í•´ì•¼í•¨<br />
-&gt; Security Contextì— ì €ì¥í•˜ëŠ” ë¶€ë¶„ì€ ì¶”í›„ JWT ë¹„êµí•„í„°ì—ì„œ ì¶”ê°€</li>
</ol>

<p><br /></p>

<h3 id="ì½”ë“œë¡œ-í•œë²ˆ-í™•ì¸í•´-ë³´ì-">ì½”ë“œë¡œ í•œë²ˆ í™•ì¸í•´ ë³´ì !</h3>

<h4 id="1-jwtauthenticationfilter-êµ¬í˜„">1). JwtAuthenticationFilter êµ¬í˜„</h4>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JwtAuthenticationFilter</span> <span class="kd">extends</span> <span class="nc">UsernamePasswordAuthenticationFilter</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">AuthenticationManager</span> <span class="n">authenticationManager</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">JwtTokenizer</span> <span class="n">jwtTokenizer</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">JwtAuthenticationFilter</span><span class="o">(</span><span class="nc">AuthenticationManager</span> <span class="n">authenticationManager</span><span class="o">,</span> <span class="nc">JwtTokenizer</span> <span class="n">jwtTokenizer</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">authenticationManager</span> <span class="o">=</span> <span class="n">authenticationManager</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">jwtTokenizer</span> <span class="o">=</span> <span class="n">jwtTokenizer</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="nd">@SneakyThrows</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Authentication</span> <span class="nf">attemptAuthentication</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">ObjectMapper</span> <span class="n">objectMapper</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectMapper</span><span class="o">();</span>
        <span class="nc">LoginDto</span> <span class="n">loginDto</span> <span class="o">=</span> <span class="n">objectMapper</span><span class="o">.</span><span class="na">readValue</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">(),</span> <span class="nc">LoginDto</span><span class="o">.</span><span class="na">class</span><span class="o">);</span> <span class="c1">// ServletInputSteam ì„ LoginDto í´ë˜ìŠ¤ ê°ì²´ë¡œ ì—­ì§ë ¬í™”</span>

        <span class="nc">UsernamePasswordAuthenticationToken</span> <span class="n">authenticationToken</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UsernamePasswordAuthenticationToken</span><span class="o">(</span><span class="n">loginDto</span><span class="o">.</span><span class="na">getUsername</span><span class="o">(),</span> <span class="n">loginDto</span><span class="o">.</span><span class="na">getPassword</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">authenticationManager</span><span class="o">.</span><span class="na">authenticate</span><span class="o">(</span><span class="n">authenticationToken</span><span class="o">);</span>
    <span class="o">}</span> 
    
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">successfulAuthentication</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">FilterChain</span> <span class="n">chain</span><span class="o">,</span> <span class="nc">Authentication</span> <span class="n">authResult</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>
        
        <span class="nc">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Member</span><span class="o">)</span> <span class="n">authResult</span><span class="o">.</span><span class="na">getPrincipal</span><span class="o">();</span>

        <span class="nc">String</span> <span class="n">accessToken</span> <span class="o">=</span> <span class="n">delegateAccessToken</span><span class="o">(</span><span class="n">member</span><span class="o">);</span> <span class="c1">// accessToken ë§Œë“¤ê¸°</span>
        <span class="nc">String</span> <span class="n">refreshToken</span> <span class="o">=</span> <span class="n">delegateRefreshToken</span><span class="o">(</span><span class="n">member</span><span class="o">);</span> <span class="c1">// refreshToken ë§Œë“¤ê¸°</span>

        <span class="nc">String</span> <span class="n">headerValue</span> <span class="o">=</span> <span class="s">"Bearer "</span><span class="o">+</span> <span class="n">accessToken</span><span class="o">;</span>

        <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"Authorization"</span><span class="o">,</span><span class="n">headerValue</span><span class="o">);</span> <span class="c1">// Headerì— ë“±ë¡</span>
        <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"Refresh"</span><span class="o">,</span><span class="n">refreshToken</span><span class="o">);</span> <span class="c1">// Headerì— ë“±ë¡</span>

        <span class="k">this</span><span class="o">.</span><span class="na">getSuccessHandler</span><span class="o">().</span><span class="na">onAuthenticationSuccess</span><span class="o">(</span><span class="n">request</span><span class="o">,</span><span class="n">response</span><span class="o">,</span><span class="n">authResult</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="nf">delegateAccessToken</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">){</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">claims</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">claims</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"username"</span><span class="o">,</span><span class="n">member</span><span class="o">.</span><span class="na">getEmail</span><span class="o">());</span>
        <span class="n">claims</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"roles"</span><span class="o">,</span><span class="n">member</span><span class="o">.</span><span class="na">getRoles</span><span class="o">());</span>

        <span class="nc">String</span> <span class="n">subject</span> <span class="o">=</span> <span class="n">member</span><span class="o">.</span><span class="na">getEmail</span><span class="o">();</span>
        <span class="nc">Date</span> <span class="n">expiration</span> <span class="o">=</span> <span class="n">jwtTokenizer</span><span class="o">.</span><span class="na">getTokenExpiration</span><span class="o">(</span><span class="n">jwtTokenizer</span><span class="o">.</span><span class="na">getAccessTokenExpirationMinutes</span><span class="o">());</span>

        <span class="nc">String</span> <span class="n">base64EncodedSecretKey</span> <span class="o">=</span> <span class="n">jwtTokenizer</span><span class="o">.</span><span class="na">encodeBase64SecretKey</span><span class="o">(</span><span class="n">jwtTokenizer</span><span class="o">.</span><span class="na">getSecretKey</span><span class="o">());</span>
        <span class="nc">String</span> <span class="n">accessToken</span> <span class="o">=</span> <span class="n">jwtTokenizer</span><span class="o">.</span><span class="na">generateAccesToken</span><span class="o">(</span><span class="n">claims</span><span class="o">,</span> <span class="n">subject</span><span class="o">,</span> <span class="n">expiration</span><span class="o">,</span> <span class="n">base64EncodedSecretKey</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">accessToken</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="nf">delegateRefreshToken</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">){</span>
        <span class="nc">String</span> <span class="n">subject</span> <span class="o">=</span> <span class="n">member</span><span class="o">.</span><span class="na">getEmail</span><span class="o">();</span>
        <span class="nc">Date</span> <span class="n">expiration</span> <span class="o">=</span> <span class="n">jwtTokenizer</span><span class="o">.</span><span class="na">getTokenExpiration</span><span class="o">(</span><span class="n">jwtTokenizer</span><span class="o">.</span><span class="na">getRefreshTokenExpirationMinutes</span><span class="o">());</span>
        <span class="nc">String</span> <span class="n">base64EncodedSecretKey</span> <span class="o">=</span> <span class="n">jwtTokenizer</span><span class="o">.</span><span class="na">encodeBase64SecretKey</span><span class="o">(</span><span class="n">jwtTokenizer</span><span class="o">.</span><span class="na">getSecretKey</span><span class="o">());</span>
        <span class="nc">String</span> <span class="n">refreshToken</span> <span class="o">=</span> <span class="n">jwtTokenizer</span><span class="o">.</span><span class="na">generateRefreshToken</span><span class="o">(</span><span class="n">subject</span><span class="o">,</span> <span class="n">expiration</span><span class="o">,</span> <span class="n">base64EncodedSecretKey</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">refreshToken</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>í•´ë‹¹ ì½”ë“œì—ì„œ ìœ ì˜ ê¹Šê²Œ ë´ì•¼í•  ë¶€ë¶„ì€ <code class="language-plaintext highlighter-rouge">JwtAuthenticationFilter</code>í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì—ˆê³ <br />
extendë¡œ <code class="language-plaintext highlighter-rouge">UsernamePasswordAuthenticationFilter</code> í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ê³ <br />
@Overriding í•˜ì—¬ <code class="language-plaintext highlighter-rouge">attemptAuthentication();</code>ì™€ <code class="language-plaintext highlighter-rouge">successfulAuthentication();</code> ë©”ì„œë“œë¥¼<br />
êµ¬í˜„í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„± ì¤‘ì´ë‹¤. ìœ„ì—ì„œ ê·¸ë¦¼ìœ¼ë¡œ ë³´ì•˜ë˜ ë¶€ë¶„ì´ë‹¤.</p>

<p>êµ¬í˜„ ë‚´ìš©ì„ ì‚´í´ë³´ë©´
<code class="language-plaintext highlighter-rouge">attemptAuthentication();</code> ë©”ì„œë“œëŠ” <br />
ìš°ë¦¬ê°€ ê¸°ì¡´ì— Form Loginìœ¼ë¡œ íŒŒë¼ë¯¸í„°ë¥¼ ê°€ì ¸ì˜¤ê³  Authentication ê°ì²´ë¥¼ ë§Œë“¤ì–´<br />
<code class="language-plaintext highlighter-rouge">authenticate();</code> ë©”ì„œë“œë¡œ ì¸ì¦ ì²˜ë¦¬ ìœ„ì„ì„ ì‹œì‘í•´ì£¼ëŠ” ë¶€ë¶„ì´ë‹¤.<br />
Form Login ë°©ì‹ì„ ì“°ì§€ì•Šê³ , í´ë¼ì´ì–¸íŠ¸ ìª½ì—ì„œ JSON ê°ì²´ë¡œ</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"username"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"dhfif718@naver.com"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"password"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"1111"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p>ë¡œê·¸ì¸ ì¸ì¦ ì •ë³´ë¥¼ ì´ë ‡ê²Œ ë³´ë‚´ì¤„ ê²ƒì´ë‹¤.<br />
ê·¸ë ‡ê¸° ë•Œë¬¸ì— <code class="language-plaintext highlighter-rouge">attemptAuthentication();</code> ë©”ì„œë“œë¥¼ êµ¬í˜„í•œ ê²ƒì´ê³ <br />
ë°›ì€ JSON ê°ì²´ëŠ” <code class="language-plaintext highlighter-rouge">request.getInputStream();</code>ìœ¼ë¡œ êº¼ë‚¼ ìˆ˜ ìˆë‹¤.<br />
ìœ„ì—ì„œëŠ” <code class="language-plaintext highlighter-rouge">ObjectMapper</code> í´ë˜ìŠ¤ë¥¼ ì´ìš©í•´ Dtoë¥¼ í•˜ë‚˜ ë§Œë“¤ì–´<br />
ë§µí•‘í•˜ì—¬ ê°’ì„ ì €ì¥í•´ ì£¼ì—ˆë‹¤. ê·¸ë¦¬ê³  ì €ì¥í•´ì¤€ ë°ì´í„°ë¥¼ ê°€ì§€ê³  Authentication ê°ì²´ë¥¼ ë§Œë“¤ì—ˆë‹¤.</p>

<p><br /></p>

<p><code class="language-plaintext highlighter-rouge">successfulAuthentication();</code>ë©”ì„œë“œëŠ”<br />
ì¸ì¦ëœ ê°ì²´ê°€ ë„˜ì–´ì™”ì„ ê²ƒì´ê³ , ì¸ì¦ëœ ê°ì²´ <code class="language-plaintext highlighter-rouge">authResult</code>ëŠ”<br />
ì´ì „ì— Spring Security ì‚¬ìš©í•  ë•Œ <code class="language-plaintext highlighter-rouge">UserDetails</code> ê°ì²´ë¥¼ ë°˜í™˜í•´ êµ¬í˜„í–ˆì—ˆë‹¤.<br />
ì‹¤ì œ êµ¬í˜„í• ë•Œ <code class="language-plaintext highlighter-rouge">UserDetails</code>ë¥¼ <code class="language-plaintext highlighter-rouge">Member</code> í´ë˜ìŠ¤ë¥¼ê°€ ìƒì†í•˜ë„ë¡ êµ¬í˜„í•´ì„œ<br />
<code class="language-plaintext highlighter-rouge">authResult.getPrincipal();</code>ë©”ì„œë“œë¡œ Down Castingí•˜ì—¬ Member ê°ì²´ë¥¼<br />
ê°€ì ¸ì˜¬ ìˆ˜ ìˆê²Œë˜ëŠ” ê²ƒì´ë‹¤.</p>

<p>ì´ë ‡ê²Œ ê°€ì ¸ì˜¨ <code class="language-plaintext highlighter-rouge">Member</code> ê°ì²´ë¥¼ í™œìš©í•´ì„œ AccessTokenê³¼ RefreshTokenì„ ë§Œë“¤ì–´<br />
<code class="language-plaintext highlighter-rouge">response.setHeader();</code> ë©”ì„œë“œë¥¼ í™œìš©í•´ HEADERì— ê°’ì„ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.<br />
HEADERì— ê¹Œì§€ ì •ìƒì ìœ¼ë¡œ ë„£ì—ˆìœ¼ë©´ <code class="language-plaintext highlighter-rouge">.onAuthenticationSuccess();</code>ë¥¼ í˜¸ì¶œí•´<br />
ì„±ê³µì ìœ¼ë¡œ ì¸ì¦ëœ ê°ì²´ë¥¼ ë§Œë“¤ì—ˆë‹¤ê³  ì•Œë¦¬ê³ , ë‹¤ìŒ Filterë¥¼ ì§„í–‰í•˜ê²Œ ëœë‹¤.</p>

<p>ì—¬ê¸°ê¹Œì§€ ë³´ì•˜ì„ë•Œ í•œê°€ì§€ ì˜ì•„í•œ ì ì„ ì°¾ì„ ìˆ˜ ìˆë‹¤.<br />
ê³µë¶€í–ˆë˜ ì¸ì¦ ì²˜ë¦¬íë¦„ì— ë§ˆì§€ë§‰ì€ <code class="language-plaintext highlighter-rouge">Security Context</code>ì— ì €ì¥ì„í•´ì•¼<br />
ë‚˜ì¤‘ì— ê¶Œí•œë¶€ì—¬ë¥¼ í• ë•Œ <code class="language-plaintext highlighter-rouge">Security Context</code>ì—ì„œ êº¼ë‚¼ ìˆ˜ ìˆëŠ”ë° <br />
ì´ë¶€ë¶„ì„ êµ¬í˜„í•˜ì§€ ì•Šì•˜ë˜ì ì„ ì˜ì•„í•´í•  ìˆ˜ ìˆë‹¤.</p>

<p>í•´ë‹¹ë¶€ë¶„ì€ ë‹¤ìŒ Filterì—ì„œ ì²˜ë¦¬í•  ê²ƒì´ë‹¤.<br />
ê·¸ëŸ¼ ë‹¤ìŒ ì¶”ê°€í•  Filterë¥¼ ì•Œì•„ë³´ì</p>

<p><br /></p>

<h4 id="2-jwtverificationfilter-êµ¬í˜„">2). JwtVerificationFilter êµ¬í˜„</h4>
<p>í•´ë‹¹ í•„í„°ëŠ” ì´ì „ì— í•„í„° <code class="language-plaintext highlighter-rouge">JwtAuthenticationFilter</code>ì˜ ë‹¤ìŒ Filterë¡œ<br />
ìš°ë¦¬ê°€ êµ¬í˜„í•˜ëŠ” ìƒˆë¡œìš´ Filter í´ë˜ìŠ¤ì´ë‹¤.</p>

<p>í•´ë‹¹ í•„í„°ì˜ ì—­í• ì€ ë„˜ì–´ì˜¨ JWTì— ëŒ€í•œ ê²€ì¦ê³¼<br />
ê²€ì¦ì´ ì™„ë£Œëœ Authentication ê°ì²´ë¥¼ <code class="language-plaintext highlighter-rouge">Security Context</code>ì—<br />
ì €ì¥í•˜ëŠ” ì—­í• ì„ êµ¬í˜„í•´ì£¼ëŠ” í´ë˜ìŠ¤ì´ë‹¤.</p>

<p>ì—¬ê¸°ì„œ í•œê°€ì§€ ì¤‘ìš”í•œì ì€ <code class="language-plaintext highlighter-rouge">Security Context</code>ì— ì €ì¥ì€ í•˜ì§€ë§Œ<br />
Session ë°©ì‹ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” í˜•ì‹ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">SecurityFilterChain</code>ì—ì„œ ì„¤ì •í•  ê²ƒì´ë‹¤.<br />
ê·¸ë˜ì•¼ JWTë¥¼ ì‚¬ìš©í•˜ëŠ” ëª©ì ê³¼ ë§ê¸° ë•Œë¬¸ì´ë‹¤.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JwtVerificationFilter</span> <span class="kd">extends</span> <span class="nc">OncePerRequestFilter</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">JwtTokenizer</span> <span class="n">jwtTokenizer</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">CustomAuthorityUtils</span> <span class="n">authorityUtils</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">JwtVerificationFilter</span><span class="o">(</span><span class="nc">JwtTokenizer</span> <span class="n">jwtTokenizer</span><span class="o">,</span> <span class="nc">CustomAuthorityUtils</span> <span class="n">authorityUtils</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">jwtTokenizer</span> <span class="o">=</span> <span class="n">jwtTokenizer</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">authorityUtils</span> <span class="o">=</span> <span class="n">authorityUtils</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/*
    * í•„í„° ì¶”ê°€, JWT ê°ì²´ë¥¼ êº¼ë‚´ì„œ ë¹„êµí›„ SecurityContextì— ì €ì¥í•¨
    * */</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doFilterInternal</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">FilterChain</span> <span class="n">filterChain</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>

        <span class="c1">// ì˜ˆì™¸ì²˜ë¦¬ ì¶”ê°€</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">claims</span> <span class="o">=</span> <span class="n">verifyJws</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
            <span class="n">setAuthenticationToContext</span><span class="o">(</span><span class="n">claims</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SignatureException</span> <span class="n">se</span><span class="o">){</span>
            <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"exception"</span><span class="o">,</span><span class="n">se</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">ExpiredJwtException</span> <span class="n">ex</span><span class="o">){</span>
            <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"exception"</span><span class="o">,</span><span class="n">ex</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"exception"</span><span class="o">,</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">// ë‹¤ìŒ Filter ì‹¤í–‰</span>
        <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span><span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>

     <span class="cm">/*
     * ë§Œì•½ requestì— ì „ë‹¬ë°›ì€ authorizationì´ ì—†ìœ¼ë©´ í•´ë‹¹ í•„í„°ëŠ” ì‹¤í–‰ì•ˆí•¨
     * */</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">boolean</span> <span class="nf">shouldNotFilter</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">authorization</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"Authorization"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">authorization</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="o">!</span><span class="n">authorization</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"Bearer"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/*
    * request ê°ì²´ë¡œ claims ê°ì²´ êº¼ë‚´ëŠ” ë©”ì„œë“œ
    * */</span>
    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="nf">verifyJws</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
        <span class="nc">String</span> <span class="n">jws</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"Authorization"</span><span class="o">).</span><span class="na">replace</span><span class="o">(</span><span class="s">"Bearer "</span><span class="o">,</span><span class="s">""</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">base64EncodedSecretKey</span> <span class="o">=</span> <span class="n">jwtTokenizer</span><span class="o">.</span><span class="na">encodeBase64SecretKey</span><span class="o">(</span><span class="n">jwtTokenizer</span><span class="o">.</span><span class="na">getSecretKey</span><span class="o">());</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span> <span class="o">,</span><span class="nc">Object</span><span class="o">&gt;</span> <span class="n">claims</span> <span class="o">=</span> <span class="n">jwtTokenizer</span><span class="o">.</span><span class="na">getClaims</span><span class="o">(</span><span class="n">jws</span><span class="o">,</span> <span class="n">base64EncodedSecretKey</span><span class="o">).</span><span class="na">getBody</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">claims</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/*
    * SecurityContextì— ì €ì¥í•˜ëŠ” ë¶€ë¶„
    * */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">setAuthenticationToContext</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">claims</span><span class="o">){</span>
        <span class="nc">String</span> <span class="n">username</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">claims</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"username"</span><span class="o">);</span>

        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">GrantedAuthority</span><span class="o">&gt;</span> <span class="n">authorities</span> <span class="o">=</span> <span class="n">authorityUtils</span><span class="o">.</span><span class="na">createAuthorities</span><span class="o">((</span><span class="nc">List</span><span class="o">)</span><span class="n">claims</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"roles"</span><span class="o">));</span>

        <span class="nc">Authentication</span> <span class="n">authentication</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UsernamePasswordAuthenticationToken</span><span class="o">(</span><span class="n">username</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">authorities</span><span class="o">);</span>
        <span class="nc">SecurityContextHolder</span><span class="o">.</span><span class="na">getContext</span><span class="o">().</span><span class="na">setAuthentication</span><span class="o">(</span><span class="n">authentication</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>í•´ë‹¹ í´ë˜ìŠ¤ëŠ” ìƒê°ë³´ë‹¤ ê°„ë‹¨í•˜ë‹¤.<br />
ìš°ì„  <code class="language-plaintext highlighter-rouge">OncePerRequestFilter</code>ë¥¼ ìƒì†ë°›ì•„ í•„í„°ë¡œ ì‚¬ìš©í•˜ëŠ” í´ë˜ìŠ¤ì´ë‹¤.<br />
ì‚¬ìš©ì í•œë²ˆì˜ ìš”ì²­ì— ë”±í•œë²ˆë§Œ ì‹¤í–‰í•˜ëŠ” í•„í„°ì´ê³  <a href="https://minkukjo.github.io/framework/2020/12/18/Spring-142/">minkukjoë‹˜ì˜ ë¸”ë¡œê·¸</a>ë¥¼ ì°¸ê³ í•˜ë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤.</p>

<p>ìš°ë¦¬ëŠ” ë¡œê·¸ì¸í• ë•Œ JWTí† í°ì„ HEADERì— ì‹¦ì–´ í´ë¼ì´ì–¸íŠ¸ì— ë°œí–‰í•´ ì¤¬ë‹¤.<br />
ì´ì œ ë§Œì•½ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì–´ë– í•œ ìš”ì²­ì´ ìˆë‹¤ê³  ê°€ì •í• ë•Œ HEADER Access Tokenì„ ë³´ë‚´ë©´<br />
request ê°ì²´ë¥¼ ì´ìš©í•´ì„œ HEADERì—ì„œ JWTë¥¼ ê°€ì ¸ì™€ì„œ, ìš°ë¦¬ê°€ ê¸°ì¡´ì— ë§Œë“¤ì–´ë‘”<br />
<code class="language-plaintext highlighter-rouge">.getClamis();</code>ë©”ì„œë“œë¥¼ ì´ìš©í•´ ë¹„êµí›„ claims ê°ì²´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.</p>

<p>ë§Œì•½ í† í°ì´ ë§Œë£Œì‹œê°„ì´ ë‹¤ë˜ì—ˆê±°ë‚˜ ì„œëª…í˜•ì‹ì´ í‹€ë ¸ë‹¤ê±°ë‚˜í•˜ë©´<br />
ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ì„œ JWT ì¸ì¦ì´ ë˜ì—ˆë‹¤ê³  íŒë‹¨í•˜ì§€ì•Šì•„ <br />
ë‹¤ìŒ í•„í„°ë¥¼ ì§„í–‰í•˜ê²Œ ëœë‹¤. ì—¬ê¸°ì„œ ë‹¤ìŒ í•„í„°ë¥¼ ì§„í–‰í•˜ê²Œ ë˜ë©´ <code class="language-plaintext highlighter-rouge">Security Context</code>ì—ëŠ”<br />
ì•„ë¬´ëŸ° ê°ì²´ê°€ ì—†ê¸°ë•Œë¬¸ì— ê¶Œí•œí™•ì¸í•˜ëŠ” í•„í„°ì—ì„œ ì¸ê°€ê°€ ë˜ì§€ ì•ŠëŠ”ë‹¤.</p>

<p>ì¦‰, ìš°ë¦¬ê°€ ë°œí–‰í•œ Access Tokenê³¼ ì¼ì¹˜í•˜ëŠ” ì§€ í™•ì¸í•œë‹¤ìŒ<br />
<code class="language-plaintext highlighter-rouge">Security Context</code>ì— ì¸ì¦ëœ ê°ì²´ë¥¼ ì €ì¥í•´ì£¼ëŠ” í•„í„° í´ë˜ìŠ¤ì´ë‹¤.<br />
ë§Œì•½ ì¼ì¹˜í•˜ì§€ì•Šê±°ë‚˜ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ <code class="language-plaintext highlighter-rouge">Security Context</code>ì— ê°ì²´ë¥¼<br />
ì €ì¥í•˜ì§€ ì•Šê³  ë‹¤ìŒ Filterë¡œ ë„˜ì–´ê°€ëŠ” ë°©ì‹ì´ë‹¤.</p>

<p>ì´ë ‡ê²Œ ê¹Œì§€ë§Œ êµ¬í˜„í•˜ë©´ JWT ê´€ë ¨í•´ì„œ ë°œí–‰ê³¼, ì¸ì¦ì— ëŒ€í•œ<br />
êµ¬í˜„ ë¶€ë¶„ì€ ëë‚¬ë‹¤. ì´ì œ ìš°ë¦¬ê°€ ë§ˆì§€ë§‰ìœ¼ë¡œ í•´ì¤˜ì•¼í•  ë¶€ë¶„ì€<br />
Spring SecurityFilterChainì— ì„¤ì •ì •ë³´ë¥¼ ì„¤ì •í•˜ëŠ”ì¼ë§Œ ë‚¨ì•˜ë‹¤.</p>

<p><br /></p>

<h4 id="3-spring-security-filterchain-ì„¤ì •">3). Spring Security FilterChain ì„¤ì •</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@EnableWebSecurity</span><span class="o">(</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfigurationV6</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">JwtTokenizer</span> <span class="n">jwtTokenizer</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">CustomAuthorityUtils</span> <span class="n">authorityUtils</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">SecurityConfigurationV6</span><span class="o">(</span><span class="nc">JwtTokenizer</span> <span class="n">jwtTokenizer</span><span class="o">,</span> <span class="nc">CustomAuthorityUtils</span> <span class="n">authorityUtils</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">jwtTokenizer</span> <span class="o">=</span> <span class="n">jwtTokenizer</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">authorityUtils</span> <span class="o">=</span> <span class="n">authorityUtils</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">SecurityFilterChain</span> <span class="nf">filterChain</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">http</span>
                <span class="o">.</span><span class="na">headers</span><span class="o">().</span><span class="na">frameOptions</span><span class="o">().</span><span class="na">sameOrigin</span><span class="o">()</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
                <span class="o">.</span><span class="na">csrf</span><span class="o">().</span><span class="na">disable</span><span class="o">()</span>
                <span class="o">.</span><span class="na">cors</span><span class="o">(</span><span class="nc">Customizer</span><span class="o">.</span><span class="na">withDefaults</span><span class="o">())</span> <span class="c1">// corsConfigurationSourceë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë“±ë¡ëœ Beanì„ ì‚¬ìš©í•œë‹¤ê³  ì •ì˜</span>
                <span class="o">.</span><span class="na">sessionManagement</span><span class="o">().</span><span class="na">sessionCreationPolicy</span><span class="o">(</span><span class="nc">SessionCreationPolicy</span><span class="o">.</span><span class="na">STATELESS</span><span class="o">)</span> <span class="c1">// ì„¸ì…˜ ì •ì±… ì¶”ê°€ (JWTì‚¬ìš©ìœ¼ë¡œ STATELESSë¡œ ì„¤ì •)</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
                <span class="o">.</span><span class="na">formLogin</span><span class="o">().</span><span class="na">disable</span><span class="o">()</span> <span class="c1">// CSR ë°©ì‹ì‚¬ìš©ìœ¼ë¡œ formLogin ë¹„í™œì„±í™”</span>
                <span class="o">.</span><span class="na">httpBasic</span><span class="o">().</span><span class="na">disable</span><span class="o">()</span> <span class="c1">// UsernamePasswordAuthenticationFilter ë“± ë¹„í™œì„±í™”</span>
                <span class="o">.</span><span class="na">exceptionHandling</span><span class="o">()</span> <span class="c1">// ì˜ˆì™¸ì²˜ë¦¬ ê¸°ëŠ¥ì´ ì‘ë™</span>
                <span class="o">.</span><span class="na">authenticationEntryPoint</span><span class="o">(</span><span class="k">new</span> <span class="nc">MemberAuthenticationEntryPoint</span><span class="o">())</span>  <span class="c1">// ì¸ì¦ ì‹¤íŒ¨ì‹œ ì²˜ë¦¬</span>
                <span class="o">.</span><span class="na">accessDeniedHandler</span><span class="o">(</span><span class="k">new</span> <span class="nc">MemberAccessDeniedHandler</span><span class="o">())</span> <span class="c1">// ì¸ì¦ ì‹¤íŒ¨ì‹œ ì²˜ë¦¬</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
                <span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="k">new</span> <span class="nc">CustomFilterConfigurer</span><span class="o">())</span> <span class="c1">// ì»¤ìŠ¤í„°ë§ˆì´ì§•í•œ í•„í„°ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŒ</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
                <span class="o">.</span><span class="na">authorizeHttpRequests</span><span class="o">(</span><span class="n">authorize</span> <span class="o">-&gt;</span> <span class="n">authorize</span>
                        <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">,</span> <span class="s">"/*/members"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">PATCH</span><span class="o">,</span> <span class="s">"/*/members/**"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"USER"</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span> <span class="s">"/*/members"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"ADMIN"</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span> <span class="s">"/*/members/**"</span><span class="o">).</span><span class="na">hasAnyRole</span><span class="o">(</span><span class="s">"USER"</span><span class="o">,</span> <span class="s">"ADMIN"</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="nc">HttpMethod</span><span class="o">.</span><span class="na">DELETE</span><span class="o">,</span> <span class="s">"/*/members/**"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"USER"</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">permitAll</span><span class="o">()</span>
                <span class="o">);</span>
        <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">PasswordEncoder</span> <span class="nf">passwordEncoder</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">PasswordEncoderFactories</span><span class="o">.</span><span class="na">createDelegatingPasswordEncoder</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/*
    * êµ¬ì²´ì ì¸ CORS ì •ì±…ì„ ì„¤ì •
    * */</span>
    <span class="nd">@Bean</span>
    <span class="nc">CorsConfigurationSource</span> <span class="nf">corsConfigurationSource</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">CorsConfiguration</span> <span class="n">configuration</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CorsConfiguration</span><span class="o">();</span>
        <span class="n">configuration</span><span class="o">.</span><span class="na">setAllowedOrigins</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"*"</span><span class="o">));</span> <span class="c1">// ìŠ¤í¬ë¦¼íŠ¸ ê¸°ë°˜ì˜ HTTP í†µì‹ ì„ í—ˆìš©</span>
        <span class="n">configuration</span><span class="o">.</span><span class="na">setAllowedMethods</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">"GET"</span><span class="o">,</span><span class="s">"POST"</span><span class="o">,</span> <span class="s">"PATCH"</span><span class="o">,</span> <span class="s">"DELETE"</span><span class="o">));</span> <span class="c1">// HTTP Methodì— ëŒ€í•œ HTTP í†µì‹  í—ˆìš©</span>

        <span class="nc">UrlBasedCorsConfigurationSource</span> <span class="n">source</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UrlBasedCorsConfigurationSource</span><span class="o">();</span> <span class="c1">// CorsConfigurationSource êµ¬í˜„ì²´ ìƒì„±</span>
        <span class="n">source</span><span class="o">.</span><span class="na">registerCorsConfiguration</span><span class="o">(</span><span class="s">"/**"</span><span class="o">,</span> <span class="n">configuration</span><span class="o">);</span> <span class="c1">// ëª¨ë“  URLì— ì •ì±… ì ìš©</span>
        <span class="k">return</span> <span class="n">source</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomFilterConfigurer</span> <span class="kd">extends</span> <span class="nc">AbstractHttpConfigurer</span><span class="o">&lt;</span><span class="nc">CustomFilterConfigurer</span><span class="o">,</span><span class="nc">HttpSecurity</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">builder</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
            <span class="nc">AuthenticationManager</span> <span class="n">authenticationManager</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">getSharedObject</span><span class="o">(</span><span class="nc">AuthenticationManager</span><span class="o">.</span><span class="na">class</span><span class="o">);</span> <span class="c1">// AuthenticationManager ê°ì²´ì–»ê¸°</span>

            <span class="nc">JwtAuthenticationFilter</span> <span class="n">jwtAuthenticationFilter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JwtAuthenticationFilter</span><span class="o">(</span><span class="n">authenticationManager</span><span class="o">,</span> <span class="n">jwtTokenizer</span><span class="o">);</span> <span class="c1">// JwtAuthenticationFilter ê°ì²´ë§Œë“¤ê¸° (ìƒì„±í•˜ë©´ì„œ DIí•˜ê¸°)</span>

            <span class="c1">// ìƒì†ë°›ì€ AbstractAuthenticationProcessingFilter í´ë˜ìŠ¤ì˜ FilterProcessesUrl ì„¤ì •í•´ì£¼ê¸° (ì„¤ì •ì•ˆí• ì‹œ default: /Login)</span>
            <span class="c1">// ì¦‰, ë¡œê·¸ì¸ ìš”ì²­í• ë•Œ ì´ Urlë¡œ ìš”ì²­í•´ì•¼í•¨, ìš°ë¦¬ê°€ ê¸°ì¡´ì— UsernamePassword í•„í„° ì‚¬ìš©ì‹œì—ëŠ” /process_login í•˜ë˜ë¶€ë¶„ì„</span>
            <span class="n">jwtAuthenticationFilter</span><span class="o">.</span><span class="na">setFilterProcessesUrl</span><span class="o">(</span><span class="s">"/v11/auth/login"</span><span class="o">);</span>
            <span class="c1">// Exception ì¶”ê°€</span>
            <span class="n">jwtAuthenticationFilter</span><span class="o">.</span><span class="na">setAuthenticationSuccessHandler</span><span class="o">(</span><span class="k">new</span> <span class="nc">MemberAuthenticationSuccessHandler</span><span class="o">());</span>
            <span class="n">jwtAuthenticationFilter</span><span class="o">.</span><span class="na">setAuthenticationFailureHandler</span><span class="o">(</span><span class="k">new</span> <span class="nc">MemberAuthenticationFailureHandler</span><span class="o">());</span>

            <span class="nc">JwtVerificationFilter</span> <span class="n">jwtVerificationFilter</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JwtVerificationFilter</span><span class="o">(</span><span class="n">jwtTokenizer</span><span class="o">,</span> <span class="n">authorityUtils</span><span class="o">);</span>

            <span class="c1">// Spring Security FilterChainì— ì¶”ê°€</span>
            <span class="n">builder</span><span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="n">jwtAuthenticationFilter</span><span class="o">)</span>  <span class="c1">// ìš°ë¦¬ê°€ë§Œë“  jwtAuthenticationFilter í•„í„°ì¶”ê°€</span>
                    <span class="o">.</span><span class="na">addFilterAfter</span><span class="o">(</span><span class="n">jwtVerificationFilter</span><span class="o">,</span> <span class="nc">JwtAuthenticationFilter</span><span class="o">.</span><span class="na">class</span><span class="o">);</span> <span class="c1">//  jwtVerificationFilter í•„í„°ì¶”ê°€, ë’¤ì— í´ë˜ìŠ¤ëŠ” ì–´ëŠí´ë˜ìŠ¤ ë‹¤ìŒì— ì‹¤í–‰í• ì§€ ì„¤ì •</span>

        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>ì´ì „ì— Spring Security ì„¤ì •ê³¼ í¬ê²Œ ë‹¬ë¼ì§„ ì ì€ 3ê°€ì§€ ì •ë„ ìˆë‹¤.</p>

<ol>
  <li>CORS ì •ì±…ì„ ì¶”ê°€</li>
  <li>ì„¸ì…˜ ì •ì±… ì¶”ê°€</li>
  <li>ìš°ë¦¬ê°€ ë§Œë“  Filter ì¶”ê°€</li>
  <li>ì˜ˆì™¸ì²˜ë¦¬ì— ëŒ€í•œ ê¸°ëŠ¥ ì¶”ê°€</li>
</ol>

<p>ì´ë ‡ê²Œ 3ê°€ì§€ì— ëŒ€í•œ ë‚´ìš©ì„ ì¶”ê°€ ì„¤ì •í•´ ì£¼ì—ˆë‹¤.
ìì„¸í•œ ë‚´ìš©ì€ ì½”ë“œì˜†ì— ì„¤ëª…ì„ ì ì–´ ë†“ì•˜ë‹¤.</p>

<p>ì—¬ê¸°ì„œ ì„¸ì…˜ì •ì±…ê´€ë ¨í•´ì„œëŠ” ì•„ê¹Œ <code class="language-plaintext highlighter-rouge">SecurityContext</code>ì— ê°ì²´ë¥¼ ì €ì¥í•˜ì§€ë§Œ<br />
STATELESSë¡œ ì„¤ì •í•˜ì—¬ ì„œë²„ì—ì„œ ê´€ë¦¬í•˜ì§€ ì•Šê²Œ ë˜ì–´ì§„ë‹¤.<br />
ì¦‰, ë¬´ìƒíƒœì„±ìœ¼ë¡œ ì„œë²„ì—ì„œ ê´€ë¦¬í•˜ì§€ ì•ŠëŠ” ê²ƒì´ë‹¤.</p>

<p>ë˜í•œ ì˜ˆì™¸ì²˜ë¦¬ë¥¼ ìœ„í•œ ìš°ë¦¬ê°€ êµ¬í˜„í•œ í´ë˜ìŠ¤ë“¤ë„ ì„¤ì •í•´ë†“ì•˜ê³ <br />
Cors ì •ì±…ê´€ë ¨í•´ì„œë„ Beanìœ¼ë¡œ ë“±ë¡í•´ ì¶”ê°€í•´ì£¼ì—ˆë‹¤.</p>

<p>ê·¸ë¦¬ê³  ë§ˆì§€ë§‰ìœ¼ë¡œ ì‚¬ìš©ìì— ë”°ë¥¸ í˜ì´ì§€ ê¶Œí•œì— ëŒ€í•œ <br />
<code class="language-plaintext highlighter-rouge">antMatchers();</code>ë¥¼ ì„¤ì •í•œ ë‹¤ìŒ ë§ˆë¬´ë¦¬ë¥¼ ì§€ì—ˆë‹¤.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Security filter chain: [
  DisableEncodeUrlFilter
  WebAsyncManagerIntegrationFilter
  SecurityContextPersistenceFilter
  HeaderWriterFilter
  CorsFilter
  LogoutFilter
  JwtAuthenticationFilter
  JwtVerificationFilter
  RequestCacheAwareFilter
  SecurityContextHolderAwareRequestFilter
  AnonymousAuthenticationFilter
  SessionManagementFilter
  ExceptionTranslationFilter
  AuthorizationFilter
]
</code></pre></div></div>
<p>ìµœì¢…ì ìœ¼ë¡œ ì™„ì„±ëœ SecurityFilterChain êµ¬ì„±ì€<br />
ë³´ì´ëŠ” ê²ƒê³¼ ê°™ì´ <code class="language-plaintext highlighter-rouge">CorsFilter</code> ì¶”ê°€ì™€<br />
<code class="language-plaintext highlighter-rouge">UsernamePasswordAuthenticationFilter</code>ê°€ ë¹„í™œì„±í™” ë˜ì—ˆê³ <br />
ìš°ë¦¬ê°€ ë§Œë“¤ì–´ì¤€ í•„í„° <code class="language-plaintext highlighter-rouge">JwtAuthenticationFilter</code>ì™€ <code class="language-plaintext highlighter-rouge">JwtVerificationFilter</code>ê°€<br />
ì¶”ê°€ëœ ëª¨ìŠµì„ ì½˜ì†”ë¡œ í™•ì¸ì´ ê°€ëŠ¥í•˜ë‹¤. (@EnableWebSecurity(debug = true))</p>

<p><br /></p>

<p>ì´ë ‡ê²Œ JWT ì„¤ì •ê´€ë ¨í•´ì„œ ì£¼ìš”í•˜ê²Œ ìš°ë¦¬ê°€ êµ¬í˜„í•´ì•¼í•˜ëŠ”<br />
í´ë˜ìŠ¤ë¥¼ ì„¤ëª…í–ˆê³  êµ¬í˜„í•œ ì½”ë“œë„ ì ì–´ë³´ì•˜ë‹¤.</p>

<p>êµ¬í˜„í–ˆë˜ í´ë˜ìŠ¤ ì¤‘ ê°€ì¥ ì¤‘ìš”í•œ í´ë˜ìŠ¤ë§Œ ì •ë¦¬ë¥¼ í•´ë‘ì—ˆê³ <br />
í•´ë‹¹ í´ë˜ìŠ¤ë¥¼ êµ¬í˜„í•˜ê¸°ìœ„í•´ ë³´ì¡°ë¡œ í•„ìš”í•œ ì˜ˆì™¸ì²˜ë¦¬ í´ë˜ìŠ¤ë¼ë“ ê°€ ë“±ë“±..ì€<br />
ë”°ë¡œ ì½”ë“œë¥¼ ì˜¬ë¦¬ì§„ ì•Šì•˜ë‹¤ëŠ” ì ì€ ì°¸ê³ í•´ì£¼ì‹¤ ë°”ë€ë‹¤.</p>

<p><br /></p>

<h3 id="jwt-ì˜ˆì™¸ê´€ë ¨">JWT ì˜ˆì™¸ê´€ë ¨</h3>

<p>ì •ìƒì ì¸ JWTë¥¼ í•˜ë‚˜ ë§Œë“¤ì—ˆë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gM7CWzAFQjn80N1hvvM9SUK3D93K7v6MKWNbJ73maG_WsDGVAWRlzCA7i2-X3BqaLP0fLkeuY3__aTBsAL3k4TzG2hqqQ=w3024-h1728" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>í•´ë‹¹ JWTë¥¼ ê°€ì§€ê³  ê°’ì„ ë³€ê²½í•´ë³´ë©´ì„œ<br />
ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ì•˜ë‹¤.</p>

<p><br /></p>

<p><strong>1). ExpiredJwtException ì˜ˆì™¸</strong></p>

<p>JWTë¥¼ ìƒì„±í•  ë•Œ ì§€ì •í•œ ìœ íš¨ê¸°ê°„ì´ ì´ˆê³¼í• ë•Œ ë°œìƒí•˜ëŠ” ì˜ˆì™¸ë‹¤</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>io.jsonwebtoken.ExpiredJwtException: JWT expired at 2022-11-24T07:28:32Z. Current time: 2022-11-24T07:31:05Z, a difference of 153263 milliseconds.  Allowed clock skew: 0 milliseconds.
</code></pre></div></div>

<p>ë¡œê·¸ì¸ ìš”ì²­ì„ í• ë•Œ, ìš°ë¦¬ëŠ” JWT í† í°ì„ Headerì— ë‹´ì•„ì„œ ë³´ë‚´ì¤€ë‹¤.<br />
í† í°ì„ ë§Œë“¤ë•ŒëŠ” ë§Œë£Œì‹œê°„ì„ ì„¤ì •í•˜ëŠ”ë°<br />
ì„¤ì •í•œ ë§Œë£Œì‹œê°„ì´ ì§€ë‚¬ëŠ”ë° ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼ìš”ì²­ì„ ë³´ë‚´ë©´ gí•´ë‹¹ ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤.</p>

<p><br /></p>

<p><strong>2). MalformedJwtException ì˜ˆì™¸</strong></p>

<p>JWTê°€ ì˜¬ë°”ë¥´ê²Œ êµ¬ì„±ë˜ì§€ ì•Šì•˜ì„ë•Œ ë°œìƒí•˜ëŠ” ì˜ˆì™¸ì´ë‹¤.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>io.jsonwebtoken.MalformedJwtException: Malformed JWT JSON: 
</code></pre></div></div>
<p>ì‹¤ì œë¡œ êµ¬ì„±ì„ ë°”ê¿¨ì„ë•Œ ì˜ˆì™¸ê°€ ë°œìƒí–ˆë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gPQhIjSnqeeREeIFdpD_a2vMw-E6r_7tu74DY46aqKGtvdcc9GP-PTkbfKyKeUIqpUJJpGuPmCFdHGTJ8wPGEh_A-FrXg=w3024-h1728" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>ìœ„ì˜ ì‚¬ì§„ì²˜ëŸ¼ Headerì˜ ë§¨ì•ë¶€ë¶„ì„ ë³€ê²½í–ˆë”ë‹ˆ<br />
ë””ì½”ë”©ì´ ë˜ì§€ ì•Šì•„ í˜•ì‹ì„ í™•ì¸í•  ìˆ˜ ì—†ëŠ” ë¬¸ì œê°€ ìƒê²¼ë‹¤.</p>

<p>ì‹¤ì œë¡œ JWT í™ˆí˜ì´ì§€ì—ì„œ ì‚¬ì§„ì²˜ëŸ¼ ë””ì½”ë”©ì„ í•´ë³´ë©´<br />
ì¸ì½”ë”©ìª½ì— í˜•ì‹ì´ ë§ì§€ì•Šì•„ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ í‘œì‹œê°€ ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.</p>

<p><br /></p>

<p><strong>3). SignatureException ì˜ˆì™¸</strong></p>

<p>JWTì˜ ê¸°ì¡´ ì„œëª…ì„ í™•ì¸í•˜ì§€ ëª»í–ˆì„ ë•Œ ìƒê¸°ëŠ” ì˜ˆì™¸ì´ë‹¤.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>io.jsonwebtoken.security.SignatureException: Unsupported signature algorithm 'H{256'
</code></pre></div></div>
<p>ì‹¤ì œë¡œ ì„œëª…ì„ í™•ì¸í•˜ì§€ ëª»í• ê²½ìš° ìœ„ì™€ ê°™ì´<br />
Exceptionì´ ë°œìƒí•œë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gM-B56_cW6Bvc86vXPTHrYxah_eJccUX-5yCNznSlZds4Ad2wCQ5-06B79zGh14djTNIyyEsiGiZofmUGLsX4T-oiVj=w3024-h1728" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>ì •ìƒ JWTì—ì„œ Header ë¶€ë¶„ì„ ë³€ê²½í•´ ì˜ˆì™¸ë¥¼ í„°íŠ¸ë ¤ë³´ì•˜ë‹¤.<br />
í˜•ì‹ì´ ê¹¨ì§€ì§€ ì•ŠëŠ” ì„ ì—ì„œ ì„œëª…ì´ í™•ì¸ë˜ì§€ ì•Šìœ¼ë©´<br />
ë°œìƒí•˜ëŠ” ì˜ˆì™¸ì¸ ê²ƒ ê°™ë‹¤.</p>

<p>ì‚¬ì§„ì—ì„œ ë³¼ ìˆ˜ ìˆëŠ” ê²ƒì²˜ëŸ¼ Headerì˜ <code class="language-plaintext highlighter-rouge">'alg' : "H{256"</code>ìœ¼ë¡œ<br />
í˜•ì‹ì€ ê¹¨ì§€ì§€ ì•Šì•˜ìœ¼ë‚˜, Headerì— ì´ìƒí•œ ê°’ì´ ë“¤ì–´ê°€<br />
ì„œëª…ì„ í™•ì¸í•˜ì§€ ëª»í•˜ëŠ” ê²½ìš°ê°€ ë°œìƒí•œ ê²ƒì´ë‹¤.</p>

<p><br /></p>

<hr />
<p>ì´ë ‡ê²Œ ì˜¤ëŠ˜ì€ JWTë¥¼ í†µí•´ ì¸ì¦ê¹Œì§€ í•´ë³´ëŠ” ì‘ì—…ì„ í•´ë³´ì•˜ë‹¤.<br />
ì‚¬ì‹¤ì€ ë‚´ê°€ ì •ë¦¬í•˜ë©´ì„œ ë§ê²Œ ì ëŠ”ì§€ ì—„ì²­ ì½”ë“œë¥¼ ë°˜ë³µì ìœ¼ë¡œ í™•ì¸í•˜ë©´ì„œ<br />
ê¸€ì„ ì¨ë‚´ë ¤ê°”ë‹¤. ì¡°ê¸ˆ ëœ ì •ë¦¬ëœ ë¶€ë¶„ì´ ë§ì•„ì„œ ì•„ì‰½ì§€ë§Œ<br />
ë‚˜ë¦„ ë‚´ê°€ ì½”ë“œë¥¼ ë¶„ì„í•˜ê³  ì •ë¦¬ë¥¼ í•´ë³´ë‹ˆ ì–´ëŠì •ë„ ê°ì€ ì¡íŒ ê²ƒ ê°™ë‹¤.</p>

<p>ì˜¤ëŠ˜ê¹Œì§€í•´ì„œ JWTì— ëŒ€í•œ ë‚´ìš©ì€ ëë‚¬ê³ <br />
ì‹¤ì œë¡œ ë‚´ê°€ ì–´ë“œë°´ìŠ¤í•œ ë‚´ìš©ì„ êµ¬í˜„í•˜ê³  ì‹¶ë‹¤ë©´<br />
ì¸ì¦ì²˜ë¦¬ íë¦„ë§Œ ìµíê²Œ ì•„ë‹ˆë¼ ë‚´ë¶€ì˜ ì½”ë“œë“¤ì´ ì–´ë–»ê²Œ êµ¬í˜„ë˜ìˆëŠ”ì§€<br />
ì™„ë²½í•˜ê²Œ ì´í•´í•˜ê³  ìˆì–´ì•¼ ì–´ë“œë°´ìŠ¤í•œ êµ¬í˜„ì´ ê°€ëŠ¥í•  ë“¯ ì‹¶ë‹¤.</p>

<p>ì˜¤ëŠ˜ê¹Œì§€ ê³µë¶€í•˜ë©´ì„œ ë§ì€ ì†Œë“ì´ ìˆì—ˆê³ <br />
í° ê·¸ë¦¼ì„ ë°°ì› ê³ , ì„¸ë¶€ì ì¸ ë‚´ìš©ë„ ì–´ëŠì •ë„ ëœ¯ì–´ë³´ë‹ˆ<br />
ì½”ë“œì— ëŒ€í•œ ìì‹ ê°ì´ ì¡°ê¸ˆ ë” ìƒê¸´ ì£¼ì˜€ë˜ ê²ƒ ê°™ë‹¤.</p>

<p>ì˜¤ëŠ˜ ê³µë¶€ëŠ” ì—¬ê¸°ì„œ ë!!</p>

<p><br /></p>

<p><span style="color:#994C00"><strong>ì˜¤ëŠ˜ì˜ ì»¤í”¼ëŸ‰</strong></span>: â˜•ï¸ â˜•ï¸<br />
<strong>ì˜¤ëŠ˜ì˜ ì ì‹¬</strong>: ë¼ë©´, ë°¥</p>]]></content><author><name>LEE JAEHYEOK</name></author><category term="TIL" /><category term="TIL" /><category term="ë¶€íŠ¸ìº í”„" /><category term="ì½”ë“œìŠ¤í…Œì´ì¸ " /><summary type="html"><![CDATA[ë‚ ì”¨ê°€ ë§ì´ ìŒ€ìŒ€í•´ì¡Œë‹¤.]]></summary></entry><entry><title type="html">TIL) JWT ê¸°ì´ˆ</title><link href="http://localhost:4000/til/2022/11/23/til.html" rel="alternate" type="text/html" title="TIL) JWT ê¸°ì´ˆ" /><published>2022-11-23T00:00:00+09:00</published><updated>2022-11-23T00:00:00+09:00</updated><id>http://localhost:4000/til/2022/11/23/til</id><content type="html" xml:base="http://localhost:4000/til/2022/11/23/til.html"><![CDATA[<p>í™•ì‹¤íˆ Spring ê´€ë ¨ëœ ê¸°ìˆ ì„ ì‚¬ìš©í•˜ë©´ì„œ<br />
í”„ë¡œê·¸ë˜ë°ì„ í•˜ê³  ìˆë‹¤ëŠ” ëŠë‚Œì´ ë“¤ë•Œê°€ ë§ì•„ì„œ ì¢‹ë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gMWwuYanwzEYSBU97J-DZR9DkAcwyTyZwvas0jVZbla4RaJ-_F28bKYzcWQqOh3iqItCBSFVIUY6GDFl9qgi16AsH2POw=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>ì‚¬ìš©í•˜ë ¤ëŠ” í”„ë ˆì„ì›Œí¬ë‚˜ ê¸°ìˆ ì— ëŒ€í•œ<br />
ì•„í‚¤í…ì²˜ êµ¬ì¡°ë¥¼ íŒŒì•…í•˜ê³ , ì‹¤ì œ ì–´ë–»ê²Œ í˜¸ì¶œê³¼ ì‘ë‹µì´ ì´ë£¨ì–´ì§€ëŠ”ì§€<br />
í™•ì¸í•˜ëŠ” ê³¼ì •ì´ ìˆœíƒ„ì¹˜ëŠ” ì•Šì§€ë§Œâ€¦ ì¡°ê¸ˆì”© ëˆˆì— ë“¤ì–´ì˜¤ë‹ˆ<br />
í™•ì‹¤íˆ ì¬ë¯¸ì˜ ê°€ì†ë„ê°€ ë¶™ëŠ” ê²ƒ ê°™ë‹¤.</p>

<hr />

<p>3ì¼ ë™ì•ˆ Spring Securityì— ëŒ€í•œ ë‚´ìš©ì„ ì–¼ì¶” ë§ˆë¬´ë¦¬í–ˆë‹¤.<br />
ì˜¤ëŠ˜ì€ JWTì— ëŒ€í•œ ë‚´ìš©ì„ ê³µë¶€í•˜ëŠ” ì‹œê°„ì´ê³ <br />
JWTë¥¼ ì‚¬ìš©í•´ ì–´ë–»ê²Œ Spring Securityì™€ ì—°ê²°ì„ ì§€ì–´ê°€ëŠ”ì§€<br />
2ì¼ì— ê±¸ì³ ê³µë¶€í•´ë³¼ë ¤ê³  í•œë‹¤.</p>

<h2 id="jwt-ê¸°ì´ˆ">JWT ê¸°ì´ˆ</h2>

<h3 id="jwtë€">JWTë€?</h3>
<p>Json Web Tokenì˜ ì•½ìë¡œ<br />
Json í¬ë§·ìœ¼ë¡œ ì‚¬ìš©ìì— ëŒ€í•œ ì†ì„±ì„ ì €ì¥í•˜ëŠ” ì›¹ í† í°ì´ë‹¤.</p>

<p>ê¸°ì¡´ì—ëŠ” ì„¸ì…˜ê¸°ë°˜ ì¸ì¦ìœ¼ë¡œ ì„œë²„ì— ìœ ì €ì •ë³´ë¥¼ ë‹´ëŠ” ë°©ì‹ìœ¼ë¡œ ì¸ì¦ì„ ì§„í–‰í–ˆì—ˆëŠ”ë°<br />
ì´ë ‡ê²Œ ë˜ë©´ ë§¤ë²ˆ ìš”ì²­ì„í• ë•Œë§ˆë‹¤ DBë¥¼ ì‚´í´ë³´ì•„ì•¼í•˜ê¸° ë•Œë¬¸ì—<br />
ì´ëŸ¬í•œ ë¶€ë‹´ì„ ì¤„ì´ê¸° ìœ„í•´ í† í°ê¸°ë°˜ ì¸ì¦ì´ ë‚˜ì™”ë‹¤.</p>

<p>í† í°ì€ ìœ ì € ì •ë³´ë¥¼ ì•”í˜¸í™”í•œ ìƒíƒœë¡œ ë‹´ì„ ìˆ˜ ìˆê³ <br />
ì•”í˜¸í™”í–ˆê¸° ë•Œë¬¸ì— í´ë¼ì´ì–¸íŠ¸ì— ë‹´ì„ ìˆ˜ ìˆë‹¤.</p>

<p>í† í°ê¸°ë°˜ ì¸ì¦ì˜ ì¥ì ?</p>
<ol>
  <li>ë¬´ìƒíƒœì„±, í™•ì¥ì„±<br />
-&gt; ì„œë²„ëŠ” í´ë¼ì´ì–¸íŠ¸ì— ëŒ€í•œ ì •ë³´ë¥¼ ì €ì¥í•  í•„ìš”ê°€ ì—†ë‹¤.<br />
-&gt; í† í°ì„ í—¤ë”ì— ì¶”ê°€í•¨ìœ¼ë¡œ ì¸ì¦ì ˆì°¨ ì™„ë£Œ</li>
  <li>ì•ˆì •ì„±<br />
-&gt; ì•”í˜¸í™” í•œ í† í°ì„ ì‚¬ìš©</li>
  <li>ì–´ë””ì„œë‚˜ ìƒì„± ê°€ëŠ¥<br />
-&gt; í† í°ì„ ìƒì„±í•˜ëŠ” ì„œë²„ê°€ ê¼­ í† í°ì„ ë§Œë“¤ì§€ ì•Šì•„ë„ë¨</li>
  <li>ê¶Œí•œ ë¶€ì—¬ì— ìš©ì´ <br />
-&gt; í† í°ì˜ payload ì•ˆì— ì–´ë–¤ ì •ë³´ì— ì ‘ê·¼ì´ ê°€ëŠ¥í•œì§€ ì •ì˜</li>
</ol>

<p><br /></p>

<h3 id="jwt-ì¢…ë¥˜">JWT ì¢…ë¥˜</h3>

<p>JWTëŠ” <code class="language-plaintext highlighter-rouge">Access Token</code>, <code class="language-plaintext highlighter-rouge">Refresh Token</code><br />
ì´ ë‘ê°€ì§€ ì¢…ë¥˜ì˜ í† í°ì„ ì‚¬ìš©ìì˜ ìê²© ì¦ëª…ì— ì´ìš©í•œë‹¤.</p>

<p><strong><span style="color:#0066CC">Access Token</span></strong> : ë³´í˜¸ëœ ì •ë³´ë“¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ë¶€ì—¬í• ë•Œ ì‚¬ìš©<br />
<strong><span style="color:#0066CC">Refresh Token</span></strong> : Access Tokenì˜ ìœ íš¨ê¸°ê°„ì´ ë§Œë£Œë˜ë©´ Refresh Tokenì„ ì´ìš©í•´<br />
ìƒˆë¡œìš´ Access Tokenì„ ë°œê¸‰ ë°›ëŠ”ë‹¤. (ë‹¤ì‹œ ë¡œê·¸ì¸ ì¸ì¦í•  í•„ìš” X)</p>

<p>Access Tokenì´ íƒˆì·¨ë‹¹í–ˆì„ ê²½ìš° <br />
íƒˆì·¨í•œ ì‚¬ëŒì´ í•´ë‹¹ ì‚¬ìš©ìì¸ ê²ƒ ì²˜ëŸ¼ ì„œë²„ì— ì—¬ëŸ¬ê°€ì§€ ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆë‹¤.<br />
ê·¸ë ‡ê¸° ë•Œë¬¸ì— íƒˆì·¨ë‹¹í•˜ë”ë¼ë„ ì˜¤ë«ë™ì•ˆ ì‚¬ìš©í•  ìˆ˜ ì—†ë„ë¡<br />
Refresh Tokenì„ ì‚¬ìš©í•´ Access Tokenì„ ìƒˆë¡œ ë°œê¸‰ì„ ë°›ëŠ”ë‹¤.</p>

<p>ë§Œì•½ Refresh Tokenê¹Œì§€ íƒˆì·¨ë¥¼ ë‹¹í–ˆì„ ê²½ìš°<br />
íƒˆì·¨í•œ ì‚¬ëŒì´ í•´ë‹¹ ì‚¬ìš©ìì— í° í•´ë¥¼ ì…í ìˆ˜ ìˆë‹¤.<br />
ê·¸ë ‡ê¸° ë•Œë¬¸ì— ë¡œê·¸ì¸ ì¸ì¦ì„ ë‹¤ì‹œí•  í•„ìš”ì—†ëŠ” í¸ì˜ ê°™ì€ ê¸°ëŠ¥ë³´ë‹¤<br />
ì •ë³´ë¥¼ ì§€í‚¤ëŠ” ê²ƒì´ ë” ì¤‘ìš”í•œ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ Refresh Tokenì„<br />
ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê³³ì´ ë§ë‹¤ê³  í•œë‹¤.<br />
(ì¦‰, Access Token ìœ íš¨ê¸°ê°„ì´ ë§Œë£Œë˜ë©´ ì¬ì¸ì¦ì„ í•´ì•¼í•¨)</p>

<p><br /></p>

<h3 id="jwt-êµ¬ì¡°">JWT êµ¬ì¡°</h3>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOYuUIX6V7l7AAL_dwuJ4c8dxSmCnlrTXPYPA2gYVV4MM1qyH7K_aGFmXu_Jkx_GYNgHI1jDmR8sJ09gf0bW7f1U9su=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /><br />
<a href="https://catsbi.oopy.io/26b7f35c-e323-4e75-a9ee-2fe3e57ac641">ì¶œì²˜ - Catsbië‹˜ blog</a></p>

<p>JWTëŠ” Header.Payload.Signature êµ¬ì¡°ë¡œ ì´ë£¨ì–´ì§„ë‹¤.</p>

<p><strong>1). Header</strong><br />
   -&gt; ì–´ë–¤ ì¢…ë¥˜ì˜ í† í°ì¸ì§€  <br />
   -&gt; ì–´ë–¤ ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ì•”í˜¸í™” í•˜ëŠ”ì§€<br />
   -&gt; Headerì˜ JSON ê°ì²´ë¥¼ base64 ë°©ì‹ìœ¼ë¡œ ì¸ì½”ë”©í•œë‹¤.</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"alg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"HS256"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"typ"</span><span class="p">:</span><span class="w"> </span><span class="s2">"JWT"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<p><strong>2). Payload</strong><br />
   -&gt; ìœ ì €ì˜ ì •ë³´ (ì‚¬ìš©ìì˜ ì´ë¦„ ë“±)  <br />
   -&gt; ë¯¼ê°í•œ ì •ë³´ëŠ” ë‹´ì§€ ì•ŠëŠ” ê²ƒì´ ì¢‹ë‹¤.<br />
   -&gt; ê¸°íƒ€ í•„ìš”í•œ ì •ë³´<br />
   -&gt; Payloadì˜ JSON ê°ì²´ë¥¼ base64 ë°©ì‹ìœ¼ë¡œ ì¸ì½”ë”©í•œë‹¤.</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"sub"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Information"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"LeeJaehyeok"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"iat"</span><span class="p">:</span><span class="w"> </span><span class="mi">151623391</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><br /></p>

<p><strong>3). Signature</strong><br />
   -&gt; Header, Payloadë¥¼ base64 ì¸ì½”ë”©í•œ ê°’ê³¼ saltê°’ì˜ ì¡°í•©ìœ¼ë¡œ ì•”í˜¸í™”ëœ ê°’<br />
   -&gt; ë‹¨ë°©í–¥ ì•”í˜¸í™”ë¥¼ ìˆ˜í–‰í•œë‹¤.<br />
   -&gt; ì´ë ‡ê²Œ ì•”í˜¸í™”ëœ ë©”ì„¸ì§€ëŠ” í† í°ì˜ ìœ„ë³€ì¡° ìœ ë¬´ë¥¼ ê²€ì¦í•˜ëŠ”ë° ì‚¬ìš©í•œë‹¤.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HMACSHA256(base64UrlEncode(header) + '.' + base64UrlEncode(payload), secret);
</code></pre></div></div>

<p><br /></p>

<h3 id="ì„¸ì…˜ê¸°ë°˜-ìê²©ì¦ëª…-vs-í† í°ê¸°ë°˜-ìê²©-ì¦ëª…">ì„¸ì…˜ê¸°ë°˜ ìê²©ì¦ëª… vs í† í°ê¸°ë°˜ ìê²© ì¦ëª…</h3>

<p>âœ… ì„¸ì…˜ê¸°ë°˜ ìê²© ì¦ëª…</p>
<ul>
  <li>ì¸ì¦ëœ ì‚¬ìš©ì ì •ë³´ë¥¼ ì„œë²„ ì¸¡ ì„¸ì…˜ ì €ì¥ì†Œì—ì„œ ê´€ë¦¬í•œë‹¤.</li>
  <li>ìƒì„±ëœ ì‚¬ìš©ì ì„¸ì…˜ì˜ ê³ ìœ  IDì¸ ì„¸ì…˜ IDëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ ì¿ í‚¤ì— ì €ì¥ëœë‹¤.  <br />
request ì „ì†¡ ì‹œ, ì¸ì¦ëœ ì‚¬ìš©ìì¸ì§€ë¥¼ ì¦ëª…í•˜ëŠ” ìˆ˜ë‹¨ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤.</li>
  <li>ì„¸ì…˜ IDë§Œ í´ë¼ì´ì–¸íŠ¸ ìª½ì—ì„œ ì‚¬ìš©í•´ ìƒëŒ€ì ìœ¼ë¡œ ë„¤íŠ¸ì›Œí¬ íŠ¸ë™í”½ì„ ì ê²Œ ì‚¬ìš©í•œë‹¤.</li>
  <li>ì„œë²„ ì¸¡ì—ì„œ ì„¸ì…˜ ì •ë³´ë¥¼ ê´€ë¦¬í•˜ë¯€ë¡œ ë³´ì•ˆì„± ì¸¡ë©´ì—ì„œ ìœ ë¦¬í•˜ë‹¤.</li>
  <li>ì„œë²„ì˜ í™•ì¥ì„± ë©´ì—ì„œëŠ” ì„¸ì…˜ ë¶ˆì¼ì¹˜ ë¬¸ì œê°€ ë°œìƒí•  ê°€ëŠ¥ì„±ì´ ë†’ë‹¤.</li>
  <li>ì„¸ì…˜ ë°ì´í„°ê°€ ë§ì•„ì§ˆìˆ˜ë¡ ì„œë²„ìœ¼ ë¶€ë‹´ì´ ê°€ì¤‘ëœë‹¤.</li>
  <li>SSR ë°•ì‹ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì í•©í•œ ë°©ì‹ì´ë‹¤.</li>
</ul>

<p><br /></p>

<p>âœ… í† í°ê¸°ë°˜ ìê²© ì¦ëª…ì˜ íŠ¹ì§•</p>
<ul>
  <li>ì¸ì¦ëœ ì‚¬ìš©ì ì •ë¸ŒëŠ” ì„œë²„ ì¸¡ì—ì„œ ë³„ë„ì˜ ê´€ë¦¬ë¥¼ í•˜ì§€ ì•ŠëŠ”ë‹¤.</li>
  <li>ìƒì„±ëœ í† í°ì„ Headerì— í¬í•¨ì‹œí‚¨ë‹¤. request ì „ìŠ¹ ì‹œ, ì¸ì¦ëœ ì‚¬ìš©ìì¸ì§€ ì¦ëª…í•˜ëŠ” ìˆ˜ë‹¨ìœ¼ë¡œ ì‚¬ìš©ëœë‹¤.</li>
  <li>í† í°ë‚´ì— ì¸ì¦ëœ ì‚¬ìš©ì ì •ë³´ ë“±ì„ í¬í•¨í•˜ê³  ìˆì–´ ì„¸ì…˜ì— ë¹„í•´ ìƒëŒ€ì ìœ¼ë¡œ ë§ì€ ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ì„ ì‚¬ìš©í•œë‹¤.</li>
  <li>ì„œë²„ ì¸¡ì—ì„œ í† í°ì„ ê´€ë¦¬í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë³´ì•ˆì„± ì¸¡ë©´ì—ì„œ ì¡°ê¸ˆ ë” ë¶ˆë¦¬í•˜ë‹¤.</li>
  <li>ì¸ì¦ëœ ì‚¬ìš©ì requestì˜ ìƒíƒœë¥¼ ìœ ì§€í•  í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì— ì„œë²„ì˜ í™•ì¥ì„±ë©´ì—ì„œ ìœ ë¦¬í•˜ê³ <br />
ì„¸ì…˜ ë¶ˆì¼ì¹˜ ê°™ì€ ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.</li>
  <li>í† í°ì— í¬í•¨ë˜ëŠ” ì‚¬ìš©ì ì •ë³´ëŠ” í† í°ì˜ íŠ¹ì„±ìƒ ì•”í˜¸í™”ê°€ ë˜ì§€ ì•Šê¸°ë•Œë¬¸ì— ê³µê²©ìì—ê²Œ í† í°ì´ íƒˆì·¨ë  ê²½ìš°<br />
ì‚¬ìš©ì ì •ë³´ë¥¼ ê·¸ëŒ€ë¡œ ì œê³µí•˜ëŠ”ì…ˆì´ ë˜ë¯€ë¡œ ë¯¼ê°í•œ ì •ë³´ëŠ” í† í°ì— í¬í•¨ì‹œí‚¤ì§€ ë§ì•„ì•¼í•œë‹¤.</li>
  <li>ê¸°ë³¸ì ìœ¼ë¡œ í† í°ì´ ë§Œë£Œë˜ê¸° ì „ê¹Œì§€ëŠ” í† í°ì„ ëª¨íš¨í™” ì‹œí‚¬ ìˆ˜ ì—†ë‹¤.</li>
  <li>CSR ë°©ì‹ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì í•©í•œ ë°©ì‹ì´ë‹¤.</li>
</ul>

<h3 id="í† í°ê¸°ë°˜-ì¸ì¦ì ˆì°¨">í† í°ê¸°ë°˜ ì¸ì¦ì ˆì°¨</h3>

<p>ì•„ë˜ì˜ ì‚¬ì§„ì€ í† í°ê¸°ë°˜ ì¸ì¦ì ˆì°¨ì— ëŒ€í•œ í° íë¦„ì´ë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOIQ-igIsxJcmvSaYg6jxG6SeXQZlDrwTmzkQCd2vE2Dy4zpZG_Z_nTqJvBkFwsDBxcZYFe5xKIx86lhvRNC5h92NGU=w1299-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<ol>
  <li>í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë¡œê·¸ì¸ ìš”ì²­ì„ ë³´ëƒ…ë‹ˆë‹¤.</li>
  <li>ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ê³ , í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë³´ë‚¼ ì•”í˜¸í™”ëœ í† í°ì„ ìƒì„±í•©ë‹ˆë‹¤.</li>
  <li>í† í°ì„ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ì†¡í•˜ë©´, í´ë¼ì´ì–¸íŠ¸ëŠ” í† í°ì„ ì €ì¥í•©ë‹ˆë‹¤.<br />
-&gt; ì €ì¥í•˜ëŠ” ìœ„ì¹˜ëŠ” Local Storage, Session Storage, Cookie ë“±ì´ ë  ìˆ˜ ìˆë‹¤.</li>
  <li>í´ë¼ë¦¬ì–¸íŠ¸ê°€ Headers ë˜ëŠ” ì¿ í‚¤ì— í† í°ì„ ë‹´ì•„ ì–´ë– í•œ ìš”ì²­ì„ í•©ë‹ˆë‹¤.</li>
  <li>ì„œë²„ì—ì„œ í† í°ì„ ê²€ì¦í•´ ì„œë²„ì—ì„œ ë°œê¸‰í•œ í† í°ì´ ë§ì„ ê²½ìš°, í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ì²˜ë¦¬í•œ í›„ ì‘ë‹µì„ ë³´ë‚¸ë‹¤.</li>
</ol>

<p><br /></p>

<h3 id="jwt-í† í°-ë§Œë“¤ì–´ë³´ê¸°">JWT í† í° ë§Œë“¤ì–´ë³´ê¸°</h3>

<p>Spring Securityì™€ JWTë¥¼ ê°™ì´ ì‚¬ìš©í•´ë³´ê¸°ì „ì— ë¨¼ì € <br />
JWT í† í°ì„ ë§Œë“œëŠ” ë°©ë²•ì„ ì½”ë“œë¡œ ì‘ì„±í•´ë³´ì</p>

<p><strong>1). ì˜ì¡´ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//jwt ì˜ì¡´ ë¼ì´ë¸ŒëŸ¬ë¦¬</span>
<span class="n">implementation</span> <span class="err">'</span><span class="n">io</span><span class="o">.</span><span class="na">jsonwebtoken</span><span class="o">:</span><span class="n">jjwt</span><span class="o">-</span><span class="nl">api:</span><span class="mf">0.11</span><span class="o">.</span><span class="mi">5</span><span class="err">'</span>
<span class="n">runtimeOnly</span> <span class="err">'</span><span class="n">io</span><span class="o">.</span><span class="na">jsonwebtoken</span><span class="o">:</span><span class="n">jjwt</span><span class="o">-</span><span class="nl">impl:</span><span class="mf">0.11</span><span class="o">.</span><span class="mi">5</span><span class="err">'</span>
<span class="n">runtimeOnly</span>	<span class="err">'</span><span class="n">io</span><span class="o">.</span><span class="na">jsonwebtoken</span><span class="o">:</span><span class="n">jjwt</span><span class="o">-</span><span class="nl">jackson:</span><span class="mf">0.11</span><span class="o">.</span><span class="mi">5</span><span class="err">'</span>
</code></pre></div></div>
<p>ìš°ì„  build.gradleì— jjwt ì˜ì¡´ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í•´ì¤€ë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gMK5rCr5B2LRfcaM0vHK_8HL-XpmBLw8J4-SmsT_ZLhCAPgxjzuWPKRWep1z0eOw7WsW7Res6as9NvHmBdxJe1STWkt5A=w3024-h1728" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>ì¶”ê°€ëœ ëª¨ìŠµì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<p><br /></p>

<p><strong>2). AccessToken ë§Œë“¤ê¸°</strong><br />
JWT í† í°ì„ ìƒì„œí•´ì£¼ëŠ” í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ë³´ì.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JwtTokenizer</span> <span class="o">{</span>
    
   <span class="kd">public</span> <span class="nc">String</span> <span class="nf">encodeBase64SecretKey</span><span class="o">(</span><span class="nc">String</span> <span class="n">secretKey</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">String</span> <span class="n">encode</span> <span class="o">=</span> <span class="nc">Encoders</span><span class="o">.</span><span class="na">BASE64</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">secretKey</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="nc">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">));</span>
      <span class="k">return</span> <span class="n">encode</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="kd">public</span> <span class="nc">String</span> <span class="nf">generateAccessToken</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">claims</span><span class="o">,</span> <span class="nc">String</span> <span class="n">subject</span><span class="o">,</span> <span class="nc">Date</span> <span class="n">expiration</span><span class="o">,</span> <span class="nc">String</span> <span class="n">base64EncodedSecretKey</span><span class="o">)</span> <span class="o">{</span>

      <span class="nc">Key</span> <span class="n">key</span> <span class="o">=</span> <span class="n">getKeyFormBase64EncodedKey</span><span class="o">(</span><span class="n">base64EncodedSecretKey</span><span class="o">);</span>

      <span class="k">return</span> <span class="nc">Jwts</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
              <span class="o">.</span><span class="na">setClaims</span><span class="o">(</span><span class="n">claims</span><span class="o">)</span> <span class="c1">// Custom Claimsë¥¼ ì¶”ê°€ (ì¸ì¦ëœ ì‚¬ìš©ìì™€ ê´€ë ¨ëœ ì •ë³´)</span>
              <span class="o">.</span><span class="na">setSubject</span><span class="o">(</span><span class="n">subject</span><span class="o">)</span> <span class="c1">// JWTì— ëŒ€í•œ ì œëª©ì„ ì¶”ê°€</span>
              <span class="o">.</span><span class="na">setIssuedAt</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getTime</span><span class="o">())</span> <span class="c1">// JWT ë°œí–‰ ì¼ì ì„¤ì •</span>
              <span class="o">.</span><span class="na">setExpiration</span><span class="o">(</span><span class="n">expiration</span><span class="o">)</span> <span class="c1">// JWT ë§Œë£Œì¼ì ì„¤ì •</span>
              <span class="o">.</span><span class="na">signWith</span><span class="o">(</span><span class="n">key</span><span class="o">)</span> <span class="c1">// ì„œëª…ì„ ìœ„í•œ Key ê°ì²´ë¥¼ ë„£ì–´ì¤€ë‹¤.</span>
              <span class="o">.</span><span class="na">compact</span><span class="o">();</span> <span class="c1">// JWTë¥¼ ìƒì„±í•˜ê³  ì§ë ¬í™”í•´ì¤Œ</span>
   <span class="o">}</span>
   
   <span class="o">...</span> <span class="n">ìƒëµ</span>
   
   <span class="kd">private</span> <span class="nc">Key</span> <span class="nf">getKeyFormBase64EncodedKey</span><span class="o">(</span><span class="nc">String</span> <span class="n">base64EncodedSecretKey</span><span class="o">){</span>
      <span class="kt">byte</span><span class="o">[]</span> <span class="n">keyBytes</span> <span class="o">=</span> <span class="nc">Decoders</span><span class="o">.</span><span class="na">BASE64</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">base64EncodedSecretKey</span><span class="o">);</span> <span class="c1">// ë””ì½”ë”© ì§„í–‰</span>
      <span class="nc">Key</span> <span class="n">key</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Key</span><span class="o">)</span> <span class="nc">Keys</span><span class="o">.</span><span class="na">hmacShaKeyFor</span><span class="o">(</span><span class="n">keyBytes</span><span class="o">);</span> <span class="c1">// HMAC ì•Œê³ ë¦¬ì¦˜ì„ ì ìš©í•œ Key ê°ì²´ ìƒì„±</span>
      <span class="k">return</span> <span class="n">key</span><span class="o">;</span>
   <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>1). <code class="language-plaintext highlighter-rouge">encodeBase64SecretKey();</code> ë©”ì„œë“œ<br />
í•´ë‹¹ ë©”ì„œë“œ ë¶€í„° ì‚´í´ë³´ë©´, String íƒ€ì…ì˜ ê°ì²´ secretKeyë¼ëŠ” ê²ƒì„<br />
ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ê³ ìˆë‹¤. ë°›ì€ ë§¤ê°œë³€ìˆ˜ëŠ” Base64 ì¸ì½”ë”©ì„ í†µí•´ ë‚˜ì˜¨ ê°ì²´ë¥¼ ë‹¤ì‹œ ë¦¬í„´í•´ì¤€ë‹¤.<br />
ì¦‰, secretKeyë¥¼ ì¸ì½”ë”©í•´ì£¼ëŠ” ë©”ì„œë“œì´ë‹¤.</p>

<p>2). <code class="language-plaintext highlighter-rouge">generateAccessToken();</code> ë©”ì„œë“œ<br />
AccessTokenì„ ë§Œë“¤ì–´ì£¼ëŠ” ë©”ì„œë“œì´ë‹¤.<br />
ìš°ì„  ë§¤ê°œë³€ìˆ˜ë¡œ ë°›ëŠ” ê°ì²´ëŠ” ì´ 4ê°œê°€ ëœë‹¤.</p>

<p>Map&lt;String, Object&gt; claims<br />
String subject<br />
Date expiration <br />
String base64EncodedSecretKey</p>

<p>claims ê°ì²´ëŠ” ì‚¬ìš©ìì˜ ê´€ë ¨ëœ ì •ë³´ê°€ Mapì— ë‹´ê²¨ìˆë‹¤.<br />
subject ê°ì²´ëŠ” í•´ë‹¹ í† í°ì˜ ì œëª©ì´ë‹¤.<br />
expriation ê°ì²´ ê°™ì€ ê²½ìš°ì—ëŠ” í† í°ì˜ ë§Œë£Œ ì‹œê°„ì„ ì„¤ì •í•œë‹¤.<br />
base64EncodedSecretKey ê°ì²´ëŠ” <code class="language-plaintext highlighter-rouge">1)ë²ˆ</code>ì—ì„œ ì¸ì½”ë”©í•œ ê°ì²´ë¥¼ ë„£ì–´ì£¼ë©´ëœë‹¤.</p>

<p>3). <code class="language-plaintext highlighter-rouge">getKeyFormBase64EncodedKey();</code> ë©”ì„œë“œ<br />
ì¸ì½”ë”©ìœ¼ë¡œ ë°›ì€ ê°ì²´ë¥¼ ë‹¤ì‹œ ë””ì½”ë”©í•´ì£¼ëŠ” ë©”ì„œë“œì´ë‹¤.<br />
HMAC_SHA ì•Œê³ ë¦¬ì¦˜ì„ ì ìš©í•´ Keyê°ì²´ë¡œ ë§Œë“¤ì–´ ë¦¬í„´í•´ì¤€ë‹¤.<br />
í•´ë‹¹ í‚¤ëŠ” <code class="language-plaintext highlighter-rouge">2)ë²ˆ</code>ì—ì„œ Access Tokenì„ ë§Œë“¤ëŒ€ ì‚¬ìš©ëœë‹¤.</p>

<p><br /></p>

<p>ì´ë ‡ê²Œ ìš°ì„  AccessTokenì„ ë§Œë“¤ì–´ì£¼ëŠ” ë©”ì„œë“œë¥¼ êµ¬í˜„í–ˆë‹¤.<br />
í•´ë‹¹ ë©”ì„œë“œë¥¼ í…ŒìŠ¤íŠ¸ì½”ë“œë¥¼ ë§Œë“¤ì–´ ê²€ì¦í•´ë³´ì.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@TestInstance</span><span class="o">(</span><span class="nc">TestInstance</span><span class="o">.</span><span class="na">Lifecycle</span><span class="o">.</span><span class="na">PER_CLASS</span><span class="o">)</span> <span class="c1">// í…ŒìŠ¤íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±ë‹¨ìœ„ê°€ í´ë˜ìŠ¤ì„</span>
<span class="kd">class</span> <span class="nc">JwtTokenizerTest</span> <span class="o">{</span>
   <span class="kd">private</span> <span class="kd">static</span> <span class="nc">JwtTokenizer</span> <span class="n">jwtTokenizer</span><span class="o">;</span>
   <span class="kd">private</span> <span class="nc">String</span> <span class="n">secretKey</span><span class="o">;</span>
   <span class="kd">private</span> <span class="nc">String</span> <span class="n">base64EncodedSecretKey</span><span class="o">;</span>

   <span class="nd">@BeforeAll</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="o">{</span>
      <span class="n">jwtTokenizer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JwtTokenizer</span><span class="o">();</span>
      <span class="n">secretKey</span> <span class="o">=</span> <span class="s">"LeeJaehyeok637637123231231231123"</span><span class="o">;</span> <span class="c1">// ë””ì½”ë”©ê°’: TGVlSmFlaHllb2s2Mzc2MzcxMjMyMzEyMzEyMzExMg==</span>
      <span class="n">base64EncodedSecretKey</span> <span class="o">=</span> <span class="n">jwtTokenizer</span><span class="o">.</span><span class="na">encodeBase64SecretKey</span><span class="o">(</span><span class="n">secretKey</span><span class="o">);</span>
   <span class="o">}</span>
   
   <span class="nd">@Test</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">encode64SecretKeyTest</span><span class="o">()</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">base64EncodedSecretKey</span><span class="o">);</span>
      <span class="n">assertThat</span><span class="o">(</span><span class="n">secretKey</span><span class="o">,</span> <span class="n">is</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="nc">Decoders</span><span class="o">.</span><span class="na">BASE64</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">base64EncodedSecretKey</span><span class="o">))));</span>
   <span class="o">}</span>

   <span class="nd">@Test</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">generateAccessTokenTest</span><span class="o">(){</span>
      <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">claims</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
      <span class="n">claims</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"memberId"</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
      <span class="n">claims</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"roles"</span><span class="o">,</span> <span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"USER"</span><span class="o">));</span>

      <span class="nc">String</span> <span class="n">subject</span> <span class="o">=</span> <span class="s">"test access token"</span><span class="o">;</span>
      <span class="nc">Calendar</span> <span class="n">calendar</span> <span class="o">=</span> <span class="nc">Calendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
      <span class="n">calendar</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">MINUTE</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span>
      <span class="nc">Date</span> <span class="n">expiration</span> <span class="o">=</span> <span class="n">calendar</span><span class="o">.</span><span class="na">getTime</span><span class="o">();</span>

      <span class="nc">String</span> <span class="n">accessToken</span> <span class="o">=</span> <span class="n">jwtTokenizer</span><span class="o">.</span><span class="na">generateAccessToken</span><span class="o">(</span><span class="n">claims</span><span class="o">,</span> <span class="n">subject</span><span class="o">,</span> <span class="n">expiration</span><span class="o">,</span> <span class="n">base64EncodedSecretKey</span><span class="o">);</span>

      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">accessToken</span><span class="o">);</span>

      <span class="n">assertThat</span><span class="o">(</span><span class="n">accessToken</span><span class="o">,</span> <span class="n">notNullValue</span><span class="o">());</span>
   <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>ìœ„ì™€ ê°™ì´ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.</p>

<p>í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰ì „ secretKeyê°’ì„ ë„£ì–´ë†“ê³  ì¸ì½”ë”©í•œ ê°’ì„<br />
base64EncodedSecretKey ê°ì²´ì— ë„£ì–´ë‘ì—ˆë‹¤.</p>

<p>ì²«ë²ˆì¨° í…ŒìŠ¤íŠ¸ <code class="language-plaintext highlighter-rouge">encode64SecretKeyTest();</code> ë©”ì„œë“œëŠ”<br />
í˜„ì¬ ì¸ì½”ë”©ëœê°’ì„ ë‹¤ì‹œ ë””ì½”ë”©í•´ secretKeyê°’ê³¼ ë¹„êµí•´<br />
ê°™ìœ¼ë©´ í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í•˜ëŠ” ì½”ë“œì´ë‹¤.</p>

<p>ë‘ë²ˆì§¸ í…ŒìŠ¤íŠ¸ <code class="language-plaintext highlighter-rouge">generateAccessTokenTest();</code> ë©”ì„œë“œëŠ”<br />
ì‹¤ì œë¡œ AccessTokenì„ ë§Œë“¤ì–´ë³´ëŠ” í…ŒìŠ¤íŠ¸ì´ê³ <br />
ìœ„ì—ì„œ ë³´ì•˜ë˜ <code class="language-plaintext highlighter-rouge">generateAccessToken()</code>;ì˜ ë§¤ê°œë³€ìˆ˜ì—<br />
í•´ë‹¹í•˜ëŠ” ë°ì´í„°ë¥¼ ë§Œë“¤ì–´ì„œ ë©”ì„œë“œ ì‹¤í–‰í•œë‹¤ìŒ ë°˜í™˜ê°’ì„ ë°›ìœ¼ë©´ëœë‹¤.</p>

<p>ì‹¤ì œ í•´ë‹¹ ë°˜í™˜ëœ í† í° accessTokenë¥¼ ì¶œë ¥í•´ë³´ë©´<br />
<code class="language-plaintext highlighter-rouge">eyJhbGciOiJIUzI1NiJ9.eyJyb2xlcyI6WyJVU0VSIl0sIm1lbWJlcklkIjoxLCJzdWIi
OiJ0ZXN0IGFjY2VzcyB0b2tlbiIsImlhdCI6MTY2OTE5MjY0OSwiZXhwIjoxNjY5MTkzMj
Q5fQ.yt_Y741NrTH5l7wsk3oYhbBqkZKgy7GNtJxsI-XuIQg</code></p>

<p>ì´ëŸ¬í•œ JWT í† í°ì´ ë§Œë“¤ì–´ì§€ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆê³ <br />
ìœ„ì—ì„œ ê³µë¶€í–ˆë˜ ê²ƒ ì²˜ëŸ¼ Header, Payload, Signatureë¡œ ì´ë£¨ì–´ì§„ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.</p>

<p>í•´ë‹¹ í† í°ì„ <a href="https://jwt.io/">JWT ì‚¬ì´íŠ¸</a>ì—ì„œ ë””ì½”ë”© í•´ë³´ë©´</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gO_wCj1b91B1IxTjBKbJBSMY_NTzz2HQ5SjXSIlqonhF-Rw9nXUkcUqJWXnZ585EHK7u8dGAODelmV8U6Fl_DM4kVbpCg=w3024-h1728" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>ìš°ë¦¬ê°€ ì •ì˜í–ˆë˜ ê°’ìœ¼ë¡œ í•´ë…ì´ ê°€ëŠ¥í•œ ëª¨ìŠµì„<br />
í™•ì¸í•´ë³¼ ìˆ˜ ìˆë‹¤.</p>

<p><br /></p>

<p><strong>3). RefreshToken ë§Œë“¤ê¸°</strong><br />
RefreshTokenì„ ë§Œë“œëŠ” ë°©ë²•ì€ ì‚¬ì‹¤ AccessTokenê³¼<br />
ë™ì¼í•œ ë°©ë²•ìœ¼ë¡œ ë§Œë“¤ë©´ëœë‹¤. ë‹¤ë§Œ ì°¨ì´ì ì€ claimsì— ëŒ€í•œ ë‚´ìš©ë§Œ<br />
ë¹ ì§„ ìƒíƒœë¡œ ë§Œë“¤ë©´ ëœë‹¤.</p>

<p>ì•„ê¹Œì™€ ë™ì¼í•œ í´ë˜ìŠ¤ JwtTokenizerì—ë‹¤ ë©”ì„œë“œë¥¼ ì¶”ê°€í•´ë³´ì</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JwtTokenizer</span> <span class="o">{</span>
    
   <span class="o">...</span> <span class="n">ìƒëµ</span>

   <span class="kd">public</span> <span class="nc">String</span> <span class="nf">generateRefreshToken</span><span class="o">(</span><span class="nc">String</span> <span class="n">subject</span><span class="o">,</span> <span class="nc">Date</span> <span class="n">expiration</span><span class="o">,</span> <span class="nc">String</span> <span class="n">base64EncodedSecretKey</span><span class="o">){</span>
      <span class="nc">Key</span> <span class="n">key</span> <span class="o">=</span> <span class="n">getKeyFormBase64EncodedKey</span><span class="o">(</span><span class="n">base64EncodedSecretKey</span><span class="o">);</span>

      <span class="k">return</span> <span class="nc">Jwts</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
              <span class="o">.</span><span class="na">setSubject</span><span class="o">(</span><span class="n">subject</span><span class="o">)</span> <span class="c1">// JWTì— ëŒ€í•œ ì œëª©ì„ ì¶”ê°€</span>
              <span class="o">.</span><span class="na">setIssuedAt</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getTime</span><span class="o">())</span> <span class="c1">// JWT ë°œí–‰ ì¼ì ì„¤ì •</span>
              <span class="o">.</span><span class="na">setExpiration</span><span class="o">(</span><span class="n">expiration</span><span class="o">)</span> <span class="c1">// JWT ë§Œë£Œì¼ì ì„¤ì •</span>
              <span class="o">.</span><span class="na">signWith</span><span class="o">(</span><span class="n">key</span><span class="o">)</span> <span class="c1">// ì„œëª…ì„ ìœ„í•œ Key ê°ì²´ë¥¼ ë„£ì–´ì¤€ë‹¤.</span>
              <span class="o">.</span><span class="na">compact</span><span class="o">();</span> <span class="c1">// JWTë¥¼ ìƒì„±í•˜ê³  ì§ë ¬í™”í•´ì¤Œ</span>
   <span class="o">}</span>
   
   <span class="o">...</span> <span class="n">ìƒëµ</span>
   
<span class="o">}</span>
</code></pre></div></div>
<p>AcessTokenê³¼ ë‹¤ë¥¸ì ì€ ì–˜ê¸°í–ˆë“¯ì´<br />
clamisì— ëŒ€í•œ ë‚´ìš©ë§Œ ë¹ ì§„ ìƒíƒœë¡œ Tokenì„ ë§Œë“¤ì–´ì£¼ë©´ëœë‹¤.</p>

<p><br /></p>

<h3 id="ì˜¤ëŠ˜-ë§Œë‚œ-error">ì˜¤ëŠ˜ ë§Œë‚œ ERROR</h3>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The specified key byte array is 248 bits which is not secure enough for any JWT HMAC-SHA algorithm.  The JWT JWA Specification (RFC 7518, Section 3.2) states that keys used with HMAC-SHA algorithms MUST have a size &gt;= 256 bits (the key size must be greater than or equal to the hash output size).  Consider using the io.jsonwebtoken.security.Keys#secretKeyFor(SignatureAlgorithm) method to create a key guaranteed to be secure enough for your preferred HMAC-SHA algorithm.  See https://tools.ietf.org/html/rfc7518#section-3.2 for more information.
io.jsonwebtoken.security.WeakKeyException: The specified key byte array is 136 bits which is not secure enough for any JWT HMAC-SHA algorithm.  The JWT JWA Specification (RFC 7518, Section 3.2) states that keys used with HMAC-SHA algorithms MUST have a size &gt;= 256 bits (the key size must be greater than or equal to the hash output size).  Consider using the io.jsonwebtoken.security.Keys#secretKeyFor(SignatureAlgorithm) method to create a key guaranteed to be secure enough for your preferred HMAC-SHA algorithm.  See https://tools.ietf.org/html/rfc7518#section-3.2 for more information.
</code></pre></div></div>

<p>HMAC_SHA ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš© ì¤‘ ë°œìƒí–ˆë˜ ì—ëŸ¬ë¥¼ ì ì–´ë³¸ë‹¤.<br />
ì•ŒëŒ ë°œìƒ ê²½ìœ„ëŠ” ìœ„ì— ì—ëŸ¬ ì½˜ì†”ì—ì„œ<br />
<code class="language-plaintext highlighter-rouge">HMAC-SHA algorithms MUST have a size &gt;= 256 bits</code>ë¥¼ ë³´ê³  ì•Œ ìˆ˜ ìˆë‹¤.<br />
SecretKeyê°’ì´ 256 bitsê°€ ë„˜ì§€ ì•Šì•„ì„œ ë°œìƒí•œ ë¬¸ì œë¡œ ì¶”ì²­ë˜ì–´</p>

<p>í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•´ë´¤ë‹¤.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">public</span> <span class="nc">String</span> <span class="nf">encodeBase64SecretKey</span><span class="o">(</span><span class="nc">String</span> <span class="n">secretKey</span><span class="o">){</span>
     <span class="nc">String</span> <span class="n">encode</span> <span class="o">=</span> <span class="nc">Encoders</span><span class="o">.</span><span class="na">BASE64</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">secretKey</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(</span><span class="nc">StandardCharsets</span><span class="o">.</span><span class="na">UTF_8</span><span class="o">));</span>
     <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"encodeBase64SecretKey Method ì‹¤í–‰ { "</span> <span class="o">+</span><span class="s">"secretKEY = "</span><span class="o">+</span> <span class="n">secretKey</span> <span class="o">+</span> <span class="s">" secretKEY.Byte = "</span><span class="o">+</span> <span class="n">secretKey</span><span class="o">.</span><span class="na">getBytes</span><span class="o">().</span><span class="na">length</span> <span class="o">+</span> <span class="s">" Base64 Encode = "</span> <span class="o">+</span> <span class="n">encode</span><span class="o">+</span><span class="s">" }"</span><span class="o">);</span>
     <span class="k">return</span> <span class="n">encode</span><span class="o">;</span>
 <span class="o">}</span>
</code></pre></div></div>
<p>í˜„ì¬ ë§¤ê°œë³€ìˆ˜ë¡œ String secretKeyë¥¼ BASE64ë¡œ ì¸ì½”ë”© í•´ì£¼ëŠ” ì‘ì—…ì´ë‹¤.<br />
secretKey = â€œLeeJaehyeok63763712323123123112â€;<br />
ì‹¤ì œë¡œ ì´ëŸ¬í•œ ë°ì´í„°ë¥¼ secretKeyë¡œ ì…ë ¥í–ˆë‹¤.</p>

<p>í•´ë‹¹ encode ê°ì²´ë¡œ ì•„ë˜ì˜ ë©”ì„œë“œì˜ ë§¤ê°œë³€ìˆ˜ë¡œ ë³´ë‚´ì£¼ì—ˆë‹¤.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">private</span> <span class="nc">Key</span> <span class="nf">getKeyFormBase64EncodedKey</span><span class="o">(</span><span class="nc">String</span> <span class="n">base64EncodedSecretKey</span><span class="o">){</span>
     <span class="kt">byte</span><span class="o">[]</span> <span class="n">keyBytes</span> <span class="o">=</span> <span class="nc">Decoders</span><span class="o">.</span><span class="na">BASE64</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">base64EncodedSecretKey</span><span class="o">);</span> <span class="c1">// ë””ì½”ë”© ì§„í–‰</span>
     <span class="nc">Key</span> <span class="n">key</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Key</span><span class="o">)</span> <span class="nc">Keys</span><span class="o">.</span><span class="na">hmacShaKeyFor</span><span class="o">(</span><span class="n">keyBytes</span><span class="o">);</span> <span class="c1">// HMAC ì•Œê³ ë¦¬ì¦˜ì„ ì ìš©í•œ Key ê°ì²´ ìƒì„±</span>
     <span class="k">return</span> <span class="n">key</span><span class="o">;</span>
 <span class="o">}</span>
</code></pre></div></div>
<p>ì²«ë²ˆì§¸ë¡œ ì¸ì½”ë”©í–ˆë˜ ë¬¸ìì—´ì„ ë””ì½”ë”©í•´ì£¼ê³ <br />
HMAC_SHA ì•Œê³ ë¦¬ì¦˜ì„ í†µí•´ Keyê°’ìœ¼ë¡œ ë°”ê¾¸ëŠ” ì‘ì—…ì„ í–ˆë‹¤.<br />
ì´ë–„ ì—¬ê¸°ì„œ ì—ëŸ¬ê°€ ë°œìƒí–ˆë˜ ì§€ì ì´ì—ˆë‹¤.</p>

<p><code class="language-plaintext highlighter-rouge">.hmacShaKeyFor();</code> ì•ˆì—ì„œ ìŠ¤í™ê³¼ ë§ì§€ì•ŠëŠ” ë””ì½”ë“œê°’ì„ <br />
ë„£ì–´ì¤€ê²Œ ë¬¸ì œì¸ ê²ƒ ê°™ë‹¤.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">private</span> <span class="nc">Key</span> <span class="nf">getKeyFormBase64EncodedKey</span><span class="o">(</span><span class="nc">String</span> <span class="n">base64EncodedSecretKey</span><span class="o">){</span>
     <span class="kt">byte</span><span class="o">[]</span> <span class="n">keyBytes</span> <span class="o">=</span> <span class="nc">Decoders</span><span class="o">.</span><span class="na">BASE64</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">base64EncodedSecretKey</span><span class="o">);</span> <span class="c1">// ë””ì½”ë”© ì§„í–‰</span>
        
     <span class="c1">// ===========Test ì„ì‹œ ì½”ë“œ===========</span>
     <span class="nc">String</span> <span class="n">test</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
     <span class="k">for</span> <span class="o">(</span><span class="kt">byte</span> <span class="n">s</span> <span class="o">:</span> <span class="n">keyBytes</span><span class="o">){</span>
        <span class="n">test</span> <span class="o">+=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span><span class="n">s</span><span class="o">;</span>
     <span class="o">}</span>
     <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">test</span><span class="o">);</span>
     <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">keyBytes</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
     <span class="c1">// ==================================</span>
     
     <span class="nc">Key</span> <span class="n">key</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Key</span><span class="o">)</span> <span class="nc">Keys</span><span class="o">.</span><span class="na">hmacShaKeyFor</span><span class="o">(</span><span class="n">keyBytes</span><span class="o">);</span> <span class="c1">// HMAC ì•Œê³ ë¦¬ì¦˜ì„ ì ìš©í•œ Key ê°ì²´ ìƒì„±</span>
     <span class="k">return</span> <span class="n">key</span><span class="o">;</span>
 <span class="o">}</span>
</code></pre></div></div>
<p>ì‹¤ì œë¡œ ë””ì½”ë”©í–ˆì„ë•Œ ìš°ë¦¬ê°€ ë„£ì–´ì¤¬ë˜</p>

<p><code class="language-plaintext highlighter-rouge">System.out.println(test);</code><br />
LeeJaehyeok63763712323123123112 ê°’ì´ ë””ì½”ë”©ëœê²ƒì´ ì½˜ì†”ì— ì¶œë ¥ë˜ì—ˆê³ </p>

<p><code class="language-plaintext highlighter-rouge">System.out.println(keyBytes.length);</code><br />
31 ì´ë¼ëŠ” ê°’ì´ ì¶œë ¥ë˜ì—ˆë‹¤. ë§ì€ ì¦‰ìŠ¨ 31Byteë¼ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.</p>

<p>ê·¸ëŸ¬ë©´ ìš°ë¦¬ê°€ ì²˜ìŒì— ë„£ì–´ì¤¬ë˜ secretKeyëŠ” 31 Bytesì˜€ê³ <br />
Bitë¡œ í™˜ì‚°í•´ë³´ë©´ 1Byte = 8 Bitë¡œ ê³„ì‚°ë˜ì–´ì§€ë‹ˆ<br />
<code class="language-plaintext highlighter-rouge">8 * 31 = 248</code>, ì¦‰ 248bitsë¡œ ê³„ì‚°ë˜ì–´ì§„ë‹¤.</p>

<p>ê·¸ëŸ¬ë©´ ìš°ë¦¬ê°€ ì²˜ìŒì— ë´¤ë˜ ì—ëŸ¬ì½˜ì†” ì²«ì¤„ì—<br />
<code class="language-plaintext highlighter-rouge">The specified key byte array is 248 bits which is not secure enough for any JWT HMAC-SHA algorithm.</code> ì´ëŸ¬í•œ êµ¬ë¬¸ì´ ìˆì—ˆê³ , ìš°ë¦¬ê°€ ì •ì˜í•œ byteê°€ 248 bitsì´ë‹ˆê¹Œ<br />
<code class="language-plaintext highlighter-rouge">size &gt;= 256 bits</code>ë¥¼ ë„˜ê¸°ê²Œ ë§Œë“¤ë¼ëŠ” ëœ»ìœ¼ë¡œ í•´ì„í•  ìˆ˜ ìˆë‹¤.</p>

<p>ì¦‰, secretKeyì˜ String Byteê°’ì„ ì§€ì •í–ˆì„ë•Œ<br />
<code class="language-plaintext highlighter-rouge">32 Bytes = 256 Bits</code>ê°€ ë„˜ì§€ ì•Šì•„ì„œ ìƒê¸°ëŠ” ë¬¸ì œì˜€ë˜ ê²ƒ!</p>

<p>ê·¸ë˜ì„œ secretKeyê°’ì„ LeeJaehyeok637637123231231231123ë¡œ<br />
ë’¤ì— ìˆ«ìí•˜ë‚˜ë¥¼ ì¶”ê°€í–ˆë”ë‹ˆ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ëŠ” ëª¨ìŠµì„ ë³¼ ìˆ˜ ìˆì—ˆë‹¤.</p>

<p><br /></p>

<hr />

<p>ì´ë ‡ê²Œ ì˜¤ëŠ˜ì€ JWTì™€ ì¸ì¦ê³¼ ê´€ë ¨ëœ ê¸°ì´ˆì§€ì‹ì„<br />
ë¨¼ì € ë°°ì› ê³ , ë‚´ì¼ë¶€í„°ëŠ” Spring Securityì™€ ê°™ì´ ì‚¬ìš©í•´ë³¼ ê²ƒ ê°™ë‹¤.</p>

<p>ì‚¬ì‹¤ ì˜¤ëŠ˜ì€ í† í°ì„ ìƒì„±í•˜ëŠ” ë²•ë§Œ ë°°ì› ê³  ë” ë‚˜ì•„ê°„ í•™ìŠµì„
ì§„í–‰í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— í´ë¼ì´ì—”íŠ¸ì— ì–´ë–»ê²Œ ë³´ë‚´ì¤„ì§€<br />
í˜¹ì‹œ ìš”ì²­ì„ ë°›ì„ë•Œ JWTë¥¼ í•´ë…í•´ ê²€ì¦í•˜ëŠ” ê³¼ì •ì„ ì–´ë–»ê²Œí• ì§€<br />
ì•„ì§ ë¨¸ë¦¬ì†ì—ì„œ ë§ˆë•…í•œ ê·¸ë¦¼ì€ ë– ì˜¤ë¥´ì§€ ì•ŠëŠ” ìƒíƒœì´ë‹¤.</p>

<p>ëª¨ìª¼ë¡ ë‚´ì¼ê¹Œì§€ JWT ì¸ì¦ê³¼ ê´€ë ¨ëœ ë¶€ë¶„ì„ ì˜ ë§ˆë¬´ë¦¬ í•´ë³´ì<br />
ì˜¤ëŠ˜ ê³µë¶€ëŠ” ì—¬ê¸°ì„œ ë !!</p>

<p><br /></p>

<p><span style="color:#994C00"><strong>ì˜¤ëŠ˜ì˜ ì»¤í”¼ëŸ‰</strong></span>: â˜•ï¸ â˜•ï¸<br />
<strong>ì˜¤ëŠ˜ì˜ ì ì‹¬</strong>: ì‚½ê²¹ì‚´, ë¼ë©´, ë°¥</p>]]></content><author><name>LEE JAEHYEOK</name></author><category term="TIL" /><category term="TIL" /><category term="ë¶€íŠ¸ìº í”„" /><category term="ì½”ë“œìŠ¤í…Œì´ì¸ " /><summary type="html"><![CDATA[í™•ì‹¤íˆ Spring ê´€ë ¨ëœ ê¸°ìˆ ì„ ì‚¬ìš©í•˜ë©´ì„œ í”„ë¡œê·¸ë˜ë°ì„ í•˜ê³  ìˆë‹¤ëŠ” ëŠë‚Œì´ ë“¤ë•Œê°€ ë§ì•„ì„œ ì¢‹ë‹¤.]]></summary></entry><entry><title type="html">TIL) Spring Security 3 (ê¶Œí•œë¶€ì—¬)</title><link href="http://localhost:4000/til/2022/11/22/til.html" rel="alternate" type="text/html" title="TIL) Spring Security 3 (ê¶Œí•œë¶€ì—¬)" /><published>2022-11-22T00:00:00+09:00</published><updated>2022-11-22T00:00:00+09:00</updated><id>http://localhost:4000/til/2022/11/22/til</id><content type="html" xml:base="http://localhost:4000/til/2022/11/22/til.html"><![CDATA[<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gO-9XVEAUETJGFf5AjYCUCurD1z-9yBYl4hAKS_SdfBOSr5ac7uSAlI8PoCiXakOadLKWhnBi-RnF5XAFfKoh4ynbCMmQ=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>ì–´ì œ ê³µë¶€í–ˆë˜ Spring Security ì¸ì¦ì²˜ë¦¬ ê³¼ì •ì—ì„œëŒ€í•´<br />
ì½”ë“œë¥¼ ì°¾ì•„ê°€ë³´ë©´ì„œ ì–´ëŠì •ë„ ê¹¨ë‹¬ìŒì´ ìˆì–´ì„œ<br />
ì§„ì „ì´ ìˆëŠ” ëŠë‚Œì´ ë“¤ì–´ ì˜¤ëœë§Œì— í¸ì•ˆí•œ ë§ˆìŒìœ¼ë¡œ ê³µë¶€ë¥¼ í–ˆë‹¤.</p>

<p>ì˜¤ëŠ˜ì€ Spring Security ê¶Œí•œê´€ë ¨ Filterë¥¼ ê³µë¶€í•˜ëŠ” ë‚ ì´ê³ <br />
ì„¹ì…˜ ì¤‘ Spring SecurityëŠ” ë§ˆì§€ë§‰ì¸ ì‹œê°„ì´ë‹¤.</p>

<hr />

<p>ì–´ì œ <a href="https://mycatlikeschuru.github.io/til/2022/11/21/til.html">(Spring Security ì¸ì¦ì²˜ë¦¬)</a>ì— ëŒ€í•œ ë‚´ìš©ì„<br />
ì½”ë“œì™€ ì•„ì¼€í…ì³ë¥¼ í†µí•´ ì­‰ ì‚´í´ë³´ì•˜ë‹¤.</p>

<p>ì˜¤ëŠ˜ì€ ê¶Œí•œê³¼ ê´€ë ¨ëœ Filterì¸<br />
<code class="language-plaintext highlighter-rouge">AuthorizationFilter</code> í´ë˜ìŠ¤ì— ëŒ€í•œ ê¶Œí•œ ë¶€ì—¬ì˜<br />
ê°„ë‹¨í•œ ì²˜ë¦¬ íë¦„ê³¼ ì½”ë“œë¥¼ ì‚´í´ë³´ë ¤ê³ í•œë‹¤.</p>

<p><br /></p>

<h2 id="spring-security-ê¶Œí•œë¶€ì—¬">Spring Security ê¶Œí•œë¶€ì—¬</h2>

<p>ì–´ì œëŠ” ì¸ì¦ì²˜ë¦¬ì— ê´€ë ¨ëœ ë‚´ìš©ì„ ë°°ì› ë‹¤.<br />
ì¸ì¦ì´ë€ ì´ ì‚¬ì´íŠ¸ë¥¼ ì´ìš©í•  ìˆ˜ ìˆëŠ” ìœ ì €ì¸ì§€ í™•ì¸í•˜ëŠ” ê³¼ì •ì´ë‹¤.<br />
í•˜ì§€ë§Œ ê¶Œí•œë¶€ì—¬ëŠ” ë­˜ê¹Œ?</p>

<p>ì¸ì¦ëœ ì‚¬ìš©ìê°€ ëª¨ë“  ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼ì„ ì œí•œí•˜ëŠ” ê²ƒì„ ë§í•œë‹¤. <br />
í—¤ë”© ì‚¬ìš©ìê°€ ì´ìš©í•  ìˆ˜ ìˆëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ ì œí•œí•˜ê±°ë‚˜ í’€ì–´ì£¼ëŠ” ê²ƒì„<br />
ê¶Œí•œ ë¶€ì—¬ë¼ê³  í•œë‹¤.</p>

<p><br /></p>

<h3 id="ê¶Œí•œë¶€ì—¬-ì²˜ë¦¬íë¦„">ê¶Œí•œë¶€ì—¬ ì²˜ë¦¬íë¦„</h3>

<p><strong>AuthorizationFilter</strong></p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOQXGNO9jp7S5n8BR1acug8wbYP2K5CODLz3E8JL1OYltFHyEMNavYMMn7otGOC4UHR5N_85NhELKDMT5Cm9oKCeMjE=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>Spring Securityì—ì„œëŠ” ê¶Œí•œ ë¶€ì—¬ë¥¼ ìœ„í•´<br />
<code class="language-plaintext highlighter-rouge">AuthorizationFilter</code> í´ë˜ìŠ¤ë¥¼ ì´ìš©í•´ ì²˜ë¦¬ë¥¼ í•œë‹¤.</p>

<p>SecurityFilterChainì„ êµ¬ì„±í•˜ëŠ” Filter ì¤‘ í•˜ë‚˜ë¡œ<br />
ì¸ì¦ Filterë¥¼ ê±°ì¹œ í›„ ì§„í–‰í•˜ê²Œ ë˜ì–´ì§„ë‹¤.<br />
ë³¸ê²©ì ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">AuthorizationFilter</code>ì˜ ê¶Œí•œì²˜ë¦¬ íë¦„ì„ ì•Œì•„ë³´ì</p>

<p><br /></p>

<p>(1). <code class="language-plaintext highlighter-rouge">SecurityContextHolder</code>ë¡œ ë¶€í„° <code class="language-plaintext highlighter-rouge">Authentication</code> ê°ì±„ë¥¼ ê°€ì ¸ì˜¨ë‹¤.<br />
<a href="https://mycatlikeschuru.github.io/til/2022/11/21/til.html">(Spring Security ì¸ì¦ì²˜ë¦¬)</a> ê³¼ì •ì—ì„œ ì¸ì¦ì´ ì™„ë£Œëœ ê°ì²´ <code class="language-plaintext highlighter-rouge">Authentication</code>ë¥¼ <br />
<code class="language-plaintext highlighter-rouge">SecurityContextHolder</code>ì— ë„£ì–´ì¤¬ë˜ íë¦„ì´ ì¸ì¦ì²˜ë¦¬ì˜ ë§ˆì§€ë§‰ì´ì–´ì—ˆë‹¤.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AuthorizationFilter</span> <span class="kd">extends</span> <span class="nc">OncePerRequestFilter</span> <span class="o">{</span>
    
    <span class="o">...</span> <span class="n">ì´ìƒ</span> <span class="n">ìƒëµ</span>
    
    <span class="kd">private</span> <span class="nc">Authentication</span> <span class="nf">getAuthentication</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">Authentication</span> <span class="n">authentication</span> <span class="o">=</span> <span class="nc">SecurityContextHolder</span><span class="o">.</span><span class="na">getContext</span><span class="o">().</span><span class="na">getAuthentication</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">authentication</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">AuthenticationCredentialsNotFoundException</span><span class="o">(</span>
                    <span class="s">"An Authentication object was not found in the SecurityContext"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">authentication</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="o">...</span> <span class="n">ì´í•˜</span> <span class="n">ìƒëµ</span>
            
<span class="o">}</span>
</code></pre></div></div>
<p>ì‹¤ì œë¡œ <code class="language-plaintext highlighter-rouge">AuthorizationFilter</code> í´ë˜ìŠ¤ ì½”ë“œ ì¤‘ <code class="language-plaintext highlighter-rouge">getAuthentication();</code> ë©”ì„œë“œë¥¼ ì´ìš©í•´  <br />
<code class="language-plaintext highlighter-rouge">Authentication</code> ê°ì²´ë¥¼ êº¼ë‚´ëŠ” ëª¨ìŠµì„ ì½”ë“œë¡œ ë³¼ ìˆ˜ ìˆë‹¤.</p>

<p><br /></p>

<p>(2). <code class="language-plaintext highlighter-rouge">Authentication</code> ê°ì²´ì™€ <code class="language-plaintext highlighter-rouge">HttpServletRequest</code> ê°ì²´ë¥¼<br />
<code class="language-plaintext highlighter-rouge">AuthorizationManager</code>ì—ê²Œ ì „ë‹¬í•œë‹¤.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AuthorizationFilter</span> <span class="kd">extends</span> <span class="nc">OncePerRequestFilter</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">AuthorizationManager</span><span class="o">&lt;</span><span class="nc">HttpServletRequest</span><span class="o">&gt;</span> <span class="n">authorizationManager</span><span class="o">;</span>
     
    <span class="o">...</span> <span class="n">ìƒëµ</span>
    
    <span class="kd">public</span> <span class="nf">AuthorizationFilter</span><span class="o">(</span><span class="nc">AuthorizationManager</span><span class="o">&lt;</span><span class="nc">HttpServletRequest</span><span class="o">&gt;</span> <span class="n">authorizationManager</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Assert</span><span class="o">.</span><span class="na">notNull</span><span class="o">(</span><span class="n">authorizationManager</span><span class="o">,</span> <span class="s">"authorizationManager cannot be null"</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">authorizationManager</span> <span class="o">=</span> <span class="n">authorizationManager</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doFilterInternal</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">FilterChain</span> <span class="n">filterChain</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>

        <span class="nc">AuthorizationDecision</span> <span class="n">decision</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">authorizationManager</span><span class="o">.</span><span class="na">check</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">getAuthentication</span><span class="o">,</span> <span class="n">request</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">eventPublisher</span><span class="o">.</span><span class="na">publishAuthorizationEvent</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">getAuthentication</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">decision</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">decision</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">decision</span><span class="o">.</span><span class="na">isGranted</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">AccessDeniedException</span><span class="o">(</span><span class="s">"Access Denied"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="o">...</span> <span class="n">ì´í•˜</span> <span class="n">ìƒëµ</span>

<span class="o">}</span>

</code></pre></div></div>
<p>ì‹¤ì œë¡œ ì½”ë“œë¥¼ í™•ì¸í•´ë³´ë©´<br />
ìƒì„±ìë¡œ <code class="language-plaintext highlighter-rouge">AuthorizationManager</code>ì˜ ê°ì²´ë¥¼ DIë°›ê³  ìˆë‹¤.<br />
ê·¸ë¦¬ê³  <code class="language-plaintext highlighter-rouge">.check(this::getAuthentication, request);</code> ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´<br />
<code class="language-plaintext highlighter-rouge">Authentication</code>ì™€ <code class="language-plaintext highlighter-rouge">HttpServletRequest</code> ê°ì²´ë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ë„˜ê²¨ì£¼ê³ ìˆë‹¤.</p>

<p><br /></p>

<p>(3). <code class="language-plaintext highlighter-rouge">AuthorizationManager</code>ëŠ” <br />
ê¶Œí•œ ë¶€ì—¬ ì²˜ë¦¬ë¥¼ ì´ê´„í•˜ëŠ” ë§¤ë‹ˆì € ì—­í• ì˜ ì¸í„°í˜ì´ìŠ¤ì´ë‹¤.<br />
êµ¬í˜„ì²´ëŠ”  <code class="language-plaintext highlighter-rouge">RequestMatcherDelegatingAuthorizationManager</code> í´ë˜ìŠ¤ì´ë‹¤.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@FunctionalInterface</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AuthorizationManager</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
    
    <span class="o">...</span> <span class="n">ì´ìƒ</span> <span class="n">ìƒëµ</span>

	<span class="nd">@Nullable</span>
	<span class="nc">AuthorizationDecision</span> <span class="nf">check</span><span class="o">(</span><span class="nc">Supplier</span><span class="o">&lt;</span><span class="nc">Authentication</span><span class="o">&gt;</span> <span class="n">authentication</span><span class="o">,</span> <span class="no">T</span> <span class="n">object</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>
<p>ì½”ë“œë¡œë„ ë³¼ ìˆ˜ ìˆë“¯ì´ ì¸í„°í˜ì´ìŠ¤ì— ë©”ì„œë“œê°€ ì •ì˜ë˜ì–´ìˆê³ </p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">RequestMatcherDelegatingAuthorizationManager</span> <span class="kd">implements</span> <span class="nc">AuthorizationManager</span><span class="o">&lt;</span><span class="nc">HttpServletRequest</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="o">...</span>
    <span class="n">ì´ìƒ</span> <span class="n">ìƒëµ</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">AuthorizationDecision</span> <span class="nf">check</span><span class="o">(</span><span class="nc">Supplier</span><span class="o">&lt;</span><span class="nc">Authentication</span><span class="o">&gt;</span> <span class="n">authentication</span><span class="o">,</span> <span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">logger</span><span class="o">.</span><span class="na">isTraceEnabled</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="nc">LogMessage</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"Authorizing %s"</span><span class="o">,</span> <span class="n">request</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">RequestMatcherEntry</span><span class="o">&lt;</span><span class="nc">AuthorizationManager</span><span class="o">&lt;</span><span class="nc">RequestAuthorizationContext</span><span class="o">&gt;&gt;</span> <span class="n">mapping</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">mappings</span><span class="o">)</span> <span class="o">{</span>

            <span class="nc">RequestMatcher</span> <span class="n">matcher</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="na">getRequestMatcher</span><span class="o">();</span>
            <span class="nc">MatchResult</span> <span class="n">matchResult</span> <span class="o">=</span> <span class="n">matcher</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">matchResult</span><span class="o">.</span><span class="na">isMatch</span><span class="o">())</span> <span class="o">{</span>
                <span class="nc">AuthorizationManager</span><span class="o">&lt;</span><span class="nc">RequestAuthorizationContext</span><span class="o">&gt;</span> <span class="n">manager</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="na">getEntry</span><span class="o">();</span>
                <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">logger</span><span class="o">.</span><span class="na">isTraceEnabled</span><span class="o">())</span> <span class="o">{</span>
                    <span class="k">this</span><span class="o">.</span><span class="na">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="nc">LogMessage</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"Checking authorization on %s using %s"</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">manager</span><span class="o">));</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">manager</span><span class="o">.</span><span class="na">check</span><span class="o">(</span><span class="n">authentication</span><span class="o">,</span>
                        <span class="k">new</span> <span class="nf">RequestAuthorizationContext</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">matchResult</span><span class="o">.</span><span class="na">getVariables</span><span class="o">()));</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">this</span><span class="o">.</span><span class="na">logger</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="s">"Abstaining since did not find matching RequestMatcher"</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="o">...</span> <span class="n">ì´í•˜</span> <span class="n">ìƒëµ</span>
            
<span class="o">}</span>
</code></pre></div></div>
<p>êµ¬í˜„ì²´ì¸ <code class="language-plaintext highlighter-rouge">RequestMatcherDelegatingAuthorizationManager</code> í´ë˜ìŠ¤ì—<br />
<code class="language-plaintext highlighter-rouge">check();</code>ë©”ì„œë“œê°€ Overrideë˜ì–´ ìˆëŠ” ëª¨ìŠµì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<p><br /></p>

<p>(4),(5). ì´ì œ ì „ë‹¬ë°›ì€ ê°ì²´ë“¤ë¡œ <code class="language-plaintext highlighter-rouge">check();</code> ë©”ì„œë“œ ë‚´ë¶€ì—ì„œ<br />
ê¶Œí•œ ì²˜ë¦¬ì— ëŒ€í•œ ë¡œì§ì´ ìˆ˜í–‰ëœë‹¤.</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">RequestMatcherEntry</code> ì •ë³´ë¥¼ ì–»ì€ í›„ì— <code class="language-plaintext highlighter-rouge">RequestMatcher</code> ê°ì²´ë¥¼ ì–»ëŠ”ë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">RequestMatcher</code> ê°ì²´ë¡œ <code class="language-plaintext highlighter-rouge">HttpServletRequest</code> ê°ì²´ë¥¼ ë„£ì–´ <code class="language-plaintext highlighter-rouge">MatchResult</code> ê°ì²´ë¥¼ ë§Œë“ ë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">MatchResult</code> ê°ì²´ì˜ ë©”ì„œë“œ <code class="language-plaintext highlighter-rouge">.isMatch();</code>ë¡œ ê¶Œí•œì„ ì²´í¬í•œë‹¤.</li>
</ol>

<p>ë§Œì•½ì— ê¶Œí•œì´ ì¡´ì¬í•´ <code class="language-plaintext highlighter-rouge">if (matchResult.isMatch())</code> ë©”ì„œë“œë¥¼ í†µê³¼í•œë‹¤ë©´<br />
<code class="language-plaintext highlighter-rouge">manager.check();</code>ë¥¼ í†µí•´ì„œ <code class="language-plaintext highlighter-rouge">matchResult.getVariables();</code>ë¥¼ í†µí•´ì„œ<br />
Mapì„ ë‹´ê³ ìˆëŠ” ê°ì²´ê°€ ë°˜í™˜ë˜ë©° ê¶Œí•œ ë¶€ì—¬ê³¼ì •ì´ ì§„í–‰ë˜ê³ </p>

<p>ë§Œì•½ì— ê¶Œí•œì´ ì¡´ì¬í•˜ì§€ ì•Šì•„ <code class="language-plaintext highlighter-rouge">if (matchResult.isMatch())</code> ë©”ì„œë“œë¥¼ í†µê³¼í•˜ì§€ ëª»í•œë‹¤ë©´<br />
<code class="language-plaintext highlighter-rouge">return null;</code>ë¡œ ì¸í•´ nullê°’ì´ ë°˜í™˜ë˜ê²Œ ë˜ì–´ì§„ë‹¤.<br />
ì¦‰, ë§¨ì²˜ìŒì— ìš°ë¦¬ê°€ <code class="language-plaintext highlighter-rouge">check();</code>ë©”ì„œë“œë¥¼ í˜¸ì¶œí–ˆë˜ <code class="language-plaintext highlighter-rouge">AuthorizationFilter</code>ì—ì„œ</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doFilterInternal</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">FilterChain</span> <span class="n">filterChain</span><span class="o">)</span>
        <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>

    <span class="nc">AuthorizationDecision</span> <span class="n">decision</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">authorizationManager</span><span class="o">.</span><span class="na">check</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">getAuthentication</span><span class="o">,</span> <span class="n">request</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">eventPublisher</span><span class="o">.</span><span class="na">publishAuthorizationEvent</span><span class="o">(</span><span class="k">this</span><span class="o">::</span><span class="n">getAuthentication</span><span class="o">,</span> <span class="n">request</span><span class="o">,</span> <span class="n">decision</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">decision</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">decision</span><span class="o">.</span><span class="na">isGranted</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">AccessDeniedException</span><span class="o">(</span><span class="s">"Access Denied"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">throw new AccessDeniedException("Access Denied");</code> ì˜ˆì™¸ë¥¼ ë˜ì§€ê²Œë˜ì–´<br />
ê¶Œí•œì„ ë¶€ì—¬í•˜ì§€ ì•Šë„ë¡ ì²˜ë¦¬ë¥¼ í•´ì£¼ëŠ” ê²ƒì´ë‹¤.</p>

<p><br /></p>

<h3 id="ì ‘ê·¼-ì œì–´-í‘œí˜„ì‹">ì ‘ê·¼ ì œì–´ í‘œí˜„ì‹</h3>

<p>Spring Security ì›¹ ë° ë©”ì„œë“œ ë³´ì•ˆì„ ìœ„í•œ í‘œí˜„ì‹</p>

<p><strong>Spring EL</strong></p>

<table>
  <tbody>
    <tr>
      <td>í‘œí˜„ì‹</td>
      <td>: ì„¤ëª… :</td>
    </tr>
    <tr>
      <td>hasRole</td>
      <td>í˜„ì¬ ë³´ì•ˆ ì£¼ì²´(principal)ê°€ ì§€ì •ëœ ì—­í• ì„ ê°–ê³  ìˆëŠ”ì§€ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ê³  ê°€ì§€ê³  ìˆë‹¤ë©´ trueë¥¼ ë¦¬í„´í•œë‹¤. <br /> hasRole(â€™adminâ€™)ì²˜ëŸ¼ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê¸´ roleì´ ROLE_ ë¡œ ì‹œì‘í•˜ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ì ìœ¼ë¡œ ì¶”ê°€í•œë‹¤. <br /> (DefaultWebSecurityExpressionHandlerì˜ defaultRolePrefixë¥¼ ìˆ˜ì •í•˜ë©´ ì»¤ìŠ¤í…€í•  ìˆ˜ ìˆë‹¤.)</td>
    </tr>
    <tr>
      <td>hasAnyRole</td>
      <td>í˜„ì¬ ë³´ì•ˆ ì£¼ì²´ê°€ ì§€ì •í•œ ì—­í•  ì¤‘ 1ê°œë¼ë„ ê°€ì§€ê³  ìˆìœ¼ë©´ trueë¥¼ ë¦¬í„´í•œë‹¤. (ë¬¸ìì—´ ë¦¬ìŠ¤íŠ¸ë¥¼ ì½¤ë§ˆë¡œ êµ¬ë¶„í•´ì„œ ì „ë‹¬í•œë‹¤.) <br /> ex) hasAnyRole(â€™adminâ€™, â€˜userâ€™)</td>
    </tr>
    <tr>
      <td>hasAuthority</td>
      <td>í˜„ì¬ ë³´ì•ˆ ì£¼ì²´ê°€ ì§€ì •í•œ ê¶Œí•œì„ ê°–ê³  ìˆëŠ”ì§€ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ê³  ê°€ì§€ê³  ìˆë‹¤ë©´ trueë¥¼ ë¦¬í„´í•œë‹¤. <br /> ex) hasAuthority(â€™readâ€™)</td>
    </tr>
    <tr>
      <td>hasAnyAuthority</td>
      <td>í˜„ì¬ ë³´ì•ˆ ì£¼ì²´ê°€ ì§€ì •í•œ ê¶Œí•œ ì¤‘ í•˜ë‚˜ë¼ë„ ìˆìœ¼ë©´ trueë¥¼ ë¦¬í„´í•œë‹¤. <br /> ex) hasAnyAuthority(â€™readâ€™, â€˜writeâ€™)</td>
    </tr>
    <tr>
      <td>principal</td>
      <td>í˜„ì¬ ì‚¬ìš©ìë¥¼ ë‚˜íƒ€ë‚´ëŠ” principal ê°ì²´ì— ì§ì ‘ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.</td>
    </tr>
    <tr>
      <td>authentication</td>
      <td>SecurityContextë¡œ ì¡°íšŒí•  ìˆ˜ ìˆëŠ” í˜„ì¬ Authentication ê°ì²´ì— ì§ì ‘ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.</td>
    </tr>
    <tr>
      <td>permitAll</td>
      <td>í•­ìƒ trueë¡œ í‰ê°€í•œë‹¤.</td>
    </tr>
    <tr>
      <td>denyAll</td>
      <td>í•­ìƒ falseë¡œ í‰ê°€í•œë‹¤.</td>
    </tr>
    <tr>
      <td>isAnonymous()</td>
      <td>í˜„ì¬ ë³´ì•ˆ ì£¼ì²´ê°€ ìµëª… ì‚¬ìš©ìë©´ trueë¥¼ ë¦¬í„´í•œë‹¤.</td>
    </tr>
    <tr>
      <td>isRememberMe()</td>
      <td>í˜„ì¬ ë³´ì•ˆ ì£¼ì²´ê°€ remember-me ì‚¬ìš©ìë©´ trueë¥¼ ë¦¬í„´í•œë‹¤.</td>
    </tr>
    <tr>
      <td>isAuthenticated()</td>
      <td>ì‚¬ìš©ìê°€ ìµëª…ì´ ì•„ë‹Œ ê²½ìš° trueë¥¼ ë¦¬í„´í•œë‹¤.</td>
    </tr>
    <tr>
      <td>isFullyAuthenticated()</td>
      <td>ì‚¬ìš©ìê°€ ìµëª… ì‚¬ìš©ìë‚˜ remember-me ì‚¬ìš©ìê°€ ì•„ë‹ˆë©´ trueë¥¼ ë¦¬í„´í•œë‹¤.</td>
    </tr>
    <tr>
      <td>hasPermission <br /> (Object target, Object permission)</td>
      <td>ì‚¬ìš©ìê°€ targetì— í•´ë‹¹ permission ê¶Œí•œì´ ìˆìœ¼ë©´ trueë¥¼ ë¦¬í„´í•œë‹¤. <br /> ex) hasPermission(domainObject, â€˜readâ€™)</td>
    </tr>
    <tr>
      <td>hasPermission <br /> (Object targetId, String targetType, Object permission)</td>
      <td>ì‚¬ìš©ìê°€ targetì— í•´ë‹¹ permission ê¶Œí•œì´ ìˆìœ¼ë©´ trueë¥¼ ë¦¬í„´í•œë‹¤. <br /> ex) hasPermission(1, â€˜com.example.domain.Messageâ€™, â€˜readâ€™)</td>
    </tr>
  </tbody>
</table>

<p><br /></p>

<hr />

<p>ì´ë ‡ê²Œ ì˜¤ëŠ˜ì„ ëìœ¼ë¡œ Spring Securityì˜<br />
ì¸ì¦ê³¼ ê¶Œí•œì— ëŒ€í•´ ì•Œì•„ë³´ì•˜ë‹¤.<br />
ì¢€ ë” ê¹Šì€ë‚´ìš©ì„ ì´í•´í•˜ê¸° ìœ„í•´ì„œëŠ” ì—¬ëŸ¬ê°€ì§€ Filterì— ëŒ€í•´ ê³µë¶€ê°€<br />
í•„ìš”í•´ë³´ì´ê³ , ë‚´ì¼ë¶€í„° ê³µë¶€í•˜ëŠ” JWTë¥¼ ì´ìš©í• ë•Œ ì–´ë– í•œ ë°©ì‹ìœ¼ë¡œ<br />
Spring Security ë¡œì§ì´ ë³€ê²½ë˜ëŠ”ì§€ ë‚´ì¼ë¶€í„° ë‹¤ì‹œ ê³µë¶€í•´ë³´ì</p>

<p>ì˜¤ëŠ˜ ê³µë¶€ëŠ” ì—¬ê¸°ì„œ ë !!</p>

<p><br /></p>

<p><span style="color:#994C00"><strong>ì˜¤ëŠ˜ì˜ ì»¤í”¼ëŸ‰</strong></span>: â˜•ï¸ â˜•ï¸<br />
<strong>ì˜¤ëŠ˜ì˜ ì ì‹¬</strong>: ì‚½ê²¹ì‚´, ëœì¥ì°Œê°œ, ë°¥</p>]]></content><author><name>LEE JAEHYEOK</name></author><category term="TIL" /><category term="TIL" /><category term="ë¶€íŠ¸ìº í”„" /><category term="ì½”ë“œìŠ¤í…Œì´ì¸ " /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">TIL) Spring Security 2 (ì¸ì¦ì²˜ë¦¬)</title><link href="http://localhost:4000/til/2022/11/21/til.html" rel="alternate" type="text/html" title="TIL) Spring Security 2 (ì¸ì¦ì²˜ë¦¬)" /><published>2022-11-21T00:00:00+09:00</published><updated>2022-11-21T00:00:00+09:00</updated><id>http://localhost:4000/til/2022/11/21/til</id><content type="html" xml:base="http://localhost:4000/til/2022/11/21/til.html"><![CDATA[<p>ì£¼ë§ì´ë¼ëŠ” ê²ƒì€â€¦ ì‚¬ëŒì„ ì°¸ ë‚˜íƒœí•˜ê²Œ ë§Œë“¤ê¸°ë„<br />
í™œë ¥ì„ ê³µê¸‰í•˜ê¸°ë„ í•˜ëŠ” ê²ƒ ê°™ë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOjX-PSPnxF_8TEMdso4KXA0JFYzGA1vArqAdtB6h1-NxbA6XRbp-Xy587IzIYiyL_lKX7HXm5PYPHWKxXIq9zV_OpOtA=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>í† ìš”ì¼ê¹Œì§€ Spring Securityë¥¼ ê³µë¶€í•˜ë‹¤ê°€ ë²ˆì•„ì›ƒì´ì™€<br />
ì¼ìš”ì¼ì— ë„ˆë¬´ ê²Œìœ¼ë¥´ê²Œ ëˆ„ì›Œë§Œ ìˆì—ˆë”ë‹ˆ<br />
ìœ íŠœë¸Œ ë‚˜íƒœì§€ì˜¥ì— ë‹¤ì‹œ ë¹ ì ¸ë²„ë ¸ë‹¤.</p>

<hr />

<p>ì €ë²ˆì£¼ì— Spring Securityë¥¼ ì‚¬ìš©í•˜ëŠ” ì˜ˆì œ ì½”ë“œì™€<br />
ê°„ë‹¨í•œ íë¦„ì„ ì•Œì•„ë³´ì•˜ë‹¤.<br />
ê·¸ì¤‘ Filterë¼ëŠ” ê²ƒë“¤ì„ ë°°ì› ê³  Spring Securityë„<br />
Filterë¡œ êµ¬ì„±ëœ FilterChainìœ¼ë¡œ êµ¬ë™í•˜ëŠ” ê²ƒë„ ë°°ì› ë‹¤.</p>

<p>ì˜¤ëŠ˜ì€ ê·¸ ì¤‘ì—ì„œ ì¸ì¦ê´€ë ¨ëœ Filterë¥¼ ìì„¸íˆ ì•Œì•„ë³´ì</p>

<h2 id="spring-security-ì¸ì¦">Spring Security ì¸ì¦</h2>

<h3 id="filter-íë¦„-ë³µìŠµ">Filter íë¦„ ë³µìŠµ</h3>

<p>ì €ë²ˆì£¼ì— ê³µë¶€í–ˆì—ˆë˜ <a href="https://mycatlikeschuru.github.io/til/2022/11/18/til.html">(Spring Security ê¸°ì´ˆ)</a>ì˜ íë¦„ì„ ë‹¤ì‹œí•œë²ˆ ì§šê³  ë„˜ì–´ê°€ì</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOdqM4FUdK-kbSe3fOY-_nbwexPCpzCoO0wU4fxsPySDcyhG4ju9jOfdiay5TA0GmdJqNj0L4UZcOZGIHz9XGJLAcqNlw=w1299-h921" alt="image" class="align-left" style="max-width: 60%" /></p>

<p>í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìš”ì²­ì´ì˜¤ë©´<br />
Filterë“¤ì˜ ëª¨ì„ì¸ FilterChainì„ ê±°ì³ í•˜ë‚˜ì”© ì‹¤í–‰í•œë‹¤.<br />
ê·¸ ì¤‘ FilterChainProxy í´ë˜ìŠ¤ë¡œ ë¶€í„° ë³´ì•ˆì„ ìœ„í•œ ì‘ì—… í•„í„°ëª¨ìŒì¸<br />
SecurityFilterChainë¥¼ ìˆ˜í–‰í•˜ê²Œëœë‹¤.</p>

<p>ì—¬ê¸°ì„œ SecurityFilterChainë„ Filterë“¤ë¡œ ì´ë£¨ì–´ì ¸ìˆê³ <br />
ì•„ë˜ì˜ ì‚¬ì§„ì´ SecurityFilterChainì˜ ëŒ€ëµì ì¸ êµ¬ì¡°ì´ë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gNlrpr3UQFs4rI7dXvh6L-v1GvYL_3mSnWy8cA9rKECR2M-C_y4fYtJrNqD7xWcvzqy0TDvYC65satnVVyAEYsoTGaQbg=w1920-h921" alt="image" class="align-left" style="max-width: 100%" /><br />
<a href="https://velog.io/@sa833591/Spring-Security-5">hyozkim.log - ì¶œì²˜</a></p>

<p>ì‚¬ì§„ì—ì„œ ë³´ë©´ ì•Œ ìˆ˜ ìˆë“¯ì´ <br />
SecurityFilterChainì˜ êµ¬ì¡°ëŠ”</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SecurityContextPersistenceFilter  
LogoutFilter  
UsernamePasswordAuthenticationFilter  
...  
</code></pre></div></div>

<p>ë“± ì—¬ëŸ¬ê°€ì§€ í•„í„°ë¥¼ê°€ì§„ í˜•íƒœë¡œ ì¡´ì¬í•œë‹¤.</p>

<p>ëª¨ë“  Filterì˜ êµ¬ì¡°ë¥¼ ì•Œê³  ì´í•´í•œë‹¤ë©´ ë¶„ëª… SpringSecurityì— ëŒ€í•œ<br />
ì´í•´ë„ê°€ ê¹Šì–´ì§ˆ ê²ƒì´ìë§Œ, í˜„ì¬ ê³µë¶€ë¥¼ ì‹œì‘í•œì§€ ì–¼ë§ˆì•ˆëœ<br />
ë‚´ê°€ ì „ë¶€ë¥¼ ì´í•´í•˜ê¸°ì—ëŠ” ì‚¬ì‹¤ ë¬´ë¦¬ê°€ ìˆëŠ” ê²ƒ ê°™ë‹¤ê³  ìƒê°ì´ ë“¤ì—ˆë‹¤.</p>

<p>ì´ ì¤‘ì—ì„œë„ ì¸ì¦ê³¼ ê´€ë ¨ëœ UsernamePasswordAuthenticationFilterì˜<br />
ì¸ì¦ ì²˜ë¦¬ íë¦„ì„ ì´í•´í•´ë³´ë ¤í•œë‹¤. í•´ë‹¹í•˜ëŠ” ë¶€ë¶„ì„ ì–´ì œ ì½”ë“œë¡œ êµ¬í˜„í•˜ê¸°ë„ í–ˆê³ <br />
íë¦„ì„ ì•Œì•„ì•¼ SpringSecurityë¥¼ ê¸°ë³¸ì ì¸ ë‚´ìš©ì„ êµ¬í˜„í•˜ëŠ”ë° ë¬´ë¦¬ê°€ ì—†ì„ ê²ƒ ê°™ë‹¤.</p>

<p><br /></p>

<p><strong>Security Filter í™•ì¸ ë°©ë²•?</strong></p>

<p>ìœ„ì—ì„œ ì–˜ê¸°í–ˆë“¯ì´ ì—¬ëŸ¬ Filterë“¤ì„ ê±°ì³ì„œ<br />
ì¸ì¦ê³¼ ê¶Œí•œì— ëŒ€í•œ ìˆ˜í–‰ì„ SpringSecurityê°€ ì§„í–‰í•´ì¤€ë‹¤.<br />
ì‹¤ì œë¡œ ì–´ë– í•œ Filterë¥¼ ê±°ì³ì™”ëŠ”ì§€ í™•ì¸ì„ í•  ìˆ˜ ìˆëŠ” ì• ë…¸í…Œì´ì…˜ì´ ìˆê³   <br />
ë””ë²„ê·¸ ìš©ë„ë¡œ ë§¤ìš° ìœ ìš©í•˜ê²Œ ì“°ì¼ ê²ƒ ê°™ë‹¤.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@EnableWebSecurity</span><span class="o">(</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span> <span class="c1">// ë””ë²„ê·¸ ì„¤ì •</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfigurationV2</span> <span class="o">{</span>
    
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">SecurityFilterChain</span> <span class="nf">filterChain</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">http</span>
                <span class="o">.</span><span class="na">csrf</span><span class="o">().</span><span class="na">disable</span><span class="o">()</span>
                <span class="o">.</span><span class="na">formLogin</span><span class="o">()</span>
                <span class="o">.</span><span class="na">loginPage</span><span class="o">(</span><span class="s">"/auths/login-form"</span><span class="o">)</span> 
                <span class="o">.</span><span class="na">loginProcessingUrl</span><span class="o">(</span><span class="s">"/process_login"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">failureUrl</span><span class="o">(</span><span class="s">"/auths/login-form?error"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
                <span class="o">.</span><span class="na">authorizeHttpRequests</span><span class="o">()</span> 
                <span class="o">.</span><span class="na">anyRequest</span><span class="o">()</span> 
                <span class="o">.</span><span class="na">permitAll</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>@EnableWebSecurity(debug = true) ì–´ë…¸í…Œì´ì…˜ì„<br />
ì´ìš©í•´ í˜„ì¬ ìš”ì²­ì— ì´ìš©ëœ Filterì˜ ëª©ë¡ì´ ì¡°íšŒê°€ ê°€ëŠ¥í•˜ë‹¤.</p>

<p>ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰ì‹œí‚¤ê³ <br />
formLogin ë°©ì‹ìœ¼ë¡œ ìš”ì²­ì„ ë³´ë‚´ë³´ì•˜ë‹¤.</p>

<p>ê·¸ë¦¬ê³  ì½˜ì†”ì„ í™•ì¸í•´ë³´ë©´</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Security filter chain: [
  DisableEncodeUrlFilter
  WebAsyncManagerIntegrationFilter
  SecurityContextPersistenceFilter
  HeaderWriterFilter
  LogoutFilter
  UsernamePasswordAuthenticationFilter
  RequestCacheAwareFilter
  SecurityContextHolderAwareRequestFilter
  AnonymousAuthenticationFilter
  SessionManagementFilter
  ExceptionTranslationFilter
  AuthorizationFilter
]
</code></pre></div></div>
<p>ì²«ë²ˆì¨°ë¡œ ìš”ì²­ì— ëŒ€í•œ ì •ë³´ë“¤ê³¼<br />
ë‹¤ìŒìœ¼ë¡œëŠ” Security filter chainì— Filter ëª©ë¡ë“¤ì´<br />
ë‚˜ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<p>ìœ„ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´ ìš°ë¦¬ê°€ ì•Œì•„ë³´ë ¤ê³ í•˜ëŠ”<br />
UsernamePasswordAuthenticationFilter í´ë˜ìŠ¤ë„ <br />
ì½˜ì†”ë¡œ í™•ì¸ì´ ê°€ëŠ¥í•˜ë‹¤.</p>

<p><br /></p>

<h3 id="ì¸ì¦-ì²˜ë¦¬">ì¸ì¦ ì²˜ë¦¬</h3>

<p>ì´ì œ ë³¸ê²©ì ìœ¼ë¡œ ì¸ì¦ì´ ì–´ë– í•œ ê³¼ì •ìœ¼ë¡œ<br />
ì§„í–‰ë˜ëŠ”ì§€ ì²˜ë¦¬ ìˆœì„œì— ëŒ€í•œ íë¦„ì„ ì•Œì•„ë³´ì.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gM9oGy1ZMRYopmfP5I5a2V8YyhzZ_cPot1-9VSX4vFPRYbCISfsxHheqNiPvpRv-ywxmVYbIGBUyfKCX3AaeeChzJ7toQ=w1920-h921" alt="image" class="align-left" style="max-width: 120%" /></p>

<p>(1). í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë¡œê·¸ì¸ ìš”ì²­ì´ ì˜¤ë©´, <code class="language-plaintext highlighter-rouge">SecurityFilterChain</code>ì„ ê±°ì¹˜ê²Œëœë‹¤.<br />
ê·¸ ì¤‘ ì¸ì¦ì— ê´€í•œ ë¶€ë¶„ì€ <code class="language-plaintext highlighter-rouge">UsernamePasswordAuthenticationFilter</code> í´ë˜ìŠ¤ì´ë‹¤.</p>

<p><br /></p>

<p>(2). <code class="language-plaintext highlighter-rouge">Authentication</code> ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.<br />
ì—¬ê¸°ì„œ ë¡œê·¸ì¸í• ë•Œ ë°›ì•„ì˜¨ Usernameê³¼ Passwordë¥¼ ì´ìš©í•´<br />
<code class="language-plaintext highlighter-rouge">Authentication</code>ì˜ êµ¬í˜„ì²´ì¸ <code class="language-plaintext highlighter-rouge">UsernamePasswordAuthenticationToken</code> <br />
í´ë˜ìŠ¤ë¥¼ ì´ìš©í•´ <code class="language-plaintext highlighter-rouge">Authentication</code> ê°ì²´ë¥¼ ë§Œë“ ë‹¤.<br />
<em><strong>(â—ï¸Authentication ê°ì²´ëŠ” ì¸ì¦ì´ ì™„ë£Œë˜ì§€ ì•ŠìŒ)</strong></em></p>

<p><br /></p>

<p>(3). <code class="language-plaintext highlighter-rouge">Authentication</code> ê°ì²´ë¥¼ <code class="language-plaintext highlighter-rouge">AuthenticationManager</code>ë¡œ ì „ë‹¬í•œë‹¤.  <br />
ì—¬ê¸°ì„œ êµ¬í˜„ì²´ì¸ <code class="language-plaintext highlighter-rouge">ProviderManager</code>ê°€ ì¸ì¦ì´ë¼ëŠ” ì‘ì—…ì˜ ì´ê´„ ë§¤ë‹ˆì €ë‹¤. <br />
ì´ê´„ì€ í•˜ì§€ë§Œ ì‹¤ì œ ì¸ì¦ì²˜ë¦¬ëŠ” <code class="language-plaintext highlighter-rouge">AuthenticationProvider</code>ì—ê²Œ ìœ„ì„í•œë‹¤.<br />
<em><strong>(â—ï¸Authentication ê°ì²´ëŠ” ì¸ì¦ì´ ì™„ë£Œë˜ì§€ ì•ŠìŒ)</strong></em></p>

<p><br /></p>

<p>(4). <code class="language-plaintext highlighter-rouge">Authentication</code> ê°ì²´ë¥¼ <code class="language-plaintext highlighter-rouge">AuthenticationProvider</code>ë¡œ ì „ë‹¬í•œë‹¤.<br />
<code class="language-plaintext highlighter-rouge">ProviderManager</code>ê°€ ì „ë‹¬í•´ì¤€ <code class="language-plaintext highlighter-rouge">Authentication</code>ê°ì²´ë¡œ ì¸ì¦í•˜ëŠ” ì‘ì—…ì„ ì§„í–‰í•œë‹¤.<br />
ì¸ì¦ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•ì€ 2ê°€ì§€ ì •ë„ê°€ ìˆë‹¤.</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">AuthenticationProvider</code>ë¥¼ ìƒì†ë°›ì•„ êµ¬í˜„</li>
  <li><code class="language-plaintext highlighter-rouge">UserDetailsService</code>ë¥¼ ìƒì†ë°›ì•„ êµ¬í˜„</li>
</ol>

<p><a href="https://mycatlikeschuru.github.io/til/2022/11/18/til.html">(Spring Security ê¸°ì´ˆ)</a>ì—ì„œ ìš°ë¦¬ëŠ” <code class="language-plaintext highlighter-rouge">UserDetailsService</code>ë¥¼<br />
ìƒì†ë°›ì•„ ì§ì ‘ í´ë˜ìŠ¤ë¥¼ êµ¬í˜„í–ˆì—ˆë‹¤.</p>

<p>ì—¬ê¸°ì„œ 1ë²ˆë°©ë²•ìœ¼ë¡œ êµ¬í˜„í•˜ë©´ <code class="language-plaintext highlighter-rouge">â‚©</code>UserDetailsService` ë¶€ë¶„ì€<br />
ì‚¬ìš©í•˜ì§€ ì•Šê³  êµ¬í˜„ì„ í•  ìˆ˜ ìˆë‹¤. êµ¬í˜„í• ë•Œ ì¤‘ìš”í•œ ë¶€ë¶„ì€<br />
ì§ì ‘ Credentialsê³¼ Passwordë¥¼ ì¸ì¦ê³¼ì • ë¡œì§ì„ êµ¬í˜„í•´ì•¼í•œë‹¤ëŠ” ì ì´ë‹¤.</p>

<p>í•˜ì§€ë§Œ ì–´ì œ ìš°ë¦¬ê°€ êµ¬í˜„í–ˆë˜ 2ë²ˆë°©ë²•ìœ¼ë¡œ êµ¬í˜„í•˜ë©´<br />
<code class="language-plaintext highlighter-rouge">AuthenticationProvider</code>ë¥¼ êµ¬í˜„í•˜ì§€ ì•Šì•„ë„ëœë‹¤.<br />
<code class="language-plaintext highlighter-rouge">DaoAuthenticationProvider</code>ë¥¼ êµ¬í˜„ í´ë˜ìŠ¤ë¡œ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì´ë‹¤. 
ì‹¤ì œë¡œ í˜¸ì¶œ íë¦„ì„ ë³¸ë‹¤ë©´,</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">ProviderManager</code> í´ë˜ìŠ¤ì˜ <code class="language-plaintext highlighter-rouge">.authenticate();</code> ë©”ì„œë“œ í˜¸ì¶œ</li>
  <li><code class="language-plaintext highlighter-rouge">AuthenticationProvider</code> ì¸í„°í˜ì´ìŠ¤ì˜ <code class="language-plaintext highlighter-rouge">AbstractUserDetailsAuthenticationProvider</code>ê°€<br />
<code class="language-plaintext highlighter-rouge">.authenticate();</code> ë©”ì„œë“œë¥¼ êµ¬í˜„í–ˆìŒ.</li>
  <li><code class="language-plaintext highlighter-rouge">.authenticate();</code> ë©”ì„œë“œì•ˆì—ì„œ ì¸ì¦ ì²˜ë¦¬ë¥¼ ìœ„í•œ <code class="language-plaintext highlighter-rouge">retrieveUser();</code> í˜¸ì¶œ<br />
<code class="language-plaintext highlighter-rouge">DaoAuthenticationProvider</code> í´ë˜ìŠ¤ê°€ <code class="language-plaintext highlighter-rouge">.retrieveUser();</code>ë¥¼ êµ¬í˜„í–ˆìŒ</li>
  <li><code class="language-plaintext highlighter-rouge">.retrieveUser();</code> ë©”ì„œë“œì—ì„œ <code class="language-plaintext highlighter-rouge">UserDetailsService</code> í´ë˜ìŠ¤ì˜ <code class="language-plaintext highlighter-rouge">.loadUserByUsername()</code>  <br />
ë©”ì„œë“œ í˜¸ì¶œ <code class="language-plaintext highlighter-rouge">.loadUserByUsername();</code> ë©”ì„œë“œëŠ” ìš°ë¦¬ê°€ êµ¬í˜„í•´ì•¼í•˜ëŠ” ë¶€ë¶„ì´ë‹¤.</li>
</ol>

<p><em><strong>(â—ï¸Authentication ê°ì²´ëŠ” ì¸ì¦ì´ ì™„ë£Œë˜ì§€ ì•ŠìŒ)</strong></em></p>

<p><br /></p>

<p>(5). ì¦‰, ìœ„ì—ì„œ ì–˜ê¸°í–ˆë˜ <code class="language-plaintext highlighter-rouge">DaoAuthenticationProvider</code> í´ë˜ìŠ¤ê°€<br />
<code class="language-plaintext highlighter-rouge">UserDetailsService</code>ë¥¼ ì´ìš©í•´ <code class="language-plaintext highlighter-rouge">UserDetails</code>ë¥¼ ê°ì²´ë¥¼ ì¡°íšŒ í•œë‹¤.</p>

<p>ì‹¤ì œë¡œ ì–´ì œ ì˜ˆì œì—ì„œ <code class="language-plaintext highlighter-rouge">UserDetails</code>ë¥¼ ìƒì†ë°›ì•„<br />
username, password, ê¶Œí•œì •ë³´ë¥¼ ê°ì²´ë¡œ ë§Œë“¤ì–´ êµ¬í˜„í•˜ì˜€ê³ <br />
í•´ë‹¹ê°ì²´ë¥¼ <code class="language-plaintext highlighter-rouge">UserDetailsService</code>ë¥¼ ì´ìš©í•´ ë°˜í™˜í•˜ëŠ” í”„ë¡œê·¸ë¨ë„ ì‘ì„±í–ˆë‹¤.<br />
<em><strong>(â—ï¸Authentication ê°ì²´ëŠ” ì¸ì¦ì´ ì™„ë£Œë˜ì§€ ì•ŠìŒ)</strong></em></p>

<p><br /></p>

<p>(6). ì¦‰, Credential ì €ì¥ì†Œë¼ëŠ” ëœ»ì€ DBì˜ ì•”í˜¸í™”ëœ ë¹„ë°€ë²ˆí˜¸ë¥¼ ê°€ì ¸ì˜¨ë‹¤ëŠ” ëœ»ì´ë‹¤.  <br />
ì‰½ê²Œ ë§í•˜ìë©´ (5)ë²ˆì„ í†µí•´ í˜¸ì¶œëœ <code class="language-plaintext highlighter-rouge">UserDetailsService</code>ì—ì„œ<br />
<code class="language-plaintext highlighter-rouge">loadUserByUsername(String username);</code> ë©”ì„œë“œë¥¼ ì´ìš©í•´ <br />
ìš°ë¦¬ëŠ” ì–´ë–¤ usernameìœ¼ë¡œ ì ‘ê·¼í•˜ëŠ”ì§€ ì•Œ ìˆ˜ ìˆìœ¼ë©°, í•´ë‹¹ ì •ë³´ë¡œ DBë¥¼ ì¡°íšŒí•´<br />
ì‹«ì œë¡œ ë™ì¼í•œ usernameì´ ì¡´ì¬í•  ê²½ìš° í•´ë‹¹ í…Œì´ë¸”ì˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.<br />
ì¦‰, ê¶Œí•œì •ë³´, ì•”í˜¸í™”ëœ ë¹„ë°€ë²ˆí˜¸ ë“±ë“± ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤ëŠ” ëœ»ì´ë‹¤.</p>

<p><br /></p>

<p>(7). ì´ì œ ìš°ë¦¬ëŠ” (6)ë²ˆì„ í†µí•´ì„œ ì¡°íšŒí•œ ë°ì´í„°ë¡œ ì¸ì¦ì„ ë¹„êµí• <br />
<code class="language-plaintext highlighter-rouge">UserDetails</code> ê°ì²´ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤. <code class="language-plaintext highlighter-rouge">UserDetails</code> ê°ì²´ëŠ”<br />
username,password,ê¶Œí•œì •ë³´ë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©´ ê°ì²´ë¡œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.</p>

<p><br /></p>

<p>(8). ë§Œë“¤ì–´ì§„ <code class="language-plaintext highlighter-rouge">UserDetails</code> ê°ì²´ëŠ”, ë§¨ì²˜ìŒ í˜¸ì¶œí–ˆë˜ <br />
<code class="language-plaintext highlighter-rouge">DaoAuthenticationProvider</code> í´ë˜ìŠ¤ì— ë°˜í™˜í•˜ê²Œ ë˜ì–´ì§„ë‹¤.<br />
ì•„ê¹Œ ì–˜ê¸°í–ˆë“¯ì´ <code class="language-plaintext highlighter-rouge">AuthenticationProvider</code>ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ë¡œ<br />
ì¸ì¦ì„ ì²˜ë¦¬í•´ì£¼ëŠ” í´ë˜ìŠ¤ì´ë‹¤.</p>

<p><br /></p>

<p>(9). <code class="language-plaintext highlighter-rouge">UserDetails</code> ì •ë³´ë¥¼ ì´ìš©í•´ <code class="language-plaintext highlighter-rouge">DaoAuthenticationProvider</code> í´ë˜ìŠ¤ê°€<br />
<code class="language-plaintext highlighter-rouge">.mitigateAgainstTimingAttack();</code> ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´ ì¸ì¦ì„ ì²˜ë¦¬í•œë‹¤.<br />
ì¸ì¦ì²˜ë¦¬ê°€ ì •ìƒì ìœ¼ë¡œ ì´ë£¨ì–´ì¡Œì„ ê²½ìš°ì— <br />
ê·¸ë¦¼ê³¼ ê°™ì´ ì¸ì¦ì •ë³´ì¸ <code class="language-plaintext highlighter-rouge">Collection&lt;GrantedAuthority&gt;</code>ê°€ ì¶”ê°€ëœ<br />
<code class="language-plaintext highlighter-rouge">Authentication</code> ê°ì²´ë¥¼ ë°˜í™˜í•˜ê²Œ ëœë‹¤.<br />
<em><strong>(â­•ï¸Authentication ê°ì²´ëŠ” ì¸ì¦ì´ ì™„ë£Œë¨)</strong></em></p>

<p><br /></p>

<p>(10). ì´ì œ ì¸ì¦ì´ ì™„ë£Œëœ ê°ì²´ë¥¼ í˜¸ì¶œí–ˆë˜<br />
<code class="language-plaintext highlighter-rouge">ProviderManager</code>ë¡œ ë°˜í•œëœë‹¤.<br />
<em><strong>(â­•ï¸Authentication ê°ì²´ëŠ” ì¸ì¦ì´ ì™„ë£Œë¨)</strong></em></p>

<p><br /></p>

<p>(11). ë§ˆì°¬ê°€ì§€ë¡œ ì²˜ìŒì— í˜¸ì¶œì„ í–ˆë˜ <br />
<code class="language-plaintext highlighter-rouge">UsernamePasswordAuthenticationFilter</code> í´ë˜ìŠ¤ë¡œ<br />
ì¸ì¦ì´ì™„ë£Œëœ ê°ì²´ê°€ ë°˜í™˜ë˜ê²Œ ë˜ì–´ì§„ë‹¤.<br />
<em><strong>(â­•ï¸Authentication ê°ì²´ëŠ” ì¸ì¦ì´ ì™„ë£Œë¨)</strong></em></p>

<p><br /></p>

<p>(12). ìµœì¢…ì ìœ¼ë¡œ ì¸ì¦ì´ ì™„ë£Œëœ Authentication ê°ì²´ë¥¼<br />
<code class="language-plaintext highlighter-rouge">SecurityContextHolder</code>ë¥¼ ì´ìš©í•´ <code class="language-plaintext highlighter-rouge">SecurityContext</code>ì— ì €ì¥ì„í•˜ê²Œ ëœë‹¤.<br />
S<code class="language-plaintext highlighter-rouge">ecurityContext</code>ì˜ ì„¸ì…˜ ì •ì±…ì— ë”°ë¼ì„œ<br />
HttpSessionì— ì €ì¥ë˜ì–´ ì‚¬ìš©ìì˜ ì¸ì¦ ìƒíƒœë¥¼ ìœ ì§€í•˜ê¸°ë„ í•˜ê³ <br />
HttpSessionì„ ìƒì„±í•˜ì§€ ì•Šê³  ë¬´ìƒíƒœë¥¼ ìœ ì§€í•˜ê¸°ë„ í•œë‹¤.</p>

<p><br /></p>

<hr />

<p>ì´ë ‡ê²Œ ì˜¤ëŠ˜ì€ SecurityFilterChainì—ì„œ<br />
ì–´ë–»ê²Œ ì¸ì¦ì´ ì´ë£¨ì–´ì§€ëŠ”ì§€ ì•Œì•„ë³´ì•˜ë‹¤.</p>

<p>ì˜¤ëŠ˜ ì •ë§ íŒŒê¸‰ì ì¸ íš¨ê³¼ë¡œ ì½”ë“œì— ëŒ€í•´ ì´í•´ë¥¼ í–ˆë‹¤.<br />
ì•„í‚¤í…ì³ë¥¼ ê·¸ë ¤ê°€ë©´ì„œ, ì‹¤ì œ ì½”ë“œë“¤ì´ í˜¸ì¶œë˜ì„œ<br />
ì‹¤í–‰ë˜ëŠ” ê²ƒì„ í•˜ë‚˜í•˜ë‚˜ ë”°ë¼ê°€ë³´ë©´ì„œ ìˆœì„œì— ëŒ€í•œ íë¦„ì„ ê¸€ë¡œ ì •ë¦¬í•´ë´¤ë‹¤.</p>

<p>ì´ë ‡ê²Œ ì½”ë“œë¥¼ ë”°ë¼ê°€ë©´ì„œ, íŒŒì•…í•œ ë‚´ìš©ì„ ì ê³  í•˜ë‹¤ë³´ë‹ˆê¹Œ<br />
ì–´ë””ì„œ ë¶€í„° ì‹œì‘ë˜ì—ˆê³ , ì–´ë–»ê²Œ ê°ì²´ë¥¼ ëŒë ¤ë°›ëŠ”ì§€ê°€<br />
íŒŒì•…ë˜ë‹¤ë³´ë‹ˆê¹Œ ì–´ëŠì •ë„ ì¸ì¦ì²˜ë¦¬ì— ëŒ€í•œ íë¦„ì€ ì¡íŒ ê²ƒ ê°™ë‹¤.</p>

<p>ì˜¤ëŠ˜ ê³µë¶€ëŠ” ì—¬ê¸°ì„œ ë !!</p>

<p><br /></p>

<p><span style="color:#994C00"><strong>ì˜¤ëŠ˜ì˜ ì»¤í”¼ëŸ‰</strong></span>: â˜•ï¸ â˜•ï¸<br />
<strong>ì˜¤ëŠ˜ì˜ ì ì‹¬</strong>: ëœì¥ì°Œê°œ, ë¼ë©´, ë°¥</p>]]></content><author><name>LEE JAEHYEOK</name></author><category term="TIL" /><category term="TIL" /><category term="ë¶€íŠ¸ìº í”„" /><category term="ì½”ë“œìŠ¤í…Œì´ì¸ " /><summary type="html"><![CDATA[ì£¼ë§ì´ë¼ëŠ” ê²ƒì€â€¦ ì‚¬ëŒì„ ì°¸ ë‚˜íƒœí•˜ê²Œ ë§Œë“¤ê¸°ë„ í™œë ¥ì„ ê³µê¸‰í•˜ê¸°ë„ í•˜ëŠ” ê²ƒ ê°™ë‹¤.]]></summary></entry><entry><title type="html">TIL) Spring Security 1 (ê¸°ì´ˆ)</title><link href="http://localhost:4000/til/2022/11/18/til.html" rel="alternate" type="text/html" title="TIL) Spring Security 1 (ê¸°ì´ˆ)" /><published>2022-11-18T00:00:00+09:00</published><updated>2022-11-18T00:00:00+09:00</updated><id>http://localhost:4000/til/2022/11/18/til</id><content type="html" xml:base="http://localhost:4000/til/2022/11/18/til.html"><![CDATA[<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gMbi5KBKT2qUujSToFzrlGZ8riZgXZWFRWl1il4pHA0AlwRLqDL1ROTXlmdEytfEfxx0rpCo3VI8iZTbovSWK60aVBtSA=w3024-h1728" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>ì˜ˆì „ë³´ë‹¤ ì›”-ê¸ˆ ì‹œê°„ì´ ì •ë§ ë¹¨ë¦¬ê°„ë‹¤.<br />
ê·¸ë§Œí¼ ê³µë¶€í•˜ëŠ” ì‹œê°„ì„ ì¦ê¸°ê³  ìˆìœ¼ë‹ˆ ì‹œê°„ë„ ë¹¨ë¦¬ê°€ëŠ” ê²ƒ ê°™ë‹¤.</p>

<p>ì˜¤ëŠ˜ë„ ì´ë²ˆì£¼ì˜ ë§ˆì§€ë§‰ì´ë‹ˆ ë§Œí¼<br />
ë” ì§‘ì¤‘í•´ì„œ ê³µë¶€í•´ë³´ì !</p>

<hr />

<p>ì˜¤ëŠ˜ì€ Spring Securityì— ëŒ€í•´ ê³µë¶€í•˜ëŠ” ë‚ ì´ë‹¤.<br />
ë‹¤ìŒì£¼ì—ë„ ê³„ì† ê³µë¶€í•  ê²ƒ ê°™ê³ <br />
ì˜¤ëŠ˜ì€ ê¸°ë³¸ êµ¬ì¡°ì™€ ì›¹ ìš”ì²­ ì²˜ë¦¬ íë¦„ì—ëŒ€í•´ ê³µë¶€í•´ë³´ë ¤í•œë‹¤.</p>

<h2 id="spring-security">Spring Security</h2>

<p><strong>Spring Securityë€ ?</strong><br />
Spring MVC ê¸°ë°˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì¸ì¦,ì¸ê°€ ê¸°ëŠ¥ì„<br />
ì§€ì›í•˜ëŠ” ë³´ì•ˆ í”„ë ˆì„ì›Œí¬ì´ë‹¤.</p>

<p>Interceptorë‚˜ Servlet Filterê³¼ ê°™ì€ ë³´ì•ˆ ê¸°ëŠ¥ì„<br />
ì§ì ‘ êµ¬í˜„í•  ìˆ˜ ìˆì§€ë§Œ Spring Securityì—ì„œ ì•ˆì •ì ìœ¼ë¡œ ì§€ì›í•˜ê³  ìˆê¸° ë•Œë¬¸ì—<br />
Spring MVCë¥¼ ê¸°ë°˜ìœ¼ë¡œí•œë‹¤ë©´ Spring Securityë¥¼ ì´ìš©í•˜ëŠ”ê²Œ ì•ˆì „í•œ ì„ íƒì´ë¼ í•  ìˆ˜ ìˆë‹¤.</p>

<p><strong>ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ë¥¼ ì´ìš©í•œë‹¤ë©´ ?</strong></p>
<ol>
  <li>ë‹¤ì–‘í•œ ìœ í˜•ì˜ ì‚¬ìš©ì ì¸ì¦ ê¸°ëŠ¥ ì ìš© ê°€ëŠ¥ (í¼ ë¡œê·¸ì¸, í† í°, OAuth 2ê¸°ë°˜ ì¸ì¦)</li>
  <li>ì• í”Œë¦¬ì¼€ì´ì…˜ ì‚¬ìš©ìì˜ ì—­í• ì— ë”°ë¥¸ ê¶Œí•œ ë ˆë²¨ ì ìš©</li>
  <li>ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì œê³µí•˜ëŠ” ë¦¬ì†ŒìŠ¤ ëŒ€í•œ ì ‘ê·¼ ì œì–´</li>
  <li>ë¯¼ê°í•œ ì •ë³´ì— ëŒ€í•œ ë°ì´í„° ì•”í˜¸í™”</li>
  <li>ì¼ë°˜ì ìœ¼ë¡œ ì•Œë ¤ì§„ ì›¹ ë³´ì•ˆ ê³µê²© ì°¨ë‹¨</li>
</ol>

<p>ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ê´€ë ¨ ìš©ì–´ë¥¼ ë¯¸ë¦¬ ìˆ™ì§€í•˜ê³  <br />
ë³¸ê²©ì ì¸ ë‚´ìš©ì„ ì‚´í´ë³´ë©´ ë„ì›€ì´ ë  ê²ƒì´ë‹¤.</p>
<ol>
  <li><strong>Principal (ì£¼ì²´)</strong><br />
-&gt; ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ì‚¬ìš©ì,ë””ë°”ì´ìŠ¤,ì‹œìŠ¤í…œ ë“±ì´ ë  ìˆ˜ ìˆë‹¤.<br />
ì¸ì¦ í”„ë¡œì„¸ìŠ¤ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜í–‰ëœ ì‚¬ìš©ìì˜ ê³„ì • ì •ë³´ë¥¼ ì˜ë¯¸í•¨.</li>
  <li><strong>Authentication (ì¸ì¦)</strong><br />
-&gt; ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ì‚¬ìš©ìê°€ ë³¸ì¸ì´ ë§ìŒì„ ì¦ëª…í•˜ëŠ” ì ˆì°¨</li>
  <li><strong>Authorization (ì¸ê°€)</strong><br />
-&gt; ì¸ì¦ì´ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰ëœ ì‚¬ìš©ìì—ê²Œ í•˜ë‚˜ ì´ìƒì˜ ê¶Œí•œì„ ë¶€ì—¬í•¨.<br />
íŠ¹ì • ì• í”Œë¦¬ì¼€ì´ì…˜ì— íŠ¹ì • ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ í—ˆê°€í•˜ëŠ” ê³¼ì •ì„ ì˜ë¯¸í•œë‹¤.</li>
  <li><strong>Access Control (ì ‘ê·¼ì œì–´)</strong><br />
-&gt; ì‚¬ìš©ìê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•˜ëŠ” í–‰ìœ„ë¥¼ ì œì–´í•˜ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.</li>
  <li><strong>Credential (ì‹ ì› ì¦ëª…ì •ë³´)</strong><br />
-&gt; ì¸ì¦ì„ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ì„œ ì‹ë³„í•˜ê¸° ìœ„í•œ ì •ë³´.</li>
</ol>

<p><br /></p>

<h3 id="spring-security-íë¦„">Spring Security íë¦„</h3>

<p>ì‚¬ìš©í•´ë³´ê¸°ì— ì•ì„œ<br />
SSRë°©ì‹ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•  ì˜ˆì •ì´ë‹¤.<br />
ë³„ë„ì˜ htmlì„ ë§Œë“¤ì–´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í–ˆê³ <br />
Form Login ë°©ì‹ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í–ˆë‹¤.</p>

<p>ê°„ë‹¨í•œ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ ë³´ì•ˆ ì ìš© íë¦„ì„ ì•Œê³  ë„˜ì–´ê°€ë³´ì.<br />
ìš°ë¦¬ëŠ” ë³´í†µ ì›¹ì—ì„œ ìš”ì²­ì„ ë³´ë‚´ë©´ EndPointë¥¼ ê±°ì³ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼ì„ í•œë‹¤.</p>

<p>Servlet ê¸°ë°˜ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì¼ ê²½ìš° EndPointì— ìš”ì²­ì´ ë„ë‹¬í•˜ê¸°ì „ì— ìš”ì²­ì„ ê°€ë¡œì±ˆ í›„  <br />
ì–´ë–¤ ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìˆëŠ” ì ì ˆí•œ í¬ì¸íŠ¸ë¥¼ ì œê³µí•´ì¤„ ìˆ˜ ìˆëŠ” APIê°€ ìˆë‹¤.<br />
ê·¸ê²ƒì€ ë°”ë¡œ Servlet Filterì´ë‹¤.</p>

<p>Servlet Filterë¥¼ ì ê¹ ì •ë¦¬í•˜ìë©´</p>
<ol>
  <li>Javaì—ì„œ Interfaceí˜•íƒœë¡œ ì œê³µí•˜ëŠ” APIì´ë‹¤.</li>
  <li>ì›¹ìš”ì²­ì„ ê°€ë¡œì±„ ì „ì²˜ë¦¬, ì‘ë‹µì„ ì „ë‹¬í•˜ê¸°ì „ í›„ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìˆë‹¤.</li>
</ol>

<p>ì´ëŸ¬í•œ Servlet FilterëŠ” í•˜ë‚˜ ì´ìƒì˜ í•„í„°ë“¤ì„ ì—°ê²°í•´<br />
Filter Chainì„ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOgZKwDg4Q2Nju5ltzUyuDISAyDNnWwDlA-x9U3zTRmZq0JpKZx5Q6Qg95NA9nMQoOQuuyyURwFi0LI-XHIUlnGlFw3Ew=w3024-h1620" alt="image" class="align-left" style="max-width: 40%" /><br />
ì¶œì²˜ - <a href="https://docs.spring.io/spring-security/reference/servlet/architecture.html">Spring Security ë ˆí¼ëŸ°ìŠ¤</a></p>

<p><br /></p>

<p>Filter Chainì˜ Filterë“¤ì€ ìš°ë¦¬ê°€ êµ¬í˜„í•œ ì‘ì—…ë“¤ì„ ì‹¤í–‰í•œ í›„ì—<br />
HttpServletì„ ê±°ì³ DispatcherServletì— ìš”ì²­ì´ ì „ë‹¬ë˜ì–´ì§„ë‹¤.</p>

<p>DispatcherServletì€ Spring MVC ê³„ì¸µêµ¬ì¡°í• ë•Œ ë§ì´ ë³´ì•˜ì„ ê²ƒì´ë‹¤.<br />
í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë°›ì€ ëª¨ë“  ìš”ì²­ì„ ì í•©í•œ ì»¨íŠ¸ë¡¤ëŸ¬ì— ìœ„ì„í•´ì£¼ëŠ”<br />
Spring MVCì—ì„œ ì•„ì£¼ ì¤‘ìš”í•œ ì—­í• ì„ ê°€ì§€ê³  ìˆëŠ” ë…€ì„ì´ì˜€ë‹¤.</p>

<p>ì—¬í•˜íŠ¼ ìš°ë¦¬ê°€ ì•Œì•„ì•¼í•  í•µì‹¬ì€ DispatcherServletì— ë„ë‹¬í•˜ê¸° ì „ì—<br />
Servlet Filterê°€ ê°€ë¡œì±ˆë‹¤ëŠ” ê²ƒì´ë‹¤.</p>

<p><br /></p>

<p>ê·¸ëŸ¼ Spring Securityì™€ Servlet Filterì™€ ì–´ë– í•œ ê´€ê³„ê°€ ìˆëƒ?</p>

<p>Spring Securityì—ì„œëŠ” ë³´ì•ˆê³¼ ê´€ë ¨ëœ Filterë¥¼ ì´ìš©í•´ <br />
í´ë¼ì´ì–¸íŠ¸ì— ìš”ì²­ì„ ì¤‘ê°„ì— ê°€ë¡œì±ˆ ë’¤ ì¶”ê°€ì ìœ¼ë¡œ ì‘ì—…ì„ í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤€ë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gMdhZrHIw8wm0G_zG7eQgHqqNnxZhifIy-8Y1taID3Id73Ik4ScIIQt6oclNltVUbpDmsfKO-prb1xGOdVcuLX7eJCA7A=w3024-h1620" alt="image" class="align-left" style="max-width: 70%" /><br />
ì¶œì²˜ - <a href="https://docs.spring.io/spring-security/reference/servlet/architecture.html">Spring Security ë ˆí¼ëŸ°ìŠ¤</a></p>

<p><br /></p>

<p>ê·¸ê²ƒì„ ë„ì™€ì£¼ëŠ” í´ë˜ìŠ¤ë“¤ì´ ë°”ë¡œ ìœ„ì—ìˆëŠ” ì•„í‚¤í…ì³ì—ì„œ ë³´ëŠ”<br />
DelegatingFilterProxyì™€ FilterChainProxyì´ë‹¤. <br />
í•´ë‹¹ í´ë˜ìŠ¤ë“¤ì€ Filter ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³  ìˆì–´<br />
Servlet Filterë¡œì¨ì˜ ì—­í• ì„ ìˆ˜í–‰í•´í•œë‹¤.</p>

<p>DelegatingFilterProxyëŠ” Servlet Container ì˜ì˜ Filterì™€<br />
ApplicationContextì— Beanìœ¼ë¡œ ë“±ë¡ëœ Filterë“¤ì„ ì—°ê²°í•´ì£¼ëŠ” ì—­í• ì„ ê°€ì§„ë‹¤.</p>

<p>FilterChainProxyëŠ” Spring Securityë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì§„ì…ì ì´ë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gNcZKkvVUXMS9csndq0ceE71GN1u2pu7EDH5twxx0Grcg4f36ZzPqvVnHu73GrKupyuIf_iKM3qR7WVa328iuXmCWqZjQ=w3024-h1620" alt="image" class="align-left" style="max-width: 80%" /><br />
ì¶œì²˜ - <a href="https://docs.spring.io/spring-security/reference/servlet/architecture.html">Spring Security ë ˆí¼ëŸ°ìŠ¤</a></p>

<p><br /></p>

<p>ìœ„ì˜ ê·¸ë¦¼ì—ì„œ ë³´ë“¯ì´ Spring Securityì˜ Filter Chainìœ¼ë¡œ <br />
ë³´ì•ˆì„ ìœ„í•œ ì‘ì—…ì„ ì²˜ë¦¬í•˜ëŠ” í•„í„°ì˜ ëª¨ìŒì„ ë§Œë“¤ë©´ <br />
FilterChainProxyë¡œ ë¶€í„° í•´ë‹¹ Filterë“¤ì„ ì‹œì‘í•  ìˆ˜ ìˆê²Œë˜ì–´ì§„ë‹¤.</p>

<p>í•œë§ˆë””ë¡œ FilterChainProxyë¶€í„° Spring Securityì—ì„œ ì œê³µí•˜ëŠ”<br />
ë³´ì•ˆ Filterë“¤ì´ í•„ìš”í•œ ì‘ì—…ì„ ìˆ˜í–‰í•´ì£¼ê²Œ ë„ì™€ì£¼ëŠ” í´ë˜ìŠ¤ë¼ ë³´ë©´ëœë‹¤.</p>

<p><br /></p>

<h3 id="spring-security-ì—°ìŠµí•´ë³´ê¸°">Spring Security ì—°ìŠµí•´ë³´ê¸°</h3>

<p>ìœ„ì˜ Spring Security ìš”ì²­ íë¦„ì— ëŒ€í•´ ì–´ëŠì •ë„<br />
ì´í•´ê°€ ë˜ì—ˆë‹¤ë©´, ì•„ë˜ ì½”ë“œë“¤ì„ ë³´ê³ <br />
ì–´ëŠ ë¶€ë¶„ì¸ì§€ ì •í™•íˆëŠ” ëª°ë¼ë„ íë¦„ì€ íŒŒì•…ì´ ê°€ëŠ¥í•˜ë‹¤.</p>

<p>ìš°ì„  Spring Securityë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì˜ì¡´ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í•´ì•¼í•œë‹¤.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">implementation</span> <span class="err">'</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">boot</span><span class="o">:</span><span class="n">spring</span><span class="o">-</span><span class="n">boot</span><span class="o">-</span><span class="n">starter</span><span class="o">-</span><span class="n">security</span><span class="err">'</span>
</code></pre></div></div>
<p>build.gradleì— ì˜ì¡´ë¼ì´ë¸ŒëŸ¬ë¥¼ ì¶”ê°€ì‹œì¼œ ë†“ìœ¼ë©´ ì¤€ë¹„ ëì´ë‹¤.</p>

<p>ì²˜ìŒìœ¼ë¡œ ìš°ì„  ìœ„ì—ì„œ ë³´ì•˜ë˜<br />
SecurityFilterChainì„ êµ¬ì„±í•´ë³´ì</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfiguration</span> <span class="o">{</span>
    
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">SecurityFilterChain</span> <span class="nf">filterChain</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">http</span>
                <span class="o">.</span><span class="na">csrf</span><span class="o">().</span><span class="na">disable</span><span class="o">()</span> <span class="c1">// csrf ê³µê²©ì— ëŒ€í•œ ì„¤ì • ë¹„í™œì„±í™”</span>
                <span class="o">.</span><span class="na">formLogin</span><span class="o">()</span><span class="c1">// Form ë¡œê·¸ì¸ ì¸ì¦ ë°©ë²•</span>
                <span class="o">.</span><span class="na">loginPage</span><span class="o">(</span><span class="s">"/auths/login-form"</span><span class="o">)</span> <span class="c1">// ë¡œê·¸ì¸ ì»¤ìŠ¤í…€ í˜ì´ì§€ ì„¤ì • (ìš°ë¦¬ê°€ë§Œë“  ê²½ë¡œì„¤ì •)</span>
                <span class="o">.</span><span class="na">loginProcessingUrl</span><span class="o">(</span><span class="s">"/process_login"</span><span class="o">)</span><span class="c1">// ì¸ì¦ìš”ì²­ì„ ìˆ˜í–‰í•  ìš”ì²­ URL ì„¤ì • (html formíƒœê·¸ì—ì„œ ìš”ì²­)</span>
                <span class="o">.</span><span class="na">failureUrl</span><span class="o">(</span><span class="s">"/auths/login-form?error"</span><span class="o">)</span><span class="c1">// ì‹¤íŒ¨ì‹œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•  URL ì§€ì •</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span> <span class="c1">// ë³´ì•ˆì„¤ì •ì„ ë©”ì„œë“œ ì²´ì¸í˜•íƒœë¡œ êµ¬ì„±í•˜ê²Œ ë„ì™€ì¤Œ</span>
                <span class="o">.</span><span class="na">logout</span><span class="o">()</span> <span class="c1">// ë¡œê·¸ì•„ì›ƒ ì„¤ì •ìœ„í•œ LogoutConfigurerë¥¼ ë¦¬í„´í•´ì¤Œ</span>
                <span class="o">.</span><span class="na">logoutUrl</span><span class="o">(</span><span class="s">"/logout"</span><span class="o">)</span> <span class="c1">// ë¡œê·¸ì•„ì›ƒ ìš”ì²­ url ì„¤ì • (html formíƒœê·¸ì—ì„œ ìš”ì²­)</span>
                <span class="o">.</span><span class="na">logoutSuccessUrl</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span> <span class="c1">// ì„±ê³µì‹œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•  ì¥ì†Œ</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span> <span class="c1">// ë³´ì•ˆì„¤ì •ì„ ë©”ì„œë“œ ì²´ì¸í˜•íƒœë¡œ êµ¬ì„±í•˜ê²Œ ë„ì™€ì¤Œ</span>
                <span class="o">.</span><span class="na">exceptionHandling</span><span class="o">().</span><span class="na">accessDeniedPage</span><span class="o">(</span><span class="s">"/auths/access-denied"</span><span class="o">)</span> <span class="c1">// ê¶Œí•œì´ ì—†ì„ë•Œ ë³´ë‚¼ ìš”ì²­</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span> <span class="c1">// ë³´ì•ˆì„¤ì •ì„ ë©”ì„œë“œ ì²´ì¸í˜•íƒœë¡œ êµ¬ì„±í•˜ê²Œ ë„ì™€ì¤Œ</span>
                <span class="o">.</span><span class="na">authorizeHttpRequests</span><span class="o">(</span><span class="n">authorize</span> <span class="o">-&gt;</span>
                        <span class="n">authorize</span><span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/orders/**"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"ADMIN"</span><span class="o">)</span> <span class="c1">// í•´ë‹¹ ê²½ë¡œì— ADMIN ê¶Œí•œë§Œ ì ‘ê·¼ê°€ëŠ¥</span>
                                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/members/my-page"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"USER"</span><span class="o">)</span> <span class="c1">// í•´ë‹¹ ê²½ë¡œì— USER ê¶Œí•œë§Œ ì ‘ê·¼ê°€ëŠ¥</span>
                                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/**"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span> <span class="c1">// ì•ì—ì§€ì •í•œ URLì„ ì œì™¸í•œê²ƒ ì ‘ê·¼ ëª¨ë‘ê°€ëŠ¥</span>
                <span class="o">);</span>
<span class="c1">//                .authorizeHttpRequests() // í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ ì ‘ê·¼ê¶Œí•œì„ í™•ì¸í•˜ê² ë‹¤ê³  ì •ì˜</span>
<span class="c1">//                .anyRequest() // í´ë¼ì´ì–¸íŠ¸ì˜ ëª¨ë“  ìš”ì²­ì— ëŒ€í•´ ì ‘ê·¼ì„ í—ˆìš©</span>
<span class="c1">//                .permitAll(); // í´ë¼ì´ì–¸íŠ¸ì˜ ëª¨ë“  ìš”ì²­ì— ëŒ€í•´ ì ‘ê·¼ì„ í—ˆìš©</span>
        <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>ê¸°ë³¸ì ì¸ êµ¬ì„±ë°©ë²•ì€ SecurityFilterChain í´ë˜ìŠ¤ íƒ€ì…ì„ ë°˜í™˜í•˜ëŠ”<br />
ë©”ì„œë“œë¥¼ í•˜ë‚˜ ë§Œë“¤ì–´ filterì˜ ì •ë³´ë¥¼ ë„£ì–´ì£¼ëŠ” ê²ƒì´ë‹¤.<br />
ê·¸ë¦¬ê³  í•´ë‹¹ ë©”ì„œë“œë¥¼ Spring Containerì— Beanìœ¼ë¡œ ë‹´ì•„ì£¼ë©´ëœë‹¤.</p>

<p>ë¹ˆìœ¼ë¡œ ë‹´ì•„ì£¼ë©´ ì•„ê¹Œ ìœ„ì—ì„œ ì–˜ê¸°í–ˆë˜<br />
DelegatingFilterProxy í´ë˜ìŠ¤ì— ì˜í•´<br />
ì„œë¸”ë¦¿ ì»¨í…Œì´ë„ˆ ì˜ì—­ì˜ í•„í„°ì™€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ë¹ˆìœ¼ë¡œ ë“±ë¡ëœ í•„í„°ë¥¼<br />
ì—°ê²°í•´ì£¼ëŠ” ë¸Œë¦¿ê°€ ìƒê¸´ë‹¤ê³  ì˜ˆìƒí•´ë³¼ ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.</p>

<p>ê·¸ë¦¬ê³  SSRë°©ì‹ì˜ FormLoginì„ ì‚¬ìš©í•œë‹¤ê³  ê°€ì •í–ˆìœ¼ë‹ˆ<br />
ì²«ë²ˆì§¸ í•„í„°ë¡œëŠ” ë¡œê·¸ì¸ì— í•´ë‹¹í•˜ëŠ” ë‚´ìš©ë“¤  <br />
ë‘ë²ˆì§¸ í•„í„°ë¡œëŠ” ë¡œê·¸ì•„ì›ƒì— í•´ë‹¹í•˜ëŠ” ë‚´ìš©ë“¤ <br />
ì„¸ë²ˆì§¸ë¡œëŠ” ê¶Œí•œì´ ì—†ì„ë•Œ ì²˜ë¦¬í•˜ëŠ” ë‚´ìš©<br />
ë„¤ë²ˆì§¸ë¡œëŠ” í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì—ë”°ë¥¸ ê¶Œí•œ ì„¤ì •ì— ëŒ€í•œ ë‚´ìš©<br />
ì´ë ‡ê²Œ ê°ê° í•„í„°ë“¤ì„ í•˜ë‚˜ì˜ í•„í„°ì²´ì¸ìœ¼ë¡œ .build(); í•˜ì—¬ ë°˜í™˜í•˜ë©´<br />
í•´ë‹¹ ë‚´ìš©ì— ë”°ë¼ ì¸ì¦ê³¼ ê¶Œí•œ ë¶€ì—¬ê°€ ì´ë£¨ì–´ì§ˆ ìˆ˜ ìˆë‹¤.</p>

<p><br /></p>

<h4 id="in-memoryë¡œ-ì¸ì¦-í•´ë³´ê¸°">In Memoryë¡œ ì¸ì¦ í•´ë³´ê¸°</h4>

<p>DBë¥¼ ì´ìš©í•˜ì§€ ì•ŠëŠ” ì¸ì¦ë°©ë²•ì„ í•œë²ˆ ì—°ìŠµí•´ë³´ì</p>

<p><strong><span style="color:#F04965"> 1). ë‹¨ìˆœí•˜ê²Œ ê³ ì •í•´ì„œ ë“±ë¡í•´ ì¸ì¦ê³¼ ê¶Œí•œì„ ì£¼ëŠ” ë°©ì‹ </span></strong></p>

<p>SecurityConfiguration í´ë˜ìŠ¤ ì•„ë˜ì— <br />
UserDetailsManager ë°˜í™˜í•˜ëŠ” Bean ê°ì²´ë¥¼ ë§Œë“¤ì–´ì£¼ì—ˆë‹¤.</p>

<p>UserDetailsManager ë¼ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ <br />
êµ¬í˜„í•œ ê°ì²´ë¥¼ Beanìœ¼ë¡œ ë“±ë¡í•´ì£¼ë©´ í•´ë‹¹ ì •ë³´ë¡œ ë“±ë¡ëœ<br />
ì‚¬ìš©ìë“¤ì€ ì •ë³´ì— í•´ë‹¹í•˜ëŠ” ì¸ì¦ê³¼ ê¶Œí•œì„ ê°€ì§€ê²Œ ëœë‹¤.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nd">@Bean</span>
 <span class="kd">public</span> <span class="nc">UserDetailsManager</span> <span class="nf">userDetailsService</span><span class="o">(){</span>
     <span class="nc">UserDetails</span> <span class="n">user</span> <span class="o">=</span> <span class="nc">User</span><span class="o">.</span><span class="na">withDefaultPasswordEncoder</span><span class="o">()</span> <span class="c1">// password ì•”í˜¸í™”</span>
             <span class="o">.</span><span class="na">username</span><span class="o">(</span><span class="s">"dhfif718@naver.com"</span><span class="o">)</span> <span class="c1">// ì‹ë³„í•˜ëŠ” ì‚¬ìš©ì ì•„ì´ë”” ê°’</span>
             <span class="o">.</span><span class="na">password</span><span class="o">(</span><span class="s">"1111"</span><span class="o">)</span>
             <span class="o">.</span><span class="na">roles</span><span class="o">(</span><span class="s">"USER"</span><span class="o">)</span> <span class="c1">// ê¶Œí•œì§€ì •</span>
             <span class="o">.</span><span class="na">build</span><span class="o">();</span>
     <span class="nc">UserDetails</span> <span class="n">admin</span> <span class="o">=</span> <span class="nc">User</span><span class="o">.</span><span class="na">withDefaultPasswordEncoder</span><span class="o">()</span>
             <span class="o">.</span><span class="na">username</span><span class="o">(</span><span class="s">"admin@naver.com"</span><span class="o">)</span>
             <span class="o">.</span><span class="na">password</span><span class="o">(</span><span class="s">"2222"</span><span class="o">)</span>
             <span class="o">.</span><span class="na">roles</span><span class="o">(</span><span class="s">"ADMIN"</span><span class="o">)</span>
             <span class="o">.</span><span class="na">build</span><span class="o">();</span>

     <span class="k">return</span> <span class="k">new</span> <span class="nf">InMemoryUserDetailsManager</span><span class="o">(</span><span class="n">user</span><span class="o">,</span><span class="n">admin</span><span class="o">);</span>
 <span class="o">}</span>
</code></pre></div></div>
<p>InMemoryUserDetailsManager êµ¬í˜„ì²´ë¡œ êµ¬ì„± ì •ë³´ë¥¼ ë„˜ê²¨ì£¼ë©´ ëœë‹¤.<br />
êµ¬ì„± ì •ë³´ë¥¼ ë§Œë“œëŠ” ë°©ë²•ì€ UserDetails ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†ë°›ëŠ”<br />
User í´ë˜ìŠ¤ë¥¼ ì´ìš©í•´ ë§Œë“¤ ìˆ˜ìˆë‹¤.</p>

<p>ë§Œì•½ í´ë¼ì´ì–¸íŠ¸ì—ì„œ form login ë°©ì‹ìœ¼ë¡œ ë¡œê·¸ì¸ ìš”ì²­ì´ ì˜¨ë‹¤ë©´<br />
í•´ë‹¹ êµ¬ì„±ì •ë³´ë¥¼ ê°€ì§„ ì‚¬ìš©ìëŠ” ë¡œê·¸ì¸ì´ ë˜ë©°<br />
ê¶Œí•œì„ ê°ê° USER, ADMINìœ¼ë¡œ ë¶€ì—¬ë°›ê²Œ ë˜ì–´ì§„ë‹¤.</p>

<p>ìœ„ì— ìˆëŠ” ì •ë³´ëŠ” DBë¥¼ ì´ìš©í•œ ê²ƒë„ ì•„ë‹ˆë©°<br />
ë‹¨ìˆœí•˜ê²Œ UserDetailsManager íƒ€ì…ì˜ Beanì„ ë§Œë“¤ì–´ ì£¼ ì—ˆì„ ë¿ì¸ë°<br />
Spring SecurityëŠ” í•´ë‹¹ ì •ë³´ë¥¼ ê°€ì§„ ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ì„ í•˜ë©´<br />
ì¸ì¦ì„ í•´ì£¼ê³  ê¶Œí•œì„ ë¶€ì—¬í•´ì¤„ ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤.</p>

<p>ì—¬ê¸°ì„œ <strong>User.withDefaultPasswordEncoder()</strong> ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´<br />
bcrypt ë°©ì‹ìœ¼ë¡œ passwordë¥¼ ì•”í˜¸í™”í•´ì¤€ë‹¤. ì¦‰, 1111,2222ë¡œ ë“¤ì–´ì˜¨ ê°’ì„<br />
ì•”í˜¸í™”í•˜ì—¬ ê´€ë¦¬ë¥¼ í•œë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.</p>

<p>ë§Œì•½ ì½”ë“œë¡œ ì¹˜ê²Œëœë‹¤ë©´ <strong>Deprecated</strong> ìƒíƒœë¡œ ë³€í•˜ëŠ”ë° (ê°€ìš´ë°ì¤„ ì³ì§)<br />
í•´ë‹¹ APIëŠ” ê¶Œì¥í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ëœ»ì´ë‹¤. ì´ ê²½ìš°ì—ëŠ” ê³ ì •ìœ¼ë¡œ ì‚¬ìš©í•˜ê³  ìˆê¸°ì—<br />
ê³ ì •í•´ì„œ ì‚¬ìš©í•˜ì§€ ë§ë¼ëŠ” ì˜ë¯¸ì—ì„œ Deprecatedë¡œ ë³€í•œ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.</p>

<p><br /></p>

<p><strong><span style="color:#F04965"> 2). íšŒì› ê°€ì…ì„ ì´ìš©í•´ ë“±ë¡í•˜ê¸° </span></strong></p>

<p>ê¸°ë³¸ì ìœ¼ë¡œ passwordë¥¼ ì•”í˜¸í™”ë¥¼ í•´ì•¼í•œë‹¤.<br />
ì•”í˜¸í™”ë¥¼ í•˜ê¸°ìœ„í•´ ìœ„ì—ì„œ ì´ìš©í–ˆë˜ bcrpty ë°©ì‹ìœ¼ë¡œ ì•”í˜¸í™”ë¥¼ <br />
ë„ì™€ì£¼ëŠ” APIê°€ ìˆë‹¤.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="cm">/*
 * PasswordEncoder Bean ë“±ë¡
 * ì•”í˜¸í™”ë¥¼ í•´ì•¼í•œë‹¤. Spring Securityì—ì„œ ì§€ì›í•˜ëŠ” Default = bcrypt
 * */</span>
 <span class="nd">@Bean</span>
 <span class="kd">public</span> <span class="nc">PasswordEncoder</span> <span class="nf">passwordEncoder</span><span class="o">(){</span>
     <span class="k">return</span> <span class="nc">PasswordEncoderFactories</span><span class="o">.</span><span class="na">createDelegatingPasswordEncoder</span><span class="o">();</span>
 <span class="o">}</span>
</code></pre></div></div>
<p>SecurityConfiguration í´ë˜ìŠ¤ì—<br />
PasswordEncoder ì¸í„°í˜ì´ìŠ¤ íƒ€ì… ê°ì²´ë¥¼ Beanìœ¼ë¡œ ë“±ë¡í•´ì£¼ê³ <br />
íšŒì›ê°€ì…ì‹œ ì‚¬ìš©í•  ìˆ˜ìˆë‹¤.</p>

<p>íšŒì›ê°€ì…í•  ê²½ìš° ControllerëŠ” êµ¬ì„±ë˜ì–´ ìˆë‹¤ê³  ê°€ì •í•˜ê³ <br />
Service ì½”ë“œë¥¼ í™•ì¸í•´ë³´ì</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
*  InMemory ì‚¬ìš©ì„ ìœ„í•œ ë¹ˆì£¼ì…
* */</span>
<span class="c1">//@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JavaConfigurationV1</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">MemberService</span> <span class="nf">inMemoryMemberService</span><span class="o">(</span><span class="nc">UserDetailsManager</span> <span class="n">userDetailsManager</span><span class="o">,</span> <span class="nc">PasswordEncoder</span> <span class="n">passwordEncoder</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">InMemoryMemberService</span><span class="o">(</span><span class="n">userDetailsManager</span><span class="o">,</span><span class="n">passwordEncoder</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>MemberServiceë¼ëŠ” ì¸í„°í˜ì´ìŠ¤ íƒ€ì…ìœ¼ë¡œ ê°ì²´ë¥¼ Beanìœ¼ë¡œ ë“±ë¡í•´ì¤€ë‹¤.</p>

<p>InMemoryMemberSerivceì— ìš°ë¦¬ê°€ ì´ìš©í•´ì•¼í• <br />
UserDetailsManagerì™€ PasswordEncoderë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ë„£ì–´<br />
ìƒì„±ìë¡œ ë°˜í™˜í•˜ê²Œ ë˜ì–´ì§„ë‹¤.</p>

<p>ê·¸ëŸ¼ Beanìœ¼ë¡œ InMemoryMemberServiceì„ êµ¬í˜„ì²´ë¡œ<br />
ì˜ì¡´ì„± ì£¼ì…í•˜ì—¬ Controllerì—ì„œ ì´ìš©ì´ ê°€ëŠ¥í•˜ë‹¤..</p>

<p><br /></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">InMemoryMemberService</span> <span class="kd">implements</span> <span class="nc">MemberService</span> <span class="o">{</span>

   <span class="kd">private</span> <span class="kd">final</span> <span class="nc">UserDetailsManager</span> <span class="n">userDetailsManager</span><span class="o">;</span>
   <span class="kd">private</span> <span class="kd">final</span> <span class="nc">PasswordEncoder</span> <span class="n">passwordEncoder</span><span class="o">;</span>

   <span class="kd">public</span> <span class="nf">InMemoryMemberService</span><span class="o">(</span><span class="nc">UserDetailsManager</span> <span class="n">userDetailsManager</span><span class="o">,</span> <span class="nc">PasswordEncoder</span> <span class="n">passwordEncoder</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">userDetailsManager</span> <span class="o">=</span> <span class="n">userDetailsManager</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">passwordEncoder</span> <span class="o">=</span> <span class="n">passwordEncoder</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="nc">Member</span> <span class="nf">createMember</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">)</span> <span class="o">{</span>

      <span class="nc">List</span><span class="o">&lt;</span><span class="nc">GrantedAuthority</span><span class="o">&gt;</span> <span class="n">authorities</span> <span class="o">=</span> <span class="n">createAuthorities</span><span class="o">(</span><span class="nc">Member</span><span class="o">.</span><span class="na">MemberRole</span><span class="o">.</span><span class="na">ROLE_USER</span><span class="o">.</span><span class="na">name</span><span class="o">());</span> <span class="c1">// ê¶Œí•œ USERë¡œ ì„¤ì •</span>

      <span class="nc">String</span> <span class="n">encryptedPassword</span> <span class="o">=</span> <span class="n">passwordEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">getPassword</span><span class="o">());</span> <span class="c1">// ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” ì§„í–‰</span>

      <span class="nc">UserDetails</span> <span class="n">userDetails</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">getEmail</span><span class="o">(),</span> <span class="n">encryptedPassword</span><span class="o">,</span> <span class="n">authorities</span><span class="o">);</span> <span class="c1">// username, password, ê¶Œí•œ ì •ë³´ë¡œ ìœ ì € ìƒì„±</span>
      <span class="n">userDetailsManager</span><span class="o">.</span><span class="na">createUser</span><span class="o">(</span><span class="n">userDetails</span><span class="o">);</span> <span class="c1">// ìƒì„±í•œ ìœ ì €ì •ë³´ ë“±ë¡</span>

      <span class="k">return</span> <span class="n">member</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">GrantedAuthority</span><span class="o">&gt;</span> <span class="nf">createAuthorities</span><span class="o">(</span><span class="nc">String</span><span class="o">...</span> <span class="n">roles</span><span class="o">)</span> <span class="o">{</span>

      <span class="k">return</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">roles</span><span class="o">)</span>
              <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">role</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">SimpleGrantedAuthority</span><span class="o">(</span><span class="n">role</span><span class="o">))</span>
              <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
   <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>ì—¬ê¸°ì„œ íšŒì›ê°€ì…ì„ ìœ„í•œ ì„œë¹„ìŠ¤ ë¡œì§ createMember <br />
ì•ˆì˜ ë‚´ìš©ì„ ë“¤ì—¬ë‹¤ë³´ë©´ëœë‹¤.</p>

<p>ì²«ë²ˆì§¸ë¡œ ê¶Œí•œì— ëŒ€í•œ ë‚´ìš©ì„ ì„¤ì •í•˜ê¸°ìœ„í•´<br />
new SimpleGrantedAuthority();ì„ ì´ìš©í•´ ê°ì²´ë¥¼<br />
List í˜•íƒœë¡œ ë‹´ì•„ë‘” authoritiesë¥¼ ë§Œë“¤ì—ˆë‹¤.</p>

<p>ë‘ë²ˆì§¸ë¡œ ì•”í˜¸í™”ë¥¼ ìœ„í•´ DIë°›ì€ passwordEncoderì˜ ë©”ì„œë“œì¸<br />
.encode();ë¥¼ ì´ìš©í•´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë„˜ê²¨ì¤˜<br />
bcrypt ë°©ì‹ìœ¼ë¡œ ì•”í˜¸í™”í•˜ì—¬ String íƒ€ì…ìœ¼ë¡œ ë°›ì•„ë‘ì—ˆë‹¤.</p>

<p>ë§ˆì§€ë§‰ìœ¼ë¡œ new User();ë¥¼ ì´ìš©í•´<br />
ìœ„ì—ì„œ ê³ ì •ìœ¼ë¡œ êµ¬ì„±ì •ë³´ë¥¼ êµ¬ì„±í•œ ê²ƒ ì²˜ëŸ¼</p>

<p>username, password, rolesë¥¼ ìƒì„±ìë¡œ ë„˜ê²¨<br />
UserDetails íƒ€ì…ì˜ ê°ì²´ë¡œ ë§Œë“¤ì–´<br />
ìœ„ì—ì„œ DI ë°›ì€ userDetailsMangerì˜ ë©”ì„œë“œ<br />
createUser();ì˜ ë§¤ê°œë³€ìˆ˜ë¡œ ë„˜ê²¨ì£¼ê²Œ ë˜ë©´<br />
íšŒì› ê°€ì…ì„ í• ë•Œ í•´ë‹¹ ì •ë³´ë¥¼ ê°€ì§„ Memberê°€ ì¸ì¦ê³¼ ê¶Œí•œì •ë³´ë¥¼<br />
ê°€ì§€ê²Œë˜ì–´ ë¡œê·¸ì¸í• ë•Œ í•´ë‹¹ ì •ë³´ë¥¼ ê°€ì§„ ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ì„ í•œë‹¤ë©´<br />
ì¸ì¦ì´ë˜ì–´ ì„¤ì •í•œ ROLE_USER ê¶Œí•œìœ¼ë¡œ ì´ìš©ì´ ê°€ëŠ¥í•˜ê²Œë˜ì–´ì§„ë‹¤.</p>

<p><br />
<br /></p>

<p><strong><span style="color:#0066CC"> ìœ„ì˜ 1,2ë²ˆì„ í•œë§ˆë””ë¡œ ì •ë¦¬ í•´ë³´ìë©´ !! </span></strong></p>

<p>UserDetails ê°ì²´ë¥¼ ë§Œë“¤ì–´ ì¤˜ì•¼í•œë‹¤.<br />
ê·¸ë¦¬ê³  ê·¸ ê°ì²´ë¥¼ ì´ìš©í•´ UserDetailsManagerì˜ êµ¬í˜„ì²´ì¸<br />
InMemoryUserDetailsManager .createUser(); ë©”ì„œë“œì—<br />
ë§¤ê°œë³€ìˆ˜ë¡œ UserDetails ê°ì²´ë¥¼ ë„˜ê²¨ì£¼ëŠ”ê²Œ ëì´ë‹¤ !</p>

<p><br /></p>

<h4 id="h2-dbë¡œ-ì¸ì¦-í•´ë³´ê¸°">H2 DBë¡œ ì¸ì¦ í•´ë³´ê¸°</h4>

<p>ìœ„ì—ì„œ UserDetailsManagerë¥¼ ì´ìš©í•´ ì¸ì¦ê³¼ ê¶Œí•œì„ ê°€ì¡Œë‹¤ë©´</p>

<p>DBë¥¼ ì´ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” UserDetailsService ì¸í„°í˜ì´ìŠ¤ë¥¼ ì´ìš©í•´ì•¼í•œë‹¤.<br />
UserDetailsManagerê°€ UserDetailsServiceë¥¼ ìƒì†ë°›ì€ ê´€ê³„ì´ë‹¤.</p>

<p>ìš°ì„  H2 DB ì„¤ì •ê³¼ ê´€ë ¨ëœ ë¶€ë¶„ì€ ë˜ì–´ìˆë‹¤ê³  ê°€ì •í•˜ê² ë‹¤. <br />
ë¬¸ì œì—†ì´ H2 DataBaseë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ”<br />
ê¸°ì¡´ì— ì„¤ì •í–ˆë˜ SecurityFilterChainì—ì„œ í•œê°€ì§€ Filterë¥¼ ì¶”ê°€í•´ì¤˜ì•¼í•œë‹¤.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfiguration</span> <span class="o">{</span>
    
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">SecurityFilterChain</span> <span class="nf">filterChain</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="n">http</span>
                <span class="o">.</span><span class="na">headers</span><span class="o">().</span><span class="na">frameOptions</span><span class="o">().</span><span class="na">sameOrigin</span><span class="o">()</span>  <span class="c1">// &lt;frame&gt; íƒœê·¸ë“± ë Œë”ë§ì—¬ë¶€ ì„¤ì •, ë™ì¼ ì¶œì²˜ë¡œë¶€í„° ë“¤ì–´ì˜¤ëŠ” requestë§Œ ë Œë”ë§í—ˆìš© , H2 ì‚¬ìš©ì„ ìœ„í•¨</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span> <span class="c1">// ë³´ì•ˆì„¤ì •ì„ ë©”ì„œë“œ ì²´ì¸í˜•íƒœë¡œ êµ¬ì„±í•˜ê²Œ ë„ì™€ì¤Œ</span>
                <span class="o">.</span><span class="na">csrf</span><span class="o">().</span><span class="na">disable</span><span class="o">()</span> <span class="c1">// csrf ê³µê²©ì— ëŒ€í•œ ì„¤ì • ë¹„í™œì„±í™”</span>
                <span class="o">.</span><span class="na">formLogin</span><span class="o">()</span><span class="c1">// Form ë¡œê·¸ì¸ ì¸ì¦ ë°©ë²•</span>
                <span class="o">.</span><span class="na">loginPage</span><span class="o">(</span><span class="s">"/auths/login-form"</span><span class="o">)</span> <span class="c1">// ë¡œê·¸ì¸ ì»¤ìŠ¤í…€ í˜ì´ì§€ ì„¤ì • (ìš°ë¦¬ê°€ë§Œë“  ê²½ë¡œì„¤ì •)</span>
                <span class="o">.</span><span class="na">loginProcessingUrl</span><span class="o">(</span><span class="s">"/process_login"</span><span class="o">)</span><span class="c1">// ì¸ì¦ìš”ì²­ì„ ìˆ˜í–‰í•  ìš”ì²­ URL ì„¤ì • (html formíƒœê·¸ì—ì„œ ìš”ì²­)</span>
                <span class="o">.</span><span class="na">failureUrl</span><span class="o">(</span><span class="s">"/auths/login-form?error"</span><span class="o">)</span><span class="c1">// ì‹¤íŒ¨ì‹œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•  URL ì§€ì •</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span> <span class="c1">// ë³´ì•ˆì„¤ì •ì„ ë©”ì„œë“œ ì²´ì¸í˜•íƒœë¡œ êµ¬ì„±í•˜ê²Œ ë„ì™€ì¤Œ</span>
                <span class="o">.</span><span class="na">logout</span><span class="o">()</span> <span class="c1">// ë¡œê·¸ì•„ì›ƒ ì„¤ì •ìœ„í•œ LogoutConfigurerë¥¼ ë¦¬í„´í•´ì¤Œ</span>
                <span class="o">.</span><span class="na">logoutUrl</span><span class="o">(</span><span class="s">"/logout"</span><span class="o">)</span> <span class="c1">// ë¡œê·¸ì•„ì›ƒ ìš”ì²­ url ì„¤ì • (html formíƒœê·¸ì—ì„œ ìš”ì²­)</span>
                <span class="o">.</span><span class="na">logoutSuccessUrl</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span> <span class="c1">// ì„±ê³µì‹œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•  ì¥ì†Œ</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span> <span class="c1">// ë³´ì•ˆì„¤ì •ì„ ë©”ì„œë“œ ì²´ì¸í˜•íƒœë¡œ êµ¬ì„±í•˜ê²Œ ë„ì™€ì¤Œ</span>
                <span class="o">.</span><span class="na">exceptionHandling</span><span class="o">().</span><span class="na">accessDeniedPage</span><span class="o">(</span><span class="s">"/auths/access-denied"</span><span class="o">)</span> <span class="c1">// ê¶Œí•œì´ ì—†ì„ë•Œ ë³´ë‚¼ ìš”ì²­</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span> <span class="c1">// ë³´ì•ˆì„¤ì •ì„ ë©”ì„œë“œ ì²´ì¸í˜•íƒœë¡œ êµ¬ì„±í•˜ê²Œ ë„ì™€ì¤Œ</span>
                <span class="o">.</span><span class="na">authorizeHttpRequests</span><span class="o">(</span><span class="n">authorize</span> <span class="o">-&gt;</span>
                        <span class="n">authorize</span><span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/orders/**"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"ADMIN"</span><span class="o">)</span> <span class="c1">// í•´ë‹¹ ê²½ë¡œì— ADMIN ê¶Œí•œë§Œ ì ‘ê·¼ê°€ëŠ¥</span>
                                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/members/my-page"</span><span class="o">).</span><span class="na">hasRole</span><span class="o">(</span><span class="s">"USER"</span><span class="o">)</span> <span class="c1">// í•´ë‹¹ ê²½ë¡œì— USER ê¶Œí•œë§Œ ì ‘ê·¼ê°€ëŠ¥</span>
                                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/**"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span> <span class="c1">// ì•ì—ì§€ì •í•œ URLì„ ì œì™¸í•œê²ƒ ì ‘ê·¼ ëª¨ë‘ê°€ëŠ¥</span>
                <span class="o">);</span>
<span class="c1">//                .authorizeHttpRequests() // í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´ ì ‘ê·¼ê¶Œí•œì„ í™•ì¸í•˜ê² ë‹¤ê³  ì •ì˜</span>
<span class="c1">//                .anyRequest() // í´ë¼ì´ì–¸íŠ¸ì˜ ëª¨ë“  ìš”ì²­ì— ëŒ€í•´ ì ‘ê·¼ì„ í—ˆìš©</span>
<span class="c1">//                .permitAll(); // í´ë¼ì´ì–¸íŠ¸ì˜ ëª¨ë“  ìš”ì²­ì— ëŒ€í•´ ì ‘ê·¼ì„ í—ˆìš©</span>
        <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>.headers().frameOptions().sameOrigin()<br />
ë©”ì„œë“œë“¤ì´ ì¶”ê°€ë˜ì—ˆê³ , ì¶”ê°€í•˜ì§€ ì•Šìœ¼ë©´</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gPof1RAUkqFj1p0icu1y0Y1G_-q79XgeRnNvxsgf4sahOYXm9S9UNHjL3dST2DYsW76e9J9ZS_C961EXzBBqNjpKuygEg=w3024-h1620" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>ìœ„ì˜ í™”ë©´ê³¼ ê°™ì´ ì •ìƒì ìœ¼ë¡œ H2 DataBaseê°€ í‘œì‹œë˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤.</p>

<p><br /></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
*  DB ì‚¬ìš©ì„ ìœ„í•œ ë¹ˆì£¼ì…
* */</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JavaConfigurationV2</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">MemberService</span> <span class="nf">dbMemberService</span><span class="o">(</span><span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">,</span> <span class="nc">PasswordEncoder</span> <span class="n">passwordEncoder</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">DBMemberServiceV1</span><span class="o">(</span><span class="n">memberRepository</span><span class="o">,</span><span class="n">passwordEncoder</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>ê¸°ì¡´ì— InMemoryë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì„¤ì •í–ˆë˜ êµ¬ì„±ì •ë³´ë¥¼ ì§€ìš°ê³ <br />
ìƒˆë¡œìš´ êµ¬ì„±ì •ë³´ë¥¼ ì„¤ì •. DBMemberServiceê°€ ì ìš©ë˜ë„ë¡ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í–ˆë‹¤.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DBMemberServiceV1</span> <span class="kd">implements</span> <span class="nc">MemberService</span> <span class="o">{</span>

   <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">;</span>
   <span class="kd">private</span> <span class="kd">final</span> <span class="nc">PasswordEncoder</span> <span class="n">passwordEncoder</span><span class="o">;</span>

   <span class="kd">public</span> <span class="nf">DBMemberServiceV1</span><span class="o">(</span><span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">,</span> <span class="nc">PasswordEncoder</span> <span class="n">passwordEncoder</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">this</span><span class="o">.</span><span class="na">memberRepository</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">;</span>
      <span class="k">this</span><span class="o">.</span><span class="na">passwordEncoder</span> <span class="o">=</span> <span class="n">passwordEncoder</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="nc">Member</span> <span class="nf">createMember</span><span class="o">(</span><span class="nc">Member</span> <span class="n">member</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">verifyExistsEmail</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">getEmail</span><span class="o">());</span>
      <span class="nc">String</span> <span class="n">encryptedPassword</span> <span class="o">=</span> <span class="n">passwordEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">getPassword</span><span class="o">());</span> <span class="c1">// ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”</span>
      <span class="n">member</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="n">encryptedPassword</span><span class="o">);</span> <span class="c1">// ì•”í˜¸í™”ëœ ë¹„ë°€ë²ˆí˜¸ ê°ì²´ì— ë§µí•‘</span>

      <span class="nc">Member</span> <span class="n">saveMember</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">member</span><span class="o">);</span> <span class="c1">// DBì— ì €ì¥</span>

      <span class="k">return</span> <span class="n">saveMember</span><span class="o">;</span>
   <span class="o">}</span>

   <span class="kd">private</span> <span class="kt">void</span> <span class="nf">verifyExistsEmail</span><span class="o">(</span><span class="nc">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">member</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findByEmail</span><span class="o">(</span><span class="n">email</span><span class="o">);</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="na">isPresent</span><span class="o">())</span>
         <span class="k">throw</span> <span class="k">new</span> <span class="nf">BusinessLogicException</span><span class="o">(</span><span class="nc">ExceptionCode</span><span class="o">.</span><span class="na">MEMBER_EXISTS</span><span class="o">);</span>
   <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>DBMemberServiceì—ì„œëŠ”<br />
ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™”ë¥¼ í•œ ê²ƒì„ member ê°ì²´ì— ë‹´ì•„<br />
Repositoryì— ì €ì¥í•˜ê²Œë§Œ êµ¬ì„±í•´ì£¼ë©´ ëë‚œë‹¤.</p>

<p>ì¸ë©”ëª¨ë¦¬ ì‚¬ìš©í• ë•Œì—ëŠ” UserDetailsManagerì—ë‹¤ê°€ ì €ì¥í–ˆì§€ë§Œ<br />
ì´ì œëŠ” DBMemberServiceëŠ” íšŒì›ê°€ì…ì´ë¼ëŠ”<br />
ì„œë¹„ìŠ¤ ë¡œì§ë§Œ ë‚¨ê²Œ ëœ ê²ƒì´ë‹¤.</p>

<p>ì´ì œ íšŒì›ê°€ì…ì„í•˜ì˜€ê³ <br />
ë¡œê·¸ì¸ì„ í•˜ì˜€ì„ë•Œ UserDetailsManagerì™€ ê°™ì€ ì—­í• ì„ êµ¬í˜„í•´ì¤˜ì•¼í•œë‹¤.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
* DBì‚¬ìš©í–ˆì„ë•Œ ì¸ì¦ ì²˜ë¦¬ ì ìš©í•˜ê¸° (ì¸ë©”ëª¨ë¦¬ ì‚¬ìš©ì‹œ ê¸°ì¡´ UserDetailManagerë¥¼ ì‚¬ìš©í–ˆì—ˆìŒ)
* UserDetailsServiceëŠ” Userì •ë³´ë¥¼ ë¡œë“œí•˜ëŠ” í•µì‹¬ì ì¸ ì¸í„°í˜ì´ìŠ¤ë‹¤.
* UserDetailManagerëŠ” UserDetailsServiceë¥¼ ìƒì†í•˜ê³ ìˆìŒ
* */</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloUserDetailsServiceV1</span> <span class="kd">implements</span> <span class="nc">UserDetailsService</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">HelloAuthorityUtils</span> <span class="n">authorityUtils</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">HelloUserDetailsServiceV1</span><span class="o">(</span><span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">,</span> <span class="nc">HelloAuthorityUtils</span> <span class="n">authorityUtils</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">memberRepository</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">authorityUtils</span> <span class="o">=</span> <span class="n">authorityUtils</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/*
    * UserDetailService ì˜¤ë²„ë¼ì´ë”©í•˜ì—¬ UserDetails ê°ì±„ë¥¼ ë§Œë“¤ì–´ ë°˜í™˜í•˜ê¸°
    * ì´í›„ëŠ” ìŠ¤í”„ë§ì‹œíë¦¬í‹°ê°€ ì¸ì¦ì²˜ë¦¬ë¥¼ ëŒ€ì‹ í•´ì¤€ë‹¤
    * */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">UserDetails</span> <span class="nf">loadUserByUsername</span><span class="o">(</span><span class="nc">String</span> <span class="n">username</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">UsernameNotFoundException</span> <span class="o">{</span>
        <span class="c1">// í•´ë‹¹ ë©”ì„œë“œ í˜¸ì¶œ ì‹œì ì€, login.htmlì—ì„œ ë¡œê·¸ì¸ ë²„íŠ¼ ëˆ„ë¥¼ë–„ì´ë‹¤.</span>
        <span class="c1">// ì¦‰, &lt;form action="/process_login" method="post"&gt; ê°€ ì‹¤í–‰ë ë–„ í˜¸ì¶œë¨</span>
        <span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">optionalMember</span> <span class="o">=</span> <span class="n">memberRepository</span><span class="o">.</span><span class="na">findByEmail</span><span class="o">(</span><span class="n">username</span><span class="o">);</span> <span class="c1">// ì´ë©”ì¼ë¡œ ë©¤ë²„ì°¾ê¸°</span>
        <span class="nc">Member</span> <span class="n">findMember</span> <span class="o">=</span> <span class="n">optionalMember</span><span class="o">.</span><span class="na">orElseThrow</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">BusinessLogicException</span><span class="o">(</span><span class="nc">ExceptionCode</span><span class="o">.</span><span class="na">MEMBER_NOT_FOUND</span><span class="o">));</span> <span class="c1">// ë©¤ë²„ ì°¾ê¸° ì˜ˆì™¸ ì²˜ë¦¬</span>
        <span class="nc">Collection</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="nc">GrantedAuthority</span><span class="o">&gt;</span> <span class="n">authorities</span> <span class="o">=</span> <span class="n">authorityUtils</span><span class="o">.</span><span class="na">createAuthorities</span><span class="o">(</span><span class="n">findMember</span><span class="o">.</span><span class="na">getEmail</span><span class="o">());</span> <span class="c1">// ì´ë©”ì¼ ë¹„êµí›„ ê¶Œí•œ ì²˜ë¦¬</span>
        <span class="nc">UserDetails</span> <span class="n">user1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="o">(</span><span class="n">findMember</span><span class="o">.</span><span class="na">getEmail</span><span class="o">(),</span> <span class="n">findMember</span><span class="o">.</span><span class="na">getPassword</span><span class="o">(),</span> <span class="n">authorities</span><span class="o">);</span> <span class="c1">// í•´ë‹¹ ì •ë³´ë¡œ Userìƒì„±ìë¡œ UserDetails ë§Œë“¤ê¸°</span>
        <span class="k">return</span> <span class="n">user1</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>ìš°ë¦¬ëŠ” UserDetailsServiceë¥¼ êµ¬í˜„í•  í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´<br />
ìƒì†ì„ ë°›ê²Œ ë§Œë“¤ì–´ì¤€ë‹¤ìŒ. loadUserByUsername ì˜¤ë²„ë¼ì´ë”©í•´<br />
ì¬ì •ì˜ë¥¼ í•´ì„œ ë°˜í™˜ì„ UserDetails ê°ì²´ë¡œ ë§Œë“¤ì–´ ë°˜í™˜ì„ í•´ì£¼ë©´ëœë‹¤.</p>

<p>íšŒì›ê°€ì…ì€ ì´ë¯¸ ë˜ì–´ìˆê³ , ì•”í˜¸í™”ê¹Œì§€í•´ ë†“ì€ ìƒíƒœë¡œ DBì— ì €ì¥ë˜ì–´ìˆë‹¤.<br />
ìš°ë¦¬ê°€ ë¡œê·¸ì¸ í˜ì´ì§€ì—ì„œ form loginìœ¼ë¡œ post ë©”ì„œë“œ /process_loginì„ í˜¸ì¶œí•˜ê²Œë˜ë©´<br />
ìš°ë¦¬ê°€ ìœ„ì—ì„œ ë´¤ë˜ íë¦„ëŒ€ë¡œ EndPointê¹Œì§€ ê°€ê¸°ì „ì—<br />
Servlet Filterê°€ íë¦„ì„ ê°€ë¡œì±„ì„œ ì‹¤í–‰í•˜ê²Œ ë˜ê³ <br />
ìš°ë¦¬ëŠ” Spring Securityë¥¼ ì‚¬ìš©í•˜ê³  ìˆê¸°ë•Œë¬¸ì— ì¸ì¦ ì ˆì°¨ë¥¼ ê°€ì§€ê²Œëœë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AFDK6gOFEpthgmY3S8CBykz2TudWwacXHEngWxFMzuqUbbRWjNwnV379_0wvzLGpOM0t0X18sB8nTpumplyiCwlc5r_PjdIZfg=w3024-h1620" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>ì¸ì¦ ì ˆì°¨ëŠ” ì‹¤ì œë¡œ ì´ëŸ¬í•œ íë¦„ì„ ì§„í–‰ëœë‹¤ê³ í•œë‹¤.</p>

<ol>
  <li>
    <p>ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ ì •ë³´ì™€ í•¨ê»˜ ì¸ì¦ ìš”ì²­ì„ í•œë‹¤.(Http Request)</p>
  </li>
  <li>
    <p>AuthenticationFilterê°€ ìš”ì²­ì„ ê°€ë¡œì±„ê³ , ê°€ë¡œì±ˆ ì •ë³´ë¥¼ í†µí•´<br />
UsernamePasswordAuthenticationTokenì˜ ì¸ì¦ìš© ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.</p>
  </li>
  <li>
    <p>AuthenticationManagerì˜ êµ¬í˜„ì²´ì¸ ProviderManagerì—ê²Œ ìƒì„±í•œ <br />
UsernamePasswordToken ê°ì²´ë¥¼ ì „ë‹¬í•œë‹¤.</p>
  </li>
  <li>
    <p>AuthenticationManagerëŠ” ë“±ë¡ëœ AuthenticationProvider(ë“¤)ì„ ì¡°íšŒí•˜ì—¬ ì¸ì¦ì„ ìš”êµ¬í•œë‹¤.</p>
  </li>
  <li>
    <p>ì‹¤ì œ DBì—ì„œ ì‚¬ìš©ì ì¸ì¦ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” UserDetailsServiceì— ì‚¬ìš©ì ì •ë³´ë¥¼ ë„˜ê²¨ì¤€ë‹¤.</p>
  </li>
  <li>
    <p>ë„˜ê²¨ë°›ì€ ì‚¬ìš©ì ì •ë³´ë¥¼ í†µí•´ DBì—ì„œ ì°¾ì€ ì‚¬ìš©ì ì •ë³´ì¸ UserDetails ê°ì²´ë¥¼ ë§Œë“ ë‹¤.</p>
  </li>
  <li>
    <p>AuthenticationProvider(ë“¤)ì€ UserDetailsë¥¼ ë„˜ê²¨ë°›ê³  ì‚¬ìš©ì ì •ë³´ë¥¼ ë¹„êµí•œë‹¤.</p>
  </li>
  <li>
    <p>ì¸ì¦ì´ ì™„ë£Œë˜ë©´ ê¶Œí•œ ë“±ì˜ ì‚¬ìš©ì ì •ë³´ë¥¼ ë‹´ì€ Authentication ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.</p>
  </li>
  <li>
    <p>ë‹¤ì‹œ ìµœì´ˆì˜ AuthenticationFilterì— Authentication ê°ì²´ê°€ ë°˜í™˜ëœë‹¤.</p>
  </li>
  <li>
    <p>Authenticaton ê°ì²´ë¥¼ SecurityContextì— ì €ì¥í•œë‹¤.</p>
  </li>
</ol>

<p><a href="https://dev-coco.tistory.com/174">ì¶œì²˜ - ìŠ¬ê¸°ë¡œìš´ ê°œë°œìƒí™œ</a></p>

<p><br /></p>

<p>ì¦‰, ìš°ë¦¬ê°€ êµ¬í˜„í•´ì¤˜ì•¼í•  ë¶€ë¶„ì€<br />
5ë²ˆì—ì„œ ì‚¬ìš©ì ì •ë³´ë¥¼ ë°›ëŠ” ê²ƒì„ ì´ìš©í•´<br />
6ë²ˆ, ë°›ì€ ì •ë³´ë¥¼ ì´ìš©í•´ UserDetails ê°ì²´ë¥¼ ë°˜í™˜ë§Œ ì‹œì¼œì£¼ë©´<br />
ê·¸ ì´í›„ëŠ” 7ë²ˆ ë¶€í„° Spring Securityê°€ ì•Œì•„ì„œ ì§„í–‰ì‹œì¼œì¤€ë‹¤.</p>

<p>ì´ë¥¼ í† ëŒ€ë¡œ ìœ„ì— í”„ë¡œê·¸ë¨ì„ ì‘ì„±í•´ ë†“ì€ ê²ƒì„ ë³´ë©´<br />
ì˜¤ë²„ë¼ì´ë”©í•œ loadUserByUsername ë©”ì„œë“œë¥¼ í†µí•´ì„œ<br />
usernameì„ ë§¤ê°œë³€ìˆ˜ë¡œ ì •ë³´ë¥¼ ë°›ëŠ”ë‹¤.<br />
í•´ë‹¹ ì •ë³´ë¡œ DBë¥¼ ì¡°íšŒí•œë‹¤ìŒ, UserDetails ê°ì²´ë¥¼ ë°˜í™˜ì‹œì¼œì£¼ëŠ” í”„ë¡œê·¸ë¨ì´ë‹¤.</p>

<p><br /></p>

<p><strong><span style="color:#0066CC"> ìœ„ì˜ ì–˜ê¸°ë¥¼ í•œë§ˆë””ë¡œ ì •ë¦¬ í•´ë³´ìë©´ !! </span></strong></p>

<p>UserDetailsService ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ë¥¼ ë§Œë“ ë‹¤.<br />
loadUserByUsername(); ë©”ì„œë“œë¥¼ ì˜¤ë²„ë¼ì´ë”©í•˜ì—¬ ë§¤ê°œë³€ìˆ˜ë¡œ username ì •ë³´ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤.<br />
usernameì •ë³´ë¥¼ ì´ìš©í•´ DBì— ì¡°íšŒë¥¼ í•œë‹¤.<br />
ì¡°íšŒí•œ ë°ì´í„°ë¥¼ í† ëŒ€ë¡œ UserDetails ê°ì²´ë¥¼ ë§Œë“¤ì–´ ë°˜í™˜ë§Œ ì‹œì¼œì£¼ë©´ ëœë‹¤.<br />
ì´í›„ëŠ” Spring Securityê°€ ì•Œì•„ì„œ í•´ì¤Œ</p>

<p><br /></p>

<h3 id="ì˜¤ëŠ˜-ë§Œë‚œ-error">ì˜¤ëŠ˜ ë§Œë‚œ ERROR</h3>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>***************************
APPLICATION FAILED TO START
***************************

Description:

Parameter 0 of constructor in com.codestates.member.MemberController required a single bean, but 2 were found:
	- inMemoryMemberService: defined by method 'inMemoryMemberService' in class path resource [com/codestates/config/JavaConfigurationV1.class]
	- dbMemberService: defined by method 'dbMemberService' in class path resource [com/codestates/config/JavaConfigurationV2.class]
</code></pre></div></div>
<p>ì˜¤ëŠ˜ í…ŒìŠ¤íŠ¸ ì¤‘ ë§Œë‚¬ë˜ ì—ëŸ¬ë‹¤. <br />
ë‚´ìš©ì€ MemberControllerì—ì„œ ì‹±ê¸€ë¹ˆì„ ìš”êµ¬í•œëŠ”ë° 2ê°œê°€ ìˆë‹¤ëŠ” ê²ƒ ê°™ì€ ë‚´ìš©ì´ë‹¤.<br />
ì¦‰, ê°™ì€ íƒ€ì…ì˜ ë¹ˆì´ ë‘ê°œê°€ ë“±ë¡ëœ ë¬¸ì œë¼ê³  ìƒê°í–ˆë‹¤.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Action:

Consider marking one of the beans as @Primary, updating the consumer to accept multiple beans, or using @Qualifier to identify the bean that should be consumed
</code></pre></div></div>
<p>ë°‘ì— ì•„ì£¼ì¹œì ˆí•˜ê²Œ @Primaryë‚˜  @Qualifierë¥¼ ì‚¬ìš©í•˜ë¼í•œë‹¤.</p>

<p><br /></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
*  InMemory ì‚¬ìš©ì„ ìœ„í•œ ë¹ˆì£¼ì…
* */</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JavaConfigurationV1</span> <span class="o">{</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">MemberService</span> <span class="nf">inMemoryMemberService</span><span class="o">(</span><span class="nc">UserDetailsManager</span> <span class="n">userDetailsManager</span><span class="o">,</span> <span class="nc">PasswordEncoder</span> <span class="n">passwordEncoder</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">InMemoryMemberService</span><span class="o">(</span><span class="n">userDetailsManager</span><span class="o">,</span><span class="n">passwordEncoder</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
*  DB ì‚¬ìš©ì„ ìœ„í•œ ë¹ˆì£¼ì…
* */</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JavaConfigurationV2</span> <span class="o">{</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">MemberService</span> <span class="nf">dbMemberService</span><span class="o">(</span><span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">,</span> <span class="nc">PasswordEncoder</span> <span class="n">passwordEncoder</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">DBMemberService</span><span class="o">(</span><span class="n">memberRepository</span><span class="o">,</span><span class="n">passwordEncoder</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>MemberControlerì—ì„œëŠ” MemberServiceë¥¼ DIë°›ê²Œ ì„¤ê³„í•´ë†“ì•˜ê³ </p>

<p>MemberServiceë¼ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ<br />
í´ë˜ìŠ¤ inMemoryMemberServie, DBMemberService ë‘ê°œë¥¼<br />
ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ë ¤ê³  ì‹œë„í•˜ë‹ˆê¹Œ ë°œìƒí•œ ì•ŒëŒì¸ ê²ƒ ê°™ë‹¤.</p>

<p>ì—¬ê¸°ì„œ @Configurationì„ í•œêµ°ë°ë¥¼ ì§€ì›Œì£¼ë©´<br />
ì¤‘ë³µë˜ì§€ ì•Šê³  í•´ê²° í•  ìˆ˜ ìˆë‹¤.</p>

<p>í•˜ì§€ë§Œ ì½”ë“œëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ì‹¶ì—ˆê¸°ì—</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JavaConfigurationV2</span> <span class="o">{</span>
    <span class="nd">@Bean</span>
    <span class="nd">@Primary</span>
    <span class="kd">public</span> <span class="nc">MemberService</span> <span class="nf">dbMemberService</span><span class="o">(</span><span class="nc">MemberRepository</span> <span class="n">memberRepository</span><span class="o">,</span> <span class="nc">PasswordEncoder</span> <span class="n">passwordEncoder</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">DBMemberService</span><span class="o">(</span><span class="n">memberRepository</span><span class="o">,</span> <span class="n">passwordEncoder</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>JavaConfigurationV2ì— ë¹ˆë“±ë¡ ë©”ì„œë“œì— @Primaryë¥¼ ì´ìš©í•´<br />
ë¹ˆì„ ì„ íƒí•´ ì£¼ì…í•´ì£¼ë„ë¡ ì •í–ˆë‹¤.</p>

<hr />

<p>ì˜¤ëŠ˜ì€ ì´ë ‡ê²Œ ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì˜ ê¸°ë³¸ì ì¸<br />
ì‚¬ìš©ë°©ë²•ì„ ì•Œì•„ë³´ì•˜ë‹¤.</p>

<p>ë‚´ë¶€ì ìœ¼ë¡œ ì´ë£¨ì–´ì§€ëŠ” ì‘ì—…ë“¤ì´ ë§ì•„ ì •í™•í•œ<br />
íë¦„ì´ ê°ì´ ì¡íˆì§ˆ ì•ŠëŠ” ê²ƒ ê°™ë‹¤.<br />
ê¸€ì„ ì ìœ¼ë©´ì„œë„ ë‚´ê°€ ì •í™•íˆ ì´í•´í•œê²Œ ë§ëŠ”ì§€ ìˆ˜ì‹­ë²ˆì„ ëŒì•„ê°€ì„œ í™•ì¸í•˜ê³  ë°˜ë³µí–ˆë‹¤. <br />
í™•ì¸í–ˆë‹¤ê³  í•œë“¤â€¦ ì •í™•í•œ ì •ë³´ë¥¼ ì ì€ ê²ƒ ê°™ì§€ ì•Šì€ ëŠë‚Œì´ë“ ë‹¤.<br />
ê³„ì† ìµìˆ™í•´ì§€ê²Œ ì‚¬ìš©í•´ë³´ë©´ì„œ ì‚¬ìš©ë²•ì— ìµìˆ™í•´ì ¸ë³´ì</p>

<p>ì˜¤ëŠ˜ê³µë¶€ëŠ” ì—¬ê¸°ì„œ ë !!</p>

<p><br /></p>

<p><span style="color:#994C00"><strong>ì˜¤ëŠ˜ì˜ ì»¤í”¼ëŸ‰</strong></span>: â˜•ï¸ â˜•ï¸<br />
<strong>ì˜¤ëŠ˜ì˜ ì ì‹¬</strong>: ì§œì¥ë©´, íƒ•ìˆ˜ìœ¡</p>]]></content><author><name>LEE JAEHYEOK</name></author><category term="TIL" /><category term="TIL" /><category term="ë¶€íŠ¸ìº í”„" /><category term="ì½”ë“œìŠ¤í…Œì´ì¸ " /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">TIL) ì¸ì¦, ë³´ì•ˆ ê¸°ì´ˆ</title><link href="http://localhost:4000/til/2022/11/17/til.html" rel="alternate" type="text/html" title="TIL) ì¸ì¦, ë³´ì•ˆ ê¸°ì´ˆ" /><published>2022-11-17T00:00:00+09:00</published><updated>2022-11-17T00:00:00+09:00</updated><id>http://localhost:4000/til/2022/11/17/til</id><content type="html" xml:base="http://localhost:4000/til/2022/11/17/til.html"><![CDATA[<p>ì˜¤ëŠ˜ì€ ë“œë””ì–´<br />
ì¸ì¦ê³¼ ë³´ì•ˆê´€ë ¨ëœ ê³µë¶€ê°€ ì‹œì‘ë˜ì—ˆë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AJc5JmSK7Vlbd6P-ZA2TpRO9yTFxz9gH-OdxjYebZ6-r_KUFyGQiml5Hx8m6WodAQFCprhzYPGAg5SXnE-TkysLMqq-BedG44A=w1920-h864" alt="image" class="align-left" style="max-width: 50%" /></p>

<p>Spring Security, JWT, OAuth2 ë“±<br />
ì—¬ëŸ¬ê°€ì§€ë¥¼ ë°°ìš¸ ì˜ˆì •ì´ê³ </p>

<p>ê°€ì¥ ê³ ì „í•˜ëŠ” ì˜ì—­ì´ì§€ ì•Šì„ê¹Œ ìƒê°í•œë‹¤.</p>

<hr />

<p>ì˜¤ëŠ˜ì€ ì¸ì¦, ë³´ì•ˆì— ëŒ€í•œ ê¸°ì´ˆë¥¼ ë¨¼ì € íŒŒì•…í•˜ê³ <br />
ë‚´ì¼ë¶€í„° ë³¸ê²©ì ì¸ Spring Security ì‚¬ìš©ë²•ì„ ì•Œì•„ë³¼ ê²ƒ ê°™ë‹¤.<br />
ì˜¤ëŠ˜ì€ ê¸°ì´ˆì¸ HTTPSì™€ Hashing, Cookie, Sessionì— ëŒ€í•´ ì•Œì•„ë³´ì</p>

<p><br /></p>

<h3 id="https">HTTPS</h3>

<p>ìš°ë¦¬ê°€ ì—¬íƒœê¹Œì§€ ë°°ì› ê¸°ë¥¼ HTTP í”„ë¡œí† ì½œì„ ì´ìš©í•´<br />
TCP/IP í†µì‹ ìœ¼ë¡œ ì„œë²„ì™€ ì—°ê²°í•  ìˆ˜ ìˆë‹¤ê³  ê³µë¶€ë¥¼ í–ˆì—ˆë‹¤.<br />
HTTP Messageë¥¼ í†µí•´ Json ê°ì²´ë¥¼ ë°›ì•„ë³´ê¸°ë„ í•˜ì˜€ë‹¤.</p>

<p>HTTPSì˜ Hyper Text Transfer Protocol Secure Socket layerì˜ ì•½ìë‹¤. <br />
ë³´ë©´ ì•Œ ìˆ˜ ìˆë“¯ì´ ê¸°ì¡´ì˜ <strong>HTTP + Secure Socket layer</strong>ê°€ ë¶™ì€ ëª¨ìŠµì´ë‹¤.<br />
HTTP í”„ë¡œí† ì½œì„ ë³´ë‹¤ ì•ˆì „í•˜ê²Œ ìš”ì²­ì„ ì£¼ê³  ë°›ê¸°ìœ„í•´ SSL, TLSë¼ëŠ” ì•Œê³ ë¦¬ì¦˜ì„ ì´ìš©í•´ <br />
HTTP í†µì‹ ì„ í•˜ëŠ” ê³¼ì •ì—ì„œ ë°ì´í„°ë¥¼ ì•”í˜¸í™”í•˜ì—¬ ì „ì†¡í•˜ëŠ” ë°©ë²•ì´ë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AJc5JmQ7kg8wBa9J9dzD10tI68mzIX9M97wYHvAyH-tNw-vTeDL5V8vTsTeX3a_QiO7FnYOL0DMp_w7JRIh9Jt27wXdEgUoDiw=w1510-h1614" alt="image" class="align-left" style="max-width: 100%" /><br />
HTTPS TLS HandShake (ì¶œì²˜: <a href="https://www.cloudflare.com/ko-kr/learning/ssl/what-happens-in-a-tls-handshake">CLOUDFLARE ì‚¬ì´íŠ¸ ì°¸ì¡°</a> )</p>

<p>í•´ë‹¹ ê·¸ë¦¼ì€ HTTPSì˜ í†µì‹  í•¸ë“œì‰ì´í¬ì´ë‹¤. <br />
í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì ‘ì†ìš”ì²­ì´ ì™”ì„ ë•Œ, ë‚´ë¶€ì ìœ¼ë¡œ í†µì‹ ì´ë˜ì–´ì§€ëŠ” ìˆœì„œì´ë‹¤.</p>

<p>TCP ì—°ê²°ì´ ì™„ë£Œí›„ TLS í•¸ë“œì‰ì´í¬ê°€ ë™ì‘í•˜ëŠ” ëª¨ìŠµì„ ë³¼ ìˆ˜ ìˆê³ <br />
TLS í•¸ë“œì‰ì´í¬ ë‚´ì—ì„œëŠ” ì¸ì¦ì„œ, ëŒ€ì¹­í‚¤, ë¹„ëŒ€ì¹­í‚¤ì™€ ê°™ì€ ì•”ë³µí˜¸ë¥¼ í†µí•´<br />
ì¸ì¦ëœ ì„œë²„ì— ì ‘ì†ì„ í•  ìˆ˜ ìˆê²Œ í™•ì¸ì„ í•´ì¤€ë‹¤.</p>

<p>ì •ë§ ê°„ë‹¨í•˜ê²Œ ì •ë¦¬í•´ë³´ìë©´</p>

<p><strong><span style="color:#F04965">ëŒ€ì¹­í‚¤ </span>: í‚¤ í•œê°œë¡œ ì•”ë³µí˜¸ë¥¼ í•œë‹¤.</strong><br />
<strong><span style="color:#F04965">ë¹„ëŒ€ì¹­í‚¤</span> : ì•”í˜¸í™”í•œ í‚¤ì™€ ë³µí˜¸í™”í•œí‚¤ê°€ ë‹¤ë¥´ë‹¤.</strong></p>

<p>í‚¤ì˜ ì¢…ë¥˜ë¡œëŠ” <strong>ê³µê°œí‚¤(Public Key)</strong>ì™€ <strong>ê°œì¸í‚¤(Private Key)</strong>ê°€ ì¡´ì¬í•˜ê³ </p>

<p>ëŒ€ì¹­í‚¤ ê°™ì€ê²½ìš°ì—ëŠ” ê³µê°œí‚¤-ê³µê°œí‚¤, ê°œì¸í‚¤-ê°œì¸í‚¤ë¡œ ì•”í˜¸í™” ë³µí˜¸í™”ë¥¼ í•  ìˆ˜ ìˆê³ <br />
ë¹„ëŒ€ì¹­í‚¤ ê°™ì€ ê²½ìš°ì—ëŠ” ê³µê°œí‚¤-ê°œì¸í‚¤, ê°œì¸í‚¤-ê³µê°œí‚¤ë¡œ ì•”í˜¸í™” ë³µí˜¸í™”ë¥¼ í•  ìˆ˜ ìˆë‹¤.<br />
HTTPS TLS í•¸ë“œì‰ì´í¬ëŠ” ëŒ€ì¹­í‚¤,ë¹„ëŒ€ì¹­í‚¤ë¥¼ ë‘˜ë‹¤ ì‚¬ìš©í•œë‹¤.</p>

<p>ì—¬ê¸°ì„œ ë¹„ëŒ€ì¹­í‚¤ ê°™ì€ ê²½ìš°ì—ëŠ”<br />
ê°œì¸í‚¤ë¡œ ì•”í˜¸í™”í•œê²ƒì„ ê³µê°œí‚¤ë¡œ ë³µí˜¸í™”í•  ìˆ˜ ìˆëŠ”ë°, ëª©ì ì€ ì¸ì¦ì„œê°™ì€ ëˆ„êµ¬ë‚˜ ë³¼ ìˆ˜ ìˆëŠ” ì •ë³´ê³ <br />
ê³µê°œí‚¤ë¡œ ì•”í˜¸í™”í•œê²ƒì„ ê°œì¸í‚¤ë¡œ ë³µí˜¸í™”í•  ìˆ˜ ìˆëŠ”ë°, ëª©ì ì€ ì •ë³´ë³´í˜¸ì™€ ì™¸ë¶€ì˜ íƒˆì·¨ë°©ì§€ë¥¼ ìœ„í•œ ê²ƒì´ë‹¤.</p>

<p>ì—¬ê¸°ì„œ <strong>ì¸ì¦ì„œ</strong>ë¼ëŠ” ê°œë…ì´ë‚˜ì˜¤ëŠ”ë°<br />
ì´ëŸ¬í•œ ì¸ì¦ì„œì˜ ì—­í• ì€ ì„œë²„ì—ì„œ ì¸ì¦ì„œë¥¼ ë¸Œë¼ìš°ì €ì—ê²Œ ë³´ë‚´ì£¼ëŠ”ë°<br />
í´ë¼ì´ì–¸íŠ¸ì— ì ‘ì†í•œ ê³³ì´ ì •ë§ í•´ë‹¹ ì„œë²„ì™€ ì¼ì¹˜í•˜ëŠ”ì§€ ë³´ì¦í•´ì£¼ëŠ” ì¥ì¹˜ì´ë‹¤.<br />
ì´ëŸ¬í•œ ì¸ì¦ì„œë¥¼ ê´€ë¦¬í•´ì£¼ëŠ” ê³µì¸ëœ ê¸°ê´€ë“¤ì„<br />
Certificate Authority ë¼ê³ í•˜ë©° ëŒ€í‘œì ìœ¼ë¡œ AWSê°€ ìˆë‹¤.</p>

<p>TLS í•¸ë“œì‰ì´í¬ë¥¼ ì •ë¦¬í•´ë³´ìë©´</p>

<ol>
  <li>Client -&gt; Serverì—ê²Œ í—¬ë¡œ ìš”ì²­</li>
  <li>Server -&gt; Client ì¸ì¦ì„œë¥¼ í¬í•¨í•´ì„œ í—¬ë¡œ ì‘ë‹µ (ê°œì¸í‚¤ë¡œ ì•”í˜¸í™”í•˜ì—¬ ì „ë‹¬)</li>
  <li>ClientëŠ” ë‚´ì¥ëœ CA ë¦¬ìŠ¤íŠ¸ë¥¼ ë³´ê³  ì¸ì¦ì„œë¥¼ í™•ì¸í•œë‹¤. (ê°œì¸í‚¤-&gt;ê³µê°œí‚¤ ë³µí˜¸í™”)</li>
  <li>Clientê°€ CAì˜ ê³µê°œí‚¤ë¡œ ë³µí˜¸í™”ë¥¼ í†µí•´ ì¸ì¦ì„œë¥¼ ê²€ì¦í–ˆë‹¤ë©´ ClientëŠ” ëŒ€ì¹­í‚¤ë¥¼ ë§Œë“ ë‹¤.</li>
  <li>ì´ ëŒ€ì¹­í‚¤ë¥¼ ì„œë²„ì˜ ê³µê°œí‚¤ë¡œ ì•”í˜¸í™”í•´ì„œ Client -&gt; Serverì— ì „ë‹¬í•œë‹¤.</li>
  <li>ê·¸ëŸ¼ ServerëŠ” ì„œë²„ì˜ ê°œì¸í‚¤ë¡œ ë³µí˜¸í™”í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì˜ ëŒ€ì¹­í‚¤ë¥¼ í™•ì¸í•œë‹¤. (ê³µê°œí‚¤-&gt;ê°œì¸í‚¤ ë³µí˜¸í™”)</li>
  <li>Server -&gt; Clientì˜ ëŒ€ì¹­í‚¤ë¡œ ìƒ˜í”Œ ë°ì´í„°ë¥¼ ì•”í˜¸í™”í•´ì„œ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë³´ë‚´ì„œ í™•ì¸í•œë‹¤.</li>
  <li>ClientëŠ” ì„œë²„ì—ê²Œ ë°›ì€ ë°ì´í„°ë¥¼ ëŒ€ì¹­í‚¤ë¡œ ë³µí˜¸í™”í•´ì„œ ì„œë¡œ ëŒ€ì¹­í‚¤ë¥¼ ì˜ ê°€ì§€ê³  ìˆëŠ”ì§€ í™•ì¸í•œë‹¤</li>
  <li>ì´ í›„ì—ëŠ” Clientì™€ ServerëŠ” ì„œë¡œ ëŒ€ì¹­í‚¤ë¡œ ì•”í˜¸í™”ì™€ ë³µí˜¸í™”ë¥¼ ì§„í–‰í•˜ì—¬ ë°ì´í„°ë¥¼ ì „ì†¡í•œë‹¤</li>
</ol>

<p>ì‚¬ì‹¤ ì´ëŸ° ì¼ë ¨ì˜ ê³¼ì •ë“¤ì€<br />
ë¸Œë¼ìš°ì €ì™€ ì„œë²„ê°€ í•´ë‹¹ ê³¼ì •ì„ ëŒ€ì‹  ì²˜ë¦¬í•´ì£¼ê¸° ë•Œë¬¸ì—<br />
ê°œë…ê³¼ ìˆœì„œì •ë„ë§Œ ì´í•´í•˜ë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤.</p>

<p><br /></p>

<h4 id="ë¡œì»¬-í™˜ê²½ì—ì„œ-í…ŒìŠ¤íŠ¸">ë¡œì»¬ í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸</h4>
<p>ê·¸ëŸ¼ ë¡œì»¬í™˜ê²½ì—ì„œ ì¸ì¦ì„œ ë°œê¸‰ê³¼ <br />
Https ì„œë²„ë¥¼ êµ¬í˜„í•˜ëŠ” ê°„ë‹¨í•œ ì˜ˆì œë¥¼ ì‚´í´ë³´ì</p>

<p>ìš°ì„  Tomcat WASë¥¼ ì‚¬ìš©í•˜ê¸°ìœ„í•´<br />
ìŠ¤í”„ë§ë¶€íŠ¸ë¡œ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ì—ˆê³ </p>

<p>ë¡œì»¬í™˜ê²½ì—ì„œ ì¸ì¦ì„œë¥¼ ë§Œë“¤ê¸°ìœ„í•´ í„°ë¯¸ë„ë¡œ mkcertë¥¼ ì„¤ì¹˜í•´ì•¼í•œë‹¤.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>mkcert
</code></pre></div></div>
<p>homebrewë¥¼ ì´ìš©í•´ mkcert ì„¤ì¹˜</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkcert <span class="nt">-install</span>
</code></pre></div></div>
<p>PKCS12 í˜•ì‹ ì¸ì¦ì„œë¥¼ ìƒì„±í•  ìˆ˜ ìˆë„ë¡ ì„¤ì¹˜</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkcert <span class="nt">-pkcs12</span> localhost
</code></pre></div></div>
<p>ë‚´ê°€ ë§Œë“  í”„ë¡œì íŠ¸ resources ê²½ë¡œì—ì„œ<br />
ìœ„ì˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰ì‹œì¼œ PKCS12 ì¸ì¦ì„œë¥¼ ìƒì„±í•´ì£¼ë©´</p>

<p><br /></p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AJc5JmSGGxmFhNDI5InKLm5xBczg_DBOgwK4OJj_PGLONuWvOCIyDPyNnQBHZR2LmGmp5KEwzXwK3MxI2-ryG8RDepbN8HRYxw=w3024-h1614" alt="image" class="align-left" style="max-width: 50%" /></p>

<p>ìœ„ì™€ ê°™ì´ resourcesì— <br />
localhost.p12 ì¸ì¦ì„œê°€ ìƒê¸´ë‹¤.</p>

<p>ì¸ì¦ì„œê°€ ìƒê²¼ë‹¤ë©´ application.properties ì•ˆì—</p>
<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">server.ssl.key-store</span><span class="p">=</span><span class="s">classpath:localhost.p12</span>
<span class="py">server.ssl.key-store-type</span><span class="p">=</span><span class="s">PKCS12</span>
<span class="py">server.ssl.key-store-password</span><span class="p">=</span><span class="s">changeit</span>
</code></pre></div></div>
<p>ì™€ ê°™ì´ ì…ë ¥í•´ì£¼ë©´ httpsë¡œ ì„œë²„ë¥¼ ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤.<br />
ì—¬ê¸°ì„œ ë¹„ë°€ë²ˆí˜¸ëŠ” ì´ˆê¸°í•´ ì…‹íŒ…ì„ í•˜ì§€ì•Šìœ¼ë©´ changeitìœ¼ë¡œ ì…ë ¥í•˜ë©´ëœë‹¤.</p>

<p>ê·¸ë¦¬ê³  ìŠ¤í”„ë§ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰ì‹œí‚¤ë©´</p>

<p><img src="https://lh3.googleusercontent.com/u/0/drive-viewer/AJc5JmThmekJqkRGtjmJemxwLYuP9uTAyLwsOWuvrxTqsdCdOtk4pnyAXTjmlQ8MrR_5PaU4rYOu8DZll_u-Qvzy1E2s4UGW7A=w3024-h1614" alt="image" class="align-left" style="max-width: 100%" /></p>

<p>ì‚¬ì§„ê³¼ ê°™ì´ httpsë¡œ ì„œë²„ êµ¬í˜„ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<p><br /></p>

<h3 id="hasing">Hasing</h3>
<p>ì–´ë–¤í•œ ë¬¸ìì—´ì— ì„ì˜ì˜ ì—°ìƒì„ ì ìš©í•˜ì—¬ <br />
ë‹¤ë¥¸ ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ëŠ” ê²ƒì„ Hasingì´ë¼ê³  í•œë‹¤.</p>

<p>ì¦‰, í•´ì‹±í•œë‹¤ëŠ” ì˜ë¯¸ëŠ” ì–´ë– í•œ ê°’ì„ ì•”í˜¸í™”í•´ì¤€ë‹¤ ìƒê°í•˜ë©´ ë  ê²ƒ ê°™ë‹¤.<br />
ì—¬ê¸°ì„œ í•´ì‹±ì˜ íŠ¹ì§•ì„ ì ì–´ë³´ìë©´</p>

<ol>
  <li>ëª¨ë“  ê°’ì— ëŒ€í•œ í•´ì‹œê°’ì„ ê³„ì‚°í•˜ëŠ”ë° ì˜¤ë˜ê±¸ë¦¬ì§€ ì•Šì•„ì•¼í•œë‹¤.</li>
  <li>ìµœëŒ€í•œ í•´ì‹œê°’ì„ í”¼í•´ì•¼ í•˜ë©°, ëª¨ë“  ê°’ì€ ê³ ìœ í•œ í•´ì‹œê°’ì„ ê°€ì§„ë‹¤.</li>
  <li>ì•„ì£½ ì‘ì€ ë‹¨ìœ„ì˜ ë³€ê²½ì´ë¼ë„ ì™„ì „íˆ ë‹¤ë¥¸ í•´ì‹œê°’ì„ ê°€ì ¸ì•¼í•œë‹¤.</li>
</ol>

<h3 id="salt">Salt</h3>
<p>ì•”í˜¸í™”í•´ì•¼ í•˜ëŠ” ê°’ì— ì–´ë–¤ ë³„ë„ì˜ ê°’ì„ ì¶”ê°€í•˜ì—¬ ê²°ê³¼ë¥¼ ë³€í˜•í•˜ëŠ” ê²ƒì´ë‹¤.<br />
ì˜ì–´ë¡œ ì†Œê¸ˆì´ë¼ëŠ” ëœ»ê³¼ ê±¸ë§ê²Œ ë¬´ì–¸ê°€ ê°„ì„ì¹˜ëŠ” ëŠë‚Œì´ë¼ ìƒê°í•˜ë©´ ë  ê²ƒ ê°™ë‹¤.</p>

<p>Saltì˜ í° íŠ¹ì§•ì„ 4ê°€ì§€ ì‚´í´ë³´ë©´</p>

<ol>
  <li>ìœ ì €ì™€ íŒ¨ìŠ¤ì›Œë“œ ë³„ë¡œ ìœ ì¼í•œ ê°’ì„ ê°€ì ¸ì•¼ í•œë‹¤.</li>
  <li>ì‚¬ìš©ì ê³„ì •ì„ ìƒì„±í•  ë•Œì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•  ë•Œ ë§ˆë‹¤ ìƒˆë¡œìš´ ì„ì˜ì˜ Saltë¥¼ ì‚¬ìš©í•´ì„œ í•´ì‹±í•´ì•¼ í•œë‹¤.</li>
  <li>ì ˆëŒ€ ì¬ì‚¬ìš©í•˜ì§€ ë§ì•„ì•¼í•œë‹¤.</li>
  <li>DBì˜ ìœ ì €í…Œì´ë¸”ì— ê°™ì´ ì €ì¥ ë˜ì–´ì•¼í•œë‹¤.</li>
</ol>

<h3 id="cookie">Cookie</h3>

<p>ì¿ í‚¤ëŠ” ì„œë²„ê°€ ì›¹ ë¸Œë¼ìš°ì €ì— ì •ë³´ë¥¼ ì €ì¥í•˜ê³  ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆëŠ” ìˆ˜ë‹¨<br />
ì´ë¼ê³  ìƒê°í•˜ë©´ ê°„ë‹¨í•  ê²ƒ ê°™ë‹¤.</p>

<p>ìš°ë¦¬ê°€ ì´ì „ì— ë°°ìš´ Http í”„ë¡œí† ì½œì€<br />
ë¬´ìƒíƒœì„±(stateless)ì€ ì´ì „ì— í–ˆë˜ ì‘ì—…ì— ëŒ€í•´ ê¸°ì–µí•˜ì§€ ì•ŠëŠ” íŠ¹ì„±ì„ ê°€ì§€ëŠ”ë°<br />
ê²€ìƒ‰ì„ í•˜ë ¤ëŠ”ë° ê²€ìƒ‰ëª©ë¡ì´ ì•„ë˜ í‘œì‹œëœë‹¤ë“ ì§€<br />
ë¡œê·¸ì¸ ê¸°ì–µë²„íŠ¼ì„ ëˆŒëŸ¬ë†“ì•˜ëŠ”ë° ë‹¤ìŒì— ì—´ì–´ë„ ëˆŒë ¤ì ¸ìˆë‹¤ë“ ì§€<br />
ìš°ë¦¬ëŠ” ìš”ì²­ì„ ë³´ë‚¼ë•Œ ë¬´ìƒíƒœì„±ìœ¼ë¡œ ë™ì‘í•˜ê¸°ë•Œë¬¸ì— ì´ëŸ¬í•œ ë‚´ìš©ë“¤ì„ ê¸°ì–µí•˜ì§€ ëª» í•˜ëŠ”ë°<br />
ë¸Œë¼ìš°ì €ì—ì„œ ì¿ í‚¤ë¼ëŠ” ê²ƒì„ ì´ìš©í•´ ì´ëŸ¬í•œ ë‚´ìš©ë“¤ì„ ì €ì¥í•´ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤.</p>

<p>í•œë§ˆë””ë¡œ ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìš”ì²­ì„ ë°›ê³ <br />
í´ë¼ì´ì–¸íŠ¸ìª½ì— ì‘ë‹µí• ë•Œ ì¿ í‚¤ì— ë°ì´í„°ë¥¼ ì‹¦ì–´ì„œ ë³´ë‚´ë©´<br />
ë¸Œë¼ìš°ì €ì—ì„œ ì¿ í‚¤ê°’ì„ ìœ ì§€ì‹œí‚¤ê³  ì‚¬ìš©í•œë‹¤ê³  ë³´ë©´ë  ê²ƒ ê°™ë‹¤.</p>

<p>ì¿ í‚¤ì˜ ì˜µì…˜ìœ¼ë¡œëŠ”</p>

<p>domain - ì„œë²„ì™€ ìš”ì²­ì˜ ë„ë©”ì¸ì´ ì¼ì¹˜í•˜ëŠ” ê²½ìš° ì¿ í‚¤ ì „ì†¡<br />
path - ì„œë²„ì˜ ìš”ì²­ì˜ ì„¸ë¶€ ê²½ë¡œê°€ ì¼ì¹˜í•˜ëŠ” ê²½ìš° ì¿ í‚¤ ì „ì†¡<br />
maxage/expires - ì¿ í‚¤ì˜ ìœ íš¨ê¸°ê°„ ì„¤ì •<br />
httpOnly - ìŠ¤í¬ë¦½íŠ¸ì˜ ì¿ í‚¤ ì ‘ê·¼ ê°€ëŠ¥ ì—¬ë¶€ ì„¤ì •<br />
secure - HTTPS ì—ì„œë§Œ ì¿ í‚¤ ì „ì†¡ ì—¬ë¶€ ì„¤ì •<br />
sameSite - ê°™ì€ ì‚¬ì´íŠ¸ì—ì„œë§Œ ì¿ í‚¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ì„¤ì •</p>

<h3 id="session">Session</h3>

<p>ì„¸ì…˜ì€ ì¸ì¦í•´ì£¼ëŠ” ë°©ë²•ìœ¼ë¡œ<br />
ì—¬ëŸ¬ í˜ì´ì§€ì— ê±¸ì³ ì‚¬ìš©ë˜ëŠ” ì‚¬ìš©ì ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” ë°©ë²•ì´ë‹¤.</p>

<p>ì„¸ì…˜ì€ ì¤‘ìš”í•œ ë°ì´í„°ë¥¼ ì„œë²„ì— ì €ì¥í•˜ê³  ì•”í˜¸í™”ëœ<br />
ì„¸ì…˜idë¥¼ ì¿ í‚¤ì— ë‹´ì•„ í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬í•˜ê³ <br />
ì„¸ì…˜idê°€ ë¶€ì—¬ëœ ë¸Œë¼ìš°ì €ëŠ” ì‹ ë¶„ì¦ê°™ì´ ì´ë¥¼ ì´ ìœ ì €ëŠ” ì¸ì¦ì— ì„±ê³µí–ˆë‹¤ê³  ì•Œë¦¬ë©°<br />
ë‹¤ë¥¸ ìš”ì²­ì„ ë³´ë‚¼ë•Œ ë§ˆë‹¤ í•´ë‹¹ ì„¸ì„ idë¡œ ì¸ì¦ì„ ê±°ì¹˜ë©° ì‚¬ìš©í•  ìˆ˜ ìˆê²Œëœë‹¤.</p>

<p><br />
<br /></p>

<p><strong>ì¿ í‚¤ì™€ ì„¸ì…˜ì˜ ë¹„êµ</strong></p>

<table>
  <thead>
    <tr>
      <th>Â </th>
      <th style="text-align: center">Cookie</th>
      <th style="text-align: center">Seesion</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ì„¤ëª…</td>
      <td style="text-align: center">ì¿ í‚¤ëŠ” ê·¸ì € httpì˜ stateless<br />í•œ ê²ƒì„ ë³´ì™„í•´ì£¼ëŠ” ë„êµ¬</td>
      <td style="text-align: center">ì ‘ì† ìƒíƒœë¥¼ ì„œë²„ê°€ ê°€ì§<br /> ì ‘ì† ìƒíƒœì™€ ê¶Œí™˜ ë¶€ì—¬ë¥¼ ìœ„í•´<br />ì„¸ì…˜ì•„ì´ë””ë¥¼ ì¿ í‚¤ë¡œ ì „ì†¡</td>
    </tr>
    <tr>
      <td>ì ‘ì† ìƒíƒœ<br />ì €ì¥ ê²½ë¡œ</td>
      <td style="text-align: center">í´ë¼ì´ì–¸íŠ¸</td>
      <td style="text-align: center">ì„œë²„</td>
    </tr>
    <tr>
      <td>ì¥ì </td>
      <td style="text-align: center">ì„œë²„ì— ë¶€ë‹´ì„ ëœì–´ì¤Œ</td>
      <td style="text-align: center">ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ìœ ì €ì¸ì§€ ì„œë²„ì—ì„œ í™•ì¸</td>
    </tr>
    <tr>
      <td>ë‹¨ì </td>
      <td style="text-align: center">ì¿ í‚¤ ê·¸ìì²´ëŠ” ì¸ì¦ì´ ì•„ë‹˜</td>
      <td style="text-align: center">í•˜ë‚˜ì˜ ì„œë²„ì—ì„œë§Œ ì ‘ì† ìƒíƒœë¥¼ ê°€ì§€ë¯€ë¡œ <br />ì„œë²„ë¶„ì‚°ì— ë¶ˆë¦¬</td>
    </tr>
  </tbody>
</table>

<p><br /></p>

<hr />

<p>ì˜¤ëŠ˜ì€ ì´ë ‡ê²Œ ì¸ì¦, ë³´ì•ˆì— ê´€í•œ <br />
ê°„ë‹¨í•œ CS ì§€ì‹ë“¤ì„ ê³µë¶€í•´ë³´ì•˜ëŠ”ë°<br />
ì‚¬ì‹¤ ì²˜ìŒ ë“£ëŠ” ê°œë…ë“¤ì´ë¼ ì•„ì§ ì–´ë–»ê²Œ ì“°ì´ëŠ”ì§€ ê°ì„ ì¡ê¸°ê°€ ì–´ë µë‹¤.</p>

<p>ì´ëŸ¬í•œ ê²ƒë“¤ì´ ìˆê³  í›„ì— í•™ìŠµí•˜ë©´ì„œ<br />
ì´ë ‡ê²Œ ì‚¬ìš©í•˜ëŠ”êµ¬ë‚˜ë¥¼ ê¹¨ë‹«ê³  ë‚´ê²ƒìœ¼ë¡œ ì²´ë“ì„ í•´ì•¼í•  ê²ƒ ê°™ë‹¤.</p>

<p>ì˜¤ëŠ˜ ê³µë¶€ëŠ” ì—¬ê¸°ì„œ ë !</p>

<p><br /></p>

<p><span style="color:#994C00"><strong>ì˜¤ëŠ˜ì˜ ì»¤í”¼ëŸ‰</strong></span>: â˜•ï¸ â˜•ï¸<br />
<strong>ì˜¤ëŠ˜ì˜ ì ì‹¬</strong>: ë¼ë©´, ê¹€ë°¥</p>]]></content><author><name>LEE JAEHYEOK</name></author><category term="TIL" /><category term="TIL" /><category term="ë¶€íŠ¸ìº í”„" /><category term="ì½”ë“œìŠ¤í…Œì´ì¸ " /><summary type="html"><![CDATA[ì˜¤ëŠ˜ì€ ë“œë””ì–´ ì¸ì¦ê³¼ ë³´ì•ˆê´€ë ¨ëœ ê³µë¶€ê°€ ì‹œì‘ë˜ì—ˆë‹¤.]]></summary></entry></feed>